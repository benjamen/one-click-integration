{"version":3,"file":"OAuthCallback-BEqMW0Gr.js","sources":["../../../../frontend/src/pages/OAuthCallback.vue"],"sourcesContent":["<template>\r\n  <div class=\"oauth-callback-page flex items-center justify-center min-vh-100 bg-gradient-dark\">\r\n    <div class=\"container\">\r\n      <div class=\"flex justify-center\">\r\n        <div class=\"col-md-6\">\r\n          <div class=\"card shadow-lg\">\r\n            <div class=\"card-body p-5 text-center\">\r\n              <!-- Loading State -->\r\n              <div v-if=\"loading\">\r\n                <div class=\"spinner-border text-primary mb-3\" style=\"width: 3rem; height: 3rem;\" role=\"status\">\r\n                  <span class=\"visually-hidden\">Processing...</span>\r\n                </div>\r\n                <h4 class=\"font-bold mb-2\">Connecting your account</h4>\r\n                <p class=\"text-gray-600\">Please wait while we complete the authentication...</p>\r\n              </div>\r\n\r\n              <!-- Success State -->\r\n              <div v-else-if=\"success\">\r\n                <div class=\"icon icon-shape bg-gradient-success shadow-success mx-auto mb-4\" style=\"width: 80px; height: 80px;\">\r\n                  <i class=\"fas fa-check text-white\" style=\"font-size: 2rem;\"></i>\r\n                </div>\r\n                <h4 class=\"font-bold mb-2\">Successfully Connected!</h4>\r\n                <p class=\"text-gray-600 mb-4\">Your account has been linked successfully.</p>\r\n                <p class=\"text-sm text-gray-600\">This window will close automatically...</p>\r\n              </div>\r\n\r\n              <!-- Error State -->\r\n              <div v-else-if=\"error\">\r\n                <div class=\"icon icon-shape bg-gradient-danger shadow-danger mx-auto mb-4\" style=\"width: 80px; height: 80px;\">\r\n                  <i class=\"fas fa-times text-white\" style=\"font-size: 2rem;\"></i>\r\n                </div>\r\n                <h4 class=\"font-bold mb-2\">Connection Failed</h4>\r\n                <p class=\"text-gray-600 mb-4\">{{ error }}</p>\r\n                <button @click=\"closeWindow\" class=\"btn btn-primary\">\r\n                  Close Window\r\n                </button>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script setup>\r\nimport { ref, onMounted } from \"vue\"\r\nimport { createResource, call } from \"frappe-ui\"\r\nimport { useRoute } from \"vue-router\"\r\n\r\nconst route = useRoute()\r\nconst loading = ref(true)\r\nconst success = ref(false)\r\nconst error = ref(null)\r\n\r\n// OAuth callback resource\r\nconst oauthCallback = createResource({\r\n  url: \"lodgeick.api.oauth.oauth_callback\",\r\n  makeParams(values) {\r\n    return {\r\n      code: values.code,\r\n      state: values.state,\r\n      provider: values.provider\r\n    }\r\n  },\r\n  onSuccess(data) {\r\n    loading.value = false\r\n    success.value = true\r\n    // Close window after 2 seconds\r\n    setTimeout(() => {\r\n      window.close()\r\n    }, 2000)\r\n  },\r\n  onError(err) {\r\n    loading.value = false\r\n    error.value = err.message || \"Failed to complete OAuth flow\"\r\n  }\r\n})\r\n\r\nonMounted(async () => {\r\n  const code = route.query.code\r\n  const state = route.query.state\r\n\r\n  if (!code || !state) {\r\n    loading.value = false\r\n    error.value = \"Missing OAuth parameters (code or state)\"\r\n    return\r\n  }\r\n\r\n  // Get provider from state cache on backend\r\n  try {\r\n    const response = await call('lodgeick.api.oauth.get_provider_from_state', { state })\r\n    if (!response || !response.provider) {\r\n      loading.value = false\r\n      error.value = \"Could not retrieve provider from state\"\r\n      return\r\n    }\r\n\r\n    const provider = response.provider\r\n\r\n    // Now submit the OAuth callback with all parameters\r\n    oauthCallback.submit({\r\n      code,\r\n      state,\r\n      provider\r\n    })\r\n  } catch (err) {\r\n    loading.value = false\r\n    error.value = err.message || \"Failed to retrieve OAuth state\"\r\n  }\r\n})\r\n\r\nfunction closeWindow() {\r\n  window.close()\r\n}\r\n</script>\r\n\r\n<style scoped>\r\n.oauth-callback-page {\r\n  background: linear-gradient(310deg, #141727 0%, #3A416F 100%);\r\n}\r\n\r\n.bg-gradient-success {\r\n  background: linear-gradient(310deg, #17AD37 0%, #98EC2D 100%);\r\n}\r\n\r\n.bg-gradient-danger {\r\n  background: linear-gradient(310deg, #EA0606 0%, #FF667C 100%);\r\n}\r\n\r\n.shadow-success {\r\n  box-shadow: 0 4px 20px 0 rgba(23, 173, 55, 0.4) !important;\r\n}\r\n\r\n.shadow-danger {\r\n  box-shadow: 0 4px 20px 0 rgba(234, 6, 6, 0.4) !important;\r\n}\r\n\r\n.icon-shape {\r\n  border-radius: 0.75rem;\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n}\r\n\r\n</style>\r\n"],"names":["route","useRoute","loading","ref","success","error","oauthCallback","createResource","values","data","err","onMounted","__async","code","state","response","call","provider","closeWindow","_openBlock","_createElementBlock","_hoisted_1","_createElementVNode","_hoisted_2","_hoisted_3","_hoisted_4","_hoisted_5","_hoisted_6","_hoisted_7","_cache","_hoisted_8","_hoisted_9","_hoisted_10","_toDisplayString"],"mappings":"0rBAkDA,MAAMA,EAAQC,EAAQ,EAChBC,EAAUC,EAAI,EAAI,EAClBC,EAAUD,EAAI,EAAK,EACnBE,EAAQF,EAAI,IAAI,EAGhBG,EAAgBC,EAAe,CACnC,IAAK,oCACL,WAAWC,EAAQ,CACjB,MAAO,CACL,KAAMA,EAAO,KACb,MAAOA,EAAO,MACd,SAAUA,EAAO,QACvB,CACE,EACA,UAAUC,EAAM,CACdP,EAAQ,MAAQ,GAChBE,EAAQ,MAAQ,GAEhB,WAAW,IAAM,CACf,OAAO,MAAK,CACd,EAAG,GAAI,CACT,EACA,QAAQM,EAAK,CACXR,EAAQ,MAAQ,GAChBG,EAAM,MAAQK,EAAI,SAAW,+BAC/B,CACF,CAAC,EAEDC,EAAU,IAAYC,EAAA,sBACpB,MAAMC,EAAOb,EAAM,MAAM,KACnBc,EAAQd,EAAM,MAAM,MAE1B,GAAI,CAACa,GAAQ,CAACC,EAAO,CACnBZ,EAAQ,MAAQ,GAChBG,EAAM,MAAQ,2CACd,MACF,CAGA,GAAI,CACF,MAAMU,EAAW,MAAMC,EAAK,6CAA8C,CAAE,MAAAF,CAAK,CAAE,EACnF,GAAI,CAACC,GAAY,CAACA,EAAS,SAAU,CACnCb,EAAQ,MAAQ,GAChBG,EAAM,MAAQ,yCACd,MACF,CAEA,MAAMY,EAAWF,EAAS,SAG1BT,EAAc,OAAO,CACnB,KAAAO,EACA,MAAAC,EACA,SAAAG,CACN,CAAK,CACH,OAASP,EAAK,CACZR,EAAQ,MAAQ,GAChBG,EAAM,MAAQK,EAAI,SAAW,gCAC/B,CACF,EAAC,EAED,SAASQ,GAAc,CACrB,OAAO,MAAK,CACd,eAjHEC,EAAA,EAAAC,EAyCM,MAzCNC,EAyCM,CAxCJC,EAuCM,MAvCNC,EAuCM,CAtCJD,EAqCM,MArCNE,EAqCM,CApCJF,EAmCM,MAnCNG,EAmCM,CAlCJH,EAiCM,MAjCNI,EAiCM,CAhCJJ,EA+BM,MA/BNK,EA+BM,CA7BOzB,EAAA,WAAXkB,EAMM,MAAAQ,EAAA,CAAA,GAAAC,EAAA,CAAA,IAAAA,EAAA,CAAA,EAAA,CALJP,EAEM,MAAA,CAFD,MAAM,mCAAmC,MAAA,CAAA,MAAA,OAAA,OAAA,MAAA,EAAmC,KAAK,WACpFA,EAAkD,OAAA,CAA5C,MAAM,iBAAiB,EAAC,eAAa,OAE7CA,EAAuD,KAAA,CAAnD,MAAM,gBAAgB,EAAC,0BAAuB,EAAA,EAClDA,EAAgF,IAAA,CAA7E,MAAM,eAAe,EAAC,sDAAmD,EAAA,OAI9DlB,EAAA,WAAhBgB,EAOM,MAAAU,EAAA,CAAA,GAAAD,EAAA,CAAA,IAAAA,EAAA,CAAA,EAAA,+dAGUxB,EAAA,WAAhBe,EASM,MAAAW,EAAA,aARJT,EAEM,MAAA,CAFD,MAAM,gEAAgE,MAAA,CAAA,MAAA,OAAA,OAAA,MAAA,IACzEA,EAAgE,IAAA,CAA7D,MAAM,0BAA0B,MAAA,CAAA,YAAA,MAAA,UAErCO,EAAA,CAAA,IAAAA,EAAA,CAAA,EAAAP,EAAiD,KAAA,CAA7C,MAAM,gBAAgB,EAAC,oBAAiB,EAAA,GAC5CA,EAA6C,IAA7CU,EAA6CC,EAAZ5B,EAAA,KAAK,EAAA,CAAA,EACtCiB,EAES,SAAA,CAFA,QAAOJ,EAAa,MAAM,mBAAkB,gBAErD"}