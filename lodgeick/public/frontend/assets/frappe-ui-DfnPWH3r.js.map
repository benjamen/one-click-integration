{"version":3,"file":"frappe-ui-DfnPWH3r.js","sources":["../../../../frontend/node_modules/frappe-ui/src/utils/useId.ts","../../../../frontend/node_modules/frappe-ui/src/utils/debounce.ts","../../../../frontend/node_modules/frappe-ui/src/utils/config.ts","../../../../frontend/node_modules/frappe-ui/src/utils/dayjs.ts","../../../../frontend/node_modules/frappe-ui/src/components/Dialog/index.ts","../../../../frontend/node_modules/frappe-ui/src/utils/confirmDialog.js","../../../../frontend/node_modules/frappe-ui/src/components/TextEditor/extensions/image/image-extension.ts","../../../../frontend/node_modules/frappe-ui/src/composables/useTouchHandler.ts","../../../../frontend/node_modules/frappe-ui/src/composables/useImageNavigation.ts","../../../../frontend/node_modules/frappe-ui/src/composables/useZoomPan.ts","../../../../frontend/node_modules/frappe-ui/src/components/TextEditor/image-viewer-extension.ts","../../../../frontend/node_modules/frappe-ui/src/components/TextEditor/video-extension.ts","../../../../frontend/node_modules/frappe-ui/src/components/TextEditor/extensions/iframe/utils.ts","../../../../frontend/node_modules/frappe-ui/src/components/TextEditor/extensions/iframe/iframe-extension.ts","../../../../frontend/node_modules/frappe-ui/src/utils/url-validation.ts","../../../../frontend/node_modules/frappe-ui/src/components/TextEditor/linkPasteHandler.ts","../../../../frontend/node_modules/frappe-ui/src/components/TextEditor/link-extension.ts","../../../../frontend/node_modules/frappe-ui/src/components/TextEditor/extensions/shared/color-utils.ts","../../../../frontend/node_modules/frappe-ui/src/components/TextEditor/extensions/color/color-extension.ts","../../../../frontend/node_modules/frappe-ui/src/components/TextEditor/extensions/highlight/highlight-extension.ts","../../../../frontend/node_modules/frappe-ui/src/components/TextEditor/extensions/suggestion/createSuggestionExtension.ts","../../../../frontend/node_modules/frappe-ui/src/components/TextEditor/extensions/mention/mention-extension.ts","../../../../frontend/node_modules/frappe-ui/src/components/TextEditor/extensions/emoji/emoji-extension.ts","../../../../frontend/node_modules/frappe-ui/src/components/TextEditor/extensions/slash-commands/slash-commands-extension.ts","../../../../frontend/node_modules/frappe-ui/src/utils/markdown.ts","../../../../frontend/node_modules/frappe-ui/src/components/TextEditor/extensions/content-paste-extension.ts","../../../../frontend/node_modules/frappe-ui/src/components/TextEditor/extensions/tag/tag-extension.ts","../../../../frontend/node_modules/frappe-ui/src/components/TextEditor/extensions/heading/heading.ts","../../../../frontend/node_modules/frappe-ui/src/components/TextEditor/extensions/image-group/image-group-extension.ts","../../../../frontend/node_modules/frappe-ui/src/components/Toast/index.ts","../../../../frontend/node_modules/frappe-ui/src/components/Calendar/composables/useCalendarData.js","../../../../frontend/node_modules/frappe-ui/src/utils/call.js","../../../../frontend/node_modules/frappe-ui/src/utils/file-to-base64.ts","../../../../frontend/node_modules/frappe-ui/src/utils/pageMeta.ts","../../../../frontend/node_modules/frappe-ui/src/utils/request.js","../../../../frontend/node_modules/frappe-ui/src/resources/local.js","../../../../frontend/node_modules/frappe-ui/src/resources/resources.js","../../../../frontend/node_modules/frappe-ui/src/resources/realtime.js","../../../../frontend/node_modules/frappe-ui/src/resources/listResource.js","../../../../frontend/node_modules/frappe-ui/src/resources/documentResource.js","../../../../frontend/node_modules/frappe-ui/src/resources/plugin.js","../../../../frontend/node_modules/frappe-ui/src/utils/frappeRequest.js","../../../../frontend/node_modules/frappe-ui/src/data-fetching/idbStore.ts","../../../../frontend/node_modules/frappe-ui/src/data-fetching/docStore.ts","../../../../frontend/node_modules/frappe-ui/src/data-fetching/useList/listStore.ts","../../../../frontend/node_modules/frappe-ui/src/data-fetching/useFrappeFetch.ts"],"sourcesContent":["let id = 0\nfunction generateId() {\n  return ++id\n}\n\nexport function useId() {\n  return 'frappe-ui-' + generateId()\n}\n","export default function debounce(\n  func: Function,\n  wait: number,\n  immediate?: boolean,\n) {\n  var timeout: number | undefined\n  return function () {\n    var context = this,\n      args = arguments\n    var later = function () {\n      timeout = undefined\n      if (!immediate) func.apply(context, args)\n    }\n    var callNow = immediate && !timeout\n    clearTimeout(timeout)\n    timeout = window.setTimeout(later, wait)\n    if (callNow) func.apply(context, args)\n  }\n}\n","interface FrappeUIConfig {\n  // Timezone configurations\n  systemTimezone?: string | null\n  localTimezone?: string | null\n\n  // Resource fetcher function\n  resourceFetcher?: (options: any) => Promise<any>\n\n  // Default API endpoints for document operations\n  defaultDocGetUrl?: string\n  defaultDocInsertUrl?: string\n  defaultDocUpdateUrl?: string\n  defaultDocDeleteUrl?: string\n  defaultRunDocMethodUrl?: string\n\n  // Default API endpoints for list operations\n  defaultListUrl?: string\n\n  // Error handling\n  fallbackErrorHandler?: (error: any) => void\n}\n\nlet config: FrappeUIConfig = {}\n\nexport function setConfig<K extends keyof FrappeUIConfig>(\n  key: K,\n  value: FrappeUIConfig[K],\n): void {\n  config[key] = value\n}\n\nexport function getConfig<K extends keyof FrappeUIConfig>(\n  key: K,\n): FrappeUIConfig[K] | null {\n  return config[key] ?? null\n}\n","import _dayjs, { Dayjs } from 'dayjs/esm'\nimport relativeTime from 'dayjs/esm/plugin/relativeTime'\nimport localizedFormat from 'dayjs/esm/plugin/localizedFormat'\nimport updateLocale from 'dayjs/esm/plugin/updateLocale'\nimport isToday from 'dayjs/esm/plugin/isToday'\nimport duration from 'dayjs/esm/plugin/duration'\nimport utc from 'dayjs/esm/plugin/utc'\nimport timezone from 'dayjs/esm/plugin/timezone'\nimport advancedFormat from 'dayjs/esm/plugin/advancedFormat'\nimport customParseFormat from 'dayjs/esm/plugin/customParseFormat'\nimport { getConfig } from './config'\n\n_dayjs.extend(updateLocale)\n_dayjs.extend(relativeTime)\n_dayjs.extend(localizedFormat)\n_dayjs.extend(isToday)\n_dayjs.extend(duration)\n_dayjs.extend(utc)\n_dayjs.extend(timezone)\n_dayjs.extend(advancedFormat)\n_dayjs.extend(customParseFormat)\n\nfunction getBrowserTimezone(): string {\n  return Intl.DateTimeFormat().resolvedOptions().timeZone\n}\n\nexport function dayjsLocal(dateTimeString?: string): Dayjs {\n  let systemTimezone = getConfig('systemTimezone')\n  let localTimezone = getConfig('localTimezone') || getBrowserTimezone()\n\n  if (!systemTimezone) return _dayjs(dateTimeString)\n\n  if (!dateTimeString) return _dayjs().tz(localTimezone)\n  return _dayjs.tz(dateTimeString, systemTimezone).tz(localTimezone)\n}\n\nexport function dayjsSystem(dateTimeString?: string): Dayjs {\n  let systemTimezone = getConfig('systemTimezone')\n  let localTimezone = getConfig('localTimezone') || getBrowserTimezone()\n\n  if (!systemTimezone) return _dayjs(dateTimeString)\n\n  if (!dateTimeString) return _dayjs().tz(systemTimezone)\n  return _dayjs.tz(dateTimeString, localTimezone).tz(systemTimezone)\n}\n\nexport let dayjs = _dayjs\n","import DialogMain from './Dialog.vue'\nimport { DialogTitle, DialogDescription } from 'reka-ui'\nexport type { DialogProps } from './types'\n\ntype DialogExport = typeof DialogMain & {\n  Title: typeof DialogTitle\n  Description: typeof DialogDescription\n}\n\nconst Dialog = DialogMain as DialogExport\nDialog.Title = DialogTitle\nDialog.Description = DialogDescription\n\nexport { Dialog }\n","import ConfirmDialog from '../components/ConfirmDialog.vue'\nimport { h, ref } from 'vue'\n\nexport function confirmDialog({ title = 'Untitled', message = '', onConfirm, onCancel }) {\n  renderDialog(\n    h(ConfirmDialog, {\n      title,\n      message,\n      onConfirm,\n      onCancel\n    }),\n  )\n}\n\nexport const dialogs = ref([])\n\nexport function renderDialog(component) {\n  component.id = dialogs.length\n  dialogs.value.push(component)\n}\n","import {\n  Node as NodeExtension,\n  nodeInputRule,\n  mergeAttributes,\n} from '@tiptap/core'\nimport { VueNodeViewRenderer } from '@tiptap/vue-3'\nimport ImageNodeView from './ImageNodeView.vue'\nimport { Plugin, Selection, Transaction, EditorState } from '@tiptap/pm/state'\nimport { EditorView } from '@tiptap/pm/view'\nimport { Node } from '@tiptap/pm/model'\nimport { fileToBase64 } from '../../../../index'\nimport { UploadedFile } from '../../../../utils/useFileUpload'\n\nexport interface ImageExtensionOptions {\n  /**\n   * Function to handle image uploads\n   * @default null\n   */\n  uploadFunction: ((file: File) => Promise<UploadedFile>) | null\n\n  /**\n   * HTML attributes to add to the image element\n   * @default {}\n   */\n  HTMLAttributes: Record<string, any>\n}\n\nexport interface SetImageOptions {\n  src: string\n  alt?: string\n  title?: string\n  width?: string | number | null\n  height?: string | number | null\n}\n\ndeclare module '@tiptap/core' {\n  interface Commands<ReturnType> {\n    image: {\n      /**\n       * Insert an image\n       */\n      setImage: (options: SetImageOptions) => ReturnType\n\n      /**\n       * Upload and insert an image\n       */\n      uploadImage: (file: File) => ReturnType\n\n      /**\n       * Select an image file using the file picker and upload it\n       */\n      selectAndUploadImage: () => ReturnType\n\n      /**\n       * Set image alignment\n       */\n      setImageAlign: (align: 'left' | 'center' | 'right') => ReturnType\n    }\n  }\n}\n\n/**\n * Matches markdown image syntax: ![alt](src \"title\")\n */\nconst inputRegex = /(?:^|\\s)(!\\[(.+|:?)]\\((\\S+)(?:(?:\\s+)[\"'](\\S+)[\"'])?\\))$/\n\nexport const ImageExtension = NodeExtension.create<ImageExtensionOptions>({\n  name: 'image',\n\n  group: 'block',\n  draggable: true,\n  selectable: true,\n\n  addAttributes() {\n    return {\n      src: { default: null },\n      alt: { default: null },\n      title: { default: null },\n      width: { default: null },\n      height: { default: null },\n      loading: {\n        default: false,\n        parseHTML: () => false,\n      },\n      align: {\n        default: 'left',\n        parseHTML: (element) => {\n          const align = (\n            element.getAttribute('data-align') ||\n            element.getAttribute('align') ||\n            'left'\n          ).toLowerCase()\n\n          if (['left', 'center', 'right'].includes(align)) {\n            return align as 'left' | 'center' | 'right'\n          }\n          return 'left'\n        },\n        renderHTML: (attributes) => {\n          return {\n            'data-align': attributes.align || 'left',\n          }\n        },\n      },\n      uploadId: {\n        default: null,\n        parseHTML: () => null,\n      },\n      error: {\n        default: null,\n        parseHTML: () => null,\n      },\n    }\n  },\n\n  parseHTML() {\n    return [\n      {\n        tag: 'img[src]',\n        getAttrs: (node) => {\n          if (typeof node === 'string') return {}\n          const element = node as HTMLElement\n          return {\n            src: element.getAttribute('src'),\n            alt: element.getAttribute('alt'),\n            title: element.getAttribute('title'),\n            width: element.getAttribute('width'),\n            height: element.getAttribute('height'),\n          }\n        },\n      },\n    ]\n  },\n\n  renderHTML({ HTMLAttributes }) {\n    return [\n      'img',\n      mergeAttributes(this.options.HTMLAttributes || {}, HTMLAttributes),\n    ]\n  },\n\n  addNodeView() {\n    return VueNodeViewRenderer(ImageNodeView)\n  },\n\n  addOptions() {\n    return {\n      uploadFunction: null,\n      HTMLAttributes: {},\n    }\n  },\n\n  addCommands() {\n    return {\n      setImageAlign:\n        (align: 'left' | 'center' | 'right') =>\n        ({ commands }) => {\n          return commands.updateAttributes(this.name, { align })\n        },\n\n      setImage:\n        (attributes: SetImageOptions) =>\n        ({ commands, editor }) => {\n          const result = commands.insertContent({\n            type: this.name,\n            attrs: attributes,\n          })\n\n          if (result && attributes.src) {\n            findImageNodeBySource(editor.view, attributes.src, (node, pos) => {\n              updateNodeWithDimensions(attributes.src, editor.view, pos)\n            })\n          }\n\n          return result\n        },\n\n      uploadImage:\n        (file: File) =>\n        ({ editor }) => {\n          return uploadImage(file, editor.view, null, this.options)\n        },\n\n      selectAndUploadImage:\n        () =>\n        ({ editor }) => {\n          const input = document.createElement('input')\n          input.type = 'file'\n          input.accept = 'image/*'\n          input.onchange = (event) => {\n            const target = event.target as HTMLInputElement\n            if (target.files && target.files.length) {\n              const file = target.files[0]\n              editor.commands.uploadImage(file)\n            }\n          }\n          input.click()\n          return true\n        },\n    }\n  },\n\n  addInputRules() {\n    return [\n      nodeInputRule({\n        find: inputRegex,\n        type: this.type,\n        getAttributes: (match) => {\n          const [, , alt, src, title] = match\n          return { src, alt, title }\n        },\n      }),\n    ]\n  },\n\n  addProseMirrorPlugins() {\n    const extensionThis = this\n\n    return [\n      new Plugin({\n        props: {\n          handleDOMEvents: {\n            drop: (view, event) => {\n              const hasFiles = event.dataTransfer?.files?.length\n\n              if (!hasFiles || !extensionThis.options.uploadFunction) {\n                return false\n              }\n\n              const images = Array.from(event.dataTransfer.files).filter(\n                (file) => /image/i.test(file.type),\n              )\n\n              if (images.length === 0) {\n                return false\n              }\n\n              event.preventDefault()\n\n              const coordinates = view.posAtCoords({\n                left: event.clientX,\n                top: event.clientY,\n              })\n\n              let pos: number | null = null\n              if (coordinates) {\n                pos = coordinates.pos\n                const transaction = view.state.tr.setSelection(\n                  Selection.near(view.state.doc.resolve(pos)),\n                )\n                view.dispatch(transaction)\n              }\n\n              processMultipleImages(images, view, pos, extensionThis.options)\n              return true\n            },\n\n            handlePaste: (view, event) => {\n              if (!extensionThis.options.uploadFunction) {\n                return false\n              }\n\n              const clipboardItems = event.clipboardData?.items\n              if (!clipboardItems || clipboardItems.length === 0) {\n                return false\n              }\n\n              const images: File[] = []\n\n              for (let i = 0; i < clipboardItems.length; i++) {\n                const item = clipboardItems[i]\n                if (\n                  item.kind === 'file' &&\n                  item.type.indexOf('image/') !== -1\n                ) {\n                  const file = item.getAsFile()\n                  if (file) {\n                    images.push(file)\n                  }\n                }\n              }\n\n              if (images.length === 0) {\n                return false\n              }\n\n              event.preventDefault()\n              processMultipleImages(images, view, null, extensionThis.options)\n              return true\n            },\n          },\n        },\n\n        appendTransaction(\n          transactions: readonly Transaction[],\n          oldState: EditorState,\n          newState: EditorState,\n        ): Transaction | null {\n          const newImageNodes: { node: Node; pos: number }[] = []\n\n          if (transactions.some((tr) => tr.docChanged)) {\n            newState.doc.descendants((node, pos) => {\n              if (\n                node.type.name === 'image' &&\n                node.attrs.src &&\n                (!node.attrs.width || !node.attrs.height) &&\n                !node.attrs.loading\n              ) {\n                newImageNodes.push({ node, pos })\n              }\n            })\n          }\n\n          if (newImageNodes.length === 0) return null\n\n          newImageNodes.forEach(({ node, pos }) => {\n            const editor = extensionThis.editor\n            if (editor) {\n              updateNodeWithDimensions(node.attrs.src, editor.view, pos)\n            }\n          })\n\n          return null\n        },\n      }),\n    ]\n  },\n})\n\nfunction findInsertPosition(\n  view: EditorView,\n  lastNodeId: string | null,\n): number | null {\n  if (!lastNodeId) {\n    return null\n  }\n\n  let insertPos = null\n\n  view.state.doc.descendants((node, pos) => {\n    if (node.type.name === 'image' && node.attrs.uploadId === lastNodeId) {\n      insertPos = pos + node.nodeSize\n      return false\n    }\n  })\n\n  return insertPos\n}\n\n// Base upload function shared by all image upload methods\nfunction uploadImageBase(\n  file: File,\n  view: EditorView,\n  pos: number | null | undefined,\n  options: Record<string, any>,\n  insertMode: 'insert' | 'replace',\n  onComplete?: (nodeId: string) => void,\n  moveCursor = false,\n): boolean {\n  if (!options.uploadFunction) {\n    console.error('uploadFunction option is not provided')\n    return false\n  }\n\n  const uploadId = `upload-${Date.now()}-${Math.random().toString(36).substring(2, 9)}`\n\n  fileToBase64(file)\n    .then((base64Result: string) => {\n      const node = view.state.schema.nodes.image.create({\n        loading: true,\n        uploadId,\n        src: base64Result,\n      })\n\n      const tr = view.state.tr\n\n      if (pos != null) {\n        tr.insert(pos, node)\n      } else if (insertMode === 'replace') {\n        tr.replaceSelectionWith(node)\n      } else {\n        const insertPos = view.state.selection.from\n        tr.insert(insertPos, node)\n      }\n\n      view.dispatch(tr)\n\n      // Optionally move cursor after the node\n      if (moveCursor) {\n        const nodeSize = node.nodeSize || 1\n        setTimeout(() => {\n          try {\n            let nodePos = null\n            view.state.doc.descendants((n, p) => {\n              if (n.type.name === 'image' && n.attrs.uploadId === uploadId) {\n                nodePos = p\n                return false\n              }\n            })\n\n            if (nodePos !== null) {\n              const posAfter = nodePos + nodeSize\n              const transaction = view.state.tr.setSelection(\n                Selection.near(view.state.doc.resolve(posAfter)),\n              )\n              view.dispatch(transaction)\n            }\n          } catch (e) {\n            console.error('Error moving cursor:', e)\n          }\n        }, 10)\n      }\n\n      return options.uploadFunction(file)\n    })\n    .then((uploadedImage: UploadedFile) => {\n      return getImageDimensions(uploadedImage.file_url)\n        .then((dimensions) => {\n          return {\n            ...uploadedImage,\n            width: dimensions.width,\n            height: dimensions.height,\n          } as UploadedFile & { width: number; height: number }\n        })\n        .catch(() => {\n          return uploadedImage as UploadedFile & {\n            width: number\n            height: number\n          }\n        })\n    })\n    .then((uploadedImage) => {\n      const transaction = view.state.tr\n\n      view.state.doc.descendants((node, pos) => {\n        if (node.type.name === 'image' && node.attrs.uploadId === uploadId) {\n          transaction.setNodeMarkup(pos, undefined, {\n            ...node.attrs,\n            src: uploadedImage.file_url,\n            width: uploadedImage.width || node.attrs.width,\n            height: uploadedImage.height || node.attrs.height,\n            loading: false,\n          })\n          return false\n        }\n      })\n\n      view.dispatch(transaction)\n\n      if (onComplete) onComplete(uploadId)\n    })\n    .catch((error: Error) => {\n      console.error('Image upload failed:', error)\n\n      try {\n        const transaction = view.state.tr\n\n        view.state.doc.descendants((node, pos) => {\n          if (node.type.name === 'image' && node.attrs.uploadId === uploadId) {\n            transaction.setNodeMarkup(pos, undefined, {\n              ...node.attrs,\n              loading: false,\n              error: error.message || 'Failed to upload image',\n            })\n            return false\n          }\n        })\n\n        view.dispatch(transaction)\n      } catch (e) {\n        console.error('Error updating failed node:', e)\n      }\n\n      if (onComplete) onComplete(uploadId)\n    })\n\n  return true\n}\n\nfunction uploadImageWithTracking(\n  file: File,\n  view: EditorView,\n  pos: number | null | undefined,\n  options: Record<string, any>,\n  onComplete?: (nodeId: string) => void,\n): boolean {\n  return uploadImageBase(file, view, pos, options, 'insert', onComplete, true)\n}\n\nfunction uploadImage(\n  file: File,\n  view: EditorView,\n  pos: number | null | undefined,\n  options: Record<string, any>,\n): boolean {\n  return uploadImageBase(file, view, pos, options, 'replace')\n}\n\nfunction findImageNodeBySource(\n  view: EditorView,\n  src: string,\n  callback: (node: Node, pos: number) => void,\n) {\n  view.state.doc.descendants((node, pos) => {\n    if (node.type.name === 'image' && node.attrs.src === src) {\n      callback(node, pos)\n      return false\n    }\n  })\n}\n\nfunction updateNodeWithDimensions(\n  src: string,\n  view: EditorView,\n  pos: number,\n): void {\n  getImageDimensions(src)\n    .then((dimensions) => {\n      const node = view.state.doc.nodeAt(pos)\n      if (!node || node.type.name !== 'image') {\n        return\n      }\n      const currentAttrs = node.attrs\n\n      if (currentAttrs.width == null || currentAttrs.height == null) {\n        const transaction = view.state.tr.setNodeMarkup(pos, undefined, {\n          ...currentAttrs,\n          width: currentAttrs.width ?? dimensions.width,\n          height: currentAttrs.height ?? dimensions.height,\n        })\n        view.dispatch(transaction)\n      }\n    })\n    .catch((error) => {\n      // Don't log error if it's just about dimensions for an existing node\n    })\n}\n\nfunction getImageDimensions(\n  src: string,\n): Promise<{ width: number; height: number }> {\n  return new Promise((resolve, reject) => {\n    const img = new Image()\n    img.onload = () =>\n      resolve({\n        width: img.naturalWidth,\n        height: img.naturalHeight,\n      })\n    img.onerror = reject\n    img.src = src\n  })\n}\n\n/**\n * Process multiple image uploads sequentially\n */\nexport function processMultipleImages(\n  images: File[],\n  view: EditorView,\n  pos: number | null,\n  options: Record<string, any>,\n) {\n  if (images.length === 1) {\n    uploadImage(images[0], view, pos, options)\n    return\n  }\n\n  let imageQueue = [...images]\n  let lastInsertedNodeId: string | null = null\n\n  const processNextImage = () => {\n    if (imageQueue.length === 0) return\n\n    const file = imageQueue.shift()\n    if (!file) return\n\n    const currentPos = lastInsertedNodeId\n      ? findInsertPosition(view, lastInsertedNodeId)\n      : pos\n\n    uploadImageWithTracking(file, view, currentPos, options, (newNodeId) => {\n      lastInsertedNodeId = newNodeId\n      setTimeout(processNextImage, 100)\n    })\n  }\n\n  processNextImage()\n}\n","import { ref, watch, type Ref, readonly } from 'vue'\n\ninterface UseTouchHandlerOptions {\n  targetRef: Ref<HTMLElement | null | undefined>\n  zoomLevel?: Ref<number>\n  onSwipeLeft?: () => void\n  onSwipeRight?: () => void\n  onDoubleTap?: (event: TouchEvent) => void\n  onTap?: (event: TouchEvent) => void\n  onPanStart?: (event: TouchEvent) => void\n  onPanMove?: (deltaX: number, deltaY: number, event: TouchEvent) => void\n  onPanAnimate?: (x: number, y: number) => void // Callback for inertia animation frame updates\n  onPanEnd?: (event: TouchEvent) => void\n  onPinchStart?: (event: TouchEvent) => void\n  onPinchMove?: (scale: number, event: TouchEvent) => void\n  onPinchEnd?: (event: TouchEvent) => void\n  doubleTapDelay?: number\n  minSwipeDistance?: number\n  maxVerticalSwipeDistance?: number\n  maxTapDuration?: number\n  maxTapMovement?: number\n  panThreshold?: number\n  inertiaDamping?: number // Damping factor for inertia (e.g., 0.95)\n  inertiaVelocityThreshold?: number // Minimum velocity (pixels/ms) to trigger inertia\n}\n\nexport function useTouchHandler(options: UseTouchHandlerOptions) {\n  const {\n    targetRef,\n    zoomLevel = ref(100),\n    onSwipeLeft,\n    onSwipeRight,\n    onDoubleTap,\n    onTap,\n    onPanStart,\n    onPanMove,\n    onPanAnimate,\n    onPanEnd,\n    onPinchStart,\n    onPinchMove,\n    onPinchEnd,\n    doubleTapDelay = 300,\n    minSwipeDistance = 50,\n    maxVerticalSwipeDistance = 75,\n    maxTapDuration = 200,\n    maxTapMovement = 10,\n    panThreshold = 5, // Pixels moved before pan starts\n    inertiaDamping = 0.94, // Damping for inertia slowdown (higher = slower stop)\n    inertiaVelocityThreshold = 0.5, // Pixels per ms\n  } = options\n\n  const isPanning = ref(false)\n  const isPinching = ref(false)\n  const isAnimatingPan = ref(false) // Track inertia animation state\n  const startPanCoords = ref({ x: 0, y: 0 })\n  const lastTapTime = ref(0)\n  const touchStartTime = ref(0)\n  const touchStartDistance = ref(0)\n  const initialTouchPoints = ref<TouchList | null>(null)\n\n  // Velocity tracking for inertia\n  const lastMoveTime = ref(0)\n  const lastMoveCoords = ref({ x: 0, y: 0 })\n  const panVelocity = ref({ x: 0, y: 0 })\n\n  // Inertia animation frame\n  const animationFrameId = ref<number | null>(null)\n\n  const cancelInertiaAnimation = () => {\n    if (animationFrameId.value !== null) {\n      cancelAnimationFrame(animationFrameId.value)\n      animationFrameId.value = null\n    }\n    isAnimatingPan.value = false\n    panVelocity.value = { x: 0, y: 0 } // Reset velocity\n  }\n\n  const handleTouchStart = (event: TouchEvent) => {\n    cancelInertiaAnimation() // Stop any ongoing inertia animation\n    event.preventDefault() // Prevent default browser actions like scroll/zoom\n\n    isPanning.value = false\n    isPinching.value = false\n    initialTouchPoints.value = event.touches\n\n    const currentTime = performance.now()\n    const timeSinceLastTap = currentTime - lastTapTime.value\n\n    // Double Tap Detection\n    if (\n      timeSinceLastTap < doubleTapDelay &&\n      timeSinceLastTap > 0 &&\n      event.touches.length === 1 &&\n      onDoubleTap\n    ) {\n      onDoubleTap(event)\n      lastTapTime.value = 0 // Reset tap time after double tap\n      touchStartTime.value = 0\n      return // Don't process as single tap/pan/pinch start\n    }\n\n    // Record Start Info\n    touchStartTime.value = currentTime\n    if (event.touches.length === 1) {\n      lastTapTime.value = currentTime // Record for potential double tap\n      const touch = event.touches[0]\n      startPanCoords.value = { x: touch.clientX, y: touch.clientY }\n      // Reset velocity tracking on new touch start\n      lastMoveTime.value = currentTime\n      lastMoveCoords.value = { ...startPanCoords.value }\n      panVelocity.value = { x: 0, y: 0 }\n      if (onPanStart) onPanStart(event)\n    } else if (event.touches.length === 2) {\n      lastTapTime.value = 0 // Reset tap time if starting with pinch\n      const touch1 = event.touches[0]\n      const touch2 = event.touches[1]\n      touchStartDistance.value = Math.hypot(\n        touch2.clientX - touch1.clientX,\n        touch2.clientY - touch1.clientY,\n      )\n      isPinching.value = true\n      if (onPinchStart) onPinchStart(event)\n    } else {\n      // More than 2 touches, reset tap time\n      lastTapTime.value = 0\n      touchStartTime.value = 0\n    }\n  }\n\n  const handleTouchMove = (event: TouchEvent) => {\n    if (!initialTouchPoints.value) return // Should have initial points if touch started correctly\n\n    event.preventDefault() // Prevent scroll/zoom during move\n\n    const currentTime = performance.now()\n    const deltaTime = currentTime - lastMoveTime.value\n\n    // Pinching\n    if (event.touches.length === 2 && initialTouchPoints.value.length === 2) {\n      isPanning.value = false // Stop panning if pinch starts\n      isPinching.value = true\n      const touch1 = event.touches[0]\n      const touch2 = event.touches[1]\n      const currentDistance = Math.hypot(\n        touch2.clientX - touch1.clientX,\n        touch2.clientY - touch1.clientY,\n      )\n\n      if (touchStartDistance.value > 0 && onPinchMove) {\n        const scale = currentDistance / touchStartDistance.value\n        onPinchMove(scale, event)\n      }\n      // Reset velocity if pinching occurs\n      panVelocity.value = { x: 0, y: 0 }\n    }\n    // Panning\n    else if (\n      event.touches.length === 1 &&\n      initialTouchPoints.value.length === 1 &&\n      !isPinching.value // Don't pan if a pinch just ended but finger is still down\n    ) {\n      const currentX = event.touches[0].clientX\n      const currentY = event.touches[0].clientY\n      const rawDeltaX = currentX - lastMoveCoords.value.x\n      const rawDeltaY = currentY - lastMoveCoords.value.y\n\n      // Calculate velocity (pixels per millisecond) for inertia\n      // Ensure deltaTime is not zero to avoid division by zero\n      if (deltaTime > 1) {\n        // Use a small threshold > 0\n        panVelocity.value = {\n          x: rawDeltaX / deltaTime,\n          y: rawDeltaY / deltaTime,\n        }\n      } else {\n        // If deltaTime is too small, retain previous velocity or reset\n        panVelocity.value = { x: 0, y: 0 } // Resetting might be safer\n      }\n\n      // Update last move state\n      lastMoveTime.value = currentTime\n      lastMoveCoords.value = { x: currentX, y: currentY }\n\n      const deltaXFromStart = currentX - startPanCoords.value.x\n      const deltaYFromStart = currentY - startPanCoords.value.y\n\n      // Start panning only if threshold is met AND zoom level allows panning\n      if (\n        !isPanning.value &&\n        zoomLevel.value > 100 &&\n        (Math.abs(deltaXFromStart) > panThreshold ||\n          Math.abs(deltaYFromStart) > panThreshold)\n      ) {\n        isPanning.value = true\n        // Adjust start coords slightly to avoid jump if pan starts mid-movement\n        startPanCoords.value = {\n          x: currentX,\n          y: currentY,\n        }\n      }\n\n      if (isPanning.value && onPanMove) {\n        const zoomFactor = zoomLevel.value / 100\n        // Pass the delta relative to the start of the *current* pan gesture, adjusted for zoom\n        const panDeltaX = deltaXFromStart / zoomFactor\n        const panDeltaY = deltaYFromStart / zoomFactor\n        onPanMove(panDeltaX, panDeltaY, event)\n      }\n    }\n  }\n\n  const handleTouchEnd = (event: TouchEvent) => {\n    const touchesLeft = event.touches.length\n    const touchEndTime = performance.now()\n    const wasPanning = isPanning.value\n    const wasPinching = isPinching.value\n\n    // Store current velocity before resetting states for potential inertia\n    const finalVelocity = { ...panVelocity.value }\n\n    // Handle Pan End and Inertia\n    if (\n      wasPanning &&\n      initialTouchPoints.value &&\n      touchesLeft < initialTouchPoints.value.length\n    ) {\n      isPanning.value = false // Set panning to false *before* starting animation\n      if (onPanEnd) onPanEnd(event)\n\n      // Check velocity threshold and start inertia animation if needed\n      const velocityMagnitude = Math.hypot(finalVelocity.x, finalVelocity.y)\n      if (\n        velocityMagnitude > inertiaVelocityThreshold &&\n        onPanAnimate &&\n        zoomLevel.value > 100 // Only animate if zoomed in\n      ) {\n        isAnimatingPan.value = true\n        let lastFrameTime = performance.now()\n        // Use a copy of the velocity for the animation loop\n        let animVelocity = { ...finalVelocity }\n\n        const animate = (currentTime: number) => {\n          // Ensure animation wasn't cancelled elsewhere (e.g., new touch start)\n          if (!isAnimatingPan.value) return\n\n          const frameDeltaTime = Math.max(1, currentTime - lastFrameTime) // Prevent zero/negative delta\n          lastFrameTime = currentTime\n\n          const zoomFactor = zoomLevel.value / 100\n          const moveX = (animVelocity.x * frameDeltaTime) / zoomFactor\n          const moveY = (animVelocity.y * frameDeltaTime) / zoomFactor\n\n          // Call component's pan update function for each frame\n          onPanAnimate(moveX, moveY)\n\n          // Apply damping (adjust based on frame time for consistency)\n          const dampingFactor = Math.pow(\n            Math.min(0.999, inertiaDamping), // Ensure base is < 1\n            frameDeltaTime / 16.67, // Normalize damping based on ~60fps\n          )\n          animVelocity.x *= dampingFactor\n          animVelocity.y *= dampingFactor\n\n          // Stop animation if velocity is negligible or zoom changed back to <= 100%\n          if (\n            Math.hypot(animVelocity.x, animVelocity.y) < 0.01 ||\n            zoomLevel.value <= 100\n          ) {\n            cancelInertiaAnimation()\n          } else {\n            animationFrameId.value = requestAnimationFrame(animate)\n          }\n        }\n        animationFrameId.value = requestAnimationFrame(animate)\n      } else {\n        panVelocity.value = { x: 0, y: 0 } // Reset velocity if no animation starts\n      }\n    } else if (!wasPanning) {\n      // Reset velocity if touch ended without panning (e.g., tap, pinch)\n      panVelocity.value = { x: 0, y: 0 }\n    }\n\n    // Handle Pinch End\n    if (wasPinching && touchesLeft < 2) {\n      isPinching.value = false\n      touchStartDistance.value = 0 // Reset pinch distance tracking\n      if (onPinchEnd) onPinchEnd(event)\n    }\n\n    // Gesture detection (Tap/Swipe) only when the *last* finger is lifted\n    if (\n      touchesLeft === 0 &&\n      event.changedTouches.length === 1 && // Ensure it's the end of a single touch sequence\n      touchStartTime.value > 0 && // Ensure there was a valid start time recorded\n      initialTouchPoints.value?.length === 1 // Ensure it started as a single touch\n    ) {\n      const endCoords = event.changedTouches[0]\n      const deltaX = endCoords.clientX - startPanCoords.value.x\n      const deltaY = endCoords.clientY - startPanCoords.value.y\n      const duration = touchEndTime - touchStartTime.value\n\n      // Swipe Detection (only if not panning AND zoom is appropriate for swipe)\n      if (\n        !wasPanning && // Only detect swipe if not panning\n        zoomLevel.value <= 100 && // Swipes only make sense at base zoom\n        Math.abs(deltaX) > minSwipeDistance &&\n        Math.abs(deltaY) < maxVerticalSwipeDistance // Allow some vertical movement\n      ) {\n        if (deltaX < 0 && onSwipeLeft) {\n          onSwipeLeft()\n        } else if (deltaX > 0 && onSwipeRight) {\n          onSwipeRight()\n        }\n      }\n      // Tap Detection (if not panning, not swiping, and within time/movement limits)\n      else if (\n        !wasPanning &&\n        duration < maxTapDuration &&\n        Math.abs(deltaX) < maxTapMovement &&\n        Math.abs(deltaY) < maxTapMovement &&\n        onTap\n      ) {\n        onTap(event)\n      }\n    }\n\n    // Reset start time and coords only when all touches are up\n    if (touchesLeft === 0) {\n      touchStartTime.value = 0\n      startPanCoords.value = { x: 0, y: 0 }\n      initialTouchPoints.value = null\n      // Don't reset isPanning here if inertia animation might start\n      isPinching.value = false\n      // Reset velocity only if not animating\n      if (!isAnimatingPan.value) {\n        panVelocity.value = { x: 0, y: 0 }\n      }\n    }\n    // If some touches remain (e.g., pinch ended, one finger remains),\n    // update start coords for potential pan with the remaining finger.\n    else if (touchesLeft === 1 && !isPanning.value && !isPinching.value) {\n      startPanCoords.value = {\n        x: event.touches[0].clientX,\n        y: event.touches[0].clientY,\n      }\n      touchStartTime.value = performance.now() // Reset start time for the remaining finger\n      initialTouchPoints.value = event.touches // Update initial touches to the single remaining one\n    }\n  }\n\n  watch(\n    targetRef,\n    (newTarget, oldTarget) => {\n      if (oldTarget) {\n        oldTarget.removeEventListener('touchstart', handleTouchStart)\n        oldTarget.removeEventListener('touchmove', handleTouchMove)\n        oldTarget.removeEventListener('touchend', handleTouchEnd)\n        oldTarget.removeEventListener('touchcancel', handleTouchEnd) // Treat cancel like end\n        cancelInertiaAnimation() // Clean up animation on unmount/target change\n      }\n      if (newTarget) {\n        // Use passive: false for start/move to allow preventDefault()\n        newTarget.addEventListener('touchstart', handleTouchStart, {\n          passive: false,\n        })\n        newTarget.addEventListener('touchmove', handleTouchMove, {\n          passive: false,\n        })\n        // Use passive: true for end/cancel as we don't preventDefault there\n        newTarget.addEventListener('touchend', handleTouchEnd, {\n          passive: true,\n        })\n        newTarget.addEventListener('touchcancel', handleTouchEnd, {\n          passive: true,\n        })\n      }\n    },\n    { immediate: true },\n  )\n\n  return {\n    isPanning: readonly(isPanning),\n    isPinching: readonly(isPinching),\n    isAnimatingPan: readonly(isAnimatingPan), // Expose inertia animation status\n  }\n}\n","import { ref, watch, type Ref } from 'vue'\n\ninterface UseImageNavigationOptions {\n  initialIndex: Ref<number>\n  imageCount: Ref<number>\n  onNavigate?: () => void\n}\n\nexport function useImageNavigation({\n  initialIndex,\n  imageCount,\n  onNavigate,\n}: UseImageNavigationOptions) {\n  const currentIndex = ref(initialIndex.value)\n\n  watch(initialIndex, (newVal) => {\n    currentIndex.value = newVal\n    onNavigate?.()\n  })\n\n  function nextImage() {\n    if (imageCount.value > 0) {\n      currentIndex.value = (currentIndex.value + 1) % imageCount.value\n      onNavigate?.()\n    }\n  }\n\n  function previousImage() {\n    if (imageCount.value > 0) {\n      currentIndex.value =\n        (currentIndex.value - 1 + imageCount.value) % imageCount.value\n      onNavigate?.()\n    }\n  }\n\n  return {\n    currentIndex,\n    nextImage,\n    previousImage,\n  }\n}\n","import { ref, watch, onMounted, onUnmounted, type Ref } from 'vue'\n\ninterface UseZoomPanOptions {\n  containerRef: Ref<HTMLElement | null>\n  isEnabled: Ref<boolean>\n}\n\nexport function useZoomPan({ containerRef, isEnabled }: UseZoomPanOptions) {\n  const zoomLevel = ref(100)\n  const panPosition = ref({ x: 0, y: 0 })\n  const isMousePanning = ref(false)\n  const startMousePanCoords = ref({ x: 0, y: 0 })\n  const initialPanPositionOnGestureStart = ref({ x: 0, y: 0 })\n\n  const snapThresholdLower = 90\n  const snapThresholdUpper = 110\n\n  watch(zoomLevel, (newZoom, oldZoom) => {\n    if (newZoom <= 100 && oldZoom > 100) {\n      panPosition.value = { x: 0, y: 0 }\n    }\n  })\n\n  function zoomIn() {\n    zoomLevel.value = Math.min(zoomLevel.value + 25, 300)\n  }\n\n  function zoomOut() {\n    const newZoom = Math.max(zoomLevel.value - 25, 25)\n    if (zoomLevel.value > 100 && newZoom < 100) {\n      zoomLevel.value = 100\n    } else {\n      zoomLevel.value = newZoom\n    }\n  }\n\n  function resetZoom() {\n    zoomLevel.value = 100\n    panPosition.value = { x: 0, y: 0 }\n    isMousePanning.value = false\n    initialPanPositionOnGestureStart.value = { x: 0, y: 0 }\n  }\n\n  function handlePanStart(event: MouseEvent) {\n    if (zoomLevel.value <= 100) return\n    event.preventDefault()\n    isMousePanning.value = true\n    startMousePanCoords.value = { x: event.clientX, y: event.clientY }\n    initialPanPositionOnGestureStart.value = { ...panPosition.value }\n\n    const handlePanMove = (moveEvent: MouseEvent) => {\n      if (!isMousePanning.value) return\n      const deltaX = moveEvent.clientX - startMousePanCoords.value.x\n      const deltaY = moveEvent.clientY - startMousePanCoords.value.y\n      const zoomFactor = zoomLevel.value / 100\n\n      panPosition.value = {\n        x: initialPanPositionOnGestureStart.value.x + deltaX / zoomFactor,\n        y: initialPanPositionOnGestureStart.value.y + deltaY / zoomFactor,\n      }\n    }\n\n    const handlePanEnd = () => {\n      if (isMousePanning.value) {\n        isMousePanning.value = false\n        document.removeEventListener('mousemove', handlePanMove)\n        document.removeEventListener('mouseup', handlePanEnd)\n      }\n    }\n\n    document.addEventListener('mousemove', handlePanMove)\n    document.addEventListener('mouseup', handlePanEnd)\n  }\n\n  function handleWheel(event: WheelEvent) {\n    if (!isEnabled.value) return\n\n    if (containerRef.value?.contains(event.target as Node)) {\n      event.preventDefault()\n\n      let dampingFactor = event.ctrlKey ? 0.5 : 0.2\n\n      const zoomChange = -event.deltaY * dampingFactor\n      const currentZoom = zoomLevel.value\n      const newZoom = Math.round(currentZoom + zoomChange)\n      let clampedZoom = Math.max(25, Math.min(300, newZoom))\n\n      if (\n        (currentZoom > 100 && clampedZoom < 100) ||\n        (currentZoom < 100 && clampedZoom > 100)\n      ) {\n        if (Math.abs(100 - clampedZoom) < Math.abs(zoomChange) * 1.5) {\n          clampedZoom = 100\n        }\n      }\n\n      zoomLevel.value = clampedZoom\n    }\n  }\n\n  onMounted(() => {\n    const container = containerRef.value\n    if (container) {\n      container.addEventListener('wheel', handleWheel, {\n        passive: false,\n        capture: true,\n      })\n    }\n  })\n\n  onUnmounted(() => {\n    const container = containerRef.value\n    if (container) {\n      container.removeEventListener('wheel', handleWheel, { capture: true })\n    }\n    if (isMousePanning.value) {\n      isMousePanning.value = false\n    }\n  })\n\n  return {\n    zoomLevel,\n    panPosition,\n    isMousePanning,\n    initialPanPositionOnGestureStart,\n    zoomIn,\n    zoomOut,\n    resetZoom,\n    handlePanStart,\n    snapThresholdLower,\n    snapThresholdUpper,\n  }\n}\n","import { Extension } from '@tiptap/core'\nimport { Plugin, PluginKey } from '@tiptap/pm/state'\nimport { createApp, h } from 'vue'\nimport ImageViewerModal from './ImageViewerModal.vue'\n\ninterface ImageInfo {\n  src: string\n  alt: string | null\n}\n\ndeclare module '@tiptap/core' {\n  interface Commands<ReturnType> {\n    imageViewer: {\n      /**\n       * Open the image viewer\n       */\n      openImageViewer: (src: string) => ReturnType\n    }\n  }\n}\n\nexport default Extension.create({\n  name: 'imageViewer',\n\n  onBeforeCreate() {\n    // Only add the style if it doesn't already exist\n    if (!document.querySelector('style[data-image-viewer-style]')) {\n      // Add a CSS rule to make images clickable when the editor is not editable\n      const style = document.createElement('style')\n      style.textContent = `\n          .ProseMirror:not(.ProseMirror-focused) img {\n            cursor: pointer;\n          }\n        `\n      style.setAttribute('data-image-viewer-style', 'true')\n      document.head.appendChild(style)\n    }\n  },\n\n  onDestroy() {\n    // Clean up the style element when the editor instance is destroyed\n    const style = document.querySelector('style[data-image-viewer-style]')\n    if (style) {\n      document.head.removeChild(style)\n    }\n  },\n\n  addCommands() {\n    return {\n      openImageViewer:\n        (src: string) =>\n        ({ editor }) => {\n          // Find all images in the document to populate the viewer\n          const images: ImageInfo[] = []\n          editor.state.doc.descendants((node) => {\n            if (node.type.name === 'image') {\n              images.push({\n                src: node.attrs.src,\n                alt: node.attrs.alt || null,\n              })\n            }\n            return true\n          })\n\n          // Find the index of the clicked image to start the viewer at the correct position\n          const currentIndex = images.findIndex((image) => image.src === src)\n\n          // Create and open the image viewer modal\n          openImageViewerModal(images, currentIndex)\n\n          return true\n        },\n    }\n  },\n\n  addProseMirrorPlugins() {\n    const extension = this\n\n    return [\n      new Plugin({\n        key: new PluginKey('imageViewer'),\n        props: {\n          handleClick(view, pos, event) {\n            // Only allow opening the viewer when the editor is not editable\n            if (extension.editor.isEditable) {\n              return false\n            }\n\n            const { state } = view\n            const clickedNode = state.doc.nodeAt(pos)\n\n            // Check if the click was directly on an image node\n            if (clickedNode?.type.name === 'image') {\n              event.preventDefault()\n              const src = clickedNode.attrs.src\n              extension.editor.commands.openImageViewer(src)\n              return true // Indicate that the event was handled\n            }\n\n            // If the click target was an <img> element, but not directly the node at pos\n            // (e.g., clicking near the edge, handled by browser event bubbling)\n            if (event.target instanceof HTMLImageElement) {\n              let foundImageNode = false\n              // Traverse the document to find the ProseMirror node corresponding to the clicked <img>\n              state.doc.descendants((node, nodePos) => {\n                if (node.type.name === 'image' && !foundImageNode) {\n                  const domNode = view.nodeDOM(nodePos)\n                  // Check if the event target is the DOM representation of this node or inside it\n                  if (\n                    domNode &&\n                    (domNode === event.target || domNode.contains(event.target))\n                  ) {\n                    event.preventDefault()\n                    extension.editor.commands.openImageViewer(node.attrs.src)\n                    foundImageNode = true\n                    return false // Stop traversal once found\n                  }\n                }\n                return true // Continue traversal\n              })\n\n              if (foundImageNode) return true // Indicate that the event was handled\n            }\n\n            return false // Event not handled by this plugin\n          },\n        },\n      }),\n    ]\n  },\n})\n\nfunction openImageViewerModal(images: ImageInfo[], initialIndex: number) {\n  // Create a temporary container div for the Vue modal instance\n  const container = document.createElement('div')\n  document.body.appendChild(container)\n\n  // Create the Vue app instance for the modal\n  const app = createApp({\n    render() {\n      return h(ImageViewerModal, {\n        show: true,\n        images, // Pass the collected image data\n        initialIndex, // Pass the starting index\n        'onUpdate:show': (value: boolean) => {\n          // Handle the modal closing\n          if (!value) {\n            // Delay unmounting and removal to allow for closing animations\n            setTimeout(() => {\n              app.unmount()\n              container.remove()\n            }, 0) // Timeout 0 ensures it runs after the current execution context\n          }\n        },\n      })\n    },\n  })\n\n  // Mount the Vue app to the container div\n  app.mount(container)\n}\n","import { Node, mergeAttributes, Editor } from '@tiptap/core'\nimport { Node as ProseMirrorNode } from '@tiptap/pm/model'\nimport { EditorView } from '@tiptap/pm/view'\nimport { UploadedFile } from '../../utils/useFileUpload'\n\nexport interface VideoOptions {\n  uploadFunction: ((file: File) => Promise<UploadedFile>) | null\n  HTMLAttributes: Record<string, any>\n}\n\nexport interface SetVideoOptions {\n  src: string\n}\n\ndeclare module '@tiptap/core' {\n  interface Commands<ReturnType> {\n    video: {\n      setVideo: (options: SetVideoOptions) => ReturnType\n      uploadVideo: (file: File) => ReturnType\n      selectAndUploadVideo: () => ReturnType\n    }\n  }\n}\n\nexport default Node.create<VideoOptions>({\n  name: 'video',\n  group: 'block',\n  selectable: true,\n  draggable: true,\n  atom: true,\n\n  addOptions() {\n    return {\n      uploadFunction: null,\n      HTMLAttributes: {},\n    }\n  },\n\n  addAttributes() {\n    return {\n      src: {\n        default: null,\n      },\n    }\n  },\n\n  parseHTML() {\n    return [\n      {\n        tag: 'video',\n      },\n    ]\n  },\n\n  renderHTML({ HTMLAttributes }) {\n    return [\n      'video',\n      mergeAttributes(this.options.HTMLAttributes, HTMLAttributes, {\n        controls: '',\n      }),\n    ]\n  },\n\n  addCommands() {\n    return {\n      setVideo:\n        (options: SetVideoOptions) =>\n        ({ commands }) => {\n          return commands.insertContent({\n            type: this.name,\n            attrs: options,\n          })\n        },\n\n      uploadVideo:\n        (file: File) =>\n        ({ editor }) => {\n          const pos = editor.state.selection.from\n          return uploadVideoInternal(file, editor.view, pos, this.options)\n        },\n\n      selectAndUploadVideo:\n        () =>\n        ({ editor }) => {\n          if (!this.options.uploadFunction) {\n            console.error('uploadFunction option is not provided for videos.')\n            return false\n          }\n\n          const input = document.createElement('input')\n          input.type = 'file'\n          input.accept = 'video/*'\n          input.onchange = (event) => {\n            const target = event.target as HTMLInputElement\n            if (target.files && target.files.length) {\n              const file = target.files[0]\n              editor.commands.uploadVideo(file)\n            }\n          }\n          input.click()\n          return true\n        },\n    }\n  },\n\n  addNodeView() {\n    return ({ editor, node }: { editor: Editor; node: ProseMirrorNode }) => {\n      const div = document.createElement('div')\n      div.className =\n        'relative aspect-w-16 aspect-h-9' +\n        (editor.isEditable ? ' cursor-pointer' : '')\n\n      const video = document.createElement('video')\n      video.src = node.attrs.src\n      video.setAttribute('controls', '')\n\n      if (editor.isEditable) {\n        let videoPill = document.createElement('div')\n        videoPill.className =\n          'absolute top-0 right-0 text-xs m-2 bg-surface-gray-6 text-ink-white px-2 py-1 rounded-md'\n        videoPill.innerHTML = 'Video'\n        div.append(videoPill)\n      }\n      div.append(video)\n      return {\n        dom: div,\n      }\n    }\n  },\n})\n\nfunction uploadVideoInternal(\n  file: File,\n  view: EditorView,\n  pos: number | null | undefined,\n  options: Record<string, any>,\n): boolean {\n  if (!options.uploadFunction) {\n    console.error('uploadFunction option is not provided for videos.')\n    return false\n  }\n\n  options\n    .uploadFunction(file)\n    .then((uploadedVideo: UploadedFile) => {\n      const { schema } = view.state\n      const node = schema.nodes.video.create({ src: uploadedVideo.file_url })\n\n      const transaction = view.state.tr\n      if (pos != null) {\n        transaction.insert(pos, node)\n      } else {\n        transaction.replaceSelectionWith(node)\n      }\n      view.dispatch(transaction)\n    })\n    .catch((error: Error) => {\n      console.error('Video upload failed:', error)\n    })\n\n  return true\n}\n","import { IframeOptions } from './iframe-extension'\n\n\nexport const ALLOWED_DOMAINS = [\n  'youtube.com',\n  'www.youtube.com',\n  'youtu.be',\n  'vimeo.com',\n  'player.vimeo.com',\n  'codepen.io',\n  'codesandbox.io',\n  'figma.com',\n  'www.figma.com',\n  'embed.figma.com',\n  'docs.google.com',\n  'drive.google.com',\n  'notion.so',\n  'www.notion.so',\n]\n\nexport interface AspectRatioInfo {\n  ratio: number\n  width: number\n  height: number\n  platform: string\n}\n\nexport interface PlatformConfig {\n  name: string\n  ratio: number\n  defaultWidth: number\n  urlPatterns: string[]\n}\n\n// Platform-specific configurations\nconst PLATFORM_CONFIGS: PlatformConfig[] = [\n  {\n    name: 'YouTube',\n    ratio: 9/16, // 16:9 aspect ratio\n    defaultWidth: 640,\n    urlPatterns: ['youtube.com', 'youtu.be', 'youtube-nocookie.com']\n  },\n  {\n    name: 'Vimeo',\n    ratio: 9/16, // 16:9 aspect ratio\n    defaultWidth: 640,\n    urlPatterns: ['vimeo.com', 'player.vimeo.com']\n  },\n  {\n    name: 'CodePen',\n    ratio: 3/2, // 2:3 aspect ratio (taller for code demos)\n    defaultWidth: 500,\n    urlPatterns: ['codepen.io']\n  },\n  {\n    name: 'CodeSandbox',\n    ratio: 3/2, // 2:3 aspect ratio\n    defaultWidth: 500,\n    urlPatterns: ['codesandbox.io']\n  },\n  {\n    name: 'Figma',\n    ratio: 9/16, // 16:9 default for design embeds\n    defaultWidth: 800,\n    urlPatterns: ['figma.com', 'www.figma.com', 'embed.figma.com']\n  },\n  {\n    name: 'Google Docs',\n    ratio: 4/3, // 4:3 for documents\n    defaultWidth: 600,\n    urlPatterns: ['docs.google.com', 'drive.google.com']\n  },\n  {\n    name: 'Notion',\n    ratio: 4/3, // 4:3 for pages\n    defaultWidth: 600,\n    urlPatterns: ['notion.so', 'www.notion.so']\n  },\n]\n\nexport function detectPlatform(url: string): PlatformConfig | null {\n  try {\n    const urlObj = new URL(url)\n    const domain = urlObj.hostname.toLowerCase()\n\n    return PLATFORM_CONFIGS.find(config =>\n      config.urlPatterns.some(pattern => domain.includes(pattern))\n    ) || null\n  } catch {\n    return null\n  }\n}\n\nexport function calculateAspectRatio(url: string): AspectRatioInfo {\n  const platform = detectPlatform(url)\n\n  if (platform) {\n    return {\n      ratio: platform.ratio,\n      width: platform.defaultWidth,\n      height: Math.round(platform.defaultWidth * platform.ratio),\n      platform: platform.name\n    }\n  }\n\n  // Default to 16:9 for unknown platforms\n  return {\n    ratio: 9/16,\n    width: 640,\n    height: 360,\n    platform: 'Generic'\n  }\n}\n\nexport function getOptimalDimensions(url: string, containerWidth?: number): { width: number, height: number } {\n  const aspectInfo = calculateAspectRatio(url)\n\n  // If container width is provided, scale to fit\n  if (containerWidth) {\n    const CONTAINER_PADDING = 40 // px for editor padding\n    const maxWidth = Math.min(containerWidth - CONTAINER_PADDING, aspectInfo.width)\n    return {\n      width: maxWidth,\n      height: Math.round(maxWidth * aspectInfo.ratio)\n    }\n  }\n\n  return {\n    width: aspectInfo.width,\n    height: aspectInfo.height\n  }\n}\n\nexport function validateURL(url: string, options: IframeOptions): boolean {\n  try {\n    if (url.startsWith('/')) return true\n    const urlObj = new URL(url)\n    const domain = urlObj.hostname.toLowerCase()\n\n    // Check blocked domains first\n    if (options.blockedDomains?.some((blocked) => domain.includes(blocked))) {\n      return false\n    }\n\n    // If allowedDomains is specified, check if domain is allowed\n    if (options.allowedDomains?.length) {\n      return options.allowedDomains.some((allowed) =>\n        domain.includes(allowed.toLowerCase())\n      )\n    }\n\n    // If no allowedDomains specified, allow all except blocked\n    return true\n  } catch {\n    return false\n  }\n}\n\nexport function processURL(url: string): string {\n  try {\n    const urlObj = new URL(url)\n    const domain = urlObj.hostname.toLowerCase()\n\n    // YouTube URL processing\n    if (domain.includes('youtube.com') || domain.includes('youtu.be')) {\n      return convertToYouTubeEmbed(url)\n    }\n\n    // Vimeo URL processing\n    if (domain.includes('vimeo.com')) {\n      return convertToVimeoEmbed(url)\n    }\n\n    // CodePen URL processing\n    if (domain.includes('codepen.io')) {\n      return convertToCodePenEmbed(url)\n    }\n\n    // Figma URL processing\n    if (domain.includes('figma.com')) {\n      return convertToFigmaEmbed(url)\n    }\n\n    // For other supported domains, return as-is\n    return url\n  } catch {\n    return url\n  }\n}\n\nfunction convertToYouTubeEmbed(url: string): string {\n  try {\n    const urlObj = new URL(url)\n    let videoId = ''\n\n    if (urlObj.hostname === 'youtu.be') {\n      videoId = urlObj.pathname.slice(1)\n    } else if (urlObj.hostname.includes('youtube.com')) {\n      videoId = urlObj.searchParams.get('v') || ''\n\n      // Handle /embed/ URLs that are already in embed format\n      if (urlObj.pathname.includes('/embed/')) {\n        return url\n      }\n    }\n\n    if (videoId) {\n      // Add common YouTube embed parameters for better UX\n      return `https://www.youtube.com/embed/${videoId}?rel=0&modestbranding=1`\n    }\n  } catch (e) {\n    console.warn('Failed to convert YouTube URL:', e)\n  }\n\n  return url\n}\n\nfunction convertToVimeoEmbed(url: string): string {\n  try {\n    // Handle already embedded URLs\n    if (url.includes('player.vimeo.com')) {\n      return url\n    }\n\n    const match = url.match(/vimeo\\.com\\/(?:.*\\/)?(\\d+)/)\n    if (match?.[1]) {\n      return `https://player.vimeo.com/video/${match[1]}?title=0&byline=0&portrait=0`\n    }\n  } catch (e) {\n    console.warn('Failed to convert Vimeo URL:', e)\n  }\n\n  return url\n}\n\nfunction convertToCodePenEmbed(url: string): string {\n  try {\n    // Handle already embedded URLs\n    if (url.includes('/embed/')) {\n      return url\n    }\n\n    const match = url.match(/codepen\\.io\\/([^\\/]+)\\/pen\\/([^\\/\\?]+)/)\n    if (match?.[1] && match?.[2]) {\n      return `https://codepen.io/${match[1]}/embed/${match[2]}?default-tab=result`\n    }\n  } catch (e) {\n    console.warn('Failed to convert CodePen URL:', e)\n  }\n\n  return url\n}\n\nfunction convertToFigmaEmbed(url: string): string {\n  try {\n    const urlObj = new URL(url)\n\n    // Convert direct Figma links to embed URLs\n    if (urlObj.hostname === 'www.figma.com' || urlObj.hostname === 'figma.com') {\n      // Convert https://www.figma.com/design/... to https://embed.figma.com/design/...\n      if (urlObj.pathname.startsWith('/design/')) {\n        urlObj.hostname = 'embed.figma.com'\n        // Set embed-host to 'share' for public embeds\n        urlObj.searchParams.set('embed-host', 'share')\n        return urlObj.toString()\n      }\n    }\n\n    // For already embedded URLs, just ensure embed-host is set\n    if (urlObj.hostname === 'embed.figma.com') {\n      if (!urlObj.searchParams.has('embed-host')) {\n        urlObj.searchParams.set('embed-host', 'share')\n      }\n      return urlObj.toString()\n    }\n\n    return url\n  } catch (e) {\n    console.warn('Failed to convert Figma URL:', e)\n  }\n\n  return url\n}\n","import { Node, mergeAttributes } from '@tiptap/core'\nimport { VueNodeViewRenderer } from '@tiptap/vue-3'\nimport { Plugin, PluginKey } from '@tiptap/pm/state'\nimport IframeNodeView from './IframeNodeView.vue'\nimport { validateURL, processURL, getOptimalDimensions, ALLOWED_DOMAINS } from './utils'\n\n// Constants for iframe constraints\nconst MIN_IFRAME_WIDTH = 200\nconst EDITOR_PADDING = 40\nconst DEFAULT_EMBED_HOST = 'gameplan'\n\nexport interface IframeOptions {\n  allowedDomains?: string[]\n  blockedDomains?: string[]\n  HTMLAttributes: Record<string, any>\n}\n\nexport interface SetIframeOptions {\n  src: string\n  width?: number\n  height?: number\n  title?: string\n  interactive?: boolean\n  align?: 'left' | 'center' | 'right'\n}\n\ndeclare module '@tiptap/core' {\n  interface Commands<ReturnType> {\n    iframe: {\n      setIframe: (options: SetIframeOptions) => ReturnType\n      insertIframeURL: (url: string) => ReturnType\n      setIframeAlign: (align: 'left' | 'center' | 'right') => ReturnType\n      openIframeDialog: () => ReturnType\n    }\n  }\n}\n\nexport const IframeExtension = Node.create<IframeOptions>({\n  name: 'iframe',\n  group: 'block',\n  selectable: true,\n  draggable: true,\n  atom: true,\n\n  addOptions() {\n    return {\n      allowedDomains: ALLOWED_DOMAINS,\n      blockedDomains: [],\n      HTMLAttributes: {},\n    }\n  },\n\n  addAttributes() {\n    return {\n      src: {\n        default: null,\n        parseHTML: (element) => element.getAttribute('src'),\n        renderHTML: (attributes) => ({\n          src: attributes.src,\n        }),\n      },\n      width: {\n        default: null,\n        parseHTML: (element) => {\n          const width = element.getAttribute('width')\n          return width ? parseInt(width, 10) : null\n        },\n        renderHTML: (attributes) => ({\n          width: attributes.width ? String(attributes.width) : null,\n        }),\n      },\n      height: {\n        default: null,\n        parseHTML: (element) => {\n          const height = element.getAttribute('height')\n          return height ? parseInt(height, 10) : null\n        },\n        renderHTML: (attributes) => ({\n          height: attributes.height ? String(attributes.height) : null,\n        }),\n      },\n      aspectRatio: {\n        default: 9/16, // Default 16:9 aspect ratio\n        parseHTML: () => null, // Don't parse from HTML\n        renderHTML: () => ({}), // Don't render to HTML\n      },\n      align: {\n        default: 'center',\n        parseHTML: (element) => {\n          const align = (\n            element.getAttribute('data-align') ||\n            element.getAttribute('align') ||\n            'left'\n          ).toLowerCase()\n\n          if (['left', 'center', 'right'].includes(align)) {\n            return align as 'left' | 'center' | 'right'\n          }\n          return 'left'\n        },\n        renderHTML: (attributes) => {\n          return {\n            'data-align': attributes.align || 'center',\n          }\n        },\n      },\n      title: {\n        default: null,\n        parseHTML: (element) => element.getAttribute('title'),\n        renderHTML: (attributes) => ({\n          title: attributes.title,\n        }),\n      },\n      frameborder: {\n        default: '0',\n        renderHTML: () => ({\n          frameborder: '0',\n        }),\n      },\n      allowfullscreen: {\n        default: 'true',\n        renderHTML: () => ({\n          allowfullscreen: 'true',\n        }),\n      },\n      sandbox: {\n        default: 'allow-scripts allow-same-origin allow-popups allow-forms',\n        renderHTML: (attributes) => ({\n          sandbox: attributes.sandbox,\n        }),\n      },\n      interactive: {\n        default: false,\n        parseHTML: (el) => el.getAttribute('data-interactive') === 'true',\n        renderHTML: (attrs) => ({\n          'data-interactive': attrs.interactive ? 'true' : 'false',\n        }),\n      },\n    }\n  },\n\n  parseHTML() {\n    return [\n      {\n        tag: 'iframe[src]',\n        getAttrs: (element) => {\n          const src = (element as HTMLElement).getAttribute('src')\n          const width = (element as HTMLElement).getAttribute('width')\n          const height = (element as HTMLElement).getAttribute('height')\n          const title = (element as HTMLElement).getAttribute('title')\n          const align = (element as HTMLElement).getAttribute('data-align')\n\n          return {\n            src,\n            width: width ? parseInt(width, 10) : null,\n            height: height ? parseInt(height, 10) : null,\n            title: title || null,\n            align: align || 'center'\n          }\n        },\n      },\n    ]\n  },\n\n  renderHTML({ HTMLAttributes }) {\n    return [\n      'iframe',\n      mergeAttributes(this.options.HTMLAttributes, HTMLAttributes, {\n        loading: 'lazy',\n        referrerpolicy: 'no-referrer-when-downgrade',\n      }),\n    ]\n  },\n\n  addNodeView() {\n    return VueNodeViewRenderer(IframeNodeView)\n  },\n\n  addCommands() {\n    return {\n      setIframeAlign:\n        (align: 'left' | 'center' | 'right') =>\n        ({ commands }) => {\n          return commands.updateAttributes(this.name, { align })\n        },\n\n      setIframe:\n        (options: SetIframeOptions) =>\n        ({ commands, editor }) => {\n          if (!validateURL(options.src, this.options)) {\n            return false\n          }\n\n          const processedSrc = processURL(options.src)\n\n          // Calculate optimal dimensions if not provided\n          const editorElement = editor.view.dom\n          const editorWidth = editorElement?.clientWidth || 800\n          const optimalDimensions = getOptimalDimensions(processedSrc, editorWidth)\n\n          const attrs = {\n            src: processedSrc,\n            width: options.width || optimalDimensions.width,\n            height: options.height || optimalDimensions.height,\n            title: options.title,\n            align: options.align || 'center',\n            aspectRatio: optimalDimensions.height / optimalDimensions.width,\n            interactive: options.interactive,\n          }\n\n          return commands.insertContent({\n            type: this.name,\n            attrs\n          })\n        },\n\n      insertIframeURL:\n        (url: string) =>\n        ({ commands }) => {\n          const processedUrl = processURL(url)\n          return commands.setIframe({ src: processedUrl })\n        },\n\n      openIframeDialog:\n        () =>\n        ({ editor }) => {\n          // Emit a custom event on the editor's view DOM element\n          // This is more localized than document.dispatchEvent\n          const event = new CustomEvent('iframe:open-dialog', {\n            detail: { editor }\n          })\n          editor.view.dom.dispatchEvent(event)\n          return true\n        },\n    }\n  },\n\n  // Add ProseMirror plugin for paste handling\n  addProseMirrorPlugins() {\n    const extensionThis = this\n\n    return [\n      new Plugin({\n        key: new PluginKey('iframe-paste-handler'),\n        props: {\n          handlePaste: (view, event, slice) => {\n            const text = event.clipboardData?.getData('text/plain')\n            const html = event.clipboardData?.getData('text/html')\n\n            // First, check for iframe embed codes in HTML content\n            if (html) {\n              const iframeData = parseIframeFromHTML(html)\n              if (iframeData) {\n                return createIframeNode(view, extensionThis, iframeData.src, iframeData.width, iframeData.height, iframeData.title)\n              }\n            }\n\n            // Check if plain text contains iframe embed code\n            if (text && text.includes('<iframe')) {\n              const iframeData = parseIframeFromHTML(text)\n              if (iframeData) {\n                return createIframeNode(view, extensionThis, iframeData.src, iframeData.width, iframeData.height, iframeData.title)\n              }\n            }\n\n            // Fallback to URL detection for plain text\n            if (text) {\n              // Check if pasted text is a supported embed URL\n              const urlPattern = /^https?:\\/\\/(?:www\\.)?(?:youtube\\.com\\/watch\\?v=[\\w-]+|youtu\\.be\\/[\\w-]+|youtube\\.com\\/embed\\/[\\w-]+|vimeo\\.com\\/\\d+|player\\.vimeo\\.com\\/video\\/\\d+|codepen\\.io\\/[\\w-]+\\/pen\\/[\\w-]+|codesandbox\\.io\\/[\\w\\/.-]+|figma\\.com\\/[\\w\\/.-]+|embed\\.figma\\.com\\/[\\w\\/.-]+)$/\n\n              if (urlPattern.test(text.trim())) {\n                return createIframeNode(view, extensionThis, text.trim())\n              }\n            }\n\n            return false // Allow default paste behavior\n          },\n        },\n      }),\n    ]\n  },\n})\n\n// Helper function to parse iframe embed codes from pasted HTML content\nfunction parseIframeFromHTML(html: string): { src: string, width?: number, height?: number, title?: string } | null {\n  try {\n    const parser = new DOMParser()\n    const doc = parser.parseFromString(html, 'text/html')\n    const iframe = doc.querySelector('iframe')\n\n    if (!iframe) {\n      // Fallback: try to parse iframe tag using regex\n      const iframeMatch = html.match(/<iframe[^>]*src=[\"']([^\"']+)[\"'][^>]*>/i)\n      if (iframeMatch) {\n        const src = iframeMatch[1]\n        const widthMatch = html.match(/width=[\"'](\\d+)[\"']/i)\n        const heightMatch = html.match(/height=[\"'](\\d+)[\"']/i)\n        const titleMatch = html.match(/title=[\"']([^\"']+)[\"']/i)\n\n        return {\n          src,\n          width: widthMatch ? parseInt(widthMatch[1], 10) : undefined,\n          height: heightMatch ? parseInt(heightMatch[1], 10) : undefined,\n          title: titleMatch ? titleMatch[1] : undefined\n        }\n      }\n      return null\n    }\n\n    const src = iframe.getAttribute('src')\n    if (!src) return null\n\n    const width = iframe.getAttribute('width') ? parseInt(iframe.getAttribute('width')!, 10) : undefined\n    const height = iframe.getAttribute('height') ? parseInt(iframe.getAttribute('height')!, 10) : undefined\n    const title = iframe.getAttribute('title') || undefined\n\n    return { src, width, height, title }\n  } catch (error) {\n    return null\n  }\n}\n\n// Helper function to create iframe node from parsed data\nfunction createIframeNode(view: any, extensionThis: any, src: string, width?: number, height?: number, title?: string) {\n  // Ask user for confirmation before creating iframe\n  const shouldCreateEmbed = confirm(`Do you want to embed this content?\\n\\nURL: ${src}\\n\\nClick \"OK\" to create an embed, or \"Cancel\" to paste as plain text.`)\n\n  if (!shouldCreateEmbed) {\n    return false // Allow default paste behavior (paste as text)\n  }\n\n  if (!validateURL(src, extensionThis.options)) {\n    return false\n  }\n\n  console.log('URL validated, creating iframe node')\n  const processedUrl = processURL(src)\n  const editorElement = extensionThis.editor.view.dom\n  const editorWidth = editorElement?.clientWidth || 800\n\n  // Use provided dimensions or calculate optimal ones\n  const finalWidth = width || getOptimalDimensions(processedUrl, editorWidth).width\n  const finalHeight = height || getOptimalDimensions(processedUrl, editorWidth).height\n\n  const attrs = {\n    src: processedUrl,\n    width: finalWidth,\n    height: finalHeight,\n    title: title,\n    align: 'center' as const,\n    aspectRatio: finalHeight / finalWidth\n  }\n\n  const node = view.state.schema.nodes.iframe.create(attrs)\n  const tr = view.state.tr.replaceSelectionWith(node)\n  view.dispatch(tr)\n\n  return true // Prevent default paste behavior\n}\n\nexport default IframeExtension\n","/**\n * Validates if the given string is a valid URL, including common protocols,\n * relative paths, and anchor links. It also allows an empty string.\n *\n * @param url The URL string to validate.\n * @returns True if the URL is considered valid, false otherwise.\n */\nexport function isValidUrl(url: string): boolean {\n  if (url === '') {\n    return true // Allows empty string as per documentation\n  }\n\n  // Regex for absolute URLs with common schemes (http, https, mailto, tel, //)\n  // Allows for paths, query strings, and fragments.\n  if (/^(https?:\\/\\/|mailto:|tel:|\\/\\/)[^\\s]+$/i.test(url)) {\n    return true\n  }\n\n  // Regex for:\n  // 1. Relative paths (starting with / or .)\n  // 2. Anchor links (starting with #)\n  // These allow for most characters except whitespace, as the initial characters\n  // prevent misinterpretation as a scheme like 'javascript:'.\n  if (/^([./#][^\\s]*)$/i.test(url)) {\n    return true\n  }\n\n  // Regex for \"Schemeless\" paths (e.g., page.html, my-document, slug-name)\n  // Must start with a word character or hyphen.\n  // Subsequent characters are restricted to common URL path/query/fragment characters\n  // (alphanumeric, -, _, ., /, #, ?, =, &, %).\n  // This prevents colons (avoiding 'javascript:' like schemes) and other problematic\n  // characters like spaces, (, ), !, {, }.\n  if (/^[\\w\\-]([\\w\\-./#?=&%]*)$/i.test(url)) {\n    return true\n  }\n\n  return false\n}\n","import { Editor } from '@tiptap/core'\nimport { MarkType } from '@tiptap/pm/model'\nimport { Plugin, PluginKey } from '@tiptap/pm/state'\nimport { isValidUrl } from '../../utils/url-validation'\n\ntype PasteHandlerOptions = {\n  editor: Editor\n  defaultProtocol: string\n  type: MarkType\n}\n\nexport function linkPasteHandler(options: PasteHandlerOptions): Plugin {\n  return new Plugin({\n    key: new PluginKey('handlePasteLink'),\n    props: {\n      handlePaste: (view, event, slice) => {\n        const { state } = view\n        const { selection } = state\n        const { empty } = selection\n\n        if (empty) {\n          return false\n        }\n\n        let textContent = ''\n        slice.content.forEach((node) => {\n          textContent += node.textContent\n        })\n        if (!textContent) {\n          return false\n        }\n\n        let link = isValidUrl(textContent) ? textContent : null\n        if (!link) {\n          return false\n        }\n\n        return options.editor\n          .chain()\n          .setTextSelection({ from: selection.from, to: selection.to })\n          .setLink({ href: link })\n          .setTextSelection(selection.to)\n          .command(({ tr }) => {\n            tr.setStoredMarks([])\n            return true\n          })\n          .run()\n      },\n    },\n  })\n}\n","import { createApp, h } from 'vue'\nimport Link from '@tiptap/extension-link'\nimport tippy, { type Instance as TippyInstance } from 'tippy.js'\nimport { getMarkRange, Range, Editor } from '@tiptap/core'\nimport { MarkType, Mark as ProseMirrorMark } from '@tiptap/pm/model'\nimport { Plugin, PluginKey } from '@tiptap/pm/state'\nimport EditLink from './EditLink.vue'\nimport { linkPasteHandler } from './linkPasteHandler'\n\ndeclare module '@tiptap/core' {\n  interface Commands<ReturnType> {\n    link: {\n      /**\n       * Opens the link editor bubble menu.\n       */\n      openLinkEditor: () => ReturnType\n    }\n  }\n}\n\nexport const LinkExtension = Link.extend({\n  addOptions() {\n    return {\n      ...this.parent?.(),\n      openOnClick: false,\n      autolink: true,\n      defaultProtocol: 'https',\n      linkOnPaste: false,\n    }\n  },\n\n  addCommands() {\n    return {\n      ...this.parent?.(),\n      openLinkEditor:\n        () =>\n        ({ editor }: { editor: Editor }): boolean => {\n          const { state } = editor\n          const { from, to } = state.selection\n          const { doc } = state\n\n          let range: Range | undefined = undefined\n          let mark: ProseMirrorMark | undefined = undefined\n          let shouldDelayPopover = false\n\n          // Check if cursor is within a link or if there's a selection\n          if (from === to) {\n            // Cursor is within a link\n            const $pos = state.selection.$from\n            const markRange = getMarkRange($pos, this.type)\n            if (markRange) {\n              range = markRange\n              mark = doc\n                .resolve(markRange.from)\n                .marks()\n                .find((m) => m.type === this.type)\n\n              // Select the link text\n              editor\n                .chain()\n                .setTextSelection({ from: markRange.from, to: markRange.to })\n                .run()\n              shouldDelayPopover = true\n            } else {\n              // No selection and not within a link, and cursor not in link\n              return false\n            }\n          } else {\n            // There is a selection\n            range = { from, to }\n            // Check if the selection is already a link\n            mark = doc\n              .resolve(from)\n              .marks()\n              .find((m) => m.type === this.type)\n          }\n\n          if (!range) return false\n\n          const existingHref = mark?.attrs.href || ''\n          const selectionFrom = range.from\n          const selectionTo = range.to\n\n          const showPopover = () => {\n            openLinkEditor(existingHref, editor.view.dom)\n              .then((href) => {\n                if (href === null) {\n                  return\n                }\n\n                let chain = editor\n                  .chain()\n                  .focus(null, { scrollIntoView: false })\n\n                if (href === '') {\n                  chain\n                    .setTextSelection({ from: selectionFrom, to: selectionTo })\n                    .unsetLink()\n                    .command(({ tr }) => {\n                      tr.setStoredMarks([])\n                      return true\n                    })\n                    .run()\n                  return\n                }\n\n                chain = chain\n                  .setTextSelection({ from: selectionFrom, to: selectionTo })\n                  .setLink({ href })\n                  .setTextSelection(selectionTo)\n                  .command(({ tr }) => {\n                    tr.setStoredMarks([])\n                    return true\n                  })\n\n                const posAfterLink = selectionTo\n                const charAfter =\n                  posAfterLink < doc.content.size\n                    ? doc.textBetween(posAfterLink, posAfterLink + 1)\n                    : null\n\n                if (charAfter === null || charAfter !== ' ') {\n                  chain = chain.insertContent(' ')\n                }\n\n                chain.run()\n              })\n              .catch(() => {})\n          }\n\n          if (shouldDelayPopover) {\n            requestAnimationFrame(showPopover)\n          } else {\n            showPopover()\n          }\n\n          return true\n        },\n    }\n  },\n\n  addKeyboardShortcuts() {\n    return {\n      'Mod-k': () => this.editor.commands.openLinkEditor(),\n    }\n  },\n\n  addProseMirrorPlugins() {\n    let plugins = this.parent?.() || []\n\n    plugins.push(\n      linkPasteHandler({\n        editor: this.editor,\n        defaultProtocol: this.options.defaultProtocol,\n        type: this.type,\n      }),\n    )\n\n    plugins.push(\n      clearLinkOnBoundaryPlugin({\n        editor: this.editor,\n        type: this.type,\n      }),\n    )\n\n    return plugins\n  },\n})\n\nfunction openLinkEditor(href: string, anchor: HTMLElement): Promise<string> {\n  return new Promise((resolve, reject) => {\n    const container = document.createElement('div')\n    document.body.appendChild(container)\n\n    let virtualReference: {\n      getBoundingClientRect: () => DOMRect | { [key: string]: any }\n    }\n\n    const selection = window.getSelection()\n    if (selection && selection.rangeCount > 0) {\n      const range = selection.getRangeAt(0)\n      const rect = range.getBoundingClientRect()\n      const isCollapsed = range.collapsed\n\n      virtualReference = {\n        getBoundingClientRect: () => ({\n          width: 0,\n          height: rect.height,\n          top: rect.top,\n          right: isCollapsed ? rect.left : rect.right,\n          bottom: rect.bottom,\n          left: rect.left,\n          x: rect.left,\n          y: rect.top,\n          toJSON: () => {},\n        }),\n      }\n    } else {\n      virtualReference = {\n        getBoundingClientRect: () => anchor.getBoundingClientRect(),\n      }\n    }\n\n    let app: ReturnType<typeof createApp> | null = null\n    let tippyInstance: TippyInstance | null = null\n    let isDestroyed = false\n    let promiseSettled = false\n\n    const settlePromise = (action: 'resolve' | 'reject', value?: any) => {\n      if (promiseSettled) return\n      promiseSettled = true\n      if (action === 'resolve') {\n        resolve(value)\n      } else {\n        reject(value)\n      }\n    }\n\n    const destroy = () => {\n      if (isDestroyed) return\n      isDestroyed = true\n\n      settlePromise('reject', 'Link editing cancelled or destroyed')\n\n      requestAnimationFrame(() => {\n        tippyInstance?.destroy()\n        app?.unmount()\n        container?.remove()\n        app = null\n        tippyInstance = null\n      })\n    }\n\n    app = createApp({\n      render() {\n        return h(EditLink, {\n          href,\n          onClose: () => {\n            settlePromise('reject', 'Link editing cancelled')\n            destroy()\n          },\n          onUpdateHref: (newHref: string) => {\n            settlePromise('resolve', newHref)\n            destroy()\n          },\n        })\n      },\n    })\n\n    app.mount(container)\n\n    tippyInstance = tippy(anchor, {\n      getReferenceClientRect: () => virtualReference.getBoundingClientRect(),\n      content: container,\n      trigger: 'manual',\n      interactive: true,\n      appendTo: document.body,\n      placement: 'top',\n      arrow: false,\n      theme: 'link-editor',\n      maxWidth: 'none',\n      onHidden() {\n        destroy()\n      },\n      hideOnClick: true,\n      interactiveDebounce: 75,\n    })\n\n    if (!tippyInstance) {\n      container.remove()\n      settlePromise('reject', 'Failed to initialize link editor tooltip')\n      return\n    }\n\n    tippyInstance.show()\n  })\n}\n\nfunction clearLinkOnBoundaryPlugin(options: {\n  editor: Editor\n  type: MarkType\n}) {\n  return new Plugin({\n    key: new PluginKey('clearLinkMarkOnBoundary'),\n    appendTransaction: (transactions, oldState, newState) => {\n      if (!options.editor.isEditable) {\n        return null\n      }\n\n      const { tr, doc, selection, storedMarks } = newState\n      const { $from, empty } = selection\n\n      if (!empty || !storedMarks || storedMarks.length === 0) {\n        // Only apply for cursor selections and if there are stored marks\n        return null\n      }\n\n      const linkMarkType = options.type\n      const hasStoredLinkMark = storedMarks.some(\n        (mark) => mark.type === linkMarkType,\n      )\n\n      if (!hasStoredLinkMark) {\n        return null\n      }\n\n      // Check if the cursor position itself has an active link mark in the document\n      const marksAtCursor = $from.marks()\n      const activeLinkAtCursor = marksAtCursor.some(\n        (mark) => mark.type === linkMarkType,\n      )\n\n      if (activeLinkAtCursor) {\n        // If there's an actual link mark active in the document at the cursor,\n        // then it's correct for the stored mark to be there.\n        return null\n      }\n\n      // If we are here, it means:\n      // 1. Selection is a cursor (empty).\n      // 2. There's a stored link mark.\n      // 3. There's no active link mark in the document at the cursor position.\n      // This indicates the stored link mark should be cleared.\n      return tr.setStoredMarks([])\n    },\n  })\n}\n\nexport default LinkExtension\n","/**\n * Shared utilities for color conversion and mapping across text editor extensions\n */\n\n// Foreground/text color mappings (tailwind scale 600)\nexport const textColorHexMap: Record<string, string> = {\n  black: '#000000',\n  red: '#dc2626',\n  blue: '#1579D0',\n  green: '#16a34a',\n  yellow: '#ca8a04',\n  orange: '#ea580c',\n  purple: '#9333ea',\n  pink: '#db2777',\n  gray: '#6b7280',\n  indigo: '#4f46e5',\n  teal: '#0d9488',\n  cyan: '#06b6d4',\n}\n\n// Background/highlight color mappings (tailwind scale 100)\nexport const highlightColorHexMap: Record<string, string> = {\n  red: '#fecaca',\n  blue: '#bfdbfe',\n  green: '#bbf7d0',\n  yellow: '#fef08a',\n  orange: '#fed7aa',\n  purple: '#e9d5ff',\n  pink: '#fbcfe8',\n  gray: '#e5e7eb',\n  indigo: '#c7d2fe',\n  teal: '#99f6e4',\n  cyan: '#a5f3fc',\n}\n\n// Legacy color mappings for backward compatibility\nexport const legacyTextColorMap: Record<string, string> = {\n  '#1F272E': 'gray',\n  '#ca8a04': 'yellow',\n  '#ea580c': 'orange',\n  '#dc2626': 'red',\n  '#16a34a': 'green',\n  '#1579D0': 'blue',\n  '#9333ea': 'purple',\n  '#db2777': 'pink',\n}\n\nexport const legacyHighlightColorMap: Record<string, string> = {\n  '#fef9c3': 'yellow',\n  '#ffedd5': 'orange',\n  '#fee2e2': 'red',\n  '#dcfce7': 'green',\n  '#D3E9FC': 'blue',\n  '#f3e8ff': 'purple',\n  '#fce7f3': 'pink',\n}\n\n/**\n * Converts a hex or RGB color to the closest named color from our allowed list\n * @param color - Color to convert (e.g. \"#fee2e2\" or \"rgb(254, 226, 226)\")\n * @param allowedColors - List of allowed color names\n * @param colorMap - Map of color names to hex values to compare against\n * @param legacyMap - Optional legacy color mapping for exact matches\n * @returns The closest named color\n */\nexport function getClosestNamedColor(\n  color: string,\n  allowedColors: string[],\n  colorMap: Record<string, string>,\n  legacyMap?: Record<string, string>,\n): string | null {\n  // Check exact match first for quick returns\n  if (legacyMap && color.startsWith('#') && legacyMap[color]) {\n    return legacyMap[color]\n  }\n\n  // Parse the color to RGB values\n  let r = 0,\n    g = 0,\n    b = 0\n\n  // Handle hex format\n  if (color.startsWith('#')) {\n    const hex = color.substring(1)\n    if (hex.length === 6) {\n      r = parseInt(hex.substring(0, 2), 16)\n      g = parseInt(hex.substring(2, 4), 16)\n      b = parseInt(hex.substring(4, 6), 16)\n    }\n  }\n  // Handle rgb format\n  else if (color.startsWith('rgb')) {\n    const rgbMatch = /rgb\\(\\s*(\\d+)\\s*,\\s*(\\d+)\\s*,\\s*(\\d+)\\s*\\)/i.exec(color)\n    if (rgbMatch) {\n      r = parseInt(rgbMatch[1], 10)\n      g = parseInt(rgbMatch[2], 10)\n      b = parseInt(rgbMatch[3], 10)\n    }\n  }\n\n  // Invalid color format\n  if (isNaN(r) || isNaN(g) || isNaN(b)) {\n    return null\n  }\n\n  let closestColor = null\n  let minDistance = Infinity\n\n  // Find the closest color by calculating the Euclidean distance in RGB space\n  for (const colorName of allowedColors) {\n    const namedHex = colorMap[colorName]\n    if (!namedHex) continue\n\n    const namedHexClean = namedHex.startsWith('#')\n      ? namedHex.substring(1)\n      : namedHex\n\n    if (namedHexClean.length !== 6) continue\n\n    const nr = parseInt(namedHexClean.substring(0, 2), 16)\n    const ng = parseInt(namedHexClean.substring(2, 4), 16)\n    const nb = parseInt(namedHexClean.substring(4, 6), 16)\n\n    // Calculate Euclidean distance\n    const distance = Math.sqrt(\n      Math.pow(r - nr, 2) + Math.pow(g - ng, 2) + Math.pow(b - nb, 2),\n    )\n\n    if (distance < minDistance) {\n      minDistance = distance\n      closestColor = colorName\n    }\n  }\n\n  return closestColor\n}\n\n/**\n * Extracts color from a style attribute and converts it to the closest named color\n * @param style - CSS style string (e.g., \"color: #ff0000; font-weight: bold;\")\n * @param allowedColors - List of allowed color names\n * @param colorMap - Map of color names to hex values\n * @param legacyMap - Optional legacy color mapping\n * @param property - CSS property to extract ('color' or 'background-color')\n * @returns The closest named color or null\n */\nexport function extractColorFromStyle(\n  style: string,\n  allowedColors: string[],\n  colorMap: Record<string, string> = textColorHexMap,\n  legacyMap: Record<string, string> = legacyTextColorMap,\n  property: string = 'color',\n): string | null {\n  const allColorsInMap = Object.keys(colorMap)\n\n  // Check for color in hex format\n  const hexColorMatch = new RegExp(`${property}:\\\\s*(#[0-9a-f]{6})`, 'i').exec(\n    style,\n  )\n  if (hexColorMatch && hexColorMatch[1]) {\n    const closestOverallColor = getClosestNamedColor(\n      hexColorMatch[1],\n      allColorsInMap, // Search in all colors from the map\n      colorMap,\n      legacyMap,\n    )\n    if (closestOverallColor) {\n      // Check if this color is in the originally passed 'allowedColors'\n      if (allowedColors.includes(closestOverallColor)) {\n        if (closestOverallColor === 'gray') {\n          return null // Special handling for gray\n        }\n        return closestOverallColor // It's the closest, allowed, and not gray\n      }\n      // If not in allowedColors, this match is invalid for the current context\n    }\n  }\n\n  // Check for color in rgb format\n  const rgbColorMatch = new RegExp(\n    `${property}:\\\\s*(rgb\\\\(\\\\s*\\\\d+\\\\s*,\\\\s*\\\\d+\\\\s*,\\\\s*\\\\d+\\\\s*\\\\))`,\n    'i',\n  ).exec(style)\n  if (rgbColorMatch && rgbColorMatch[1]) {\n    const closestOverallColor = getClosestNamedColor(\n      rgbColorMatch[1],\n      allColorsInMap, // Search in all colors from the map\n      colorMap,\n      legacyMap,\n    )\n    if (closestOverallColor) {\n      // Check if this color is in the originally passed 'allowedColors'\n      if (allowedColors.includes(closestOverallColor)) {\n        if (closestOverallColor === 'gray') {\n          return null // Special handling for gray\n        }\n        return closestOverallColor // It's the closest, allowed, and not gray\n      }\n      // If not in allowedColors, this match is invalid for the current context\n    }\n  }\n\n  return null\n}\n\n/**\n * Extracts text color from a style attribute\n */\nexport function extractTextColorFromStyle(\n  style: string,\n  allowedColors: string[],\n): string | null {\n  return extractColorFromStyle(\n    style,\n    allowedColors,\n    textColorHexMap,\n    legacyTextColorMap,\n    'color',\n  )\n}\n\n/**\n * Extracts background color from a style attribute for highlights\n */\nexport function extractHighlightColorFromStyle(\n  style: string,\n  allowedColors: string[],\n): string | null {\n  return extractColorFromStyle(\n    style,\n    allowedColors,\n    highlightColorHexMap,\n    legacyHighlightColorMap,\n    'background-color',\n  )\n}\n","import '@tiptap/extension-text-style'\n\nimport { Extension } from '@tiptap/core'\nimport { extractTextColorFromStyle } from '../shared/color-utils'\n\nexport type ColorOptions = {\n  /**\n   * The types where the color can be applied\n   * @default ['textStyle']\n   */\n  types: string[]\n\n  /**\n   * Available color names that can be used\n   * @default ['red', 'blue', 'green', 'yellow', 'orange', 'purple', 'pink', 'gray']\n   */\n  colors: string[]\n}\n\ndeclare module '@tiptap/core' {\n  interface Commands<ReturnType> {\n    namedColor: {\n      /**\n       * Set the text color by name\n       * @param colorName The named color to set (e.g., 'blue', 'red')\n       * @example editor.commands.setColorByName('blue')\n       */\n      setColorByName: (colorName: string) => ReturnType\n\n      /**\n       * Unset the text color\n       * @example editor.commands.unsetColor()\n       */\n      unsetColor: () => ReturnType\n    }\n  }\n}\n\n/**\n * This extension allows you to color your text using named colors instead of hex/rgb values.\n * Colors are applied as data attributes that can be styled with CSS for light/dark mode support.\n */\nexport const NamedColorExtension = Extension.create<ColorOptions>({\n  name: 'namedColor',\n\n  addOptions() {\n    return {\n      types: ['textStyle'],\n      colors: [\n        'red',\n        'blue',\n        'green',\n        'yellow',\n        'orange',\n        'purple',\n        'pink',\n        'gray',\n        'teal',\n        'cyan',\n      ],\n    }\n  },\n\n  addGlobalAttributes() {\n    return [\n      {\n        types: this.options.types,\n        attributes: {\n          color: {\n            default: null,\n            parseHTML: (element) => {\n              // Check for CSS custom property format in style attribute\n              const style = element.getAttribute('style')\n              if (style) {\n                const colorMatch = style.match(\n                  /color:\\s*var\\(--prose-color-(\\w+)\\)/,\n                )\n                if (colorMatch && this.options.colors.includes(colorMatch[1])) {\n                  return colorMatch[1]\n                }\n\n                // Fallback: try extracting from legacy formats\n                const extractedColor = extractTextColorFromStyle(\n                  style,\n                  this.options.colors,\n                )\n                if (extractedColor) {\n                  return extractedColor\n                }\n              }\n\n              return null\n            },\n            renderHTML: (attributes) => {\n              if (\n                !attributes.color ||\n                !this.options.colors.includes(attributes.color)\n              ) {\n                return {}\n              }\n              return {\n                style: `color: var(--prose-color-${attributes.color})`,\n              }\n            },\n          },\n        },\n      },\n    ]\n  },\n\n  addCommands() {\n    return {\n      setColorByName:\n        (colorName: string) =>\n        ({ chain, state, editor }) => {\n          // Validate that the color name is allowed\n          if (!this.options.colors.includes(colorName)) {\n            console.warn(\n              `Color \"${colorName}\" is not in the allowed colors list`,\n            )\n            return false\n          }\n\n          const { to, empty } = state.selection\n\n          let commandChain = chain().setMark('textStyle', { color: colorName })\n\n          if (!empty) {\n            commandChain = commandChain\n              .setTextSelection(to)\n              .command(({ tr }) => {\n                tr.setStoredMarks([])\n                return true\n              })\n          }\n\n          return commandChain.focus().run()\n        },\n      unsetColor:\n        () =>\n        ({ chain }) => {\n          return chain()\n            .setMark('textStyle', { color: null })\n            .removeEmptyTextStyle()\n            .run()\n        },\n    }\n  },\n})\n\nexport { NamedColorExtension as default }\n","import { Mark, mergeAttributes } from '@tiptap/core'\nimport {\n  getClosestNamedColor,\n  highlightColorHexMap,\n  legacyHighlightColorMap,\n  extractHighlightColorFromStyle,\n} from '../shared/color-utils'\n\nexport interface HighlightOptions {\n  /**\n   * HTML tag to wrap the highlighted text\n   * @default 'mark'\n   */\n  HTMLAttributes: Record<string, any>\n\n  /**\n   * Available highlight color names that can be used\n   * @default ['yellow', 'blue', 'green', 'red', 'orange', 'purple', 'pink', 'gray']\n   */\n  colors: string[]\n\n  /**\n   * Enable multiple highlight colors\n   * @default true\n   */\n  multicolor: boolean\n}\n\ndeclare module '@tiptap/core' {\n  interface Commands<ReturnType> {\n    namedHighlight: {\n      /**\n       * Set a highlight by color name\n       * @param colorName The named color to set (e.g., 'yellow', 'blue')\n       * @example editor.commands.setHighlightByName('yellow')\n       */\n      setHighlightByName: (colorName: string) => ReturnType\n      /**\n       * Toggle a highlight by color name\n       * @param colorName The named color to toggle (e.g., 'yellow', 'blue')\n       * @example editor.commands.toggleHighlightByName('yellow')\n       */\n      toggleHighlightByName: (colorName: string) => ReturnType\n      /**\n       * Unset the highlight\n       * @example editor.commands.unsetHighlight()\n       */\n      unsetHighlight: () => ReturnType\n    }\n  }\n}\n\n/**\n * This extension allows you to highlight your text using named colors instead of hex/rgb values.\n * Highlights are applied as data attributes that can be styled with CSS for light/dark mode support.\n */\nexport const NamedHighlightExtension = Mark.create<HighlightOptions>({\n  name: 'namedHighlight',\n\n  addOptions() {\n    return {\n      HTMLAttributes: {},\n      multicolor: true,\n      colors: [\n        'yellow',\n        'blue',\n        'green',\n        'red',\n        'orange',\n        'purple',\n        'pink',\n        'gray',\n        'teal',\n        'cyan',\n      ],\n    }\n  },\n\n  addAttributes() {\n    if (!this.options.multicolor) {\n      return {}\n    }\n\n    return {\n      color: {\n        default: null,\n        parseHTML: (element) => {\n          // Check for CSS custom property format in style attribute\n          const style = element.getAttribute('style')\n          if (style) {\n            const highlightMatch = style.match(\n              /background-color:\\s*var\\(--prose-highlight-(\\w+)\\)/,\n            )\n            if (\n              highlightMatch &&\n              this.options.colors.includes(highlightMatch[1])\n            ) {\n              return highlightMatch[1]\n            }\n          }\n\n          // Check for legacy format with data-color attribute (hex value)\n          const legacyColorAttr = element.getAttribute('data-color')\n          if (legacyColorAttr) {\n            const closestColor = getClosestNamedColor(\n              legacyColorAttr,\n              this.options.colors,\n              highlightColorHexMap,\n              legacyHighlightColorMap,\n            )\n            if (closestColor) {\n              return closestColor\n            }\n          }\n\n          // Try extracting from style attribute as fallback\n          if (style) {\n            const extractedColor = extractHighlightColorFromStyle(\n              style,\n              this.options.colors,\n            )\n            if (extractedColor) {\n              return extractedColor\n            }\n          }\n\n          return null\n        },\n        renderHTML: (attributes) => {\n          if (\n            !attributes.color ||\n            !this.options.colors.includes(attributes.color)\n          ) {\n            return {}\n          }\n\n          return {\n            style: `background-color: var(--prose-highlight-${attributes.color})`,\n          }\n        },\n      },\n    }\n  },\n\n  parseHTML() {\n    return [\n      {\n        tag: 'mark',\n      },\n    ]\n  },\n\n  renderHTML({ HTMLAttributes }) {\n    return [\n      'mark',\n      mergeAttributes(this.options.HTMLAttributes, HTMLAttributes),\n      0,\n    ]\n  },\n\n  addCommands() {\n    return {\n      setHighlightByName:\n        (colorName) =>\n        ({ chain, commands, editor, state }) => {\n          // Validate that the color name is allowed\n          if (!this.options.colors.includes(colorName)) {\n            console.warn(\n              `Highlight color \"${colorName}\" is not in the allowed colors list`,\n            )\n            return false\n          }\n\n          const { from, to, empty } = state.selection // Get original selection details\n\n          let commandChain = chain()\n          if (this.options.multicolor) {\n            commandChain = commandChain.setMark(this.name, { color: colorName })\n          } else {\n            commandChain = commandChain.setMark(this.name)\n          }\n\n          if (!empty) {\n            commandChain = commandChain\n              .setTextSelection(to)\n              .command(({ tr }) => {\n                tr.setStoredMarks([])\n                return true\n              })\n          }\n\n          return commandChain.focus().run()\n        },\n      toggleHighlightByName:\n        (colorName) =>\n        ({ chain, commands, editor, state }) => {\n          // Validate that the color name is allowed\n          if (!this.options.colors.includes(colorName)) {\n            console.warn(\n              `Highlight color \"${colorName}\" is not in the allowed colors list`,\n            )\n            return false\n          }\n\n          const { to, empty } = state.selection // Get original selection details\n          const highlightAttributes = this.options.multicolor\n            ? { color: colorName }\n            : undefined\n\n          // Check if the mark is currently active with the given attributes *before* toggling\n          // This helps determine if the toggle action will be setting or unsetting the mark.\n          const isCurrentlyActive = editor.isActive(\n            this.name,\n            highlightAttributes,\n          )\n\n          let commandChain = chain().toggleMark(this.name, highlightAttributes)\n\n          // If the selection was not empty AND the toggle action is about to *set* the mark\n          // (i.e., it wasn't active before)\n          if (!empty && !isCurrentlyActive) {\n            commandChain = commandChain\n              .setTextSelection(to)\n              .command(({ tr }) => {\n                tr.setStoredMarks([])\n                return true\n              })\n          }\n\n          return commandChain.focus().run()\n        },\n      unsetHighlight:\n        () =>\n        ({ commands }) => {\n          return commands.unsetMark(this.name)\n        },\n    }\n  },\n})\n\nexport { NamedHighlightExtension as default }\n","import { Extension, Editor, Range } from '@tiptap/core'\nimport { VueRenderer } from '@tiptap/vue-3'\nimport Suggestion, {\n  SuggestionOptions,\n  SuggestionProps,\n} from '@tiptap/suggestion'\nimport { PluginKey } from '@tiptap/pm/state'\nimport tippy, { Instance as TippyInstance, Props as TippyProps } from 'tippy.js'\nimport { Component as VueComponent } from 'vue'\n\nexport interface BaseSuggestionItem {\n  title?: string\n  name?: string\n  [key: string]: any\n}\n\nexport interface CreateSuggestionExtensionOptions<\n  TItem extends BaseSuggestionItem,\n> {\n  name: string\n  char: string\n  pluginKey: PluginKey\n  items: (props: {\n    query: string\n    editor: Editor\n  }) => TItem[] | Promise<TItem[]>\n  command: (props: { editor: Editor; range: Range; props: TItem }) => void\n  component: VueComponent\n  tippyOptions?: Partial<TippyProps>\n  allowSpaces?: boolean\n  startOfLine?: boolean\n  decorationTag?: string\n  decorationClass?: string\n  addOptions?: () => Record<string, any>\n}\n\nexport function createSuggestionExtension<TItem extends BaseSuggestionItem>(\n  options: CreateSuggestionExtensionOptions<TItem>,\n) {\n  type ExtensionFullOptions = Record<string, any> & {\n    suggestion: Omit<SuggestionOptions<TItem>, 'editor'>\n  }\n\n  return Extension.create<ExtensionFullOptions>({\n    name: options.name,\n\n    addOptions() {\n      const customOptions = options.addOptions\n        ? options.addOptions.call(this)\n        : {}\n\n      return {\n        ...customOptions,\n        suggestion: {\n          char: options.char,\n          pluginKey: options.pluginKey,\n          items: options.items,\n          command: options.command,\n          allowSpaces: options.allowSpaces,\n          startOfLine: options.startOfLine,\n          decorationTag: options.decorationTag || 'span',\n          decorationClass: options.decorationClass || 'suggestion',\n          render: () => {\n            let component: VueRenderer | null\n            let popup: TippyInstance[] | null\n\n            return {\n              onStart: (props: SuggestionProps<TItem>) => {\n                component = new VueRenderer(options.component, {\n                  editor: props.editor,\n                  props: props,\n                })\n\n                if (!props.clientRect || !component.element) {\n                  return\n                }\n\n                const defaultTippyOptions: Partial<TippyProps> = {\n                  getReferenceClientRect: props.clientRect as () => DOMRect,\n                  appendTo: () => document.body,\n                  content: component.element,\n                  showOnCreate: true,\n                  interactive: true,\n                  trigger: 'manual',\n                  placement: 'bottom-start',\n                }\n\n                popup = tippy('body', {\n                  ...defaultTippyOptions,\n                  ...options.tippyOptions,\n                })\n              },\n\n              onUpdate(props: SuggestionProps<TItem>) {\n                component?.updateProps(props)\n\n                if (!props.clientRect) {\n                  return\n                }\n\n                if (popup && popup[0]) {\n                  popup[0].setProps({\n                    getReferenceClientRect: props.clientRect as () => DOMRect,\n                  })\n                }\n              },\n\n              onKeyDown(props: { event: KeyboardEvent }): boolean {\n                if (props.event.key === 'Escape') {\n                  if (popup && popup[0]) {\n                    popup[0].hide()\n                  }\n                  return true\n                }\n\n                if (\n                  component &&\n                  component.ref &&\n                  typeof (component.ref as any).onKeyDown === 'function'\n                ) {\n                  return (component.ref as any).onKeyDown(props)\n                }\n                return false\n              },\n\n              onExit() {\n                if (popup && popup[0]) {\n                  popup[0].destroy()\n                }\n                if (component) {\n                  component.destroy()\n                }\n                popup = null\n                component = null\n              },\n            }\n          },\n        } as Omit<SuggestionOptions<TItem>, 'editor'>,\n      }\n    },\n\n    addProseMirrorPlugins() {\n      return [\n        Suggestion<TItem>({\n          editor: this.editor,\n          ...this.options.suggestion,\n        }),\n      ]\n    },\n  })\n}\n","import { MaybeRefOrGetter, toValue, type Component } from 'vue'\nimport { Extension, Node, mergeAttributes } from '@tiptap/core'\nimport { VueNodeViewRenderer } from '@tiptap/vue-3'\nimport { PluginKey } from '@tiptap/pm/state'\nimport {\n  createSuggestionExtension,\n  BaseSuggestionItem,\n} from '../suggestion/createSuggestionExtension'\nimport SuggestionList from '../suggestion/SuggestionList.vue'\nimport './style.css'\n\nexport interface MentionSuggestionItem extends BaseSuggestionItem {\n  id: string\n  label: string\n  value?: string\n  email?: string\n  full_name?: string\n}\n\nfunction createMentionNode(component?: Component) {\n  const config: any = {\n    name: 'mention',\n    group: 'inline',\n    inline: true,\n    selectable: true,\n    atom: true,\n\n    addOptions() {\n      return {\n        component: undefined,\n      }\n    },\n\n    addAttributes() {\n      return {\n        id: {\n          default: null,\n          parseHTML: (element: HTMLElement) => element.getAttribute('data-id'),\n          renderHTML: (attributes: any) => {\n            if (!attributes.id) {\n              return {}\n            }\n            return { 'data-id': attributes.id }\n          },\n        },\n        label: {\n          default: null,\n          parseHTML: (element: HTMLElement) =>\n            element.getAttribute('data-label'),\n          renderHTML: (attributes: any) => {\n            if (!attributes.label) {\n              return {}\n            }\n            return { 'data-label': attributes.label }\n          },\n        },\n      }\n    },\n\n    parseHTML() {\n      return [\n        {\n          tag: 'span.mention[data-type=\"mention\"]',\n          getAttrs: (dom: any) => {\n            const element = dom as HTMLElement\n            return {\n              id: element.getAttribute('data-id'),\n              label: element.getAttribute('data-label'),\n            }\n          },\n        },\n      ]\n    },\n\n    renderHTML({ HTMLAttributes }: any) {\n      return [\n        'span',\n        mergeAttributes(HTMLAttributes, {\n          class: 'mention',\n          'data-type': 'mention',\n        }),\n        `@${HTMLAttributes['data-label'] || HTMLAttributes.id || ''}`,\n      ]\n    },\n  }\n\n  if (component) {\n    config.addNodeView = () => {\n      return VueNodeViewRenderer(component)\n    }\n  }\n\n  return Node.create(config)\n}\n\nconst MentionSuggestionExtension =\n  createSuggestionExtension<MentionSuggestionItem>({\n    name: 'mentionSuggestion',\n    char: '@',\n    pluginKey: new PluginKey('mentionSuggestion'),\n    component: SuggestionList,\n\n    addOptions() {\n      return {\n        mentions: [],\n      }\n    },\n\n    items: ({ query, editor }) => {\n      const { mentions: _mentions } = editor.extensionManager.extensions.find(\n        (ext) => ext.name === 'mentionSuggestion',\n      )!.options\n      const mentions = toValue(_mentions)\n\n      const filtered = mentions\n        .filter((mention: MentionSuggestionItem) =>\n          mention.label.toLowerCase().startsWith(query.toLowerCase()),\n        )\n        .slice(0, 10)\n        .map((mention: MentionSuggestionItem) => ({\n          ...mention,\n          display: mention.label,\n        }))\n\n      return filtered\n    },\n\n    command: ({ editor, range, props }) => {\n      const attributes = {\n        id: props.id || props.value,\n        label: props.label,\n      }\n\n      editor\n        .chain()\n        .focus()\n        .insertContentAt(range, [\n          {\n            type: 'mention',\n            attrs: attributes,\n          },\n          {\n            type: 'text',\n            text: ' ',\n          },\n        ])\n        .run()\n    },\n\n    tippyOptions: {\n      placement: 'bottom-start',\n      offset: [0, 8],\n    },\n    allowSpaces: false,\n    decorationTag: 'span',\n    decorationClass: 'mention-suggestion-active',\n  })\n\nexport const MentionExtension = Extension.create<{\n  mentions: MaybeRefOrGetter<MentionSuggestionItem[]>\n  component?: Component\n}>({\n  name: 'mentionExtension',\n\n  addOptions() {\n    return {\n      mentions: [],\n      component: undefined,\n    }\n  },\n\n  addExtensions() {\n    return [\n      createMentionNode(this.options.component),\n      MentionSuggestionExtension.configure({\n        mentions: this.options.mentions,\n      }),\n    ]\n  },\n})\n","import { PluginKey } from '@tiptap/pm/state'\nimport {\n  BaseSuggestionItem,\n  createSuggestionExtension,\n} from '../suggestion/createSuggestionExtension'\nimport EmojiList from './EmojiList.vue'\nimport _EMOJIS from './emojis.json'\n\nconst EMOJIS = _EMOJIS as EmojiItem[]\n\nexport interface EmojiItem extends BaseSuggestionItem {\n  name: string\n  emoji: string\n}\n\nexport default createSuggestionExtension<EmojiItem>({\n  name: 'emoji',\n  char: ':',\n  pluginKey: new PluginKey('emojiSuggestion'),\n  items: ({ query }: { query: string }) => {\n    return EMOJIS.filter((item) =>\n      item.name.toLowerCase().includes(query.toLowerCase()),\n    )\n      .sort((a, b) => {\n        const aName = a.name.toLowerCase()\n        const bName = b.name.toLowerCase()\n        const queryLower = query.toLowerCase()\n\n        // Exact matches first\n        if (aName === queryLower && bName !== queryLower) return -1\n        if (bName === queryLower && aName !== queryLower) return 1\n\n        // Then names starting with the query\n        if (aName.startsWith(queryLower) && !bName.startsWith(queryLower))\n          return -1\n        if (bName.startsWith(queryLower) && !aName.startsWith(queryLower))\n          return 1\n\n        // Then sort by name length (shorter first)\n        return aName.length - bName.length\n      })\n      .slice(0, 5)\n  },\n  command: ({ editor, range, props: item }) => {\n    if (item && item.emoji) {\n      editor.chain().focus().deleteRange(range).insertContent(item.emoji).run()\n    } else {\n      console.error(\n        'Emoji command execution error: emoji property not found on selected item or item is invalid.',\n        item,\n      )\n    }\n  },\n  component: EmojiList,\n})\n","import { Editor, Range } from '@tiptap/core'\nimport { PluginKey } from '@tiptap/pm/state'\nimport {\n  createSuggestionExtension,\n  type BaseSuggestionItem,\n} from '../suggestion/createSuggestionExtension'\nimport SlashCommandsList from './SlashCommandsList.vue'\nimport { Component as VueComponent } from 'vue'\n\nimport Heading2 from '~icons/lucide/heading-2'\nimport Heading3 from '~icons/lucide/heading-3'\nimport List from '~icons/lucide/list'\nimport ListOrdered from '~icons/lucide/list-ordered'\nimport ListTask from '~icons/lucide/list-checks'\nimport Code from '~icons/lucide/code'\nimport Quote from '~icons/lucide/quote'\nimport Image from '~icons/lucide/image'\nimport Video from '~icons/lucide/video'\nimport GalleryVertical from '~icons/lucide/gallery-vertical'\nimport Link from '~icons/lucide/link'\nimport Minus from '~icons/lucide/minus'\nimport Table from '~icons/lucide/table-2'\n\nexport const SlashCommandSuggestionKey = new PluginKey<any>(\n  'slashCommandSuggestion',\n)\n\nexport interface CommandItem extends BaseSuggestionItem {\n  title: string\n  icon: VueComponent\n  command: (props: CommandExecutionProps) => void\n}\n\ntype CommandExecutionProps = {\n  editor: Editor\n  range: Range\n}\n\nconst getCommands = (): CommandItem[] => [\n  {\n    title: 'Heading 2',\n    icon: Heading2,\n    command: ({ editor, range }: CommandExecutionProps) => {\n      editor\n        .chain()\n        .focus()\n        .deleteRange(range)\n        .setNode('heading', { level: 2 })\n        .run()\n    },\n  },\n  {\n    title: 'Heading 3',\n    icon: Heading3,\n    command: ({ editor, range }: CommandExecutionProps) => {\n      editor\n        .chain()\n        .focus()\n        .deleteRange(range)\n        .setNode('heading', { level: 3 })\n        .run()\n    },\n  },\n  {\n    title: 'Bullet List',\n    icon: List,\n    command: ({ editor, range }: CommandExecutionProps) => {\n      editor.chain().focus().deleteRange(range).toggleBulletList().run()\n    },\n  },\n  {\n    title: 'Numbered List',\n    icon: ListOrdered,\n    command: ({ editor, range }: CommandExecutionProps) => {\n      editor.chain().focus().deleteRange(range).toggleOrderedList().run()\n    },\n  },\n  {\n    title: 'Task List',\n    icon: ListTask,\n    command: ({ editor, range }: CommandExecutionProps) => {\n      editor.chain().focus().deleteRange(range).toggleTaskList().run()\n    },\n  },\n  {\n    title: 'Code Block',\n    icon: Code,\n    command: ({ editor, range }: CommandExecutionProps) => {\n      editor.chain().focus().deleteRange(range).toggleCodeBlock().run()\n    },\n  },\n  {\n    title: 'Blockquote',\n    icon: Quote,\n    command: ({ editor, range }: CommandExecutionProps) => {\n      editor.chain().focus().deleteRange(range).toggleBlockquote().run()\n    },\n  },\n  {\n    title: 'Image',\n    icon: Image,\n    command: ({ editor, range }: CommandExecutionProps) => {\n      editor.chain().focus().deleteRange(range).selectAndUploadImage().run()\n    },\n  },\n  {\n    title: 'Video',\n    icon: Video,\n    command: ({ editor, range }: CommandExecutionProps) => {\n      editor.chain().focus().deleteRange(range).selectAndUploadVideo().run()\n    },\n  },\n  {\n    title: 'Embed',\n    icon: GalleryVertical,\n    command: ({ editor, range }: CommandExecutionProps) => {\n      editor.chain().focus().deleteRange(range).openIframeDialog().run()\n    },\n  },\n  {\n    title: 'Link',\n    icon: Link,\n    command: ({ editor, range }: CommandExecutionProps) => {\n      editor.chain().focus().deleteRange(range).setLink({ href: '' }).run()\n    },\n  },\n  {\n    title: 'Horizontal Rule',\n    icon: Minus,\n    command: ({ editor, range }: CommandExecutionProps) => {\n      editor.chain().focus().deleteRange(range).setHorizontalRule().run()\n    },\n  },\n  {\n    title: 'Table',\n    icon: Table,\n    command: ({ editor, range }: CommandExecutionProps) => {\n      editor\n        .chain()\n        .focus()\n        .deleteRange(range)\n        .insertTable({ rows: 3, cols: 3, withHeaderRow: true })\n        .run()\n    },\n  },\n]\n\nexport const SlashCommands = createSuggestionExtension<CommandItem>({\n  name: 'slashCommands',\n  char: '/',\n  pluginKey: SlashCommandSuggestionKey,\n  items: ({ query }) => {\n    const commands = getCommands()\n    return commands.filter((item) =>\n      item.title.toLowerCase().startsWith(query.toLowerCase()),\n    )\n  },\n  command: ({ editor, range, props: item }) => {\n    if (item && typeof item.command === 'function') {\n      item.command({ editor, range })\n    } else {\n      console.error(\n        'Slash command execution error: command function not found on selected item or item is invalid.',\n        item,\n      )\n    }\n  },\n  component: SlashCommandsList,\n})\n\nexport default SlashCommands\n","import { marked } from 'marked'\n\nexport function markdownToHTML(text: string): string {\n  // Use synchronous marked.parse\n  return marked.parse(text, {\n    gfm: true,\n    breaks: true,\n    async: false,\n  }) as string\n}\n\nexport function detectMarkdown(text: string): boolean {\n  const lines = text.split('\\n')\n  const markdown = lines.filter(\n    (line) =>\n      // check for inline markdown content like images, links, italic, bold, etc.\n      /!\\[.*\\]\\(.*\\)/.test(line) ||\n      /\\[.*\\]\\(.*\\)/.test(line) ||\n      /(^|\\s)\\*.*\\*(\\s|$)/.test(line) ||\n      /(^|\\s)_.*_(\\s|$)/.test(line) ||\n      /(^|\\s)\\*\\*.*\\*\\*(\\s|$)/.test(line) ||\n      /(^|\\s)__.*__(\\s|$)/.test(line) ||\n      /(^|\\s)~~.*~~(\\s|$)/.test(line) ||\n      // check for block markdown content like headings, code blocks, lists, etc.\n      line.startsWith('![') ||\n      line.startsWith('#') ||\n      line.startsWith('> ') ||\n      line.startsWith('*') ||\n      line.startsWith('- ') ||\n      line.startsWith('1. ') ||\n      line.startsWith('```') ||\n      line.startsWith('`') ||\n      line.startsWith('[') ||\n      line.startsWith('---'),\n  )\n  return markdown.length > 0\n}\n","import { Extension } from '@tiptap/core'\nimport { Plugin, PluginKey } from '@tiptap/pm/state'\nimport { DOMParser } from '@tiptap/pm/model'\nimport { EditorView } from '@tiptap/pm/view'\nimport { detectMarkdown, markdownToHTML } from '../../../utils/markdown'\nimport { processMultipleImages } from './image/image-extension'\n\nexport interface ContentPasteOptions {\n  enabled: boolean\n  showConfirmation: boolean\n  uploadFunction: Function | null\n}\n\nexport const ContentPasteExtension = Extension.create<ContentPasteOptions>({\n  name: 'contentPaste',\n\n  addOptions() {\n    return {\n      enabled: true,\n      showConfirmation: true,\n      uploadFunction: null,\n    }\n  },\n\n  addProseMirrorPlugins() {\n    const extensionThis = this\n    return [\n      new Plugin({\n        key: new PluginKey('contentPaste'),\n        props: {\n          handlePaste: (\n            view: EditorView,\n            event: ClipboardEvent,\n            slice: any,\n          ) => {\n            if (!this.options.enabled) return false\n\n            // handle image pasting\n            const files: File[] | [] = Array.from(\n              event.clipboardData?.files || [],\n            )\n            const images = Array.from(files).filter((file) =>\n              file.type.startsWith('image/'),\n            )\n            if (images.length > 0) {\n              processMultipleImages(images, view, null, extensionThis.options)\n              return true\n            }\n\n            // handle markdown pasting\n            const text = event.clipboardData?.getData('text/plain')\n            if (!text) return false\n\n            if (!detectMarkdown(text)) return false\n\n            if (this.options.showConfirmation) {\n              const shouldConvert = confirm(\n                'Do you want to convert markdown content to HTML before pasting?',\n              )\n              if (!shouldConvert) return false\n            }\n\n            const htmlContent = markdownToHTML(text)\n            const tempDiv = document.createElement('div')\n            tempDiv.innerHTML = htmlContent\n\n            const parser = DOMParser.fromSchema(view.state.schema)\n            const parsedSlice = parser.parseSlice(tempDiv, {\n              preserveWhitespace: true,\n            })\n\n            const tr = view.state.tr.replaceSelection(parsedSlice)\n            view.dispatch(tr)\n\n            return true\n          },\n        },\n      }),\n    ]\n  },\n})\n","import { Node, mergeAttributes, Range, Editor } from '@tiptap/core'\nimport { PluginKey } from '@tiptap/pm/state'\nimport {\n  createSuggestionExtension,\n  BaseSuggestionItem,\n} from '../suggestion/createSuggestionExtension'\nimport SuggestionList from '../suggestion/SuggestionList.vue'\nimport { toValue, unref } from 'vue'\n\nexport const TagNode = Node.create({\n  name: 'tagItem',\n  group: 'inline',\n  inline: true,\n  selectable: true,\n  atom: true,\n\n  addAttributes() {\n    return {\n      tagId: {\n        default: null,\n        parseHTML: (element) => element.getAttribute('data-tag-id'),\n        renderHTML: (attributes) => {\n          if (!attributes.tagId) {\n            return {}\n          }\n          return { 'data-tag-id': attributes.tagId }\n        },\n      },\n      tagLabel: {\n        default: 'tag',\n        parseHTML: (element) => element.getAttribute('data-tag-label'),\n        renderHTML: (attributes) => ({ 'data-tag-label': attributes.tagLabel }),\n      },\n    }\n  },\n\n  parseHTML() {\n    return [\n      {\n        tag: 'span.tag-item',\n        getAttrs: (dom) => {\n          const element = dom as HTMLElement\n          return {\n            tagId: element.getAttribute('data-tag-id'),\n            tagLabel:\n              element.getAttribute('data-tag-label') ||\n              element.innerText.replace(/^#/, ''),\n          }\n        },\n      },\n    ]\n  },\n\n  renderHTML({ HTMLAttributes }) {\n    // HTMLAttributes will include data-tag-id and data-tag-label\n    return [\n      'span',\n      mergeAttributes(HTMLAttributes, { class: 'tag-item' }),\n      `#${HTMLAttributes['data-tag-label']}`,\n    ]\n  },\n\n  addCommands() {\n    return {\n      setTag:\n        (attributes: { tagLabel: string; tagId?: string }) =>\n        ({ commands }) => {\n          return commands.insertContent({\n            type: this.name,\n            attrs: attributes,\n          })\n        },\n    }\n  },\n})\n\ninterface TagSuggestionItem extends BaseSuggestionItem {\n  name?: string\n  label: string\n  isNew?: boolean\n}\n\nexport const TagExtension = createSuggestionExtension<TagSuggestionItem>({\n  name: 'tagSuggestion',\n  char: '#',\n  pluginKey: new PluginKey('tagSuggestion'),\n  component: SuggestionList,\n\n  addOptions() {\n    return {\n      tags: [],\n    }\n  },\n\n  items: ({ query, editor }) => {\n    const { tags: _tags } = editor.extensionManager.extensions.find(\n      (ext) => ext.name === 'tagSuggestion',\n    )!.options\n    let tags = toValue(_tags)\n\n    // Filter existing tags based on the query\n    let filteredTags = tags\n      .filter((tag: TagSuggestionItem) =>\n        tag.label.toLowerCase().startsWith(query.toLowerCase()),\n      )\n      .map((tag: TagSuggestionItem) => ({ ...tag, display: tag.label }))\n\n    if (\n      query.length > 0 &&\n      !tags.some(\n        (tag: TagSuggestionItem) =>\n          tag.label.toLowerCase() === query.toLowerCase(),\n      )\n    ) {\n      filteredTags.push({\n        display: `New tag: \"${query}\"`,\n        label: query,\n        isNew: true,\n      })\n    }\n    return filteredTags\n  },\n\n  command: ({ editor, range, props }) => {\n    const attributes = {\n      tagLabel: props.label,\n      ...(props.id && !props.isNew && { tagId: props.id }),\n    }\n\n    editor\n      .chain()\n      .focus()\n      .insertContentAt(range, [\n        {\n          type: TagNode.name,\n          attrs: attributes,\n        },\n        {\n          type: 'text',\n          text: ' ',\n        },\n      ])\n      .run()\n  },\n\n  tippyOptions: {\n    placement: 'bottom-start',\n    offset: [0, 8],\n  },\n  allowSpaces: false,\n  decorationTag: 'span',\n  decorationClass: 'tag-suggestion-active',\n})\n","import TiptapHeading from '@tiptap/extension-heading'\nimport { textblockTypeInputRule } from '@tiptap/core'\n\n// This custom Heading extension modifies the default input rule behavior.\n// The default Tiptap heading input rule converts text to a heading when '#' is followed by any whitespace (including Enter).\n// This customization ensures that headings are only created when '#' is followed by a literal space.\n// This change is necessary to prevent conflicts with other extensions, such as a tags extension,\n// which uses '#' followed by Enter to add a tag.\nexport const Heading = TiptapHeading.extend({\n  addInputRules() {\n    return this.options.levels.map((level) => {\n      let regexp = new RegExp(`^(#{${level}}) $`)\n      return textblockTypeInputRule({\n        find: regexp,\n        type: this.type,\n        getAttributes: { level },\n      })\n    })\n  },\n})\n","import { Node, mergeAttributes } from '@tiptap/core'\nimport { VueNodeViewRenderer } from '@tiptap/vue-3'\nimport ImageGroupNodeView from './ImageGroupNodeView.vue'\nimport { UploadedFile } from '../../../../utils/useFileUpload'\n\nexport interface ImageGroupOptions {\n  /**\n   * Function to handle image uploads\n   * @default null\n   */\n  uploadFunction: ((file: File) => Promise<UploadedFile>) | null\n  HTMLAttributes: Record<string, any>\n}\n\nexport interface ImageGroupAttrs {\n  columns?: number\n  images: {\n    src: string\n    alt?: string\n  }[]\n}\n\ndeclare module '@tiptap/core' {\n  interface Commands<ReturnType> {\n    imageGroup: {\n      /**\n       * Insert an image group/gallery node\n       */\n      setImageGroup: (attrs: {\n        columns?: number\n        images: { src: string; alt?: string }[]\n      }) => ReturnType\n    }\n  }\n}\n\nexport const ImageGroup = Node.create<ImageGroupOptions>({\n  name: 'imageGroup',\n\n  group: 'block',\n  content: 'image+', // one or more images\n  selectable: true,\n  draggable: true,\n  isolating: true,\n\n  addOptions() {\n    return {\n      uploadFunction: null,\n      HTMLAttributes: {},\n    }\n  },\n\n  addAttributes() {\n    return {\n      columns: {\n        default: 4,\n      },\n    }\n  },\n\n  parseHTML() {\n    return [\n      {\n        tag: 'div[data-type=\"image-group\"]',\n        getAttrs: (element) => {\n          if (typeof element === 'string') return {}\n          const el = element as HTMLElement\n          return {\n            columns: el.getAttribute('data-columns')\n              ? Number(el.getAttribute('data-columns'))\n              : 4,\n          }\n        },\n      },\n    ]\n  },\n\n  renderHTML({ HTMLAttributes, node }) {\n    return [\n      'div',\n      mergeAttributes(\n        {\n          'data-type': 'image-group',\n          'data-columns': node.attrs.columns,\n        },\n        this.options.HTMLAttributes,\n        HTMLAttributes,\n      ),\n      0, // content placeholder for child images\n    ]\n  },\n\n  addNodeView() {\n    return VueNodeViewRenderer(ImageGroupNodeView)\n  },\n\n  addCommands() {\n    return {\n      setImageGroup:\n        (attrs) =>\n        ({ commands }) => {\n          return commands.insertContent({\n            type: this.name,\n            attrs: {\n              columns: attrs.columns || 4,\n            },\n            content: attrs.images.map((img) => ({\n              type: 'image',\n              attrs: img,\n            })),\n          })\n        },\n    }\n  },\n})\n","import DOMPurify from 'dompurify'\nimport { defineComponent, h, ref, Ref } from 'vue'\nimport LoadingIndicator from '../LoadingIndicator.vue'\nimport ToastComponent from './Toast.vue'\nimport type { ToastProps } from './types'\n\ninterface ToastOptions\n  extends Omit<Partial<ToastProps>, 'open' | 'message' | 'title'> {\n  id?: string\n  message: string\n}\n\ninterface ToastItem\n  extends Pick<\n    ToastProps,\n    'duration' | 'action' | 'type' | 'icon' | 'closable'\n  > {\n  id: string\n  open: boolean\n  message: string\n}\n\ninterface ToastPromiseOptions<TData = any, TError = any> {\n  loading: string\n  /** Message for success state, or a function that returns a message. */\n  success: string | ((data: TData) => string)\n  /** Message for error state, or a function that returns a message. */\n  error: string | ((error: TError) => string)\n  /** Optional: Duration in seconds for the success toast. Defaults to 5 seconds. */\n  successDuration?: number\n  /** Optional: Duration in seconds for the error toast. Defaults to 5 seconds. */\n  errorDuration?: number\n  /** Optional: Common duration in seconds for all toast states, unless overridden by successDuration or errorDuration. */\n  duration?: number\n}\n\nconst toastsState: Ref<ToastItem[]> = ref([])\nlet toastIdCounter = 0\n\nconst updateToastInState = (\n  id: string,\n  updates: Partial<Omit<ToastItem, 'id'>>,\n) => {\n  const index = toastsState.value.findIndex((t) => t.id === id)\n  if (index !== -1) {\n    toastsState.value[index] = {\n      ...toastsState.value[index],\n      ...updates,\n      open: true,\n    }\n  }\n}\n\nexport const toast = {\n  create: (options: ToastOptions): string => {\n    const id = `toast-${toastIdCounter++}`\n    const durationInMs =\n      options.duration != null ? options.duration * 1000 : 5000\n\n    const sanitizedMessage = DOMPurify.sanitize(options.message, {\n      ALLOWED_TAGS: ['a', 'em', 'strong', 'i', 'b', 'u'],\n    })\n\n    const toastItem: ToastItem = {\n      id: options.id || id,\n      open: true,\n      message: sanitizedMessage,\n      type: options.type || 'info',\n      duration: durationInMs,\n      action: options.action,\n      icon: options.icon,\n      closable: options.closable ?? true,\n    }\n    toastsState.value.push(toastItem)\n    return toastItem.id\n  },\n  remove: (id: string) => {\n    toastsState.value = toastsState.value.filter((t) => t.id !== id)\n  },\n  removeAll: () => {\n    toastsState.value = []\n  },\n\n  promise: async <TData = any, TError = any>(\n    promiseToResolve: Promise<TData>,\n    options: ToastPromiseOptions<TData, TError>,\n  ): Promise<TData> => {\n    const loadingDurationInSeconds = options.duration ?? 0\n\n    const toastId = toast.create({\n      message: options.loading,\n      type: 'info',\n      icon: () => h(LoadingIndicator, { class: 'text-ink-white' }),\n      duration: loadingDurationInSeconds,\n      closable: false,\n    })\n\n    try {\n      const data = await promiseToResolve\n      const successMessage =\n        typeof options.success === 'function'\n          ? options.success(data)\n          : options.success\n\n      const successToastDurationInSeconds =\n        options.successDuration ?? options.duration ?? 5\n\n      updateToastInState(toastId, {\n        message: successMessage,\n        type: 'success',\n        duration: successToastDurationInSeconds * 1000,\n        icon: undefined,\n        closable: true,\n      })\n      return data\n    } catch (error) {\n      const errorMessage =\n        typeof options.error === 'function'\n          ? options.error(error as TError)\n          : options.error\n\n      const errorToastDurationInSeconds =\n        options.errorDuration ?? options.duration ?? 5\n\n      updateToastInState(toastId, {\n        message: errorMessage,\n        type: 'error',\n        duration: errorToastDurationInSeconds * 1000,\n        icon: undefined,\n        closable: true,\n      })\n      throw error\n    }\n  },\n\n  success: (\n    message: string,\n    options: Omit<ToastOptions, 'message' | 'type'> = {},\n  ) => toast.create({ message, type: 'success', ...options }),\n  error: (\n    message: string,\n    options: Omit<ToastOptions, 'message' | 'type'> = {},\n  ) => toast.create({ message, type: 'error', ...options }),\n  warning: (\n    message: string,\n    options: Omit<ToastOptions, 'message' | 'type'> = {},\n  ) => toast.create({ message, type: 'warning', ...options }),\n  info: (\n    message: string,\n    options: Omit<ToastOptions, 'message' | 'type'> = {},\n  ) => toast.create({ message, type: 'info', ...options }),\n}\n\nexport const Toasts = defineComponent({\n  name: 'FrappeToasts',\n  setup() {\n    const handleUpdateOpen = (id: string, isOpen: boolean) => {\n      if (!isOpen) {\n        toast.remove(id)\n      } else {\n        const t = toastsState.value.find((item) => item.id === id)\n        if (t) t.open = true\n      }\n    }\n\n    const handleActionForItem = (toastItem: ToastItem) => {\n      toast.remove(toastItem.id)\n    }\n\n    return () =>\n      toastsState.value.map((t) =>\n        h(ToastComponent, {\n          key: t.id,\n          open: t.open,\n          message: t.message,\n          type: t.type,\n          duration: t.duration,\n          action: t.action,\n          icon: t.icon,\n          closable: t.closable,\n          'onUpdate:open': (isOpen) => handleUpdateOpen(t.id, isOpen),\n          onAction: () => handleActionForItem(t),\n        }),\n      )\n  },\n})\n","import { ref, computed } from 'vue'\nimport {\n  groupBy,\n  calculateMinutes,\n  findOverlappingEventsCount,\n} from '../calendarUtils'\n\nexport const activeEvent = ref('')\n\nexport default function useCalendarData(events, view = '') {\n  const timedEvents = computed(() => {\n    let groupByDate = groupBy(events, (row) => row.date)\n    let sortedArray = {}\n    if (view === 'Month') {\n      for (const [key, value] of Object.entries(groupByDate)) {\n        sortedArray[key] = sortMonthlyEvents(value)\n      }\n    } else {\n      for (let [key, value] of Object.entries(groupByDate)) {\n        value = value.filter((event) => !event.isFullDay)\n        value.forEach((task) => {\n          task.startTime = calculateMinutes(task.fromTime)\n          task.endTime = calculateMinutes(task.toTime)\n        })\n        let sortedEvents = value.sort((a, b) => a.startTime - b.startTime)\n        sortedArray[key] = findOverlappingEventsCount(sortedEvents)\n      }\n    }\n    return sortedArray\n  })\n\n  const fullDayEvents = computed(() => {\n    let fullDay = events.filter((event) => event.isFullDay)\n    let dateGroup = groupBy(fullDay, (row) => row.date)\n    return dateGroup\n  })\n\n  return { timedEvents, fullDayEvents }\n}\n\nfunction sortMonthlyEvents(events) {\n  let fullDayEvents = events.filter((event) => event.isFullDay)\n  let timedEvents = events\n    .filter((event) => !event.isFullDay)\n    .sort((a, b) =>\n      a.fromTime !== b.fromTime\n        ? calculateMinutes(a.fromTime) > calculateMinutes(b.fromTime)\n          ? 1\n          : -1\n        : calculateMinutes(a.toTime) > calculateMinutes(b.toTime)\n          ? 1\n          : -1,\n    )\n  // full day events should be at the top in month view\n  return [...fullDayEvents, ...timedEvents]\n}\n","export default async function call(method, args, options = {}) {\n  if (!args) {\n    args = {}\n  }\n\n  let headers = Object.assign(\n    {\n      Accept: 'application/json',\n      'Content-Type': 'application/json; charset=utf-8',\n      'X-Frappe-Site-Name': window.location.hostname,\n    },\n    options.headers || {},\n  )\n\n  if (window.csrf_token && window.csrf_token !== '{{ csrf_token }}') {\n    headers['X-Frappe-CSRF-Token'] = window.csrf_token\n  }\n\n  let path = method.startsWith('/') ? method : `/api/method/${method}`\n  const res = await fetch(path, {\n    method: 'POST',\n    headers,\n    body: JSON.stringify(args),\n  })\n\n  if (res.ok) {\n    const data = await res.json()\n    if (data.docs || method === 'login') {\n      return data\n    }\n    if (data.exc) {\n      try {\n        console.groupCollapsed(method)\n        console.log(`method: ${method}`)\n        console.log(`params:`, args)\n        let warning = JSON.parse(data.exc)\n        for (let text of warning) {\n          console.log(text)\n        }\n        console.groupEnd()\n      } catch (e) {\n        console.warn('Error printing debug messages', e)\n      }\n    }\n    return data.message\n  } else {\n    let response = await res.text()\n    let error, exception\n    try {\n      error = JSON.parse(response)\n      // eslint-disable-next-line no-empty\n    } catch (e) {}\n    let errorParts = [\n      [method, error.exc_type, error._error_message].filter(Boolean).join(' '),\n    ]\n    if (error.exc) {\n      exception = error.exc\n      try {\n        exception = JSON.parse(exception)[0]\n        console.log(exception)\n        // eslint-disable-next-line no-empty\n      } catch (e) {}\n    }\n    let e = new Error(errorParts.join('\\n'))\n    e.exc_type = error.exc_type\n    e.exc = exception\n    e.status = res.status\n    e.messages = error._server_messages\n      ? JSON.parse(error._server_messages)\n      : []\n    e.messages = e.messages.concat(error.message)\n    e.messages = e.messages.map((m) => {\n      try {\n        return JSON.parse(m).message\n      } catch (error) {\n        return m\n      }\n    })\n    e.messages = e.messages.filter(Boolean)\n    if (!e.messages.length) {\n      e.messages = error._error_message\n        ? [error._error_message]\n        : ['Internal Server Error']\n    }\n\n    if (options.onError) {\n      options.onError({ response: res, status: res.status, error: e })\n    }\n\n    throw e\n  }\n}\n\nexport function createCall(options) {\n  return function customCall(method, args) {\n    return call(method, args, options)\n  }\n}\n","export default (file: File): Promise<string> => {\n  return new Promise((resolve, reject) => {\n    const reader = new FileReader()\n    reader.onloadend = () => {\n      if (reader.result == null) {\n        reject(new Error('FileReader result is null'))\n      } else if (typeof reader.result === 'string') {\n        resolve(reader.result)\n      }\n    }\n    reader.readAsDataURL(file)\n  })\n}\n","import {\n  watch,\n  getCurrentInstance,\n  onBeforeUnmount,\n  type App,\n  type WatchStopHandle,\n} from 'vue'\n\ninterface PageMeta {\n  title?: string\n  emoji?: string\n  icon?: string\n}\n\ntype PageMetaFunction = () => PageMeta | null | undefined\ntype StopWatcherFunction = () => void\n\nlet faviconRef: HTMLLinkElement | null = null\nlet defaultFavIcon: string | null = null\n\nfunction initializeFavicon(): void {\n  if (typeof window !== 'undefined' && !faviconRef) {\n    faviconRef = document.querySelector('link[rel=\"icon\"]')\n    defaultFavIcon = faviconRef?.href || null\n  }\n}\n\nexport function usePageMeta(fn: PageMetaFunction): StopWatcherFunction {\n  // Initialize favicon if we're on the client\n  if (typeof window !== 'undefined') {\n    initializeFavicon()\n  }\n\n  const stopWatcher: WatchStopHandle = watch(\n    () => {\n      try {\n        return fn()\n      } catch (error) {\n        if (process.env.NODE_ENV === 'development') {\n          console.warn('Failed to parse pageMeta in', fn)\n          console.error(error)\n        }\n        return null\n      }\n    },\n    (pageMeta: PageMeta | null | undefined) => {\n      // Only execute on client side\n      if (typeof window === 'undefined') return\n      if (!pageMeta) return\n\n      if (pageMeta.title) {\n        document.title = pageMeta.title\n      }\n\n      // Ensure favicon ref is initialized\n      if (!faviconRef) initializeFavicon()\n\n      if (pageMeta.emoji) {\n        const href = `data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>${pageMeta.emoji}</text></svg>`\n        if (faviconRef) faviconRef.href = href\n      } else if (pageMeta.icon) {\n        if (faviconRef) faviconRef.href = pageMeta.icon\n      } else {\n        if (faviconRef && defaultFavIcon) faviconRef.href = defaultFavIcon\n      }\n    },\n    {\n      immediate: true,\n      deep: true,\n    },\n  )\n\n  // Auto-cleanup if called within a component (like <script setup>)\n  const instance = getCurrentInstance()\n  if (instance) {\n    onBeforeUnmount(stopWatcher)\n  }\n\n  return stopWatcher\n}\n\ninterface PageMetaPlugin {\n  install(app: App): void\n}\n\nexport default {\n  install(app: App): void {\n    app.mixin(createMixin())\n  },\n} as PageMetaPlugin\n\ninterface ComponentWithPageMeta {\n  $options: {\n    pageMeta?: PageMetaFunction\n  }\n  _pageMetaStopWatcher?: StopWatcherFunction\n}\n\nfunction createMixin() {\n  return {\n    mounted(this: ComponentWithPageMeta): void {\n      if (this.$options.pageMeta) {\n        const fn = this.$options.pageMeta.bind(this)\n        this._pageMetaStopWatcher = usePageMeta(fn)\n      }\n    },\n    beforeUnmount(this: ComponentWithPageMeta): void {\n      if (this._pageMetaStopWatcher) {\n        this._pageMetaStopWatcher()\n        this._pageMetaStopWatcher = undefined\n      }\n    },\n  }\n}\n","export function request(_options) {\n  let options = Object.assign({}, _options)\n  if (!options.url) {\n    throw new Error('[request] options.url is required')\n  }\n  if (options.transformRequest) {\n    options = options.transformRequest(_options)\n  }\n  if (!options.responseType) {\n    options.responseType = 'json'\n  }\n  if (!options.method) {\n    options.method = 'GET'\n  }\n\n  let url = options.url\n  let body\n  if (options.params) {\n    if (options.method === 'GET') {\n      let params = new URLSearchParams()\n      for (let key in options.params) {\n        params.append(key, options.params[key])\n      }\n      url = options.url + '?' + params.toString()\n    } else {\n      body = JSON.stringify(options.params)\n    }\n  }\n\n  return fetch(url, {\n    method: options.method || 'GET',\n    headers: options.headers,\n    body,\n  })\n    .then((response) => {\n      if (options.transformResponse) {\n        return options.transformResponse(response, options)\n      }\n      if (response.status >= 200 && response.status < 300) {\n        if (options.responseType === 'json') {\n          return response.json()\n        }\n        return response\n      } else {\n        let error = new Error(response.statusText)\n        error.response = response\n        throw error\n      }\n    })\n    .catch((error) => {\n      if (options.transformError) {\n        return options.transformError(error)\n      }\n      throw error\n    })\n}\n","import { get, set, del } from 'idb-keyval'\n\nexport function saveLocal(key, data) {\n  if (typeof indexedDB === 'undefined') {\n    return Promise.resolve(null)\n  }\n  if (!key) return Promise.resolve()\n  return set(key, JSON.stringify(data))\n}\n\nexport function deleteLocal(key) {\n  if (typeof indexedDB === 'undefined') {\n    return Promise.resolve(null)\n  }\n  if (!key) return Promise.resolve()\n  return del(key)\n}\n\nexport function getLocal(key) {\n  if (typeof indexedDB === 'undefined') {\n    return Promise.resolve(null)\n  }\n  return get(key).then((val) => (val ? JSON.parse(val) : val))\n}\n","import { reactive } from 'vue'\nimport debounce from '../utils/debounce'\nimport { request } from '../utils/request'\nimport { getLocal, saveLocal } from './local'\nimport { getConfig } from '../utils/config'\n\nlet cached = {}\n\nexport function createResource(options, vm) {\n  let cacheKey = null\n  if (options.cache) {\n    cacheKey = getCacheKey(options.cache)\n    let cachedResource = cached[cacheKey]\n\n    if (cachedResource) {\n      if (cachedResource.auto) {\n        cachedResource.reload()\n      }\n      return cachedResource\n    }\n  }\n\n  if (typeof options == 'string') {\n    options = {\n      url: options,\n      auto: true,\n    }\n  }\n\n  let fetchFunction = options.debounce\n    ? debounce(fetch, options.debounce)\n    : fetch\n\n  let out = reactive({\n    method: options.method,\n    url: options.url,\n    data: options.initialData || null,\n    previousData: null,\n    loading: false,\n    fetched: false,\n    error: null,\n    promise: null,\n    auto: options.auto,\n    params: null,\n    fetch: fetchFunction,\n    reload: fetchFunction,\n    submit: fetchFunction,\n    reset,\n    update,\n    setData,\n  })\n\n  async function fetch(params, tempOptions = {}) {\n    let resourceFetcher =\n      options.resourceFetcher || getConfig('resourceFetcher') || request\n\n    if (params instanceof Event) {\n      params = null\n    }\n    params = params || out.params\n    if (options.makeParams) {\n      params = options.makeParams.call(vm, params)\n    }\n    out.params = params\n    out.previousData = out.data ? JSON.parse(JSON.stringify(out.data)) : null\n    out.loading = true\n    out.error = null\n\n    if (options.onFetch) {\n      options.onFetch.call(vm, out.params)\n    }\n\n    let beforeSubmitFunctions = [options.beforeSubmit, tempOptions.beforeSubmit]\n    for (let fn of beforeSubmitFunctions) {\n      if (fn) {\n        fn.call(vm, out.params)\n      }\n    }\n\n    let validateFunction = tempOptions.validate || options.validate\n    let errorFunctions = [options.onError, tempOptions.onError]\n    let successFunctions = [options.onSuccess, tempOptions.onSuccess]\n    let dataFunctions = [options.onData, tempOptions.onData]\n\n    if (validateFunction) {\n      let invalidMessage\n      try {\n        invalidMessage = await validateFunction.call(vm, out.params)\n        if (invalidMessage && typeof invalidMessage == 'string') {\n          throw new Error(invalidMessage)\n        }\n      } catch (error) {\n        handleError(error, errorFunctions)\n        return\n      }\n    }\n\n    try {\n      out.promise = resourceFetcher({\n        ...options,\n        params: params || options.params,\n      })\n      let data = await out.promise\n      saveLocal(cacheKey, data)\n      out.data = transform(data)\n      out.fetched = true\n      for (let fn of successFunctions) {\n        if (fn) {\n          fn.call(vm, data)\n        }\n      }\n      for (let fn of dataFunctions) {\n        if (fn) {\n          fn.call(vm, data)\n        }\n      }\n    } catch (error) {\n      handleError(error, errorFunctions)\n    }\n    out.loading = false\n    return out.data\n  }\n\n  function update({ method, url, params, auto }) {\n    if (method && method !== options.method) {\n      out.method = method\n    }\n    if (url && url !== options.url) {\n      out.url = url\n    }\n    if (params && params !== options.params) {\n      out.params = params\n    }\n    if (auto !== undefined && auto !== out.auto) {\n      out.auto = auto\n    }\n  }\n\n  function reset() {\n    out.data = options.initialData || null\n    out.previousData = null\n    out.loading = false\n    out.fetched = false\n    out.error = null\n    out.params = null\n    out.auto = options.auto\n  }\n\n  function handleError(error, errorFunctions) {\n    out.loading = false\n    if (out.previousData) {\n      out.data = out.previousData\n    }\n    out.error = error\n    for (let fn of errorFunctions) {\n      if (fn) {\n        fn.call(vm, error)\n      }\n    }\n    // if no error handler is defined, use fallbackErrorHandler\n    if (errorFunctions.every((fn) => fn == null)) {\n      let errorHandler = getConfig('fallbackErrorHandler')\n      if (errorHandler) {\n        try {\n          errorHandler(error)\n        } catch (error) {\n          // who handles the error handler?\n          console.warn('Error in fallbackErrorHandler', error)\n        }\n      }\n    }\n    throw error\n  }\n\n  // usage:\n  // setData(newData) or\n  // setData(data => data.filter(d => !d.deleted))\n  function setData(data) {\n    if (typeof data === 'function') {\n      data = data.call(vm, out.data)\n    }\n    out.data = transform(data)\n  }\n\n  function transform(data) {\n    if (options.transform) {\n      let returnValue = options.transform.call(vm, data)\n      if (returnValue != null) {\n        return returnValue\n      }\n    }\n    return data\n  }\n\n  if (cacheKey && !cached[cacheKey]) {\n    cached[cacheKey] = out\n    // offline\n    getLocal(cacheKey).then((data) => {\n      if ((out.loading || !out.fetched) && data) {\n        setData(data)\n        options.onData?.call(vm, data)\n      }\n    })\n  }\n\n  if (options.auto) {\n    out.fetch()\n  }\n\n  return out\n}\n\nexport function getCacheKey(cacheKey) {\n  if (!cacheKey) {\n    return null\n  }\n  if (typeof cacheKey === 'string') {\n    cacheKey = [cacheKey]\n  }\n  return JSON.stringify(cacheKey)\n}\n\nexport function getCachedResource(cacheKey) {\n  cacheKey = getCacheKey(cacheKey)\n  return cached[cacheKey] || null\n}\n","export function onDocUpdate(socket, doctype, callback) {\n  subscribe(socket, doctype)\n  socket.on('list_update', (data) => {\n    if (data.doctype == doctype) {\n      callback(data.name)\n    }\n  })\n}\n\nlet subscribed = {}\nfunction subscribe(socket, doctype) {\n  if (subscribed[doctype]) return\n  socket.emit('doctype_subscribe', doctype)\n  subscribed[doctype] = true\n}\n","import { reactive } from 'vue'\nimport { getCacheKey, createResource } from './resources'\nimport { saveLocal, getLocal } from './local'\nimport { onDocUpdate } from './realtime'\nimport { getConfig } from '../utils/config'\n\nlet listCache = reactive({})\nlet resourcesByDocType = {}\n\nexport function createListResource(options, vm) {\n  if (!options.doctype) {\n    throw new Error('List resource requires doctype')\n  }\n\n  let cacheKey = getCacheKey(options.cache)\n  if (cacheKey) {\n    let cachedResource = listCache[cacheKey]\n    if (cachedResource) {\n      if (cachedResource.auto) {\n        cachedResource.reload()\n      }\n      return cachedResource\n    }\n  }\n\n  let defaultListUrl = getConfig('defaultListUrl') || 'frappe.client.get_list'\n  let defaultDocInsertUrl =\n    getConfig('defaultDocInsertUrl') || 'frappe.client.insert'\n  let defaultDocUpdateUrl =\n    getConfig('defaultDocUpdateUrl') || 'frappe.client.set_value'\n  let defaultDocDeleteUrl =\n    getConfig('defaultDocDeleteUrl') || 'frappe.client.delete'\n  let defaultRunDocMethodUrl =\n    getConfig('defaultRunDocMethodUrl') || 'run_doc_method'\n\n  let out = reactive({\n    doctype: options.doctype,\n    fields: options.fields,\n    filters: options.filters,\n    orFilters: options.orFilters,\n    orderBy: options.orderBy,\n    start: options.start || 0,\n    pageLength: options.pageLength || 20,\n    groupBy: options.groupBy,\n    parent: options.parent,\n    debug: options.debug || 0,\n    originalData: null,\n    dataMap: {},\n    data: null,\n    previous,\n    hasPreviousPage: false,\n    next,\n    hasNextPage: true,\n    auto: options.auto,\n    list: createResource(\n      {\n        url: options.url || defaultListUrl,\n        makeParams() {\n          return {\n            doctype: out.doctype,\n            fields: out.fields,\n            filters: out.filters,\n            or_filters: out.orFilters,\n            order_by: out.orderBy,\n            start: out.start,\n            limit: out.pageLength,\n            limit_start: out.start,\n            limit_page_length: out.pageLength,\n            group_by: out.groupBy,\n            parent: out.parent,\n            debug: out.debug,\n          }\n        },\n        onSuccess(data) {\n          out.hasPreviousPage = !!out.start\n          out.hasNextPage = data.length < out.pageLength ? false : true\n          let pagedData\n          if (!out.start || out.start == 0) {\n            pagedData = data\n          } else if (out.start > 0) {\n            pagedData = out.originalData.concat(data)\n          }\n          saveLocal(cacheKey, pagedData)\n          setData(pagedData)\n          options.onSuccess?.call(vm, out.data)\n        },\n        onError: options.onError,\n      },\n      vm,\n    ),\n    fetchOne: createResource(\n      {\n        url: options.url || defaultListUrl,\n        makeParams(name) {\n          return {\n            doctype: out.doctype,\n            fields: out.fields || '*',\n            filters: { name },\n          }\n        },\n        onSuccess(data) {\n          if (data.length > 0 && out.originalData) {\n            let doc = data[0]\n            updateRowInListResource(out.doctype, doc)\n          }\n\n          options.fetchOne?.onSuccess?.call(vm, out.data)\n        },\n        onError: options.fetchOne?.onError,\n      },\n      vm,\n    ),\n    insert: createResource(\n      {\n        url: defaultDocInsertUrl,\n        makeParams(values) {\n          return {\n            doc: {\n              doctype: out.doctype,\n              ...values,\n            },\n          }\n        },\n        onSuccess(data) {\n          out.list.fetch()\n          options.insert?.onSuccess?.call(vm, data)\n        },\n        onError: options.insert?.onError,\n      },\n      vm,\n    ),\n    setValue: createResource(\n      {\n        url: defaultDocUpdateUrl,\n        makeParams(options) {\n          let { name, ...values } = options\n          return {\n            doctype: out.doctype,\n            name: name,\n            fieldname: values,\n          }\n        },\n        onSuccess(doc) {\n          updateRowInListResource(out.doctype, doc)\n          options.setValue?.onSuccess?.call(vm, doc)\n        },\n        onError: options.setValue?.onError,\n      },\n      vm,\n    ),\n    delete: createResource(\n      {\n        url: defaultDocDeleteUrl,\n        makeParams(name) {\n          return {\n            doctype: out.doctype,\n            name,\n          }\n        },\n        onSuccess(data) {\n          out.list.fetch()\n          options.delete?.onSuccess?.call(vm, data)\n        },\n        onError: options.delete?.onError,\n      },\n      vm,\n    ),\n    runDocMethod: createResource(\n      {\n        url: defaultRunDocMethodUrl,\n        makeParams({ method, name, ...values }) {\n          return {\n            dt: out.doctype,\n            dn: name,\n            method: method,\n            args: values,\n          }\n        },\n        onSuccess(data) {\n          if (data.docs) {\n            for (let doc of data.docs) {\n              updateRowInListResource(doc.doctype, doc)\n            }\n          }\n          options.runDocMethod?.onSuccess?.call(vm, data)\n        },\n        onError: options.runDocMethod?.onError,\n      },\n      vm,\n    ),\n    update,\n    fetch,\n    reload,\n    setData,\n    transform,\n    getRow,\n  })\n\n  function update(updatedOptions) {\n    Object.assign(out, updatedOptions)\n  }\n\n  function transform(data) {\n    if (options.transform) {\n      let returnValue = options.transform.call(vm, data)\n      if (returnValue != null) {\n        return returnValue\n      }\n    }\n    return data\n  }\n\n  function reload() {\n    let _start = out.start\n    let _pageLength = out.pageLength\n    if (out.start > 0) {\n      out.start = 0\n      out.pageLength = out.originalData.length\n    }\n    return out.list.fetch().finally(() => {\n      out.start = _start\n      out.pageLength = _pageLength\n    })\n  }\n\n  function fetch() {\n    reload()\n  }\n\n  function setData(data) {\n    out.originalData = data\n    if (typeof data === 'function') {\n      data = data.call(vm, out.data)\n    }\n    out.data = transform(data)\n\n    if (Array.isArray(out.data)) {\n      out.dataMap = {}\n      for (let row of out.data) {\n        if (!row.name) continue\n        let key = row.name.toString()\n        out.dataMap[key] = row\n      }\n    }\n  }\n\n  function previous() {\n    out.start = out.start - out.pageLength\n    out.list.fetch()\n  }\n\n  function next() {\n    out.start = out.start + out.pageLength\n    out.list.fetch()\n  }\n\n  function getRow(name) {\n    let key = name.toString()\n    return out.dataMap[key]\n  }\n\n  if (options.realtime && vm?.$socket) {\n    onDocUpdate(vm.$socket, out.doctype, (name) => {\n      if (out.originalData?.find((d) => d.name === name)) {\n        out.fetchOne.submit(name)\n      }\n    })\n  }\n\n  if (cacheKey) {\n    // cache\n    listCache[cacheKey] = out\n    // offline\n    getLocal(cacheKey).then((data) => {\n      if ((out.list.loading || !out.list.fetched) && data) {\n        setData(data)\n        options.onData?.call(vm, data)\n      }\n    })\n  }\n\n  if (options.auto) {\n    out.list.fetch()\n  }\n\n  resourcesByDocType[out.doctype] = resourcesByDocType[out.doctype] || []\n  resourcesByDocType[out.doctype].push(out)\n\n  return out\n}\n\nexport function getCachedListResource(cacheKey) {\n  cacheKey = getCacheKey(cacheKey)\n  return listCache[cacheKey] || null\n}\n\nexport function updateRowInListResource(doctype, doc) {\n  if (!doc.name) return\n  let resources = resourcesByDocType[doctype] || []\n  for (let resource of resources) {\n    if (resource.originalData) {\n      for (let row of resource.originalData) {\n        if (row.name && row.name == doc.name) {\n          delete row._previousData\n          let previousRowData = JSON.stringify(row)\n          for (let key in row) {\n            if (key in doc) {\n              row[key] = doc[key]\n            }\n          }\n          row._previousData = previousRowData\n        }\n      }\n      resource.data = resource.transform(resource.originalData)\n    }\n  }\n}\n\nexport function deleteRowInListResource(doctype, docname) {\n  let resources = resourcesByDocType[doctype] || []\n  for (let resource of resources) {\n    if (resource.originalData) {\n      resource.originalData = resource.originalData.filter(\n        (row) => row.name.toString() !== docname.toString(),\n      )\n      resource.data = resource.transform(resource.originalData)\n    }\n  }\n}\n\nexport function revertRowInListResource(doctype, doc) {\n  let resources = resourcesByDocType[doctype] || []\n  for (let resource of resources) {\n    if (resource.originalData) {\n      for (let row of resource.originalData) {\n        if (row.name && row.name == doc.name) {\n          let previousRowData = JSON.parse(row._previousData)\n          for (let key in row) {\n            row[key] = previousRowData[key]\n          }\n          delete row._previousData\n        }\n      }\n      resource.data = resource.transform(resource.originalData)\n    }\n  }\n}\n","import { reactive, watch } from 'vue'\nimport { getCacheKey, createResource } from './resources'\nimport {\n  updateRowInListResource,\n  deleteRowInListResource,\n  revertRowInListResource,\n} from './listResource'\nimport { getLocal, saveLocal, deleteLocal } from './local'\nimport { onDocUpdate } from './realtime'\nimport { getConfig } from '../utils/config'\n\nlet documentCache = reactive({})\n\nexport function createDocumentResource(options, vm) {\n  if (!(options.doctype && options.name)) return\n\n  let cacheKey = getCacheKey([options.doctype, options.name])\n  let cachedResource = documentCache[cacheKey]\n  if (cachedResource) {\n    if (cachedResource.auto) {\n      cachedResource.reload()\n    }\n    return cachedResource\n  }\n\n  let defaultDocGetUrl = getConfig('defaultDocGetUrl') || 'frappe.client.get'\n  let defaultDocUpdateUrl =\n    getConfig('defaultDocUpdateUrl') || 'frappe.client.set_value'\n  let defaultDocDeleteUrl =\n    getConfig('defaultDocDeleteUrl') || 'frappe.client.delete'\n  let defaultRunDocMethodUrl =\n    getConfig('defaultRunDocMethodUrl') || 'run_doc_method'\n\n  let setValueOptions = {\n    url: defaultDocUpdateUrl,\n    makeParams(values) {\n      return {\n        doctype: out.doctype,\n        name: out.name,\n        fieldname: values,\n      }\n    },\n    validate(data) {\n      options.setValue?.validate?.call(vm, data)\n    },\n    beforeSubmit(params) {\n      out.previousDoc = JSON.stringify(out.doc)\n      Object.assign(out.doc, params.fieldname || {})\n      // update data in list resources\n      updateRowInListResource(out.doctype, out.doc)\n    },\n    onSuccess(data) {\n      out.doc = transform(data)\n      out.originalDoc = JSON.parse(JSON.stringify(out.doc))\n      options.setValue?.onSuccess?.call(vm, data)\n    },\n    onError(error) {\n      out.doc = JSON.parse(out.previousDoc)\n      options.setValue?.onError?.call(vm, error)\n      // revert data in list resource\n      revertRowInListResource(out.doctype, out.doc)\n    },\n  }\n\n  const autoPropIsPassed = options.auto !== undefined\n\n  let out = reactive({\n    doctype: options.doctype,\n    name: options.name,\n    doc: null,\n    originalDoc: null,\n    isDirty: false,\n    auto: autoPropIsPassed ? options.auto : true,\n    get: createResource(\n      {\n        url: defaultDocGetUrl,\n        makeParams() {\n          return {\n            doctype: out.doctype,\n            name: out.name,\n          }\n        },\n        onSuccess(data) {\n          saveLocal(cacheKey, data)\n          out.doc = transform(data)\n          out.originalDoc = JSON.parse(JSON.stringify(out.doc))\n          options.onSuccess?.call(vm, out.doc)\n        },\n        onError(error) {\n          deleteLocal(cacheKey)\n          out.doc = null\n          out.originalDoc = null\n          options.onError?.call(vm, error)\n        },\n      },\n      vm,\n    ),\n    setValue: createResource(setValueOptions, vm),\n    setValueDebounced: createResource(\n      {\n        ...setValueOptions,\n        debounce: options.debounce || 500,\n      },\n      vm,\n    ),\n    save: createResource(\n      {\n        ...setValueOptions,\n        makeParams() {\n          let values = JSON.parse(JSON.stringify(out.doc))\n          delete values.doctype\n          delete values.name\n          return {\n            doctype: out.doctype,\n            name: out.name,\n            fieldname: values,\n          }\n        },\n      },\n      vm,\n    ),\n    delete: createResource(\n      {\n        url: defaultDocDeleteUrl,\n        makeParams() {\n          return {\n            doctype: out.doctype,\n            name: out.name,\n          }\n        },\n        onSuccess() {\n          out.doc = null\n          options.delete?.onSuccess?.call(vm)\n          // delete from list resources\n          deleteRowInListResource(out.doctype, out.name)\n        },\n        onError: options.delete?.onError,\n      },\n      vm,\n    ),\n    reload,\n    setDoc,\n  })\n\n  // keep track of isDirty as doc changes\n  watch(\n    () => out.doc,\n    () => {\n      out.isDirty = JSON.stringify(out.doc) !== JSON.stringify(out.originalDoc)\n    },\n    {\n      deep: true,\n    },\n  )\n\n  for (let methodKey in options.whitelistedMethods) {\n    let methodOptions = options.whitelistedMethods[methodKey]\n    if (typeof methodOptions == 'string') {\n      methodOptions = {\n        method: methodOptions,\n      }\n    }\n\n    let {\n      method,\n      onSuccess,\n      makeParams,\n      transform: _transform,\n      ...otherOptions\n    } = methodOptions\n\n    out[methodKey] = createResource(\n      {\n        url: defaultRunDocMethodUrl,\n        makeParams(values) {\n          values = makeParams ? makeParams.call(vm, values) : values\n          return {\n            dt: out.doctype,\n            dn: out.name,\n            method: method,\n            args: values,\n          }\n        },\n        transform(data) {\n          if (_transform) {\n            let returnValue = _transform.call(vm, data.message)\n            if (returnValue != null) {\n              return returnValue\n            }\n          }\n          return data.message\n        },\n        onSuccess(data) {\n          if (data.docs) {\n            for (let doc of data.docs) {\n              if (\n                doc.doctype === out.doctype &&\n                doc.name.toString() === out.name.toString()\n              ) {\n                out.doc = transform(doc)\n                // update data in list resources\n                updateRowInListResource(out.doctype, out.doc)\n                break\n              }\n            }\n          }\n          onSuccess?.call(vm, data.message)\n        },\n        ...otherOptions,\n      },\n      vm,\n    )\n  }\n\n  function reload() {\n    return out.get.fetch()\n  }\n\n  function setDoc(doc) {\n    if (typeof doc === 'function') {\n      doc = doc.call(vm, out.doc)\n    }\n    out.doc = transform(doc)\n  }\n\n  function transform(doc) {\n    if (options.transform) {\n      let returnValue = options.transform.call(vm, doc)\n      if (typeof returnValue === 'object') {\n        return returnValue\n      }\n    }\n    return doc\n  }\n\n  if (options.realtime && vm.$socket) {\n    onDocUpdate(vm.$socket, out.doctype, (name) => {\n      if (name == out.name) {\n        out.get.fetch()\n      }\n    })\n  }\n\n  // cache\n  documentCache[cacheKey] = out\n  // offline\n  getLocal(cacheKey).then((data) => {\n    if ((out.get.loading || !out.get.fetched) && data) {\n      out.doc = transform(data)\n    }\n  })\n\n  if (out.auto) {\n    out.get.fetch()\n  }\n\n  return out\n}\n\nexport function getCachedDocumentResource(doctype, name) {\n  let cacheKey = getCacheKey([doctype, name])\n  return documentCache[cacheKey] || null\n}\n","import { reactive, watch } from 'vue'\nimport { createResource, getCachedResource } from './resources'\nimport {\n  createDocumentResource,\n  getCachedDocumentResource,\n} from './documentResource'\nimport { createListResource, getCachedListResource } from './listResource'\n\nlet createMixin = (mixinOptions) => ({\n  created() {\n    if (this.$options.resources) {\n      this._resources = reactive({})\n      for (let key in this.$options.resources) {\n        let options = this.$options.resources[key]\n\n        if (typeof options == 'function') {\n          watch(\n            () => {\n              let out = null\n              try {\n                out = options.call(this)\n              } catch (error) {\n                console.warn('Failed to get resource options\\n\\n', error)\n                out = null\n              }\n              return out\n            },\n            (options, oldOptions) => {\n              if (!options) {\n                return\n              }\n\n              let changed =\n                !oldOptions ||\n                JSON.stringify(options) !== JSON.stringify(oldOptions)\n\n              if (!changed) return\n              this._resources[key] = createResourceForOptions(options, this)\n            },\n            {\n              immediate: true,\n              deep: true,\n            },\n          )\n        } else {\n          let resource = createResourceForOptions(options, this)\n          this._resources[key] = resource\n        }\n      }\n    }\n  },\n  methods: {\n    $getResource(cacheKey) {\n      return getCachedResource(cacheKey)\n    },\n    $getDocumentResource(doctype, name) {\n      return getCachedDocumentResource(doctype, name)\n    },\n    $getDoc(doctype, name) {\n      let resource = this.$getDocumentResource(doctype, name)\n      return resource ? resource.doc : null\n    },\n    $getListResource(cacheKey) {\n      return getCachedListResource(cacheKey)\n    },\n    $refetchResource(cache) {\n      let resource = this.$getResource(cache)\n      resource && resource.fetch()\n    },\n  },\n  computed: {\n    $resources() {\n      return this._resources\n    },\n  },\n})\n\nfunction createResourceForOptions(options, vm) {\n  if (options.type === 'document') {\n    return createDocumentResource(options, vm)\n  }\n  if (options.type === 'list') {\n    return createListResource(options, vm)\n  }\n  return createResource(options, vm)\n}\n\nexport default {\n  install(app, options) {\n    let resourceMixin = createMixin(options)\n    app.mixin(resourceMixin)\n  },\n}\n","import { getConfig } from './config'\nimport { request } from './request'\n\nexport function frappeRequest(options) {\n  return request({\n    ...options,\n    transformRequest: (options = {}) => {\n      if (!options.url) {\n        throw new Error('[frappeRequest] options.url is required')\n      }\n      let headers = Object.assign(\n        {\n          Accept: 'application/json',\n          'Content-Type': 'application/json; charset=utf-8',\n          'X-Frappe-Site-Name': window.location.hostname,\n        },\n        options.headers || {},\n      )\n      if (window.csrf_token && window.csrf_token !== '{{ csrf_token }}') {\n        headers['X-Frappe-CSRF-Token'] = window.csrf_token\n      }\n      if (!options.url.startsWith('/') && !options.url.startsWith('http')) {\n        options.url = '/api/method/' + options.url\n      }\n      return {\n        ...options,\n        method: options.method || 'POST',\n        headers,\n      }\n    },\n    transformResponse: async (response, options) => {\n      let url = options.url\n      if (response.ok) {\n        const data = await response.json()\n        if (data.docs || url === '/api/method/login') {\n          return data\n        }\n        if (data.exc) {\n          try {\n            console.groupCollapsed(url)\n            console.log(options)\n            let warning = JSON.parse(data.exc)\n            for (let text of warning) {\n              console.log(text)\n            }\n            console.groupEnd()\n          } catch (e) {\n            console.warn('Error printing debug messages', e)\n          }\n        }\n\n        if (data._server_messages) {\n          let onMessageHandler =\n            getConfig('serverMessagesHandler') || options.onServerMessages || null\n          if (onMessageHandler) {\n            onMessageHandler(JSON.parse(data?._server_messages) || [])\n          }\n        }\n\n        return data.message\n      } else {\n        let errorResponse = await response.text()\n        let error, exception\n        try {\n          error = JSON.parse(errorResponse)\n          // eslint-disable-next-line no-empty\n        } catch (e) {}\n        let errorParts = [\n          [options.url, error?.exc_type, error?._error_message]\n            .filter(Boolean)\n            .join(' '),\n        ]\n        if (error.exc) {\n          exception = error.exc\n          try {\n            exception = JSON.parse(exception)[0]\n            console.log(exception)\n            // eslint-disable-next-line no-empty\n          } catch (e) {}\n        }\n        let e = new Error(errorParts.join('\\n'))\n        e.exc_type = error.exc_type\n        e.exc = exception\n        e.response = response\n        e.status = errorResponse.status\n        e.messages = error._server_messages\n          ? JSON.parse(error._server_messages)\n          : []\n        e.messages = e.messages.concat(error.message)\n        e.messages = e.messages.map((m) => {\n          try {\n            return JSON.parse(m).message\n          } catch (error) {\n            return m\n          }\n        })\n        e.messages = e.messages.filter(Boolean)\n        if (!e.messages.length) {\n          e.messages = error._error_message\n            ? [error._error_message]\n            : ['Internal Server Error']\n        }\n        options.onError && options.onError(e)\n        throw e\n      }\n    },\n    transformError: (error) => {\n      options.onError && options.onError(error)\n      throw error\n    },\n  })\n}\n","import { get, set, del, setMany, keys } from 'idb-keyval'\n\nexport class IDBStore {\n  private memoryStore: Record<string, string> = {}\n  private useIndexedDB: boolean\n\n  constructor() {\n    this.useIndexedDB = typeof window !== 'undefined' && !!window.indexedDB\n  }\n\n  set(key: string, data: unknown): Promise<void | null> {\n    if (!this.validateKey(key)) {\n      return Promise.resolve(null)\n    }\n\n    try {\n      if (this.useIndexedDB) {\n        return set(key, JSON.stringify(data))\n      }\n      this.memoryStore[key] = JSON.stringify(data)\n      return Promise.resolve()\n    } catch (error) {\n      return this.handleError(error, 'save to')\n    }\n  }\n\n  setMany(data: Record<string, unknown>): Promise<void | null> {\n    try {\n      if (this.useIndexedDB) {\n        let entries: [IDBValidKey, any][] = []\n        for (const [key, value] of Object.entries(data)) {\n          entries.push([key, JSON.stringify(value)])\n        }\n        return setMany(entries)\n      }\n      for (const [key, value] of Object.entries(data)) {\n        this.memoryStore[key] = JSON.stringify(value)\n      }\n      return Promise.resolve()\n    } catch (error) {\n      return this.handleError(error, 'save to')\n    }\n  }\n\n  delete(key: string): Promise<void | null> {\n    if (!this.validateKey(key)) {\n      return Promise.resolve(null)\n    }\n\n    try {\n      if (this.useIndexedDB) {\n        return del(key)\n      }\n      delete this.memoryStore[key]\n      return Promise.resolve()\n    } catch (error) {\n      return this.handleError(error, 'delete from')\n    }\n  }\n\n  get(key: string): Promise<unknown | null> {\n    if (!this.validateKey(key)) {\n      return Promise.resolve(null)\n    }\n\n    if (this.useIndexedDB) {\n      return get(key).then((val) => {\n        if (!val) return null\n        try {\n          return JSON.parse(val)\n        } catch (error) {\n          return this.handleError(error, 'parse data from')\n        }\n      })\n    }\n\n    try {\n      const val = this.memoryStore[key]\n      return Promise.resolve(val ? JSON.parse(val) : null)\n    } catch (error) {\n      return this.handleError(error, 'parse data from')\n    }\n  }\n\n  async keys(): Promise<string[]> {\n    try {\n      if (this.useIndexedDB) {\n        return keys() as Promise<string[]>\n      }\n      return Promise.resolve(Object.keys(this.memoryStore))\n    } catch (error) {\n      console.error(\n        `Failed to get keys from ${this.useIndexedDB ? 'IndexedDB' : 'memory store'}:`,\n        error,\n      )\n      return Promise.resolve([])\n    }\n  }\n\n  private validateKey(key: string): boolean {\n    return !!key\n  }\n\n  private handleError(error: unknown, operation: string): Promise<null> {\n    console.error(\n      `Failed to ${operation} ${this.useIndexedDB ? 'IndexedDB' : 'memory store'}:`,\n      error,\n    )\n    return Promise.resolve(null)\n  }\n}\n\nexport let idbStore = new IDBStore()\n","import { Ref, ref, MaybeRefOrGetter, toValue } from 'vue'\nimport { idbStore } from './idbStore'\n\ntype Doc = {\n  doctype: string\n  name: string\n  [key: string]: any\n}\n\ntype DocKey = `${string}/${string}`\n\nclass DocStore {\n  private docs: Map<DocKey, Ref<Doc | null>>\n  private lastFetched: Map<DocKey, number>\n  private cacheTimeout: number = 5 * 60 * 1000 // 5 minutes\n  private storePrefix = 'doc:'\n\n  constructor() {\n    this.docs = new Map<DocKey, Ref<Doc | null>>()\n    this.lastFetched = new Map()\n  }\n\n  setCacheTimeout(minutes: number) {\n    if (minutes < 1) {\n      throw new Error('Cache timeout must be at least 1 minute')\n    }\n    this.cacheTimeout = minutes * 60 * 1000\n  }\n\n  async setDoc(doc: Doc) {\n    if (!doc?.doctype || !doc?.name) {\n      throw new Error('Invalid doc: must have doctype and name')\n    }\n    doc.name = doc.name.toString()\n    const key = this.getKey(doc.doctype, doc.name)\n    try {\n      await idbStore.set(this.storePrefix + key, doc)\n      if (!this.docs.has(key)) {\n        this.docs.set(key, ref(null))\n      }\n      const docRef = this.docs.get(key)\n      if (docRef) {\n        docRef.value = doc\n      }\n      this.lastFetched.set(key, Date.now())\n    } catch (error) {\n      console.error('Failed to set doc in IDB:', error)\n      throw error\n    }\n  }\n\n  getDoc(doctype: string, name: MaybeRefOrGetter<string>): Ref<Doc | null> {\n    const nameStr = toValue(name)\n    if (!doctype || !nameStr) {\n      throw new Error('doctype and name are required')\n    }\n    const key = this.getKey(doctype, nameStr)\n\n    if (!this.docs.has(key)) {\n      this.docs.set(key, ref(null))\n      this.loadDoc(key, true)\n    } else if (this.isStale(key)) {\n      this.loadDoc(key, false)\n    }\n\n    return this.docs.get(key)!\n  }\n\n  private async loadDoc(key: DocKey, isFirstLoad: boolean) {\n    try {\n      if (!isFirstLoad && this.isStale(key)) {\n        await this.cleanup(key)\n      }\n\n      const idbDoc = (await idbStore.get(this.storePrefix + key)) as Doc | null\n      if (idbDoc) {\n        const docRef = this.docs.get(key)\n        if (docRef) {\n          docRef.value = idbDoc\n        }\n        this.lastFetched.set(key, Date.now())\n      }\n    } catch (error) {\n      console.error('Failed to load doc from IDB:', error)\n      throw error\n    }\n  }\n\n  async setDocs(docs: Doc[]) {\n    const docMap: Record<string, Doc> = {}\n    for (const doc of docs) {\n      if (!doc?.doctype || !doc?.name) continue\n      doc.name = doc.name.toString()\n      const key = this.getKey(doc.doctype, doc.name)\n      if (!this.docs.has(key)) {\n        this.docs.set(key, ref(null))\n      }\n      const docRef = this.docs.get(key)\n      if (docRef) {\n        docRef.value = doc\n      }\n      this.lastFetched.set(key, Date.now())\n      docMap[this.storePrefix + key] = doc\n    }\n    await idbStore.setMany(docMap)\n  }\n\n  async invalidateDoc(doctype: string, name: string) {\n    if (!doctype || !name) return\n    const key = this.getKey(doctype, name)\n    await this.cleanup(key)\n  }\n\n  removeDoc(doctype: string, name: string) {\n    return this.invalidateDoc(doctype, name)\n  }\n\n  private getKey(doctype: string, name: string): DocKey {\n    return `${doctype.trim()}/${name.trim()}` as DocKey\n  }\n\n  private isStale(key: DocKey): boolean {\n    const fetchTime = this.lastFetched.get(key)\n    if (!fetchTime) return true\n    return Date.now() - fetchTime > this.cacheTimeout\n  }\n\n  private async cleanup(key: DocKey) {\n    this.docs.delete(key)\n    this.lastFetched.delete(key)\n    await idbStore.delete(this.storePrefix + key)\n  }\n\n  async clearAll() {\n    try {\n      const allKeys = await idbStore.keys()\n      const docKeys = allKeys.filter((key: string) =>\n        key.startsWith(this.storePrefix),\n      )\n      await Promise.all(docKeys.map((key: string) => idbStore.delete(key)))\n      this.docs.clear()\n      this.lastFetched.clear()\n    } catch (error) {\n      console.error('Failed to clear all docs:', error)\n      throw error\n    }\n  }\n}\n\nexport const docStore = new DocStore()\n","export interface ListInstanceMethods {\n  updateRow: (doc: Partial<{ name: string }> & Record<string, unknown>) => void\n  removeRow: (name: string) => void\n}\n\ninterface Doc {\n  name: string\n  [key: string]: any\n}\n\nclass ListStore {\n  byDocType: { [key: string]: Array<ListInstanceMethods> }\n\n  constructor() {\n    this.byDocType = {}\n  }\n\n  addList(doctype: string, list: ListInstanceMethods) {\n    this.ensureList(doctype)\n    this.byDocType[doctype].push(list)\n  }\n\n  updateRows(docs: Array<Doc>) {\n    for (let doc of docs) {\n      this.updateRow(doc.doctype, doc)\n    }\n  }\n\n  updateRow(doctype: string, doc: Doc) {\n    this.ensureList(doctype)\n    this.byDocType[doctype].forEach((list) => {\n      list.updateRow(doc)\n    })\n  }\n\n  removeRow(doctype: string, name: string) {\n    this.ensureList(doctype)\n    this.byDocType[doctype].forEach((list) => {\n      list.removeRow(name)\n    })\n  }\n\n  ensureList(docType: string) {\n    if (!this.byDocType[docType]) {\n      this.byDocType[docType] = []\n    }\n  }\n}\n\nexport const listStore = new ListStore()\n","import { createFetch } from '@vueuse/core'\nimport { docStore } from './docStore'\nimport { listStore } from './useList/listStore'\n\nexport class FrappeResponseError extends Error {\n  title: string\n  type: string\n  exception?: string\n  indicator?: string\n\n  constructor(\n    message: string,\n    options: {\n      title: string\n      type: string\n      exception?: string\n      indicator?: string\n    },\n  ) {\n    super(message)\n    this.name = 'FrappeResponseError'\n    this.title = options.title\n    this.type = options.type\n    this.exception = options.exception\n    this.indicator = options.indicator\n\n    // Maintains proper stack trace for where our error was thrown (only available on V8)\n    if (Error.captureStackTrace) {\n      Error.captureStackTrace(this, FrappeResponseError)\n    }\n  }\n}\n\nexport const useFrappeFetch = createFetch({\n  options: {\n    fetch: (...args) => fetch(...args), // required for vitest\n    beforeFetch({ options }) {\n      options.headers = setHeaders(options.headers || {})\n      return { options }\n    },\n    afterFetch(ctx) {\n      let responseData = JSON.parse(ctx.data)\n      ctx.data = responseData\n      if (responseData.debug) {\n        let path = ctx.response.url.replace(window.location.origin, '')\n        console.group(path)\n        for (let d of responseData.debug) {\n          console.log(d?.message)\n        }\n        console.groupEnd()\n      }\n      if (responseData.docs) {\n        let docs = responseData.docs\n        for (let doc of docs) {\n          doc.name = doc.name.toString()\n        }\n        docStore.setDocs(docs)\n        listStore.updateRows(docs)\n      }\n      return ctx\n    },\n    onFetchError(ctx) {\n      if (ctx.response?.ok && ctx.error) {\n        // if response is ok and there is an error, it's a client side programming error\n        console.error(\n          'Fetch request succeeded but there was a programming error:\\n\\n',\n          ctx.error,\n        )\n        return ctx\n      }\n\n      type FrappeError = {\n        title: string\n        message: string\n        exception?: string\n        type: string\n        indicator: string\n      }\n      try {\n        let errorResponse = JSON.parse(ctx.data)\n        let errors: Array<FrappeError> = errorResponse.errors\n        let error = errors[0] // assuming only one error for now\n        let errorDescription = error.message\n          ? `: ${error.message}`\n          : error.exception\n            ? ` (Traceback)`\n            : ''\n        let frappeError = new FrappeResponseError(\n          `${error.type}${errorDescription}`,\n          {\n            title: error.title,\n            type: error.type,\n            exception: error.exception,\n            indicator: error.indicator,\n          },\n        )\n\n        if (import.meta.env.DEV && error.exception) {\n          console.log(error.exception)\n        }\n\n        ctx.error = frappeError\n        return ctx\n      } catch (e) {\n        console.log('Error parsing error response:', e)\n        return ctx\n      }\n    },\n  },\n})\n\nfunction setHeaders(headers: HeadersInit) {\n  // handle case where this could run in node environment (vitest)\n  let siteName = null\n  let csrfToken = null\n  if (typeof window !== 'undefined') {\n    siteName = window.location.hostname\n    csrfToken =\n      window.csrf_token !== '{{ csrf_token }}' ? window.csrf_token : null\n  }\n\n  const defaultHeaders: Record<string, string> = {\n    Accept: 'application/json',\n    'Content-Type': 'application/json; charset=utf-8',\n  }\n  if (siteName) {\n    defaultHeaders['X-Frappe-Site-Name'] = siteName\n  }\n  if (csrfToken) {\n    defaultHeaders['X-Frappe-CSRF-Token'] = csrfToken\n  }\n\n  return { ...headers, ...defaultHeaders }\n}\n"],"names":["id","generateId","useId","debounce","func","wait","immediate","timeout","context","args","later","config","setConfig","key","value","getConfig","_a","_dayjs","updateLocale","relativeTime","localizedFormat","isToday","duration","utc","timezone","advancedFormat","customParseFormat","Dialog","DialogMain","DialogTitle","DialogDescription","ref","inputRegex","NodeExtension","element","align","attributes","node","HTMLAttributes","mergeAttributes","VueNodeViewRenderer","ImageNodeView","commands","editor","result","findImageNodeBySource","pos","updateNodeWithDimensions","file","uploadImage","input","event","target","nodeInputRule","match","alt","src","title","extensionThis","Plugin","view","_b","images","coordinates","transaction","Selection","processMultipleImages","clipboardItems","i","item","transactions","oldState","newState","newImageNodes","tr","findInsertPosition","lastNodeId","insertPos","uploadImageBase","options","insertMode","onComplete","moveCursor","uploadId","fileToBase64","base64Result","nodeSize","nodePos","n","p","posAfter","e","uploadedImage","getImageDimensions","dimensions","__spreadProps","__spreadValues","error","uploadImageWithTracking","callback","currentAttrs","resolve","reject","img","imageQueue","lastInsertedNodeId","processNextImage","currentPos","newNodeId","useTouchHandler","targetRef","zoomLevel","onSwipeLeft","onSwipeRight","onDoubleTap","onTap","onPanStart","onPanMove","onPanAnimate","onPanEnd","onPinchStart","onPinchMove","onPinchEnd","doubleTapDelay","minSwipeDistance","maxVerticalSwipeDistance","maxTapDuration","maxTapMovement","panThreshold","inertiaDamping","inertiaVelocityThreshold","isPanning","isPinching","isAnimatingPan","startPanCoords","lastTapTime","touchStartTime","touchStartDistance","initialTouchPoints","lastMoveTime","lastMoveCoords","panVelocity","animationFrameId","cancelInertiaAnimation","handleTouchStart","currentTime","timeSinceLastTap","touch","touch1","touch2","handleTouchMove","deltaTime","currentDistance","scale","currentX","currentY","rawDeltaX","rawDeltaY","deltaXFromStart","deltaYFromStart","zoomFactor","panDeltaX","panDeltaY","handleTouchEnd","touchesLeft","touchEndTime","wasPanning","wasPinching","finalVelocity","lastFrameTime","animVelocity","animate","frameDeltaTime","moveX","moveY","dampingFactor","endCoords","deltaX","deltaY","watch","newTarget","oldTarget","readonly","useImageNavigation","initialIndex","imageCount","onNavigate","currentIndex","newVal","nextImage","previousImage","useZoomPan","containerRef","isEnabled","panPosition","isMousePanning","startMousePanCoords","initialPanPositionOnGestureStart","snapThresholdLower","snapThresholdUpper","newZoom","oldZoom","zoomIn","zoomOut","resetZoom","handlePanStart","handlePanMove","moveEvent","handlePanEnd","handleWheel","zoomChange","currentZoom","clampedZoom","onMounted","container","onUnmounted","Extension","style","image","openImageViewerModal","extension","PluginKey","state","clickedNode","foundImageNode","domNode","app","createApp","h","ImageViewerModal","Node","uploadVideoInternal","div","video","videoPill","uploadedVideo","schema","ALLOWED_DOMAINS","PLATFORM_CONFIGS","detectPlatform","url","domain","pattern","calculateAspectRatio","platform","getOptimalDimensions","containerWidth","aspectInfo","maxWidth","validateURL","blocked","allowed","processURL","convertToYouTubeEmbed","convertToVimeoEmbed","convertToCodePenEmbed","convertToFigmaEmbed","urlObj","videoId","width","height","el","attrs","IframeNodeView","processedSrc","editorElement","editorWidth","optimalDimensions","processedUrl","slice","text","html","iframeData","parseIframeFromHTML","createIframeNode","iframe","iframeMatch","widthMatch","heightMatch","titleMatch","finalWidth","finalHeight","isValidUrl","linkPasteHandler","selection","empty","textContent","link","Link","from","to","doc","range","mark","shouldDelayPopover","$pos","markRange","getMarkRange","m","existingHref","selectionFrom","selectionTo","showPopover","openLinkEditor","href","chain","posAfterLink","charAfter","plugins","clearLinkOnBoundaryPlugin","anchor","virtualReference","rect","isCollapsed","tippyInstance","isDestroyed","promiseSettled","settlePromise","action","destroy","EditLink","newHref","tippy","storedMarks","$from","linkMarkType","textColorHexMap","highlightColorHexMap","legacyTextColorMap","legacyHighlightColorMap","getClosestNamedColor","color","allowedColors","colorMap","legacyMap","r","g","b","hex","rgbMatch","closestColor","minDistance","colorName","namedHex","namedHexClean","nr","ng","nb","distance","extractColorFromStyle","property","allColorsInMap","hexColorMatch","closestOverallColor","rgbColorMatch","extractTextColorFromStyle","extractHighlightColorFromStyle","colorMatch","extractedColor","commandChain","Mark","highlightMatch","legacyColorAttr","highlightAttributes","isCurrentlyActive","createSuggestionExtension","customOptions","component","popup","props","VueRenderer","defaultTippyOptions","Suggestion","createMentionNode","dom","MentionSuggestionExtension","SuggestionList","query","_mentions","ext","toValue","mention","EMOJIS","_EMOJIS","a","aName","bName","queryLower","EmojiList","SlashCommandSuggestionKey","getCommands","Heading2","Heading3","List","ListOrdered","ListTask","Code","Quote","Image","Video","GalleryVertical","Minus","Table","SlashCommandsList","markdownToHTML","marked","detectMarkdown","line","files","htmlContent","tempDiv","parsedSlice","DOMParser","TagNode","_tags","tags","filteredTags","tag","TiptapHeading","level","regexp","textblockTypeInputRule","ImageGroupNodeView","call","_0","_1","__async","method","headers","path","res","data","warning","response","exception","errorParts","reader","faviconRef","defaultFavIcon","initializeFavicon","usePageMeta","fn","stopWatcher","pageMeta","getCurrentInstance","onBeforeUnmount","pageMetaPlugin","createMixin","request","_options","body","params","saveLocal","set","deleteLocal","del","getLocal","get","val","cached","createResource","vm","cacheKey","getCacheKey","cachedResource","fetchFunction","fetch","out","reactive","reset","update","setData","tempOptions","resourceFetcher","beforeSubmitFunctions","validateFunction","errorFunctions","successFunctions","dataFunctions","invalidMessage","handleError","transform","auto","errorHandler","returnValue","getCachedResource","onDocUpdate","socket","doctype","subscribe","subscribed","listCache","resourcesByDocType","createListResource","defaultListUrl","defaultDocInsertUrl","defaultDocUpdateUrl","defaultDocDeleteUrl","defaultRunDocMethodUrl","previous","next","pagedData","name","updateRowInListResource","values","__objRest","_c","_d","_e","_f","_g","reload","getRow","updatedOptions","_start","_pageLength","row","d","getCachedListResource","resources","resource","previousRowData","deleteRowInListResource","docname","revertRowInListResource","documentCache","createDocumentResource","defaultDocGetUrl","setValueOptions","autoPropIsPassed","setDoc","methodKey","methodOptions","onSuccess","makeParams","_transform","otherOptions","getCachedDocumentResource","mixinOptions","oldOptions","createResourceForOptions","cache","resourcesPlugin","resourceMixin","frappeRequest","onMessageHandler","errorResponse","IDBStore","entries","setMany","keys","operation","idbStore","DocStore","minutes","docRef","nameStr","isFirstLoad","idbDoc","docs","docMap","fetchTime","docKeys","docStore","ListStore","list","docType","listStore","FrappeResponseError","message","createFetch","setHeaders","ctx","responseData","errorDescription","frappeError","siteName","csrfToken","defaultHeaders"],"mappings":"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","x_google_ignoreList":[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45]}