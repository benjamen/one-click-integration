{"version":3,"file":"frappe-ui-hd4z7wd9.js","sources":["../../../../frontend/node_modules/frappe-ui/src/components/Alert/Alert.vue","../../../../frontend/node_modules/frappe-ui/src/components/Popover/Popover.vue","../../../../frontend/node_modules/frappe-ui/src/components/FeatherIcon.vue","../../../../frontend/node_modules/frappe-ui/src/components/LoadingIndicator.vue","../../../../frontend/node_modules/frappe-ui/src/components/Tooltip/Tooltip.vue","../../../../frontend/node_modules/frappe-ui/src/components/Button/Button.vue","../../../../frontend/node_modules/frappe-ui/src/components/Autocomplete/Autocomplete.vue","../../../../frontend/node_modules/frappe-ui/src/components/Badge/Badge.vue","../../../../frontend/node_modules/frappe-ui/src/utils/useId.ts","../../../../frontend/node_modules/frappe-ui/src/components/LoadingText.vue","../../../../frontend/node_modules/frappe-ui/src/components/Card.vue","../../../../frontend/node_modules/frappe-ui/src/components/Checkbox/Checkbox.vue","../../../../frontend/node_modules/frappe-ui/src/utils/debounce.ts","../../../../frontend/node_modules/frappe-ui/src/components/TextInput/TextInput.vue","../../../../frontend/node_modules/frappe-ui/src/utils/config.ts","../../../../frontend/node_modules/frappe-ui/src/utils/dayjs.ts","../../../../frontend/node_modules/frappe-ui/src/components/Dialog/Dialog.vue","../../../../frontend/node_modules/frappe-ui/src/components/Dialog/index.ts","../../../../frontend/node_modules/frappe-ui/src/utils/confirmDialog.js","../../../../frontend/node_modules/frappe-ui/src/components/ErrorMessage/ErrorMessage.vue","../../../../frontend/node_modules/frappe-ui/src/components/Select/Select.vue","../../../../frontend/node_modules/frappe-ui/src/components/Textarea/Textarea.vue","../../../../frontend/node_modules/frappe-ui/src/components/FormLabel.vue","../../../../frontend/node_modules/frappe-ui/src/components/FormControl/FormControl.vue","../../../../frontend/node_modules/frappe-ui/src/components/Input.vue","../../../../frontend/node_modules/frappe-ui/src/components/TextEditor/extensions/image/ImageNodeView.vue","../../../../frontend/node_modules/frappe-ui/src/components/TextEditor/extensions/image/image-extension.ts","../../../../frontend/node_modules/frappe-ui/src/composables/useTouchHandler.ts","../../../../frontend/node_modules/frappe-ui/src/composables/useImageNavigation.ts","../../../../frontend/node_modules/frappe-ui/src/composables/useZoomPan.ts","../../../../frontend/node_modules/frappe-ui/src/components/TextEditor/ImageViewerModal.vue","../../../../frontend/node_modules/frappe-ui/src/components/TextEditor/image-viewer-extension.ts","../../../../frontend/node_modules/frappe-ui/src/components/TextEditor/video-extension.ts","../../../../frontend/node_modules/frappe-ui/src/components/TextEditor/extensions/iframe/utils.ts","../../../../frontend/node_modules/frappe-ui/src/components/TextEditor/extensions/iframe/IframeNodeView.vue","../../../../frontend/node_modules/frappe-ui/src/components/TextEditor/extensions/iframe/iframe-extension.ts","../../../../frontend/node_modules/frappe-ui/src/utils/url-validation.ts","../../../../frontend/node_modules/frappe-ui/src/components/TextEditor/EditLink.vue","../../../../frontend/node_modules/frappe-ui/src/components/TextEditor/linkPasteHandler.ts","../../../../frontend/node_modules/frappe-ui/src/components/TextEditor/link-extension.ts","../../../../frontend/node_modules/frappe-ui/src/components/TextEditor/extensions/shared/color-utils.ts","../../../../frontend/node_modules/frappe-ui/src/components/TextEditor/extensions/color/color-extension.ts","../../../../frontend/node_modules/frappe-ui/src/components/TextEditor/extensions/highlight/highlight-extension.ts","../../../../frontend/node_modules/frappe-ui/src/components/TextEditor/extensions/suggestion/createSuggestionExtension.ts","../../../../frontend/node_modules/frappe-ui/src/components/TextEditor/extensions/suggestion/SuggestionList.vue","../../../../frontend/node_modules/frappe-ui/src/components/TextEditor/extensions/mention/mention-extension.ts","../../../../frontend/node_modules/frappe-ui/src/components/TextEditor/extensions/emoji/EmojiList.vue","../../../../frontend/node_modules/frappe-ui/src/components/TextEditor/extensions/emoji/emoji-extension.ts","../../../../frontend/node_modules/frappe-ui/src/components/TextEditor/extensions/slash-commands/SlashCommandsList.vue","../../../../frontend/node_modules/frappe-ui/src/components/TextEditor/extensions/slash-commands/slash-commands-extension.ts","../../../../frontend/node_modules/frappe-ui/src/utils/markdown.ts","../../../../frontend/node_modules/frappe-ui/src/components/TextEditor/extensions/content-paste-extension.ts","../../../../frontend/node_modules/frappe-ui/src/components/TextEditor/extensions/tag/tag-extension.ts","../../../../frontend/node_modules/frappe-ui/src/components/TextEditor/extensions/heading/heading.ts","../../../../frontend/node_modules/frappe-ui/src/components/TextEditor/extensions/image-group/ImageGroupUploadDialog.vue","../../../../frontend/node_modules/frappe-ui/src/components/TextEditor/extensions/image-group/ImageGroupNodeView.vue","../../../../frontend/node_modules/frappe-ui/src/components/TextEditor/extensions/image-group/image-group-extension.ts","../../../../frontend/node_modules/frappe-ui/src/components/Toast/index.ts","../../../../frontend/node_modules/frappe-ui/src/components/Calendar/composables/useCalendarData.js","../../../../frontend/node_modules/frappe-ui/src/utils/call.js","../../../../frontend/node_modules/frappe-ui/src/utils/file-to-base64.ts","../../../../frontend/node_modules/frappe-ui/src/utils/pageMeta.ts","../../../../frontend/node_modules/frappe-ui/src/utils/request.js","../../../../frontend/node_modules/frappe-ui/src/resources/local.js","../../../../frontend/node_modules/frappe-ui/src/resources/resources.js","../../../../frontend/node_modules/frappe-ui/src/resources/realtime.js","../../../../frontend/node_modules/frappe-ui/src/resources/listResource.js","../../../../frontend/node_modules/frappe-ui/src/resources/documentResource.js","../../../../frontend/node_modules/frappe-ui/src/resources/plugin.js","../../../../frontend/node_modules/frappe-ui/src/utils/frappeRequest.js","../../../../frontend/node_modules/frappe-ui/src/data-fetching/idbStore.ts","../../../../frontend/node_modules/frappe-ui/src/data-fetching/docStore.ts","../../../../frontend/node_modules/frappe-ui/src/data-fetching/useList/listStore.ts","../../../../frontend/node_modules/frappe-ui/src/data-fetching/useFrappeFetch.ts"],"sourcesContent":["<template>\n  <div class=\"block w-full\">\n    <div\n      class=\"flex items-start rounded-md px-4 py-3.5 text-base md:px-5\"\n      :class=\"classes\"\n    >\n      <svg\n        width=\"24\"\n        height=\"24\"\n        viewBox=\"0 0 24 24\"\n        fill=\"none\"\n        xmlns=\"http://www.w3.org/2000/svg\"\n      >\n        <path\n          opacity=\"0.8\"\n          fill-rule=\"evenodd\"\n          clip-rule=\"evenodd\"\n          d=\"M12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C17.5 22 22 17.5 22 12C22 6.5 17.5 2 12 2ZM12 10.5C12.5523 10.5 13 10.9477 13 11.5V17C13 17.5523 12.5523 18 12 18C11.4477 18 11 17.5523 11 17V11.5C11 10.9477 11.4477 10.5 12 10.5ZM13 7.99976C13 7.44747 12.5523 6.99976 12 6.99976C11.4477 6.99976 11 7.44747 11 7.99976V8.1C11 8.65228 11.4477 9.1 12 9.1C12.5523 9.1 13 8.65228 13 8.1V7.99976Z\"\n          fill=\"#318AD8\"\n        />\n      </svg>\n      <div class=\"ml-2 w-full\">\n        <div class=\"flex flex-col md:flex-row md:items-baseline\">\n          <h3 class=\"text-lg font-medium text-ink-gray-9\" v-if=\"title\">\n            {{ title }}\n          </h3>\n          <div class=\"mt-1 md:ml-2 md:mt-0\">\n            <slot></slot>\n          </div>\n          <div class=\"mt-3 md:ml-auto md:mt-0\">\n            <slot name=\"actions\"></slot>\n          </div>\n        </div>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport { computed } from 'vue'\nimport type { AlertProps } from './types'\n\nconst props = withDefaults(defineProps<AlertProps>(), {\n  type: 'warning',\n})\n\nconst classes = computed(() => {\n  return {\n    warning: 'text-ink-gray-7 bg-surface-blue-1',\n  }[props.type]\n})\n</script>\n","<template>\n  <PopoverRoot v-model:open=\"isOpen\" @update:open=\"onUpdateOpen\">\n    <PopoverAnchor asChild>\n      <div\n        ref=\"anchorRef\"\n        :class=\"['flex', $attrs.class]\"\n        @mouseover=\"onMouseover\"\n        @mouseleave=\"onMouseleave\"\n      >\n        <slot\n          name=\"target\"\n          v-bind=\"{\n            togglePopover,\n            updatePosition,\n            open,\n            close,\n            isOpen,\n          }\"\n        />\n      </div>\n    </PopoverAnchor>\n    <PopoverPortal>\n      <PopoverContent\n        :side=\"placementSide\"\n        :align=\"placementAlign\"\n        :style=\"{\n          minWidth: matchTargetWidth\n            ? 'var(--reka-popover-trigger-width)'\n            : undefined,\n        }\"\n        :class=\"['PopoverContent', { 'has-transition': hasTransition }]\"\n        @mouseover=\"\n          () => {\n            pointerOverTargetOrPopup = true\n          }\n        \"\n        @mouseleave=\"onMouseleave\"\n        @interact-outside=\"onInteractOutside\"\n      >\n        <div class=\"relative\" :class=\"['body-container', popoverClass]\">\n          <slot\n            name=\"body\"\n            v-bind=\"{ togglePopover, updatePosition, open, close, isOpen }\"\n          >\n            <div class=\"rounded-lg border bg-surface-modal shadow-xl\">\n              <slot\n                name=\"body-main\"\n                v-bind=\"{\n                  togglePopover,\n                  updatePosition,\n                  open,\n                  close,\n                  isOpen,\n                }\"\n              />\n            </div>\n          </slot>\n        </div>\n      </PopoverContent>\n    </PopoverPortal>\n  </PopoverRoot>\n</template>\n\n<script setup lang=\"ts\">\nimport { computed, ref, onUnmounted } from 'vue'\nimport {\n  PopoverAnchor,\n  PopoverContent,\n  PopoverPortal,\n  PopoverRoot,\n} from 'reka-ui'\nimport { PopoverProps } from './types'\n\nconst props = withDefaults(defineProps<PopoverProps>(), {\n  show: undefined,\n  trigger: 'click',\n  hoverDelay: 0,\n  leaveDelay: 0.5,\n  placement: 'bottom-start',\n  popoverClass: '',\n  transition: null,\n  hideOnBlur: true,\n})\n\nconst emit = defineEmits<{\n  (event: 'open'): void\n  (event: 'close'): void\n  (event: 'update:show', value: boolean): void\n}>()\n\ndefineExpose({ open, close })\n\ndefineOptions({\n  inheritAttrs: false,\n})\n\nconst _isOpen = ref(false)\nconst pointerOverTargetOrPopup = ref(false)\nconst hoverTimer = ref<number | null>(null)\nconst leaveTimer = ref<number | null>(null)\nconst anchorRef = ref<HTMLElement | null>(null)\n\nconst isOpen = computed({\n  get: () => (isShowPropPassed.value ? props.show : _isOpen.value),\n  set: (value: boolean) => {\n    if (!isShowPropPassed.value) {\n      _isOpen.value = value\n    }\n    emit('update:show', value)\n  },\n})\n\nconst isShowPropPassed = computed(() => {\n  return props.show !== undefined\n})\n\nconst placementSide = computed(() => {\n  const [side] = props.placement.split('-')\n  return side as 'top' | 'right' | 'bottom' | 'left'\n})\n\nconst placementAlign = computed(() => {\n  const [, align] = props.placement.split('-')\n  if (!align) return 'center'\n  return align as 'start' | 'center' | 'end'\n})\n\nfunction togglePopover(flag?: boolean | Event) {\n  if (flag instanceof Event) {\n    flag = undefined\n  }\n  if (flag == null) {\n    flag = !isOpen.value\n  }\n  flag = Boolean(flag)\n  if (flag) {\n    open()\n  } else {\n    close()\n  }\n}\n\nfunction updatePosition() {\n  // not needed\n}\n\nfunction open() {\n  isOpen.value = true\n}\n\nfunction close() {\n  isOpen.value = false\n}\n\nfunction onUpdateOpen(value: boolean) {\n  emit('update:show', value)\n  if (value) {\n    emit('open')\n  } else {\n    emit('close')\n  }\n}\n\nfunction onMouseover() {\n  pointerOverTargetOrPopup.value = true\n  if (leaveTimer.value) {\n    clearTimeout(leaveTimer.value)\n    leaveTimer.value = null\n  }\n  if (props.trigger === 'hover') {\n    if (props.hoverDelay) {\n      hoverTimer.value = setTimeout(\n        () => {\n          if (pointerOverTargetOrPopup.value) {\n            open()\n          }\n        },\n        Number(props.hoverDelay) * 1000,\n      ) as unknown as number\n    } else {\n      open()\n    }\n  }\n}\n\nfunction onMouseleave() {\n  pointerOverTargetOrPopup.value = false\n  if (hoverTimer.value) {\n    clearTimeout(hoverTimer.value)\n    hoverTimer.value = null\n  }\n  if (props.trigger === 'hover') {\n    if (leaveTimer.value) {\n      clearTimeout(leaveTimer.value)\n    }\n    if (props.leaveDelay) {\n      leaveTimer.value = setTimeout(\n        () => {\n          if (!pointerOverTargetOrPopup.value) {\n            close()\n          }\n        },\n        Number(props.leaveDelay) * 1000,\n      ) as unknown as number\n    } else {\n      if (!pointerOverTargetOrPopup.value) {\n        close()\n      }\n    }\n  }\n}\n\nfunction onInteractOutside(event: Event) {\n  if (!props.hideOnBlur) {\n    event.preventDefault()\n    return\n  }\n\n  // Check if the click is on the trigger/anchor element\n  const target = event.target as Element\n  if (\n    anchorRef.value &&\n    (anchorRef.value.contains(target) || anchorRef.value === target)\n  ) {\n    event.preventDefault()\n    return\n  }\n}\n\nconst hasTransition = computed(() => {\n  return props.transition === 'default'\n})\n\n// Cleanup timers on unmount\nonUnmounted(() => {\n  if (hoverTimer.value) {\n    clearTimeout(hoverTimer.value)\n  }\n  if (leaveTimer.value) {\n    clearTimeout(leaveTimer.value)\n  }\n})\n</script>\n\n<style>\n/* Default transition animations */\n@keyframes popover-enter {\n  from {\n    opacity: 0;\n    transform: translateY(4px);\n  }\n  to {\n    opacity: 1;\n    transform: translateY(0);\n  }\n}\n\n@keyframes popover-exit {\n  from {\n    opacity: 1;\n    transform: translateY(0);\n  }\n  to {\n    opacity: 0;\n    transform: translateY(4px);\n  }\n}\n\n/* Default transition */\n.PopoverContent.has-transition[data-state='open'] {\n  animation: popover-enter 150ms ease-out;\n}\n\n.PopoverContent.has-transition[data-state='closed'] {\n  animation: popover-exit 150ms ease-in;\n}\n</style>\n","<script>\nimport { h, mergeProps } from 'vue'\nimport feather from 'feather-icons'\n\nconst validIcons = Object.keys(feather.icons)\n\nexport default {\n  props: {\n    name: {\n      type: String,\n      required: true,\n      validator(value) {\n        const valid = validIcons.includes(value)\n        if (!valid) {\n          console.groupCollapsed(\n            '[frappe-ui] name property for feather-icon must be one of ',\n          )\n          console.dir(validIcons)\n          console.groupEnd()\n        }\n        return valid\n      },\n    },\n    color: {\n      type: String,\n      default: null,\n    },\n    strokeWidth: {\n      type: Number,\n      default: 1.5,\n    },\n  },\n  render() {\n    let icon = feather.icons[this.name]\n    if (!icon) {\n      icon = feather.icons['circle']\n    }\n    return h(\n      'svg',\n      mergeProps(\n        icon.attrs,\n        {\n          fill: 'none',\n          stroke: 'currentColor',\n          color: this.color,\n          'stroke-linecap': 'round',\n          'stroke-linejoin': 'round',\n          'stroke-width': this.strokeWidth,\n          width: null,\n          height: null,\n          class: [icon.attrs.class, 'shrink-0'],\n          innerHTML: icon.contents,\n        },\n        this.$attrs,\n      ),\n    )\n  },\n}\n</script>\n","<template>\n  <svg\n    class=\"max-w-xs animate-spin\"\n    xmlns=\"http://www.w3.org/2000/svg\"\n    fill=\"none\"\n    :style=\"`scale: ${scale}%;`\"\n    viewBox=\"0 0 24 24\"\n  >\n    <circle\n      class=\"opacity-25\"\n      cx=\"12\"\n      cy=\"12\"\n      r=\"10\"\n      stroke=\"currentColor\"\n      stroke-width=\"4\"\n    ></circle>\n    <path\n      class=\"opacity-75\"\n      fill=\"currentColor\"\n      d=\"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z\"\n    ></path>\n  </svg>\n</template>\n<script setup lang=\"ts\">\ndefineProps({ scale: { required: false, default: 100 } })\n</script>\n","<script setup lang=\"ts\">\nimport {\n  TooltipProvider,\n  TooltipRoot,\n  TooltipPortal,\n  TooltipTrigger,\n  TooltipContent,\n  TooltipArrow,\n} from 'reka-ui'\nimport { computed } from 'vue'\nimport type { TooltipProps } from './types'\n\ndefineOptions({\n  inheritAttrs: false,\n})\n\nconst props = withDefaults(defineProps<TooltipProps>(), {\n  text: '',\n  placement: 'top',\n  hoverDelay: 0.5,\n  arrowClass: 'fill-surface-gray-7',\n  disabled: false,\n})\n\nconst delayDuration = computed(() => props.hoverDelay * 1000)\n</script>\n\n<template>\n  <slot v-if=\"disabled\" />\n  <TooltipProvider v-else :delayDuration=\"delayDuration\">\n    <TooltipRoot>\n      <TooltipTrigger as-child>\n        <slot />\n      </TooltipTrigger>\n      <TooltipPortal>\n        <TooltipContent\n          v-if=\"props.text || $slots.body || $slots.content\"\n          :side=\"props.placement\"\n          :side-offset=\"4\"\n          class=\"z-[100]\"\n        >\n          <slot name=\"body\">\n            <div\n              class=\"rounded bg-surface-gray-7 px-2 py-1 text-xs text-ink-white shadow-xl\"\n            >\n              <slot name=\"content\">{{ props.text }}</slot>\n            </div>\n          </slot>\n          <TooltipArrow :class=\"props.arrowClass\" :width=\"8\" :height=\"4\" />\n        </TooltipContent>\n      </TooltipPortal>\n    </TooltipRoot>\n  </TooltipProvider>\n</template>\n","<template>\n  <Tooltip :text=\"tooltip\" :disabled=\"!tooltip?.length\">\n    <button\n      v-bind=\"$attrs\"\n      :class=\"buttonClasses\"\n      @click=\"handleClick\"\n      :disabled=\"isDisabled\"\n      :ariaLabel=\"ariaLabel\"\n      ref=\"rootRef\"\n    >\n      <LoadingIndicator\n        v-if=\"loading\"\n        :class=\"{\n          'h-3 w-3': size == 'sm',\n          'h-[13.5px] w-[13.5px]': size == 'md',\n          'h-[15px] w-[15px]': size == 'lg',\n          'h-4.5 w-4.5': size == 'xl' || size == '2xl',\n        }\"\n      />\n      <slot name=\"prefix\" v-else-if=\"$slots['prefix'] || iconLeft\">\n        <FeatherIcon\n          v-if=\"iconLeft && typeof iconLeft === 'string'\"\n          :name=\"iconLeft\"\n          :class=\"slotClasses\"\n          aria-hidden=\"true\"\n        />\n        <component v-else-if=\"iconLeft\" :is=\"iconLeft\" :class=\"slotClasses\" />\n      </slot>\n\n      <template v-if=\"loading && loadingText\">{{ loadingText }}</template>\n      <template v-else-if=\"isIconButton && !loading\">\n        <FeatherIcon\n          v-if=\"icon && typeof icon === 'string'\"\n          :name=\"icon\"\n          :class=\"slotClasses\"\n          :aria-label=\"label\"\n        />\n        <component v-else-if=\"icon\" :is=\"icon\" :class=\"slotClasses\" />\n        <slot name=\"icon\" v-else-if=\"$slots.icon\" />\n        <div v-else-if=\"hasLucideIconInDefaultSlot\" :class=\"slotClasses\">\n          <slot>{{ label }}</slot>\n        </div>\n      </template>\n      <span v-else :class=\"{ 'sr-only': isIconButton }\" class=\"truncate\">\n        <slot>{{ label }}</slot>\n      </span>\n\n      <slot name=\"suffix\">\n        <FeatherIcon\n          v-if=\"iconRight && typeof iconRight === 'string'\"\n          :name=\"iconRight\"\n          :class=\"slotClasses\"\n          aria-hidden=\"true\"\n        />\n          <component\n            v-else-if=\"iconRight\"\n            :is=\"iconRight\"\n            :class=\"slotClasses\"\n          />\n      </slot>\n    </button>\n  </Tooltip>\n</template>\n<script lang=\"ts\" setup>\nimport { computed, useSlots, ref } from 'vue'\nimport FeatherIcon from '../FeatherIcon.vue'\nimport LoadingIndicator from '../LoadingIndicator.vue'\nimport { useRouter } from 'vue-router'\nimport type { ButtonProps, ThemeVariant } from './types'\nimport Tooltip from '../Tooltip/Tooltip.vue'\n\ndefineOptions({ inheritAttrs: false })\n\nconst props = withDefaults(defineProps<ButtonProps>(), {\n  theme: 'gray',\n  size: 'sm',\n  variant: 'subtle',\n  loading: false,\n  disabled: false,\n})\n\nconst slots = useSlots()\nconst router = useRouter()\n\nconst buttonClasses = computed(() => {\n  let solidClasses = {\n    gray: 'text-ink-white bg-surface-gray-7 hover:bg-surface-gray-6 active:bg-surface-gray-5',\n    blue: 'text-ink-white bg-blue-500 hover:bg-surface-blue-3 active:bg-blue-700',\n    green:\n      'text-ink-white bg-surface-green-3 hover:bg-green-700 active:bg-green-800',\n    red: 'text-ink-white bg-surface-red-5 hover:bg-surface-red-6 active:bg-surface-red-7',\n  }[props.theme]\n\n  let subtleClasses = {\n    gray: 'text-ink-gray-8 bg-surface-gray-2 hover:bg-surface-gray-3 active:bg-surface-gray-4',\n    blue: 'text-ink-blue-3 bg-surface-blue-2 hover:bg-blue-200 active:bg-blue-300',\n    green:\n      'text-green-800 bg-surface-green-2 hover:bg-green-200 active:bg-green-300',\n    red: 'text-red-700 bg-surface-red-2 hover:bg-surface-red-3 active:bg-surface-red-4',\n  }[props.theme]\n\n  let outlineClasses = {\n    gray: 'text-ink-gray-8 bg-surface-white bg-surface-white border border-outline-gray-2 hover:border-outline-gray-3 active:border-outline-gray-3 active:bg-surface-gray-4',\n    blue: 'text-ink-blue-3 bg-surface-white border border-outline-blue-1 hover:border-blue-400 active:border-blue-400 active:bg-blue-300',\n    green:\n      'text-green-800 bg-surface-white border border-outline-green-2 hover:border-green-500 active:border-green-500 active:bg-green-300',\n    red: 'text-red-700 bg-surface-white border border-outline-red-1 hover:border-outline-red-2 active:border-outline-red-2 active:bg-surface-red-3',\n  }[props.theme]\n\n  let ghostClasses = {\n    gray: 'text-ink-gray-8 bg-transparent hover:bg-surface-gray-3 active:bg-surface-gray-4',\n    blue: 'text-ink-blue-3 bg-transparent hover:bg-blue-200 active:bg-blue-300',\n    green:\n      'text-green-800 bg-transparent hover:bg-green-200 active:bg-green-300',\n    red: 'text-red-700 bg-transparent hover:bg-surface-red-3 active:bg-surface-red-4',\n  }[props.theme]\n\n  let focusClasses = {\n    gray: 'focus-visible:ring focus-visible:ring-outline-gray-3',\n    blue: 'focus-visible:ring focus-visible:ring-blue-400',\n    green: 'focus-visible:ring focus-visible:ring-outline-green-2',\n    red: 'focus-visible:ring focus-visible:ring-outline-red-2',\n  }[props.theme]\n\n  let variantClasses = {\n    subtle: subtleClasses,\n    solid: solidClasses,\n    outline: outlineClasses,\n    ghost: ghostClasses,\n  }[props.variant]\n\n  let themeVariant: ThemeVariant = `${props.theme}-${props.variant}`\n\n  let disabledClassesMap: Record<ThemeVariant, string> = {\n    'gray-solid': 'bg-surface-gray-2 text-ink-gray-4',\n    'gray-subtle': 'bg-surface-gray-2 text-ink-gray-4',\n    'gray-outline':\n      'bg-surface-gray-2 text-ink-gray-4 border border-outline-gray-2',\n    'gray-ghost': 'text-ink-gray-4',\n\n    'blue-solid': 'bg-blue-300 text-ink-white',\n    'blue-subtle': 'bg-surface-blue-2 text-ink-blue-link',\n    'blue-outline':\n      'bg-surface-blue-2 text-ink-blue-link border border-outline-blue-1',\n    'blue-ghost': 'text-ink-blue-link',\n\n    'green-solid': 'bg-surface-green-2 text-ink-green-2',\n    'green-subtle': 'bg-surface-green-2 text-ink-green-2',\n    'green-outline':\n      'bg-surface-green-2 text-ink-green-2 border border-outline-green-2',\n    'green-ghost': 'text-ink-green-2',\n\n    'red-solid': 'bg-surface-red-2 text-ink-red-2',\n    'red-subtle': 'bg-surface-red-2 text-ink-red-2',\n    'red-outline':\n      'bg-surface-red-2 text-ink-red-2 border border-outline-red-1',\n    'red-ghost': 'text-ink-red-2',\n  }\n  let disabledClasses = disabledClassesMap[themeVariant]\n\n  let sizeClasses = {\n    sm: 'h-7 text-base px-2 rounded',\n    md: 'h-8 text-base font-medium px-2.5 rounded',\n    lg: 'h-10 text-lg font-medium px-3 rounded-md',\n    xl: 'h-11.5 text-xl font-medium px-3.5 rounded-lg',\n    '2xl': 'h-13 text-2xl font-medium px-3.5 rounded-xl',\n  }[props.size]\n\n  if (isIconButton.value) {\n    sizeClasses = {\n      sm: 'h-7 w-7 rounded',\n      md: 'h-8 w-8 rounded',\n      lg: 'h-10 w-10 rounded-md',\n      xl: 'h-11.5 w-11.5 rounded-lg',\n      '2xl': 'h-13 w-13 rounded-xl',\n    }[props.size]\n  }\n\n  return [\n    'inline-flex items-center justify-center gap-2 transition-colors focus:outline-none shrink-0',\n    isDisabled.value ? disabledClasses : variantClasses,\n    focusClasses,\n    sizeClasses,\n  ]\n})\n\nconst slotClasses = computed(() => {\n  let classes = {\n    sm: 'h-4',\n    md: 'h-4.5',\n    lg: 'h-5',\n    xl: 'h-6',\n    '2xl': 'h-6',\n  }[props.size]\n\n  return classes\n})\n\nconst isDisabled = computed(() => {\n  return props.disabled || props.loading\n})\n\nconst ariaLabel = computed(() => {\n  return isIconButton.value ? props.label : null\n})\n\nconst isIconButton = computed(() => {\n  return props.icon || slots.icon || hasLucideIconInDefaultSlot.value\n})\n\nconst hasLucideIconInDefaultSlot = computed(() => {\n  if (!slots.default) return false\n\n  const slotContent = slots.default()\n  if (!Array.isArray(slotContent)) return false\n  // if the slot contains only one element and it's a lucide icon\n  // render it as an icon button\n  let firstVNode = slotContent[0]\n  if (\n    typeof firstVNode.type?.name == 'string' &&\n    firstVNode.type?.name?.startsWith('lucide-')\n  ) {\n    return true\n  }\n  return false\n})\n\nconst handleClick = () => {\n  if (props.route) {\n    return router.push(props.route)\n  } else if (props.link) {\n    return window.open(props.link, '_blank')\n  }\n}\n\nconst rootRef = ref()\ndefineExpose({ rootRef })\n</script>\n","<template>\n  <Combobox\n    v-model=\"selectedValue\"\n    :multiple=\"multiple\"\n    nullable\n    :by=\"compareFn\"\n    v-slot=\"{ open: isComboboxOpen }\"\n  >\n    <Popover\n      class=\"w-full\"\n      v-model:show=\"showOptions\"\n      ref=\"rootRef\"\n      :placement=\"placement\"\n      :match-target-width=\"true\"\n    >\n      <template\n        #target=\"{ open: openPopover, togglePopover, close: closePopover }\"\n      >\n        <slot\n          name=\"target\"\n          v-bind=\"{\n            open: openPopover,\n            close: closePopover,\n            togglePopover,\n            isOpen: isComboboxOpen,\n          }\"\n        >\n          <div class=\"w-full space-y-1.5\">\n            <label v-if=\"props.label\" class=\"block text-xs text-ink-gray-5\">\n              {{ props.label }}\n            </label>\n            <button\n              class=\"flex h-7 w-full items-center justify-between gap-2 rounded bg-surface-gray-2 px-2 py-1 transition-colors hover:bg-surface-gray-3 border border-transparent focus:border-outline-gray-4 focus:outline-none focus:ring-2 focus:ring-outline-gray-3\"\n              :class=\"{ 'bg-surface-gray-3': isComboboxOpen }\"\n              @click=\"() => togglePopover()\"\n            >\n              <div class=\"flex items-center overflow-hidden\">\n                <slot name=\"prefix\" />\n                <span\n                  class=\"truncate text-base leading-5 text-ink-gray-8\"\n                  v-if=\"displayValue\"\n                >\n                  {{ displayValue }}\n                </span>\n                <span class=\"text-base leading-5 text-ink-gray-4\" v-else>\n                  {{ placeholder || '' }}\n                </span>\n                <slot name=\"suffix\" />\n              </div>\n              <FeatherIcon\n                name=\"chevron-down\"\n                class=\"h-4 w-4 text-ink-gray-5\"\n                aria-hidden=\"true\"\n              />\n            </button>\n          </div>\n        </slot>\n      </template>\n      <template #body=\"{ isOpen, togglePopover }\">\n        <div v-show=\"isOpen\">\n          <div\n            class=\"relative mt-1 rounded-lg bg-surface-modal text-base shadow-2xl\"\n            :class=\"bodyClasses\"\n          >\n            <ComboboxOptions\n              class=\"max-h-[15rem] overflow-y-auto px-1.5 pb-1.5\"\n              :class=\"{ 'pt-1.5': hideSearch }\"\n              static\n            >\n              <div\n                v-if=\"!hideSearch\"\n                class=\"sticky top-0 z-10 flex items-stretch space-x-1.5 bg-surface-modal py-1.5\"\n              >\n                <div class=\"relative w-full\">\n                  <ComboboxInput\n                    ref=\"searchInput\"\n                    class=\"form-input w-full focus:bg-surface-gray-3 hover:bg-surface-gray-4 text-ink-gray-8\"\n                    type=\"text\"\n                    :value=\"query\"\n                    @change=\"query = $event.target.value\"\n                    autocomplete=\"off\"\n                    placeholder=\"Search\"\n                  />\n                  <div\n                    class=\"absolute right-0 inline-flex h-7 w-7 items-center justify-center\"\n                  >\n                    <LoadingIndicator\n                      v-if=\"props.loading\"\n                      class=\"h-4 w-4 text-ink-gray-5\"\n                    />\n                    <button v-else @click=\"clearAll\">\n                      <FeatherIcon name=\"x\" class=\"w-4 text-ink-gray-8\" />\n                    </button>\n                  </div>\n                </div>\n              </div>\n              <div\n                v-for=\"group in groups\"\n                :key=\"group.key\"\n                v-show=\"group.items.length > 0\"\n              >\n                <div\n                  v-if=\"group.group && !group.hideLabel\"\n                  class=\"sticky top-10 truncate bg-surface-modal px-2.5 py-1.5 text-sm font-medium text-ink-gray-5\"\n                >\n                  {{ group.group }}\n                </div>\n                <ComboboxOption\n                  as=\"template\"\n                  v-for=\"(option, idx) in group.items.slice(\n                    0,\n                    props.maxOptions,\n                  )\"\n                  :key=\"idx\"\n                  :value=\"option\"\n                  :disabled=\"option.disabled\"\n                  v-slot=\"{ active, selected }\"\n                >\n                  <li\n                    :class=\"[\n                      'flex cursor-pointer items-center justify-between rounded px-2.5 py-1.5 text-base',\n                      {\n                        'bg-surface-gray-3': active,\n                        'opacity-50': option.disabled,\n                      },\n                    ]\"\n                  >\n                    <div class=\"flex flex-1 gap-2 overflow-hidden items-center\">\n                      <div\n                        v-if=\"$slots['item-prefix'] || props.multiple\"\n                        class=\"flex flex-shrink-0\"\n                      >\n                        <slot\n                          name=\"item-prefix\"\n                          v-bind=\"{ active, selected, option }\"\n                        >\n                          <FeatherIcon\n                            name=\"check\"\n                            v-if=\"isOptionSelected(option)\"\n                            class=\"h-4 w-4 text-ink-gray-7\"\n                          />\n                          <div v-else class=\"h-4 w-4\" />\n                        </slot>\n                      </div>\n                      <span class=\"flex-1 truncate text-ink-gray-7\">\n                        {{ getLabel(option) }}\n                      </span>\n                    </div>\n\n                    <div\n                      v-if=\"$slots['item-suffix'] || option?.description\"\n                      class=\"ml-2 flex-shrink-0\"\n                    >\n                      <slot\n                        name=\"item-suffix\"\n                        v-bind=\"{ active, selected, option }\"\n                      >\n                        <div\n                          v-if=\"option?.description\"\n                          class=\"text-sm text-ink-gray-5\"\n                        >\n                          {{ option.description }}\n                        </div>\n                      </slot>\n                    </div>\n                  </li>\n                </ComboboxOption>\n              </div>\n              <li\n                v-if=\"groups.length == 0\"\n                class=\"rounded-md px-2.5 py-1.5 text-base text-ink-gray-5\"\n              >\n                No results found\n              </li>\n            </ComboboxOptions>\n\n            <div\n              v-if=\"$slots.footer || props.showFooter || multiple\"\n              class=\"border-t p-1\"\n            >\n              <slot name=\"footer\" v-bind=\"{ togglePopover }\">\n                <div v-if=\"multiple\" class=\"flex items-center justify-end\">\n                  <Button\n                    v-if=\"!areAllOptionsSelected\"\n                    label=\"Select All\"\n                    @click.stop=\"selectAll\"\n                  />\n                  <Button\n                    v-if=\"areAllOptionsSelected\"\n                    label=\"Clear All\"\n                    @click.stop=\"clearAll\"\n                  />\n                </div>\n                <div v-else class=\"flex items-center justify-end\">\n                  <Button label=\"Clear\" @click.stop=\"clearAll\" />\n                </div>\n              </slot>\n            </div>\n          </div>\n        </div>\n      </template>\n    </Popover>\n  </Combobox>\n</template>\n\n<script setup lang=\"ts\">\nimport {\n  Combobox,\n  ComboboxInput,\n  ComboboxOption,\n  ComboboxOptions,\n} from '@headlessui/vue'\nimport { computed, nextTick, ref, watch } from 'vue'\nimport { Popover } from '../Popover'\nimport { Button } from '../Button'\nimport FeatherIcon from '../FeatherIcon.vue'\nimport LoadingIndicator from '../LoadingIndicator.vue'\nimport type {\n  AutocompleteOptionGroup,\n  AutocompleteOption,\n  AutocompleteProps,\n  Option,\n} from './types'\n\nconst props = withDefaults(defineProps<AutocompleteProps>(), {\n  multiple: false,\n  maxOptions: 50,\n  hideSearch: false,\n  compareFn: (a, b) => a.value === b.value,\n})\nconst emit = defineEmits(['update:modelValue', 'update:query', 'change'])\n\nconst searchInput = ref()\nconst showOptions = ref(false)\nconst query = ref('')\n\nconst groups = computed(() => {\n  if (!props.options?.length) return []\n\n  let groups: AutocompleteOptionGroup[]\n  if (isOptionGroup(props.options[0])) {\n    groups = props.options as AutocompleteOptionGroup[]\n  } else {\n    groups = [\n      {\n        group: '',\n        items: sanitizeOptions(props.options as AutocompleteOption[]),\n        hideLabel: false,\n      },\n    ]\n  }\n\n  return groups\n    .map((group, i) => {\n      return {\n        key: i,\n        group: group.group,\n        hideLabel: group.hideLabel,\n        items: filterOptions(sanitizeOptions(group.items || [])),\n      }\n    })\n    .filter((group) => group.items.length > 0)\n})\n\nconst allOptions = computed(() => {\n  return groups.value.flatMap((group) => group.items)\n})\n\nconst sanitizeOptions = (options: AutocompleteOption[]) => {\n  if (!options) return []\n  // in case the options are just values, convert them to objects\n  return options.map((option) => {\n    return isOption(option)\n      ? option\n      : { label: option.toString(), value: option }\n  })\n}\n\nconst filterOptions = (options: Option[]) => {\n  if (!query.value) return options\n  return options.filter((option) => {\n    return (\n      option.label.toLowerCase().includes(query.value.trim().toLowerCase()) ||\n      option.value\n        .toString()\n        .toLowerCase()\n        .includes(query.value.trim().toLowerCase())\n    )\n  })\n}\n\nconst selectedValue = computed({\n  get() {\n    if (!props.multiple) {\n      return (\n        findOption(props.modelValue as AutocompleteOption) ||\n        // if the modelValue is not found in the option list\n        // return the modelValue as is\n        makeOption(props.modelValue as AutocompleteOption)\n      )\n    }\n    // in case of `multiple`, modelValue is an array of values\n    // if the modelValue is a list of values, convert them to options\n    const values = (props.modelValue || []) as AutocompleteOption[]\n    return isOption(values[0])\n      ? values\n      : values.map((v) => findOption(v) || makeOption(v))\n  },\n  set(val) {\n    query.value = ''\n    if (val && !props.multiple) showOptions.value = false\n    if (!props.multiple) {\n      emit('update:modelValue', val)\n      return\n    }\n    emit('update:modelValue', val)\n  },\n})\n\nconst findOption = (option: AutocompleteOption) => {\n  if (!option) return option\n  const value = isOption(option) ? option.value : option\n  return allOptions.value.find((o) => o.value === value)\n}\n\nconst makeOption = (option: AutocompleteOption) => {\n  return isOption(option) ? option : { label: option, value: option }\n}\n\nconst getLabel = (option: AutocompleteOption) => {\n  if (isOption(option)) {\n    return option?.label || option?.value\n  }\n  return option\n}\n\nconst displayValue = computed(() => {\n  if (!selectedValue.value) return ''\n  if (!props.multiple) {\n    return getLabel(selectedValue.value as AutocompleteOption)\n  }\n  return (selectedValue.value as AutocompleteOption[])\n    .map((v) => getLabel(v))\n    .join(', ')\n})\n\nconst isOptionSelected = (option: AutocompleteOption) => {\n  if (!selectedValue.value) return false\n  const value = isOption(option) ? option.value : option\n  if (!props.multiple) {\n    return selectedValue.value === value\n  }\n  return (selectedValue.value as AutocompleteOption[]).find((v) =>\n    isOption(v) ? v.value === value : v === value,\n  )\n}\n\nconst areAllOptionsSelected = computed(() => {\n  if (!props.multiple) return false\n  return (\n    allOptions.value.length ===\n    (selectedValue.value as AutocompleteOption[])?.length\n  )\n})\n\nconst selectAll = () => {\n  selectedValue.value = allOptions.value\n}\n\nconst clearAll = () => {\n  selectedValue.value = props.multiple ? [] : undefined\n}\n\nconst isOption = (option: AutocompleteOption) => {\n  return typeof option === 'object'\n}\n\nconst isOptionGroup = (option: any) => {\n  return typeof option === 'object' && 'items' in option && 'group' in option\n}\n\nwatch(\n  () => query.value,\n  () => {\n    emit('update:query', query.value)\n  },\n)\n\nwatch(\n  () => showOptions.value,\n  () => {\n    if (showOptions.value) {\n      nextTick(() => searchInput.value?.$el.focus())\n    }\n  },\n)\n\nconst rootRef = ref()\n\nconst togglePopover = () => {\n  showOptions.value = !showOptions.value\n}\n\ndefineExpose({\n  rootRef,\n  togglePopover,\n})\n</script>\n","<template>\n  <div\n    class=\"inline-flex select-none items-center gap-1 rounded-full\"\n    :class=\"classes\"\n  >\n    <div\n      :class=\"[props.size == 'lg' ? 'max-h-6' : 'max-h-4']\"\n      v-if=\"$slots.prefix\"\n    >\n      <slot name=\"prefix\"></slot>\n    </div>\n    <slot>{{ props.label?.toString() }}</slot>\n    <div\n      :class=\"[props.size == 'lg' ? 'max-h-6' : 'max-h-4']\"\n      v-if=\"$slots.suffix\"\n    >\n      <slot name=\"suffix\"></slot>\n    </div>\n  </div>\n</template>\n\n<script lang=\"ts\" setup>\nimport { computed } from 'vue'\nimport type { BadgeProps } from './types'\n\nconst props = withDefaults(defineProps<BadgeProps>(), {\n  theme: 'gray',\n  size: 'md',\n  variant: 'subtle',\n})\n\nconst classes = computed(() => {\n  let solidClasses = {\n    gray: 'text-ink-white bg-surface-gray-7',\n    blue: 'text-ink-blue-1 bg-surface-blue-2',\n    green: 'text-ink-green-1 bg-surface-green-3',\n    orange: 'text-ink-amber-1 bg-surface-amber-2',\n    red: 'text-ink-red-1 bg-surface-red-4',\n  }[props.theme]\n\n  let subtleClasses = {\n    gray: 'text-ink-gray-6 bg-surface-gray-2',\n    blue: 'text-ink-blue-2 bg-surface-blue-1',\n    green: 'text-ink-green-3 bg-surface-green-2',\n    orange: 'text-ink-amber-3 bg-surface-amber-1',\n    red: 'text-ink-red-4 bg-surface-red-1',\n  }[props.theme]\n\n  let outlineClasses = {\n    gray: 'text-ink-gray-6 bg-transparent border border-outline-gray-1',\n    blue: 'text-ink-blue-2 bg-transparent border border-outline-blue-1',\n    green: 'text-ink-green-3 bg-transparent border border-outline-green-2',\n    orange: 'text-ink-amber-3 bg-transparent border border-outline-amber-2',\n    red: 'text-ink-red-4 bg-transparent border border-outline-red-2',\n  }[props.theme]\n\n  let ghostClasses = {\n    gray: 'text-ink-gray-6 bg-transparent',\n    blue: 'text-ink-blue-2 bg-transparent',\n    green: 'text-ink-green-3 bg-transparent',\n    orange: 'text-ink-amber-3 bg-transparent',\n    red: 'text-ink-red-4 bg-transparent',\n  }[props.theme]\n\n  let variantClasses = {\n    subtle: subtleClasses,\n    solid: solidClasses,\n    outline: outlineClasses,\n    ghost: ghostClasses,\n  }[props.variant]\n\n  let sizeClasses = {\n    sm: 'h-4 text-xs px-1.5',\n    md: 'h-5 text-xs px-1.5',\n    lg: 'h-6 text-sm px-2',\n  }[props.size]\n\n  return [variantClasses, sizeClasses]\n})\n</script>\n","let id = 0\nfunction generateId() {\n  return ++id\n}\n\nexport function useId() {\n  return 'frappe-ui-' + generateId()\n}\n","<template>\n  <div class=\"flex items-center text-base text-ink-gray-4\">\n    <LoadingIndicator class=\"-ml-1 mr-2 h-3 w-3\" /> {{ text }}\n  </div>\n</template>\n<script>\nimport LoadingIndicator from './LoadingIndicator.vue'\n\nexport default {\n  name: 'Loading',\n  props: {\n    text: {\n      type: String,\n      default: 'Loading...',\n    },\n  },\n  components: {\n    LoadingIndicator,\n  },\n}\n</script>\n","<template>\n  <div class=\"flex flex-col rounded-lg border bg-white px-6 py-5 shadow\">\n    <div class=\"flex items-baseline justify-between\">\n      <div class=\"flex items-baseline space-x-2\">\n        <div class=\"flex items-center space-x-2\" v-if=\"$slots['actions-left']\">\n          <slot name=\"actions-left\"></slot>\n        </div>\n        <h2 class=\"text-xl font-semibold\">{{ title }}</h2>\n      </div>\n      <div class=\"flex items-center space-x-2\" v-if=\"$slots['actions']\">\n        <slot name=\"actions\"></slot>\n      </div>\n    </div>\n    <p class=\"mt-1.5 text-base text-gray-600\" v-if=\"subtitle\">\n      {{ subtitle }}\n    </p>\n    <div\n      v-if=\"loading\"\n      class=\"mt-4 flex flex-auto flex-col items-center justify-center rounded-md\"\n    >\n      <LoadingText />\n    </div>\n    <div class=\"mt-4 flex-auto overflow-auto\" v-else-if=\"$slots['default']\">\n      <slot></slot>\n    </div>\n  </div>\n</template>\n<script>\nimport LoadingText from './LoadingText.vue'\nexport default {\n  name: 'Card',\n  props: {\n    title: {\n      type: String,\n    },\n    subtitle: {\n      type: String,\n    },\n    loading: {\n      type: Boolean,\n    },\n  },\n  components: {\n    LoadingText,\n  },\n}\n</script>\n","<template>\n  <div\n    class=\"inline-flex space-x-2 rounded transition\"\n    :class=\"{\n      'px-2.5 py-1.5': padding && size === 'sm',\n      'px-3 py-2': padding && size === 'md',\n      'focus-within:bg-surface-gray-2 focus-within:ring-2 focus-within:ring-outline-gray-3 hover:bg-surface-gray-3 active:bg-surface-gray-4':\n        padding && !disabled,\n    }\"\n  >\n    <input\n      class=\"rounded-sm mt-[1px]\"\n      :class=\"inputClasses\"\n      type=\"checkbox\"\n      :disabled=\"disabled\"\n      :id=\"htmlId\"\n      :checked=\"Boolean(modelValue)\"\n      @change=\"\n        (e) =>\n          $emit('update:modelValue', (e.target as HTMLInputElement).checked)\n      \"\n      v-bind=\"attrs\"\n    />\n    <label class=\"block\" :class=\"labelClasses\" v-if=\"label\" :for=\"htmlId\">\n      {{ label }}\n    </label>\n  </div>\n</template>\n<script lang=\"ts\" setup>\nimport { computed, useAttrs } from 'vue'\nimport { useId } from '../../utils/useId'\nimport type { CheckboxProps } from './types'\n\nconst props = withDefaults(defineProps<CheckboxProps>(), {\n  size: 'sm',\n  padding: false,\n})\n\nconst attrs = useAttrs()\n\nconst htmlId = props.id ?? useId()\n\nconst labelClasses = computed(() => {\n  return [\n    {\n      sm: 'text-base font-medium',\n      md: 'text-lg font-medium',\n    }[props.size],\n    props.disabled ? 'text-ink-gray-4' : 'text-ink-gray-8',\n    'select-none',\n  ]\n})\n\nconst inputClasses = computed(() => {\n  let baseClasses = props.disabled\n    ? 'border-outline-gray-2 bg-surface-menu-bar text-ink-gray-3'\n    : 'border-outline-gray-4 text-ink-gray-9 hover:border-gray-600 focus:ring-offset-0 focus:border-gray-900 active:border-gray-700 transition'\n\n  let interactionClasses = props.disabled\n    ? ''\n    : props.padding\n      ? 'focus:ring-0'\n      : 'hover:shadow-sm focus:ring-0 focus-visible:ring-2 focus-visible:ring-outline-gray-3 active:bg-surface-gray-2'\n\n  let sizeClasses = {\n    sm: 'w-3.5 h-3.5',\n    md: 'w-4 h-4',\n  }[props.size]\n\n  return [baseClasses, interactionClasses, sizeClasses]\n})\n</script>\n","export default function debounce(\n  func: Function,\n  wait: number,\n  immediate?: boolean,\n) {\n  var timeout: number | undefined\n  return function () {\n    var context = this,\n      args = arguments\n    var later = function () {\n      timeout = undefined\n      if (!immediate) func.apply(context, args)\n    }\n    var callNow = immediate && !timeout\n    clearTimeout(timeout)\n    timeout = window.setTimeout(later, wait)\n    if (callNow) func.apply(context, args)\n  }\n}\n","<template>\n  <div\n    class=\"relative flex items-center\"\n    :class=\"attrs.class\"\n    :style=\"attrs.style\"\n  >\n    <div\n      :class=\"[\n        'absolute inset-y-0 left-0 flex items-center',\n        textColor,\n        prefixClasses,\n      ]\"\n      v-if=\"$slots.prefix\"\n    >\n      <slot name=\"prefix\"> </slot>\n    </div>\n    <input\n      ref=\"inputRef\"\n      :type=\"type\"\n      :placeholder=\"placeholder\"\n      :class=\"inputClasses\"\n      :disabled=\"disabled\"\n      :id=\"id\"\n      :value=\"modelValue\"\n      :required=\"required\"\n      @input=\"handleChange\"\n      @change=\"handleChange\"\n      v-bind=\"attrsWithoutClassStyle\"\n    />\n    <div\n      :class=\"[\n        'absolute inset-y-0 right-0 flex items-center',\n        textColor,\n        suffixClasses,\n      ]\"\n      v-if=\"$slots.suffix\"\n    >\n      <slot name=\"suffix\"> </slot>\n    </div>\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport { computed, useSlots, useAttrs, ref } from 'vue'\nimport debounce from '../../utils/debounce'\nimport type { TextInputProps } from './types'\n\ndefineOptions({\n  inheritAttrs: false,\n})\n\nconst props = withDefaults(defineProps<TextInputProps>(), {\n  type: 'text',\n  size: 'sm',\n  variant: 'subtle',\n})\n\nconst emit = defineEmits(['update:modelValue'])\n\nconst slots = useSlots()\nconst attrs = useAttrs()\n\nconst attrsWithoutClassStyle = computed(() => {\n  return Object.fromEntries(\n    // class and style is passed to the root element\n    Object.entries(attrs).filter(([key]) => key !== 'class' && key !== 'style'),\n  )\n})\n\nconst inputRef = ref<HTMLInputElement | null>(null)\n\ndefineExpose({ el: inputRef })\n\nconst textColor = computed(() => {\n  return props.disabled ? 'text-ink-gray-5' : 'text-ink-gray-8'\n})\n\nconst inputClasses = computed(() => {\n  let sizeClasses = {\n    sm: 'text-base rounded h-7',\n    md: 'text-base rounded h-8',\n    lg: 'text-lg rounded-md h-10',\n    xl: 'text-xl rounded-md h-10',\n  }[props.size]\n\n  let paddingClasses = {\n    sm: [\n      'py-1.5',\n      slots.prefix ? 'pl-8' : 'pl-2',\n      slots.suffix ? 'pr-8' : 'pr-2',\n    ],\n    md: [\n      'py-1.5',\n      slots.prefix ? 'pl-9' : 'pl-2.5',\n      slots.suffix ? 'pr-9' : 'pr-2.5',\n    ],\n    lg: [\n      'py-1.5',\n      slots.prefix ? 'pl-10' : 'pl-3',\n      slots.suffix ? 'pr-10' : 'pr-3',\n    ],\n    xl: [\n      'py-1.5',\n      slots.prefix ? 'pl-10' : 'pl-3',\n      slots.suffix ? 'pr-10' : 'pr-3',\n    ],\n  }[props.size]\n\n  let variant = props.disabled ? 'disabled' : props.variant\n  let variantClasses = {\n    subtle:\n      'border border-[--surface-gray-2] bg-surface-gray-2 placeholder-ink-gray-4 hover:border-outline-gray-modals hover:bg-surface-gray-3 focus:bg-surface-white focus:border-outline-gray-4 focus:shadow-sm focus:ring-0 focus-visible:ring-2 focus-visible:ring-outline-gray-3',\n    outline:\n      'border border-outline-gray-2 bg-surface-white placeholder-ink-gray-4 hover:border-outline-gray-3 hover:shadow-sm focus:bg-surface-white focus:border-outline-gray-4 focus:shadow-sm focus:ring-0 focus-visible:ring-2 focus-visible:ring-outline-gray-3',\n    disabled: [\n      'border bg-surface-gray-1 placeholder-ink-gray-3',\n      props.variant === 'outline'\n        ? 'border-outline-gray-2'\n        : 'border-transparent',\n    ],\n    ghost: 'border-0 focus:ring-0 focus-visible:ring-0',\n  }[variant]\n\n  return [\n    sizeClasses,\n    paddingClasses,\n    variantClasses,\n    textColor.value,\n    'transition-colors w-full dark:[color-scheme:dark]',\n  ]\n})\n\nlet prefixClasses = computed(() => {\n  return {\n    sm: 'pl-2',\n    md: 'pl-2.5',\n    lg: 'pl-3',\n    xl: 'pl-3',\n  }[props.size]\n})\n\nlet suffixClasses = computed(() => {\n  return {\n    sm: 'pr-2',\n    md: 'pr-2.5',\n    lg: 'pr-3',\n    xl: 'pr-3',\n  }[props.size]\n})\n\nlet emitChange = (value: string) => {\n  emit('update:modelValue', value)\n}\nif (props.debounce) {\n  emitChange = debounce(emitChange, props.debounce)\n}\n\nlet handleChange = (e: Event) => {\n  emitChange((e.target as HTMLInputElement).value)\n}\n</script>\n","interface FrappeUIConfig {\n  // Timezone configurations\n  systemTimezone?: string | null\n  localTimezone?: string | null\n\n  // Resource fetcher function\n  resourceFetcher?: (options: any) => Promise<any>\n\n  // Default API endpoints for document operations\n  defaultDocGetUrl?: string\n  defaultDocInsertUrl?: string\n  defaultDocUpdateUrl?: string\n  defaultDocDeleteUrl?: string\n  defaultRunDocMethodUrl?: string\n\n  // Default API endpoints for list operations\n  defaultListUrl?: string\n\n  // Error handling\n  fallbackErrorHandler?: (error: any) => void\n}\n\nlet config: FrappeUIConfig = {}\n\nexport function setConfig<K extends keyof FrappeUIConfig>(\n  key: K,\n  value: FrappeUIConfig[K],\n): void {\n  config[key] = value\n}\n\nexport function getConfig<K extends keyof FrappeUIConfig>(\n  key: K,\n): FrappeUIConfig[K] | null {\n  return config[key] ?? null\n}\n","import _dayjs, { Dayjs } from 'dayjs/esm'\nimport relativeTime from 'dayjs/esm/plugin/relativeTime'\nimport localizedFormat from 'dayjs/esm/plugin/localizedFormat'\nimport updateLocale from 'dayjs/esm/plugin/updateLocale'\nimport isToday from 'dayjs/esm/plugin/isToday'\nimport duration from 'dayjs/esm/plugin/duration'\nimport utc from 'dayjs/esm/plugin/utc'\nimport timezone from 'dayjs/esm/plugin/timezone'\nimport advancedFormat from 'dayjs/esm/plugin/advancedFormat'\nimport customParseFormat from 'dayjs/esm/plugin/customParseFormat'\nimport { getConfig } from './config'\n\n_dayjs.extend(updateLocale)\n_dayjs.extend(relativeTime)\n_dayjs.extend(localizedFormat)\n_dayjs.extend(isToday)\n_dayjs.extend(duration)\n_dayjs.extend(utc)\n_dayjs.extend(timezone)\n_dayjs.extend(advancedFormat)\n_dayjs.extend(customParseFormat)\n\nfunction getBrowserTimezone(): string {\n  return Intl.DateTimeFormat().resolvedOptions().timeZone\n}\n\nexport function dayjsLocal(dateTimeString?: string): Dayjs {\n  let systemTimezone = getConfig('systemTimezone')\n  let localTimezone = getConfig('localTimezone') || getBrowserTimezone()\n\n  if (!systemTimezone) return _dayjs(dateTimeString)\n\n  if (!dateTimeString) return _dayjs().tz(localTimezone)\n  return _dayjs.tz(dateTimeString, systemTimezone).tz(localTimezone)\n}\n\nexport function dayjsSystem(dateTimeString?: string): Dayjs {\n  let systemTimezone = getConfig('systemTimezone')\n  let localTimezone = getConfig('localTimezone') || getBrowserTimezone()\n\n  if (!systemTimezone) return _dayjs(dateTimeString)\n\n  if (!dateTimeString) return _dayjs().tz(systemTimezone)\n  return _dayjs.tz(dateTimeString, localTimezone).tz(systemTimezone)\n}\n\nexport let dayjs = _dayjs\n","<template>\n  <DialogRoot v-model:open=\"isOpen\" @update:open=\"handleOpenChange\">\n    <DialogPortal>\n      <DialogOverlay\n        class=\"fixed inset-0 bg-black-overlay-200 backdrop-filter backdrop-blur-[12px] overflow-y-auto dialog-overlay outline-none\"\n        :data-dialog=\"options.title\"\n        @after-leave=\"$emit('after-leave')\"\n      >\n        <div\n          class=\"flex min-h-screen flex-col items-center px-4 py-4 text-center\"\n          :class=\"dialogPositionClasses\"\n        >\n          <DialogContent\n            class=\"my-8 inline-block w-full transform overflow-hidden rounded-xl bg-surface-modal text-left align-middle shadow-xl dialog-content focus-visible:outline-none\"\n            :class=\"{\n              'max-w-7xl': options.size === '7xl',\n              'max-w-6xl': options.size === '6xl',\n              'max-w-5xl': options.size === '5xl',\n              'max-w-4xl': options.size === '4xl',\n              'max-w-3xl': options.size === '3xl',\n              'max-w-2xl': options.size === '2xl',\n              'max-w-xl': options.size === 'xl',\n              'max-w-lg': options.size === 'lg' || !options.size,\n              'max-w-md': options.size === 'md',\n              'max-w-sm': options.size === 'sm',\n              'max-w-xs': options.size === 'xs',\n            }\"\n            @escape-key-down=\"close()\"\n            @interact-outside=\"\n              (e: Event) => {\n                if (props.disableOutsideClickToClose) {\n                  e.preventDefault()\n                }\n              }\n            \"\n          >\n            <slot name=\"body\">\n              <slot name=\"body-main\">\n                <div class=\"bg-surface-modal px-4 pb-6 pt-5 sm:px-6\">\n                  <div class=\"flex\">\n                    <div class=\"w-full flex-1\">\n                      <slot name=\"body-header\">\n                        <div class=\"mb-6 flex items-center justify-between\">\n                          <div class=\"flex items-center space-x-2\">\n                            <div\n                              v-if=\"icon\"\n                              class=\"flex h-7 w-7 flex-shrink-0 items-center justify-center rounded-full\"\n                              :class=\"dialogIconBgClasses\"\n                            >\n                              <FeatherIcon\n                                :name=\"icon.name\"\n                                class=\"h-4 w-4\"\n                                :class=\"dialogIconClasses\"\n                                aria-hidden=\"true\"\n                              />\n                            </div>\n                            <DialogTitle as=\"header\">\n                              <slot name=\"body-title\">\n                                <h3\n                                  class=\"text-2xl font-semibold leading-6 text-ink-gray-9\"\n                                >\n                                  {{ options.title || 'Untitled' }}\n                                </h3>\n                              </slot>\n                            </DialogTitle>\n                          </div>\n                          <DialogClose as-child>\n                            <Button variant=\"ghost\" @click=\"close\">\n                              <template #icon>\n                                <LucideX class=\"h-4 w-4 text-ink-gray-9\" />\n                              </template>\n                            </Button>\n                          </DialogClose>\n                        </div>\n                      </slot>\n\n                      <slot name=\"body-content\">\n                        <DialogDescription as-child v-if=\"options.message\">\n                          <p class=\"text-p-base text-ink-gray-7\">\n                            {{ options.message }}\n                          </p>\n                        </DialogDescription>\n                      </slot>\n                    </div>\n                  </div>\n                </div>\n              </slot>\n              <div\n                class=\"px-4 pb-7 pt-4 sm:px-6\"\n                v-if=\"actions.length || $slots.actions\"\n              >\n                <slot name=\"actions\" v-bind=\"{ close }\">\n                  <div class=\"space-y-2\">\n                    <Button\n                      class=\"w-full\"\n                      v-for=\"action in actions\"\n                      :key=\"action.label\"\n                      :disabled=\"action.disabled\"\n                      v-bind=\"action\"\n                    >\n                      {{ action.label }}\n                    </Button>\n                  </div>\n                </slot>\n              </div>\n            </slot>\n          </DialogContent>\n        </div>\n      </DialogOverlay>\n    </DialogPortal>\n  </DialogRoot>\n</template>\n\n<script setup lang=\"ts\">\nimport {\n  DialogRoot,\n  DialogPortal,\n  DialogOverlay,\n  DialogContent,\n  DialogTitle,\n  DialogDescription,\n  DialogClose,\n} from 'reka-ui'\nimport { computed, reactive } from 'vue'\nimport { Button } from '../Button'\nimport FeatherIcon from '../FeatherIcon.vue'\nimport LucideX from '~icons/lucide/x'\nimport type {\n  DialogProps,\n  DialogIcon,\n  DialogAction,\n  DialogActionContext,\n} from './types'\n\n// Type for dialog action with reactive loading state\ntype ReactiveDialogAction = DialogAction & {\n  loading: boolean\n}\n\nconst props = withDefaults(defineProps<DialogProps>(), {\n  options: () => ({}),\n  disableOutsideClickToClose: false,\n})\n\nconst emit = defineEmits<{\n  (event: 'update:modelValue', value: boolean): void\n  (event: 'close'): void\n  (event: 'after-leave'): void\n}>()\n\nconst actions = computed((): ReactiveDialogAction[] => {\n  let actions = props.options.actions\n  if (!actions?.length) return []\n\n  return actions.map((action) => {\n    let _action = reactive({\n      ...action,\n      loading: false,\n      onClick: !action.onClick\n        ? close\n        : async () => {\n            _action.loading = true\n            try {\n              if (action.onClick) {\n                // deprecated: uncomment this when we remove the backwards compatibility\n                // let context: DialogActionContext = { close }\n                type BackwardsCompatibleDialogActionContext = (() => void) &\n                  DialogActionContext\n\n                let backwardsCompatibleContext = (() => {\n                  console.warn(\n                    'Value passed to onClick is a context object. Please use context.close() instead of context() to close the dialog.',\n                  )\n                  close()\n                }) as BackwardsCompatibleDialogActionContext\n                backwardsCompatibleContext.close = close\n                await action.onClick(backwardsCompatibleContext)\n              }\n            } finally {\n              _action.loading = false\n            }\n          },\n    })\n    return _action\n  })\n})\n\nconst isOpen = computed({\n  get() {\n    return props.modelValue\n  },\n  set(val: boolean) {\n    emit('update:modelValue', val)\n    if (!val) {\n      emit('close')\n    }\n  },\n})\n\nfunction handleOpenChange(open: boolean) {\n  isOpen.value = open\n}\n\nfunction close() {\n  isOpen.value = false\n}\n\nconst icon = computed(() => {\n  if (!props.options?.icon) return null\n\n  let icon = props.options.icon\n  if (typeof icon === 'string') {\n    icon = { name: icon }\n  }\n  return icon as DialogIcon\n})\n\nconst dialogPositionClasses = computed(() => {\n  const position = props.options?.position || 'center'\n  const classMap: Record<string, string> = {\n    center: 'justify-center',\n    top: 'pt-[20vh]',\n  }\n  return classMap[position]\n})\n\nconst dialogIconBgClasses = computed(() => {\n  const appearance = icon.value?.appearance\n  if (!appearance) return 'bg-surface-gray-2'\n  const classMap: Record<string, string> = {\n    warning: 'bg-surface-amber-2',\n    info: 'bg-surface-blue-2',\n    danger: 'bg-surface-red-2',\n    success: 'bg-surface-green-2',\n  }\n  return classMap[appearance]\n})\n\nconst dialogIconClasses = computed(() => {\n  const appearance = icon.value?.appearance\n  if (!appearance) return 'text-ink-gray-5'\n  const classMap: Record<string, string> = {\n    warning: 'text-ink-amber-3',\n    info: 'text-ink-blue-3',\n    danger: 'text-ink-red-4',\n    success: 'text-ink-green-3',\n  }\n  return classMap[appearance]\n})\n</script>\n\n<style scoped>\n@keyframes dialog-overlay-in {\n  from {\n    opacity: 0;\n  }\n  to {\n    opacity: 1;\n  }\n}\n\n@keyframes dialog-overlay-out {\n  from {\n    opacity: 1;\n  }\n  to {\n    opacity: 0;\n  }\n}\n\n@keyframes dialog-content-in {\n  from {\n    opacity: 0.5;\n    transform: scale(0.98);\n  }\n  to {\n    opacity: 1;\n    transform: scale(1);\n  }\n}\n\n@keyframes dialog-content-out {\n  from {\n    opacity: 1;\n    transform: scale(1);\n  }\n  to {\n    opacity: 0.5;\n    transform: scale(0.98);\n  }\n}\n\n:global(.dialog-overlay[data-state='open']) {\n  animation: dialog-overlay-in 100ms ease-out;\n}\n\n:global(.dialog-overlay[data-state='closed']) {\n  animation: dialog-overlay-out 150ms ease-in;\n}\n\n:global(.dialog-content[data-state='open']) {\n  animation: dialog-content-in 100ms ease-out;\n}\n\n:global(.dialog-content[data-state='closed']) {\n  animation: dialog-content-out 150ms ease-in;\n}\n</style>\n","import DialogMain from './Dialog.vue'\nimport { DialogTitle, DialogDescription } from 'reka-ui'\nexport type { DialogProps } from './types'\n\ntype DialogExport = typeof DialogMain & {\n  Title: typeof DialogTitle\n  Description: typeof DialogDescription\n}\n\nconst Dialog = DialogMain as DialogExport\nDialog.Title = DialogTitle\nDialog.Description = DialogDescription\n\nexport { Dialog }\n","import ConfirmDialog from '../components/ConfirmDialog.vue'\nimport { h, ref } from 'vue'\n\nexport function confirmDialog({ title = 'Untitled', message = '', onConfirm, onCancel }) {\n  renderDialog(\n    h(ConfirmDialog, {\n      title,\n      message,\n      onConfirm,\n      onCancel\n    }),\n  )\n}\n\nexport const dialogs = ref([])\n\nexport function renderDialog(component) {\n  component.id = dialogs.length\n  dialogs.value.push(component)\n}\n","<template>\n  <div\n    v-if=\"message\"\n    class=\"whitespace-pre-line text-sm text-ink-red-4\"\n    role=\"alert\"\n    v-html=\"errorMessage\"\n  ></div>\n</template>\n\n<script setup lang=\"ts\">\nimport { computed } from 'vue'\nimport type { ErrorMessageProps } from './types'\n\nconst props = defineProps<ErrorMessageProps>()\n\nconst errorMessage = computed(() => {\n  if (!props.message) return ''\n  if (props.message instanceof Error) {\n    return (props.message as any).messages || props.message.message\n  }\n  return props.message\n})\n</script>\n","<template>\n  <div class=\"relative flex items-center\">\n    <div\n      :class=\"[\n        'absolute inset-y-0 left-0 flex items-center',\n        textColor,\n        prefixClasses,\n      ]\"\n      v-if=\"$slots.prefix\"\n    >\n      <slot name=\"prefix\"> </slot>\n    </div>\n    <div\n      v-if=\"placeholder\"\n      v-show=\"!modelValue\"\n      class=\"pointer-events-none absolute text-ink-gray-4 truncate w-full\"\n      :class=\"[fontSizeClasses, paddingClasses]\"\n    >\n      {{ placeholder }}\n    </div>\n    <select\n      :class=\"selectClasses\"\n      :disabled=\"disabled\"\n      :id=\"id\"\n      :value=\"modelValue\"\n      @change=\"handleChange\"\n      v-bind=\"attrs\"\n    >\n      <option\n        v-for=\"option in selectOptions\"\n        :key=\"option.value\"\n        :value=\"option.value\"\n        :disabled=\"option.disabled || false\"\n        :selected=\"modelValue === option.value\"\n      >\n        {{ option.label }}\n      </option>\n    </select>\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport { computed, useSlots, useAttrs } from 'vue'\nimport type { SelectProps } from './types'\n\ndefineOptions({\n  inheritAttrs: false,\n})\n\nconst props = withDefaults(defineProps<SelectProps>(), {\n  size: 'sm',\n  variant: 'subtle',\n})\n\nconst emit = defineEmits(['update:modelValue'])\nconst slots = useSlots()\nconst attrs = useAttrs()\n\nfunction handleChange(e: Event) {\n  emit('update:modelValue', (e.target as HTMLInputElement).value)\n}\n\nconst selectOptions = computed(() => {\n  return (\n    props.options\n      ?.map((option) => {\n        if (typeof option === 'string') {\n          return {\n            label: option,\n            value: option,\n          }\n        }\n        return option\n      })\n      .filter(Boolean) || []\n  )\n})\n\nconst textColor = computed(() => {\n  return props.disabled ? 'text-ink-gray-4' : 'text-ink-gray-8'\n})\n\nconst fontSizeClasses = computed(() => {\n  return {\n    sm: 'text-base',\n    md: 'text-base',\n    lg: 'text-lg',\n    xl: 'text-xl',\n  }[props.size]\n})\n\nconst paddingClasses = computed(() => {\n  return {\n    sm: 'pl-2 pr-5',\n    md: 'pl-2.5 pr-5.5',\n    lg: 'pl-3 pr-6',\n    xl: 'pl-3 pr-6',\n  }[props.size]\n})\n\nconst selectClasses = computed(() => {\n  let sizeClasses = {\n    sm: 'rounded h-7',\n    md: 'rounded h-8',\n    lg: 'rounded-md h-10',\n    xl: 'rounded-md h-10',\n  }[props.size]\n\n  let variant = props.disabled ? 'disabled' : props.variant\n  let variantClasses = {\n    subtle:\n      'border border-[--surface-gray-2] bg-surface-gray-2 hover:border-outline-gray-modals hover:bg-surface-gray-3 focus:border-outline-gray-4 focus:ring-0 focus-visible:ring-2 focus-visible:ring-outline-gray-3',\n    outline:\n      'border border-outline-gray-2 bg-surface-white hover:border-outline-gray-3 focus:border-outline-gray-4 focus:ring-0 focus-visible:ring-2 focus-visible:ring-outline-gray-3',\n    ghost:\n      'bg-transparent border-transparent hover:bg-surface-gray-3 focus:bg-surface-gray-3 focus:border-outline-gray-4 focus:ring-0 focus-visible:ring-2 focus-visible:ring-outline-gray-3',\n    disabled: [\n      'border',\n      props.variant !== 'ghost' ? 'bg-surface-gray-1' : '',\n      props.variant === 'outline'\n        ? 'border-outline-gray-2'\n        : 'border-transparent',\n    ],\n  }[variant]\n\n  return [\n    sizeClasses,\n    fontSizeClasses.value,\n    paddingClasses.value,\n    variantClasses,\n    textColor.value,\n    'transition-colors w-full py-0 truncate',\n  ]\n})\n\nlet prefixClasses = computed(() => {\n  return {\n    sm: 'pl-2',\n    md: 'pl-2.5',\n    lg: 'pl-3',\n    xl: 'pl-3',\n  }[props.size]\n})\n</script>\n","<template>\n  <div class=\"space-y-1.5\">\n    <label class=\"block\" :class=\"labelClasses\" v-if=\"label\" :for=\"id\">\n      {{ label }}\n    </label>\n    <textarea\n      ref=\"textareaRef\"\n      :placeholder=\"placeholder\"\n      :class=\"inputClasses\"\n      :disabled=\"disabled\"\n      :id=\"id\"\n      :value=\"modelValue\"\n      :rows=\"rows\"\n      @input=\"handleChange\"\n      @change=\"handleChange\"\n      v-bind=\"attrs\"\n    />\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport { computed, useAttrs, ref } from 'vue'\nimport debounce from '../../utils/debounce'\nimport type { TextareaProps } from './types'\n\nconst props = withDefaults(defineProps<TextareaProps>(), {\n  type: 'text',\n  size: 'sm',\n  variant: 'subtle',\n  rows: 3,\n})\n\nconst emit = defineEmits(['update:modelValue'])\nconst attrs = useAttrs()\nconst textareaRef = ref<HTMLTextAreaElement | null>(null)\n\nconst inputClasses = computed(() => {\n  let sizeClasses = {\n    sm: 'text-base rounded',\n    md: 'text-base rounded',\n    lg: 'text-lg rounded-md',\n    xl: 'text-xl rounded-md',\n  }[props.size]\n\n  let paddingClasses = {\n    sm: ['py-1.5 px-2'],\n    md: ['py-1.5 px-2.5'],\n    lg: ['py-1.5 px-3'],\n    xl: ['py-1.5 px-3'],\n  }[props.size]\n\n  let variant = props.disabled ? 'disabled' : props.variant\n  let variantClasses = {\n    subtle:\n      'border border-[--surface-gray-2] bg-surface-gray-2 placeholder-ink-gray-4 hover:border-outline-gray-modals hover:bg-surface-gray-3 focus:bg-surface-white focus:border-outline-gray-4 focus:shadow-sm focus:ring-0 focus-visible:ring-2 focus-visible:ring-outline-gray-3',\n    outline:\n      'border border-outline-gray-2 bg-surface-white placeholder-ink-gray-4 hover:border-outline-gray-3 hover:shadow-sm focus:bg-surface-white focus:border-outline-gray-4 focus:shadow-sm focus:ring-0 focus-visible:ring-2 focus-visible:ring-outline-gray-3',\n    disabled: [\n      'border bg-surface-gray-1 placeholder-ink-gray-3',\n      props.variant === 'outline'\n        ? 'border-outline-gray-2'\n        : 'border-transparent',\n    ],\n  }[variant]\n\n  return [\n    sizeClasses,\n    paddingClasses,\n    variantClasses,\n    props.disabled ? 'text-ink-gray-5' : 'text-ink-gray-8',\n    'transition-colors w-full block',\n  ]\n})\n\nconst labelClasses = computed(() => {\n  return [\n    {\n      sm: 'text-xs',\n      md: 'text-base',\n      lg: 'text-lg',\n      xl: 'text-xl',\n    }[props.size],\n    'text-ink-gray-5',\n  ]\n})\n\nlet emitChange = (value: string) => {\n  emit('update:modelValue', value)\n}\nif (props.debounce) {\n  emitChange = debounce(emitChange, props.debounce)\n}\n\nlet handleChange = (e: Event) => {\n  emitChange((e.target as HTMLInputElement).value)\n}\n\ndefineExpose({ el: textareaRef })\n</script>\n","<template>\n  <label class=\"block\" :class=\"labelClasses\" :for=\"id\">\n    {{ label }}\n    <template v-if=\"required\">\n      <span class=\"text-ink-red-3 select-none\" aria-hidden=\"true\">*</span>\n      <span class=\"sr-only\">(required)</span>\n    </template>\n  </label>\n</template>\n<script setup lang=\"ts\">\nimport { computed } from 'vue'\n\ninterface FormLabelProps {\n  label: string\n  size?: 'sm' | 'md'\n  id?: string\n  required?: boolean\n}\n\nconst props = withDefaults(defineProps<FormLabelProps>(), {\n  size: 'sm',\n})\n\nconst labelClasses = computed(() => {\n  return [\n    {\n      sm: 'text-xs',\n      md: 'text-base',\n    }[props.size],\n    'text-ink-gray-5',\n  ]\n})\n</script>\n","<template>\n  <div\n    v-if=\"type != 'checkbox'\"\n    :class=\"['space-y-1.5', attrs.class]\"\n    :style=\"attrs.style\"\n  >\n    <FormLabel\n      v-if=\"label\"\n      :label=\"label\"\n      :size=\"size\"\n      :id=\"id\"\n      :required=\"required\"\n    />\n    <Select\n      v-if=\"type === 'select'\"\n      :id=\"id\"\n      v-bind=\"{ ...controlAttrs, size, variant }\"\n    >\n      <template #prefix v-if=\"$slots.prefix\">\n        <slot name=\"prefix\" />\n      </template>\n    </Select>\n    <Autocomplete\n      v-else-if=\"type === 'autocomplete'\"\n      v-bind=\"{ ...controlAttrs }\"\n    >\n      <template #prefix v-if=\"$slots.prefix\">\n        <slot name=\"prefix\" />\n      </template>\n      <template #item-prefix=\"itemPrefixProps\" v-if=\"$slots['item-prefix']\">\n        <slot name=\"item-prefix\" v-bind=\"itemPrefixProps\" />\n      </template>\n    </Autocomplete>\n    <Textarea\n      v-else-if=\"type === 'textarea'\"\n      :id=\"id\"\n      v-bind=\"{ ...controlAttrs, size, variant }\"\n    />\n    <TextInput\n      v-else\n      :id=\"id\"\n      v-bind=\"{ ...controlAttrs, type, size, variant, required }\"\n    >\n      <template #prefix v-if=\"$slots.prefix\">\n        <slot name=\"prefix\" />\n      </template>\n      <template #suffix v-if=\"$slots.suffix\">\n        <slot name=\"suffix\" />\n      </template>\n    </TextInput>\n    <slot name=\"description\">\n      <p v-if=\"description\" :class=\"descriptionClasses\">{{ description }}</p>\n    </slot>\n  </div>\n  <Checkbox\n    v-else\n    :id=\"id\"\n    v-bind=\"{ ...controlAttrs, label, size, class: attrs.class }\"\n  />\n</template>\n<script setup lang=\"ts\">\nimport { useAttrs, computed } from 'vue'\nimport { useId } from '../../utils/useId'\nimport { TextInput } from '../TextInput'\nimport { Select } from '../Select'\nimport { Textarea } from '../Textarea'\nimport { Checkbox } from '../Checkbox'\nimport { Autocomplete } from '../Autocomplete'\nimport FormLabel from '../FormLabel.vue'\nimport type { FormControlProps } from './types'\n\nconst id = useId()\nconst props = withDefaults(defineProps<FormControlProps>(), {\n  type: 'text',\n  size: 'sm',\n  variant: 'subtle',\n})\n\nconst attrs = useAttrs()\nconst controlAttrs = computed(() => {\n  // pass everything except class and style\n  let _attrs: typeof attrs = {}\n  for (let key in attrs) {\n    if (key !== 'class' && key !== 'style') {\n      _attrs[key] = attrs[key]\n    }\n  }\n  return _attrs\n})\n\nconst descriptionClasses = computed(() => {\n  return [\n    {\n      sm: 'text-xs',\n      md: 'text-base',\n    }[props.size],\n    'text-ink-gray-5',\n  ]\n})\n</script>\n<script lang=\"ts\">\nexport default {\n  inheritAttrs: false,\n}\n</script>\n","<template>\n  <label :class=\"[type == 'checkbox' ? 'flex' : 'block', $attrs.class]\" :style=\"$attrs.style\">\n    <span\n      v-if=\"label && type != 'checkbox'\"\n      class=\"mb-2 block text-sm leading-4 text-gray-700\"\n    >\n      {{ label }}\n    </span>\n    <div\n      class=\"relative flex\"\n      :class=\"{ 'items-center': isNormalInput || type == 'select' }\"\n    >\n      <FeatherIcon\n        v-if=\"iconLeft && type != 'checkbox'\"\n        :name=\"iconLeft\"\n        class=\"absolute mx-2 h-4 w-4 text-gray-600\"\n        :class=\"{ 'mt-2': type == 'textarea' }\"\n      />\n      <input\n        v-if=\"isNormalInput\"\n        v-bind=\"inputAttributes\"\n        class=\"border-gray-400 placeholder-gray-500\"\n        ref=\"input\"\n        :class=\"[\n          {\n            'form-input block w-full': type != 'checkbox',\n            'form-checkbox': type == 'checkbox',\n            'pl-8': iconLeft && type != 'checkbox',\n          },\n          inputClass,\n        ]\"\n        :type=\"type || 'text'\"\n        :disabled=\"disabled\"\n        :placeholder=\"placeholder\"\n        :value=\"passedInputValue\"\n      />\n      <textarea\n        v-if=\"type === 'textarea'\"\n        v-bind=\"inputAttributes\"\n        :placeholder=\"placeholder\"\n        class=\"placeholder-gray-500\"\n        :class=\"[\n          'form-textarea block w-full resize-none',\n          inputClass,\n          {\n            'pl-8': iconLeft,\n          },\n        ]\"\n        ref=\"input\"\n        :value=\"passedInputValue\"\n        :disabled=\"disabled\"\n        :rows=\"rows\"\n      ></textarea>\n      <select\n        v-if=\"type === 'select'\"\n        v-bind=\"inputAttributes\"\n        class=\"form-select block w-full\"\n        :class=\"{ 'pl-8': iconLeft }\"\n        ref=\"input\"\n        :disabled=\"disabled\"\n      >\n        <option\n          v-for=\"option in selectOptions\"\n          :key=\"option.value\"\n          :value=\"option.value\"\n          :disabled=\"option.disabled || false\"\n          :selected=\"passedInputValue === option.value\"\n        >\n          {{ option.label }}\n        </option>\n      </select>\n    </div>\n    <span\n      v-if=\"label && type == 'checkbox'\"\n      class=\"ml-2 inline-block text-base leading-4\"\n    >\n      {{ label }}\n    </span>\n  </label>\n</template>\n\n<script>\nimport debounce from '../utils/debounce.ts'\nimport FeatherIcon from './FeatherIcon.vue'\n\nexport default {\n  name: 'Input',\n  inheritAttrs: false,\n  expose: ['getInputValue'],\n  components: { FeatherIcon },\n  props: {\n    label: {\n      type: String,\n    },\n    type: {\n      type: String,\n      default: 'text',\n      validator(value) {\n        let isValid = [\n          'text',\n          'number',\n          'checkbox',\n          'textarea',\n          'select',\n          'email',\n          'password',\n          'date',\n        ].includes(value)\n        if (!isValid) {\n          console.warn(`Invalid value \"${value}\" for \"type\" prop for Input`)\n        }\n        return isValid\n      },\n    },\n    modelValue: {\n      type: [String, Number, Boolean, Object, Array],\n    },\n    inputClass: {\n      type: [String, Array, Object],\n    },\n    debounce: {\n      type: Number,\n    },\n    options: {\n      type: Array,\n    },\n    disabled: {\n      type: Boolean,\n    },\n    rows: {\n      type: Number,\n      default: 3,\n    },\n    placeholder: {\n      type: String,\n    },\n    iconLeft: {\n      type: String,\n    },\n  },\n  emits: ['input', 'change', 'update:modelValue'],\n  methods: {\n    focus() {\n      this.$refs.input.focus()\n    },\n    blur() {\n      this.$refs.input.blur()\n    },\n    getInputValue(e) {\n      let $input = e ? e.target : this.$refs.input\n      let value = $input.value\n      if (this.type == 'checkbox') {\n        value = $input.checked\n      }\n      return value\n    },\n  },\n  computed: {\n    passedInputValue() {\n      if ('value' in this.$attrs) {\n        return this.$attrs.value\n      }\n      return this.modelValue || null\n    },\n    inputAttributes() {\n      let attrs = {}\n      let onInput = (e) => {\n        this.$emit('input', this.getInputValue(e))\n      }\n      if (this.debounce) {\n        onInput = debounce(onInput, this.debounce)\n      }\n      if (this.type == 'checkbox') {\n        attrs.checked = this.passedInputValue\n      }\n      return Object.assign(attrs, this.$attrs, {\n        onInput,\n        onChange: (e) => {\n          this.$emit('change', this.getInputValue(e))\n          this.$emit('update:modelValue', this.getInputValue(e))\n        },\n      })\n    },\n    selectOptions() {\n      return this.options\n        .map((option) => {\n          if (typeof option === 'string') {\n            return {\n              label: option,\n              value: option,\n            }\n          }\n          return option\n        })\n        .filter(Boolean)\n    },\n    isNormalInput() {\n      return [\n        'text',\n        'number',\n        'checkbox',\n        'email',\n        'password',\n        'date',\n      ].includes(this.type)\n    },\n  },\n}\n</script>\n<style>\n.form-select {\n  background-image: url(\"data:image/svg+xml;utf8,<svg fill='none' width='8' xmlns='http://www.w3.org/2000/svg' viewBox='-4 -2 16 16'><path d='M4.5 3.636 6.136 2l1.637 1.636M4.5 8.364 6.136 10l1.637-1.636' stroke='%23333C44' stroke-linecap='round' stroke-linejoin='round'/></svg>\");\n}\n</style>\n","<script setup lang=\"ts\">\nimport { ref, onMounted } from 'vue'\nimport { NodeViewWrapper, nodeViewProps } from '@tiptap/vue-3'\nimport LoadingIndicator from '../../../LoadingIndicator.vue'\nimport { ErrorMessage } from '../../../ErrorMessage'\nimport LucideMoveDiagonal2 from '~icons/lucide/move-diagonal-2'\nimport LucideAlignLeft from '~icons/lucide/align-left'\nimport LucideAlignCenter from '~icons/lucide/align-center'\nimport LucideAlignRight from '~icons/lucide/align-right'\n\nconst props = defineProps(nodeViewProps)\n\nconst imageRef = ref<HTMLImageElement | null>(null)\nconst containerRef = ref<HTMLDivElement | null>(null)\nconst isResizing = ref(false)\nconst startDragX = ref(0)\nconst startWidth = ref(0)\nconst originalAspectRatio = ref(1)\n\nfunction selectImage() {\n  props.editor.commands.setNodeSelection(props.getPos())\n}\n\nconst caption = ref(props.node.attrs.alt || '')\nconst isEditable = ref(false)\n\nonMounted(() => {\n  isEditable.value = props.editor.isEditable\n  if (imageRef.value) {\n    // Ensure initial aspect ratio is captured if dimensions are available\n    const initialWidth = props.node.attrs.width || imageRef.value.naturalWidth\n    const initialHeight =\n      props.node.attrs.height || imageRef.value.naturalHeight\n    if (initialWidth && initialHeight) {\n      originalAspectRatio.value = initialHeight / initialWidth\n    }\n  }\n})\n\nprops.editor.on('update', () => {\n  isEditable.value = props.editor.isEditable\n})\n\nfunction updateCaption(event: Event) {\n  const newCaption = (event.target as HTMLInputElement).value\n  caption.value = newCaption\n  props.updateAttributes({ alt: newCaption })\n}\n\nfunction handleKeydown(event: KeyboardEvent) {\n  if (event.key === 'Enter') {\n    event.preventDefault()\n    createParagraphAfterImage()\n  } else if (event.key === 'Escape' || event.key === 'ArrowDown') {\n    event.preventDefault()\n    setCursorAfterImage()\n  }\n  if (event.key === 'ArrowUp') {\n    event.preventDefault()\n    setCursorBeforeImage()\n  }\n}\n\nfunction setCursorAt(pos: number) {\n  props.editor.commands.focus()\n  props.editor.chain().setTextSelection(pos).scrollIntoView().run()\n}\n\nfunction createParagraphAfterImage() {\n  const pos = props.getPos()\n  props.editor.commands.focus()\n  props.editor\n    .chain()\n    .setTextSelection(pos + 1)\n    .createParagraphNear()\n    .scrollIntoView()\n    .run()\n}\n\nfunction setCursorAfterImage() {\n  const pos = props.getPos()\n  setCursorAt(pos + 1)\n}\n\nfunction setCursorBeforeImage() {\n  const pos = props.getPos()\n  setCursorAt(pos - 1)\n}\n\nfunction startResize(event: MouseEvent) {\n  if (!isEditable.value) return\n  selectImage()\n  isResizing.value = true\n  startDragX.value = event.clientX\n  startWidth.value = imageRef.value?.offsetWidth || props.node.attrs.width || 0\n\n  // Calculate aspect ratio from current attributes or natural dimensions\n  const width = props.node.attrs.width || imageRef.value?.naturalWidth\n  const height = props.node.attrs.height || imageRef.value?.naturalHeight\n  if (width && height) {\n    originalAspectRatio.value = height / width\n  } else {\n    originalAspectRatio.value = 1\n  }\n\n  window.addEventListener('mousemove', handleResize)\n  window.addEventListener('mouseup', stopResize)\n  document.body.style.cursor = 'ew-resize'\n}\n\nfunction handleResize(event: MouseEvent) {\n  if (!isResizing.value || !imageRef.value || !containerRef.value) return\n\n  const editorElement = props.editor.view.dom\n  const editorWidth = editorElement.clientWidth\n\n  const deltaX = event.clientX - startDragX.value\n  let newWidth = startWidth.value + deltaX\n\n  // Add constraints (e.g., minimum width and maximum width based on editor)\n  newWidth = Math.max(50, Math.min(newWidth, editorWidth))\n\n  const newHeight = newWidth * originalAspectRatio.value\n\n  // Apply temporary styles for visual feedback\n  imageRef.value.style.width = `${newWidth}px`\n  imageRef.value.style.height = `${newHeight}px`\n  containerRef.value.style.width = `${newWidth}px`\n}\n\nfunction stopResize() {\n  if (!isResizing.value) return\n\n  isResizing.value = false\n  window.removeEventListener('mousemove', handleResize)\n  window.removeEventListener('mouseup', stopResize)\n  document.body.style.cursor = ''\n\n  if (imageRef.value && containerRef.value) {\n    const finalWidth = imageRef.value.offsetWidth\n    const finalHeight = imageRef.value.offsetHeight\n    props.updateAttributes({ width: finalWidth, height: finalHeight })\n\n    // Clear temporary styles after updating attributes\n    imageRef.value.style.width = ''\n    imageRef.value.style.height = ''\n    containerRef.value.style.width = ''\n  }\n}\n\nfunction setAlignment(align: 'left' | 'center' | 'right') {\n  props.editor.commands.setImageAlign(align)\n}\n</script>\n\n<template>\n  <NodeViewWrapper>\n    <div\n      ref=\"containerRef\"\n      class=\"relative overflow-hidden not-prose my-6 rounded-[2px] block max-w-full\"\n      :class=\"[\n        { 'ring-2 ring-outline-gray-3 ring-offset-2': selected },\n        node.attrs.align === 'center' ? 'mx-auto' : '',\n        node.attrs.align === 'right' ? 'ml-auto mr-0' : '',\n        node.attrs.align === 'left' ? 'mr-auto ml-0' : '',\n      ]\"\n      :style=\"{ width: node.attrs.width ? `${node.attrs.width}px` : 'auto' }\"\n    >\n      <div class=\"relative\">\n        <img\n          v-if=\"node.attrs.src\"\n          ref=\"imageRef\"\n          class=\"rounded-[2px]\"\n          :src=\"node.attrs.src\"\n          :alt=\"node.attrs.alt || ''\"\n          :width=\"node.attrs.width\"\n          :height=\"node.attrs.height\"\n          @click.stop=\"selectImage\"\n        />\n\n        <div class=\"absolute bottom-2 right-2 flex items-center gap-2\">\n          <!-- Alignment Controls -->\n          <div\n            v-if=\"selected && isEditable\"\n            class=\"flex divide-x divide-outline-gray-5 rounded bg-black/65\"\n          >\n            <button\n              @click.stop=\"setAlignment('left')\"\n              :class=\"[\n                'px-1.5 py-1 hover:text-ink-white',\n                node.attrs.align === 'left'\n                  ? 'text-ink-white'\n                  : 'text-ink-gray-4',\n              ]\"\n            >\n              <LucideAlignLeft class=\"size-4\" />\n            </button>\n            <button\n              @click.stop=\"setAlignment('center')\"\n              :class=\"[\n                'px-1.5 py-1 hover:text-ink-white',\n                node.attrs.align === 'center'\n                  ? 'text-ink-white'\n                  : 'text-ink-gray-4',\n              ]\"\n            >\n              <LucideAlignCenter class=\"size-4\" />\n            </button>\n            <button\n              @click.stop=\"setAlignment('right')\"\n              :class=\"[\n                'px-1.5 py-1 hover:text-ink-white',\n                node.attrs.align === 'right'\n                  ? 'text-ink-white'\n                  : 'text-ink-gray-4',\n              ]\"\n            >\n              <LucideAlignRight class=\"size-4\" />\n            </button>\n          </div>\n\n          <!-- Resize Handle -->\n          <button\n            v-if=\"selected && isEditable\"\n            class=\"cursor-nw-resize bg-black/65 rounded p-1\"\n            @mousedown.prevent=\"startResize\"\n          >\n            <LucideMoveDiagonal2 class=\"text-white size-4\" />\n          </button>\n        </div>\n\n        <!-- Loading indicator overlay -->\n        <div\n          v-if=\"node.attrs.loading\"\n          class=\"inset-0 absolute flex items-center justify-center z-10\"\n        >\n          <div\n            class=\"bg-gray-900/80 p-2 inset-0 leading-none rounded-sm flex flex-col items-center justify-center gap-2\"\n          >\n            <div class=\"flex items-center gap-2\">\n              <LoadingIndicator class=\"text-gray-100 size-4\" />\n              <span class=\"text-gray-100\">Uploading...</span>\n            </div>\n          </div>\n        </div>\n      </div>\n\n      <input\n        v-if=\"(isEditable || node.attrs.alt) && !node.attrs.error\"\n        v-model=\"caption\"\n        class=\"w-full text-center bg-transparent text-sm text-ink-gray-6 h-7 border-none focus:ring-0 placeholder-ink-gray-4\"\n        placeholder=\"Add caption\"\n        :disabled=\"!isEditable\"\n        @change=\"updateCaption\"\n        @keydown=\"handleKeydown\"\n      />\n\n      <div v-if=\"node.attrs.error\" class=\"w-full py-1.5\">\n        <ErrorMessage :message=\"`Upload Failed: ${node.attrs.error}`\" />\n      </div>\n    </div>\n  </NodeViewWrapper>\n</template>\n","import {\n  Node as NodeExtension,\n  nodeInputRule,\n  mergeAttributes,\n} from '@tiptap/core'\nimport { VueNodeViewRenderer } from '@tiptap/vue-3'\nimport ImageNodeView from './ImageNodeView.vue'\nimport { Plugin, Selection, Transaction, EditorState } from '@tiptap/pm/state'\nimport { EditorView } from '@tiptap/pm/view'\nimport { Node } from '@tiptap/pm/model'\nimport { fileToBase64 } from '../../../../index'\nimport { UploadedFile } from '../../../../utils/useFileUpload'\n\nexport interface ImageExtensionOptions {\n  /**\n   * Function to handle image uploads\n   * @default null\n   */\n  uploadFunction: ((file: File) => Promise<UploadedFile>) | null\n\n  /**\n   * HTML attributes to add to the image element\n   * @default {}\n   */\n  HTMLAttributes: Record<string, any>\n}\n\nexport interface SetImageOptions {\n  src: string\n  alt?: string\n  title?: string\n  width?: string | number | null\n  height?: string | number | null\n}\n\ndeclare module '@tiptap/core' {\n  interface Commands<ReturnType> {\n    image: {\n      /**\n       * Insert an image\n       */\n      setImage: (options: SetImageOptions) => ReturnType\n\n      /**\n       * Upload and insert an image\n       */\n      uploadImage: (file: File) => ReturnType\n\n      /**\n       * Select an image file using the file picker and upload it\n       */\n      selectAndUploadImage: () => ReturnType\n\n      /**\n       * Set image alignment\n       */\n      setImageAlign: (align: 'left' | 'center' | 'right') => ReturnType\n    }\n  }\n}\n\n/**\n * Matches markdown image syntax: ![alt](src \"title\")\n */\nconst inputRegex = /(?:^|\\s)(!\\[(.+|:?)]\\((\\S+)(?:(?:\\s+)[\"'](\\S+)[\"'])?\\))$/\n\nexport const ImageExtension = NodeExtension.create<ImageExtensionOptions>({\n  name: 'image',\n\n  group: 'block',\n  draggable: true,\n  selectable: true,\n\n  addAttributes() {\n    return {\n      src: { default: null },\n      alt: { default: null },\n      title: { default: null },\n      width: { default: null },\n      height: { default: null },\n      loading: {\n        default: false,\n        parseHTML: () => false,\n      },\n      align: {\n        default: 'left',\n        parseHTML: (element) => {\n          const align = (\n            element.getAttribute('data-align') ||\n            element.getAttribute('align') ||\n            'left'\n          ).toLowerCase()\n\n          if (['left', 'center', 'right'].includes(align)) {\n            return align as 'left' | 'center' | 'right'\n          }\n          return 'left'\n        },\n        renderHTML: (attributes) => {\n          return {\n            'data-align': attributes.align || 'left',\n          }\n        },\n      },\n      uploadId: {\n        default: null,\n        parseHTML: () => null,\n      },\n      error: {\n        default: null,\n        parseHTML: () => null,\n      },\n    }\n  },\n\n  parseHTML() {\n    return [\n      {\n        tag: 'img[src]',\n        getAttrs: (node) => {\n          if (typeof node === 'string') return {}\n          const element = node as HTMLElement\n          return {\n            src: element.getAttribute('src'),\n            alt: element.getAttribute('alt'),\n            title: element.getAttribute('title'),\n            width: element.getAttribute('width'),\n            height: element.getAttribute('height'),\n          }\n        },\n      },\n    ]\n  },\n\n  renderHTML({ HTMLAttributes }) {\n    return [\n      'img',\n      mergeAttributes(this.options.HTMLAttributes || {}, HTMLAttributes),\n    ]\n  },\n\n  addNodeView() {\n    return VueNodeViewRenderer(ImageNodeView)\n  },\n\n  addOptions() {\n    return {\n      uploadFunction: null,\n      HTMLAttributes: {},\n    }\n  },\n\n  addCommands() {\n    return {\n      setImageAlign:\n        (align: 'left' | 'center' | 'right') =>\n        ({ commands }) => {\n          return commands.updateAttributes(this.name, { align })\n        },\n\n      setImage:\n        (attributes: SetImageOptions) =>\n        ({ commands, editor }) => {\n          const result = commands.insertContent({\n            type: this.name,\n            attrs: attributes,\n          })\n\n          if (result && attributes.src) {\n            findImageNodeBySource(editor.view, attributes.src, (node, pos) => {\n              updateNodeWithDimensions(attributes.src, editor.view, pos)\n            })\n          }\n\n          return result\n        },\n\n      uploadImage:\n        (file: File) =>\n        ({ editor }) => {\n          return uploadImage(file, editor.view, null, this.options)\n        },\n\n      selectAndUploadImage:\n        () =>\n        ({ editor }) => {\n          const input = document.createElement('input')\n          input.type = 'file'\n          input.accept = 'image/*'\n          input.onchange = (event) => {\n            const target = event.target as HTMLInputElement\n            if (target.files && target.files.length) {\n              const file = target.files[0]\n              editor.commands.uploadImage(file)\n            }\n          }\n          input.click()\n          return true\n        },\n    }\n  },\n\n  addInputRules() {\n    return [\n      nodeInputRule({\n        find: inputRegex,\n        type: this.type,\n        getAttributes: (match) => {\n          const [, , alt, src, title] = match\n          return { src, alt, title }\n        },\n      }),\n    ]\n  },\n\n  addProseMirrorPlugins() {\n    const extensionThis = this\n\n    return [\n      new Plugin({\n        props: {\n          handleDOMEvents: {\n            drop: (view, event) => {\n              const hasFiles = event.dataTransfer?.files?.length\n\n              if (!hasFiles || !extensionThis.options.uploadFunction) {\n                return false\n              }\n\n              const images = Array.from(event.dataTransfer.files).filter(\n                (file) => /image/i.test(file.type),\n              )\n\n              if (images.length === 0) {\n                return false\n              }\n\n              event.preventDefault()\n\n              const coordinates = view.posAtCoords({\n                left: event.clientX,\n                top: event.clientY,\n              })\n\n              let pos: number | null = null\n              if (coordinates) {\n                pos = coordinates.pos\n                const transaction = view.state.tr.setSelection(\n                  Selection.near(view.state.doc.resolve(pos)),\n                )\n                view.dispatch(transaction)\n              }\n\n              processMultipleImages(images, view, pos, extensionThis.options)\n              return true\n            },\n\n            handlePaste: (view, event) => {\n              if (!extensionThis.options.uploadFunction) {\n                return false\n              }\n\n              const clipboardItems = event.clipboardData?.items\n              if (!clipboardItems || clipboardItems.length === 0) {\n                return false\n              }\n\n              const images: File[] = []\n\n              for (let i = 0; i < clipboardItems.length; i++) {\n                const item = clipboardItems[i]\n                if (\n                  item.kind === 'file' &&\n                  item.type.indexOf('image/') !== -1\n                ) {\n                  const file = item.getAsFile()\n                  if (file) {\n                    images.push(file)\n                  }\n                }\n              }\n\n              if (images.length === 0) {\n                return false\n              }\n\n              event.preventDefault()\n              processMultipleImages(images, view, null, extensionThis.options)\n              return true\n            },\n          },\n        },\n\n        appendTransaction(\n          transactions: readonly Transaction[],\n          oldState: EditorState,\n          newState: EditorState,\n        ): Transaction | null {\n          const newImageNodes: { node: Node; pos: number }[] = []\n\n          if (transactions.some((tr) => tr.docChanged)) {\n            newState.doc.descendants((node, pos) => {\n              if (\n                node.type.name === 'image' &&\n                node.attrs.src &&\n                (!node.attrs.width || !node.attrs.height) &&\n                !node.attrs.loading\n              ) {\n                newImageNodes.push({ node, pos })\n              }\n            })\n          }\n\n          if (newImageNodes.length === 0) return null\n\n          newImageNodes.forEach(({ node, pos }) => {\n            const editor = extensionThis.editor\n            if (editor) {\n              updateNodeWithDimensions(node.attrs.src, editor.view, pos)\n            }\n          })\n\n          return null\n        },\n      }),\n    ]\n  },\n})\n\nfunction findInsertPosition(\n  view: EditorView,\n  lastNodeId: string | null,\n): number | null {\n  if (!lastNodeId) {\n    return null\n  }\n\n  let insertPos = null\n\n  view.state.doc.descendants((node, pos) => {\n    if (node.type.name === 'image' && node.attrs.uploadId === lastNodeId) {\n      insertPos = pos + node.nodeSize\n      return false\n    }\n  })\n\n  return insertPos\n}\n\n// Base upload function shared by all image upload methods\nfunction uploadImageBase(\n  file: File,\n  view: EditorView,\n  pos: number | null | undefined,\n  options: Record<string, any>,\n  insertMode: 'insert' | 'replace',\n  onComplete?: (nodeId: string) => void,\n  moveCursor = false,\n): boolean {\n  if (!options.uploadFunction) {\n    console.error('uploadFunction option is not provided')\n    return false\n  }\n\n  const uploadId = `upload-${Date.now()}-${Math.random().toString(36).substring(2, 9)}`\n\n  fileToBase64(file)\n    .then((base64Result: string) => {\n      const node = view.state.schema.nodes.image.create({\n        loading: true,\n        uploadId,\n        src: base64Result,\n      })\n\n      const tr = view.state.tr\n\n      if (pos != null) {\n        tr.insert(pos, node)\n      } else if (insertMode === 'replace') {\n        tr.replaceSelectionWith(node)\n      } else {\n        const insertPos = view.state.selection.from\n        tr.insert(insertPos, node)\n      }\n\n      view.dispatch(tr)\n\n      // Optionally move cursor after the node\n      if (moveCursor) {\n        const nodeSize = node.nodeSize || 1\n        setTimeout(() => {\n          try {\n            let nodePos = null\n            view.state.doc.descendants((n, p) => {\n              if (n.type.name === 'image' && n.attrs.uploadId === uploadId) {\n                nodePos = p\n                return false\n              }\n            })\n\n            if (nodePos !== null) {\n              const posAfter = nodePos + nodeSize\n              const transaction = view.state.tr.setSelection(\n                Selection.near(view.state.doc.resolve(posAfter)),\n              )\n              view.dispatch(transaction)\n            }\n          } catch (e) {\n            console.error('Error moving cursor:', e)\n          }\n        }, 10)\n      }\n\n      return options.uploadFunction(file)\n    })\n    .then((uploadedImage: UploadedFile) => {\n      return getImageDimensions(uploadedImage.file_url)\n        .then((dimensions) => {\n          return {\n            ...uploadedImage,\n            width: dimensions.width,\n            height: dimensions.height,\n          } as UploadedFile & { width: number; height: number }\n        })\n        .catch(() => {\n          return uploadedImage as UploadedFile & {\n            width: number\n            height: number\n          }\n        })\n    })\n    .then((uploadedImage) => {\n      const transaction = view.state.tr\n\n      view.state.doc.descendants((node, pos) => {\n        if (node.type.name === 'image' && node.attrs.uploadId === uploadId) {\n          transaction.setNodeMarkup(pos, undefined, {\n            ...node.attrs,\n            src: uploadedImage.file_url,\n            width: uploadedImage.width || node.attrs.width,\n            height: uploadedImage.height || node.attrs.height,\n            loading: false,\n          })\n          return false\n        }\n      })\n\n      view.dispatch(transaction)\n\n      if (onComplete) onComplete(uploadId)\n    })\n    .catch((error: Error) => {\n      console.error('Image upload failed:', error)\n\n      try {\n        const transaction = view.state.tr\n\n        view.state.doc.descendants((node, pos) => {\n          if (node.type.name === 'image' && node.attrs.uploadId === uploadId) {\n            transaction.setNodeMarkup(pos, undefined, {\n              ...node.attrs,\n              loading: false,\n              error: error.message || 'Failed to upload image',\n            })\n            return false\n          }\n        })\n\n        view.dispatch(transaction)\n      } catch (e) {\n        console.error('Error updating failed node:', e)\n      }\n\n      if (onComplete) onComplete(uploadId)\n    })\n\n  return true\n}\n\nfunction uploadImageWithTracking(\n  file: File,\n  view: EditorView,\n  pos: number | null | undefined,\n  options: Record<string, any>,\n  onComplete?: (nodeId: string) => void,\n): boolean {\n  return uploadImageBase(file, view, pos, options, 'insert', onComplete, true)\n}\n\nfunction uploadImage(\n  file: File,\n  view: EditorView,\n  pos: number | null | undefined,\n  options: Record<string, any>,\n): boolean {\n  return uploadImageBase(file, view, pos, options, 'replace')\n}\n\nfunction findImageNodeBySource(\n  view: EditorView,\n  src: string,\n  callback: (node: Node, pos: number) => void,\n) {\n  view.state.doc.descendants((node, pos) => {\n    if (node.type.name === 'image' && node.attrs.src === src) {\n      callback(node, pos)\n      return false\n    }\n  })\n}\n\nfunction updateNodeWithDimensions(\n  src: string,\n  view: EditorView,\n  pos: number,\n): void {\n  getImageDimensions(src)\n    .then((dimensions) => {\n      const node = view.state.doc.nodeAt(pos)\n      if (!node || node.type.name !== 'image') {\n        return\n      }\n      const currentAttrs = node.attrs\n\n      if (currentAttrs.width == null || currentAttrs.height == null) {\n        const transaction = view.state.tr.setNodeMarkup(pos, undefined, {\n          ...currentAttrs,\n          width: currentAttrs.width ?? dimensions.width,\n          height: currentAttrs.height ?? dimensions.height,\n        })\n        view.dispatch(transaction)\n      }\n    })\n    .catch((error) => {\n      // Don't log error if it's just about dimensions for an existing node\n    })\n}\n\nfunction getImageDimensions(\n  src: string,\n): Promise<{ width: number; height: number }> {\n  return new Promise((resolve, reject) => {\n    const img = new Image()\n    img.onload = () =>\n      resolve({\n        width: img.naturalWidth,\n        height: img.naturalHeight,\n      })\n    img.onerror = reject\n    img.src = src\n  })\n}\n\n/**\n * Process multiple image uploads sequentially\n */\nexport function processMultipleImages(\n  images: File[],\n  view: EditorView,\n  pos: number | null,\n  options: Record<string, any>,\n) {\n  if (images.length === 1) {\n    uploadImage(images[0], view, pos, options)\n    return\n  }\n\n  let imageQueue = [...images]\n  let lastInsertedNodeId: string | null = null\n\n  const processNextImage = () => {\n    if (imageQueue.length === 0) return\n\n    const file = imageQueue.shift()\n    if (!file) return\n\n    const currentPos = lastInsertedNodeId\n      ? findInsertPosition(view, lastInsertedNodeId)\n      : pos\n\n    uploadImageWithTracking(file, view, currentPos, options, (newNodeId) => {\n      lastInsertedNodeId = newNodeId\n      setTimeout(processNextImage, 100)\n    })\n  }\n\n  processNextImage()\n}\n","import { ref, watch, type Ref, readonly } from 'vue'\n\ninterface UseTouchHandlerOptions {\n  targetRef: Ref<HTMLElement | null | undefined>\n  zoomLevel?: Ref<number>\n  onSwipeLeft?: () => void\n  onSwipeRight?: () => void\n  onDoubleTap?: (event: TouchEvent) => void\n  onTap?: (event: TouchEvent) => void\n  onPanStart?: (event: TouchEvent) => void\n  onPanMove?: (deltaX: number, deltaY: number, event: TouchEvent) => void\n  onPanAnimate?: (x: number, y: number) => void // Callback for inertia animation frame updates\n  onPanEnd?: (event: TouchEvent) => void\n  onPinchStart?: (event: TouchEvent) => void\n  onPinchMove?: (scale: number, event: TouchEvent) => void\n  onPinchEnd?: (event: TouchEvent) => void\n  doubleTapDelay?: number\n  minSwipeDistance?: number\n  maxVerticalSwipeDistance?: number\n  maxTapDuration?: number\n  maxTapMovement?: number\n  panThreshold?: number\n  inertiaDamping?: number // Damping factor for inertia (e.g., 0.95)\n  inertiaVelocityThreshold?: number // Minimum velocity (pixels/ms) to trigger inertia\n}\n\nexport function useTouchHandler(options: UseTouchHandlerOptions) {\n  const {\n    targetRef,\n    zoomLevel = ref(100),\n    onSwipeLeft,\n    onSwipeRight,\n    onDoubleTap,\n    onTap,\n    onPanStart,\n    onPanMove,\n    onPanAnimate,\n    onPanEnd,\n    onPinchStart,\n    onPinchMove,\n    onPinchEnd,\n    doubleTapDelay = 300,\n    minSwipeDistance = 50,\n    maxVerticalSwipeDistance = 75,\n    maxTapDuration = 200,\n    maxTapMovement = 10,\n    panThreshold = 5, // Pixels moved before pan starts\n    inertiaDamping = 0.94, // Damping for inertia slowdown (higher = slower stop)\n    inertiaVelocityThreshold = 0.5, // Pixels per ms\n  } = options\n\n  const isPanning = ref(false)\n  const isPinching = ref(false)\n  const isAnimatingPan = ref(false) // Track inertia animation state\n  const startPanCoords = ref({ x: 0, y: 0 })\n  const lastTapTime = ref(0)\n  const touchStartTime = ref(0)\n  const touchStartDistance = ref(0)\n  const initialTouchPoints = ref<TouchList | null>(null)\n\n  // Velocity tracking for inertia\n  const lastMoveTime = ref(0)\n  const lastMoveCoords = ref({ x: 0, y: 0 })\n  const panVelocity = ref({ x: 0, y: 0 })\n\n  // Inertia animation frame\n  const animationFrameId = ref<number | null>(null)\n\n  const cancelInertiaAnimation = () => {\n    if (animationFrameId.value !== null) {\n      cancelAnimationFrame(animationFrameId.value)\n      animationFrameId.value = null\n    }\n    isAnimatingPan.value = false\n    panVelocity.value = { x: 0, y: 0 } // Reset velocity\n  }\n\n  const handleTouchStart = (event: TouchEvent) => {\n    cancelInertiaAnimation() // Stop any ongoing inertia animation\n    event.preventDefault() // Prevent default browser actions like scroll/zoom\n\n    isPanning.value = false\n    isPinching.value = false\n    initialTouchPoints.value = event.touches\n\n    const currentTime = performance.now()\n    const timeSinceLastTap = currentTime - lastTapTime.value\n\n    // Double Tap Detection\n    if (\n      timeSinceLastTap < doubleTapDelay &&\n      timeSinceLastTap > 0 &&\n      event.touches.length === 1 &&\n      onDoubleTap\n    ) {\n      onDoubleTap(event)\n      lastTapTime.value = 0 // Reset tap time after double tap\n      touchStartTime.value = 0\n      return // Don't process as single tap/pan/pinch start\n    }\n\n    // Record Start Info\n    touchStartTime.value = currentTime\n    if (event.touches.length === 1) {\n      lastTapTime.value = currentTime // Record for potential double tap\n      const touch = event.touches[0]\n      startPanCoords.value = { x: touch.clientX, y: touch.clientY }\n      // Reset velocity tracking on new touch start\n      lastMoveTime.value = currentTime\n      lastMoveCoords.value = { ...startPanCoords.value }\n      panVelocity.value = { x: 0, y: 0 }\n      if (onPanStart) onPanStart(event)\n    } else if (event.touches.length === 2) {\n      lastTapTime.value = 0 // Reset tap time if starting with pinch\n      const touch1 = event.touches[0]\n      const touch2 = event.touches[1]\n      touchStartDistance.value = Math.hypot(\n        touch2.clientX - touch1.clientX,\n        touch2.clientY - touch1.clientY,\n      )\n      isPinching.value = true\n      if (onPinchStart) onPinchStart(event)\n    } else {\n      // More than 2 touches, reset tap time\n      lastTapTime.value = 0\n      touchStartTime.value = 0\n    }\n  }\n\n  const handleTouchMove = (event: TouchEvent) => {\n    if (!initialTouchPoints.value) return // Should have initial points if touch started correctly\n\n    event.preventDefault() // Prevent scroll/zoom during move\n\n    const currentTime = performance.now()\n    const deltaTime = currentTime - lastMoveTime.value\n\n    // Pinching\n    if (event.touches.length === 2 && initialTouchPoints.value.length === 2) {\n      isPanning.value = false // Stop panning if pinch starts\n      isPinching.value = true\n      const touch1 = event.touches[0]\n      const touch2 = event.touches[1]\n      const currentDistance = Math.hypot(\n        touch2.clientX - touch1.clientX,\n        touch2.clientY - touch1.clientY,\n      )\n\n      if (touchStartDistance.value > 0 && onPinchMove) {\n        const scale = currentDistance / touchStartDistance.value\n        onPinchMove(scale, event)\n      }\n      // Reset velocity if pinching occurs\n      panVelocity.value = { x: 0, y: 0 }\n    }\n    // Panning\n    else if (\n      event.touches.length === 1 &&\n      initialTouchPoints.value.length === 1 &&\n      !isPinching.value // Don't pan if a pinch just ended but finger is still down\n    ) {\n      const currentX = event.touches[0].clientX\n      const currentY = event.touches[0].clientY\n      const rawDeltaX = currentX - lastMoveCoords.value.x\n      const rawDeltaY = currentY - lastMoveCoords.value.y\n\n      // Calculate velocity (pixels per millisecond) for inertia\n      // Ensure deltaTime is not zero to avoid division by zero\n      if (deltaTime > 1) {\n        // Use a small threshold > 0\n        panVelocity.value = {\n          x: rawDeltaX / deltaTime,\n          y: rawDeltaY / deltaTime,\n        }\n      } else {\n        // If deltaTime is too small, retain previous velocity or reset\n        panVelocity.value = { x: 0, y: 0 } // Resetting might be safer\n      }\n\n      // Update last move state\n      lastMoveTime.value = currentTime\n      lastMoveCoords.value = { x: currentX, y: currentY }\n\n      const deltaXFromStart = currentX - startPanCoords.value.x\n      const deltaYFromStart = currentY - startPanCoords.value.y\n\n      // Start panning only if threshold is met AND zoom level allows panning\n      if (\n        !isPanning.value &&\n        zoomLevel.value > 100 &&\n        (Math.abs(deltaXFromStart) > panThreshold ||\n          Math.abs(deltaYFromStart) > panThreshold)\n      ) {\n        isPanning.value = true\n        // Adjust start coords slightly to avoid jump if pan starts mid-movement\n        startPanCoords.value = {\n          x: currentX,\n          y: currentY,\n        }\n      }\n\n      if (isPanning.value && onPanMove) {\n        const zoomFactor = zoomLevel.value / 100\n        // Pass the delta relative to the start of the *current* pan gesture, adjusted for zoom\n        const panDeltaX = deltaXFromStart / zoomFactor\n        const panDeltaY = deltaYFromStart / zoomFactor\n        onPanMove(panDeltaX, panDeltaY, event)\n      }\n    }\n  }\n\n  const handleTouchEnd = (event: TouchEvent) => {\n    const touchesLeft = event.touches.length\n    const touchEndTime = performance.now()\n    const wasPanning = isPanning.value\n    const wasPinching = isPinching.value\n\n    // Store current velocity before resetting states for potential inertia\n    const finalVelocity = { ...panVelocity.value }\n\n    // Handle Pan End and Inertia\n    if (\n      wasPanning &&\n      initialTouchPoints.value &&\n      touchesLeft < initialTouchPoints.value.length\n    ) {\n      isPanning.value = false // Set panning to false *before* starting animation\n      if (onPanEnd) onPanEnd(event)\n\n      // Check velocity threshold and start inertia animation if needed\n      const velocityMagnitude = Math.hypot(finalVelocity.x, finalVelocity.y)\n      if (\n        velocityMagnitude > inertiaVelocityThreshold &&\n        onPanAnimate &&\n        zoomLevel.value > 100 // Only animate if zoomed in\n      ) {\n        isAnimatingPan.value = true\n        let lastFrameTime = performance.now()\n        // Use a copy of the velocity for the animation loop\n        let animVelocity = { ...finalVelocity }\n\n        const animate = (currentTime: number) => {\n          // Ensure animation wasn't cancelled elsewhere (e.g., new touch start)\n          if (!isAnimatingPan.value) return\n\n          const frameDeltaTime = Math.max(1, currentTime - lastFrameTime) // Prevent zero/negative delta\n          lastFrameTime = currentTime\n\n          const zoomFactor = zoomLevel.value / 100\n          const moveX = (animVelocity.x * frameDeltaTime) / zoomFactor\n          const moveY = (animVelocity.y * frameDeltaTime) / zoomFactor\n\n          // Call component's pan update function for each frame\n          onPanAnimate(moveX, moveY)\n\n          // Apply damping (adjust based on frame time for consistency)\n          const dampingFactor = Math.pow(\n            Math.min(0.999, inertiaDamping), // Ensure base is < 1\n            frameDeltaTime / 16.67, // Normalize damping based on ~60fps\n          )\n          animVelocity.x *= dampingFactor\n          animVelocity.y *= dampingFactor\n\n          // Stop animation if velocity is negligible or zoom changed back to <= 100%\n          if (\n            Math.hypot(animVelocity.x, animVelocity.y) < 0.01 ||\n            zoomLevel.value <= 100\n          ) {\n            cancelInertiaAnimation()\n          } else {\n            animationFrameId.value = requestAnimationFrame(animate)\n          }\n        }\n        animationFrameId.value = requestAnimationFrame(animate)\n      } else {\n        panVelocity.value = { x: 0, y: 0 } // Reset velocity if no animation starts\n      }\n    } else if (!wasPanning) {\n      // Reset velocity if touch ended without panning (e.g., tap, pinch)\n      panVelocity.value = { x: 0, y: 0 }\n    }\n\n    // Handle Pinch End\n    if (wasPinching && touchesLeft < 2) {\n      isPinching.value = false\n      touchStartDistance.value = 0 // Reset pinch distance tracking\n      if (onPinchEnd) onPinchEnd(event)\n    }\n\n    // Gesture detection (Tap/Swipe) only when the *last* finger is lifted\n    if (\n      touchesLeft === 0 &&\n      event.changedTouches.length === 1 && // Ensure it's the end of a single touch sequence\n      touchStartTime.value > 0 && // Ensure there was a valid start time recorded\n      initialTouchPoints.value?.length === 1 // Ensure it started as a single touch\n    ) {\n      const endCoords = event.changedTouches[0]\n      const deltaX = endCoords.clientX - startPanCoords.value.x\n      const deltaY = endCoords.clientY - startPanCoords.value.y\n      const duration = touchEndTime - touchStartTime.value\n\n      // Swipe Detection (only if not panning AND zoom is appropriate for swipe)\n      if (\n        !wasPanning && // Only detect swipe if not panning\n        zoomLevel.value <= 100 && // Swipes only make sense at base zoom\n        Math.abs(deltaX) > minSwipeDistance &&\n        Math.abs(deltaY) < maxVerticalSwipeDistance // Allow some vertical movement\n      ) {\n        if (deltaX < 0 && onSwipeLeft) {\n          onSwipeLeft()\n        } else if (deltaX > 0 && onSwipeRight) {\n          onSwipeRight()\n        }\n      }\n      // Tap Detection (if not panning, not swiping, and within time/movement limits)\n      else if (\n        !wasPanning &&\n        duration < maxTapDuration &&\n        Math.abs(deltaX) < maxTapMovement &&\n        Math.abs(deltaY) < maxTapMovement &&\n        onTap\n      ) {\n        onTap(event)\n      }\n    }\n\n    // Reset start time and coords only when all touches are up\n    if (touchesLeft === 0) {\n      touchStartTime.value = 0\n      startPanCoords.value = { x: 0, y: 0 }\n      initialTouchPoints.value = null\n      // Don't reset isPanning here if inertia animation might start\n      isPinching.value = false\n      // Reset velocity only if not animating\n      if (!isAnimatingPan.value) {\n        panVelocity.value = { x: 0, y: 0 }\n      }\n    }\n    // If some touches remain (e.g., pinch ended, one finger remains),\n    // update start coords for potential pan with the remaining finger.\n    else if (touchesLeft === 1 && !isPanning.value && !isPinching.value) {\n      startPanCoords.value = {\n        x: event.touches[0].clientX,\n        y: event.touches[0].clientY,\n      }\n      touchStartTime.value = performance.now() // Reset start time for the remaining finger\n      initialTouchPoints.value = event.touches // Update initial touches to the single remaining one\n    }\n  }\n\n  watch(\n    targetRef,\n    (newTarget, oldTarget) => {\n      if (oldTarget) {\n        oldTarget.removeEventListener('touchstart', handleTouchStart)\n        oldTarget.removeEventListener('touchmove', handleTouchMove)\n        oldTarget.removeEventListener('touchend', handleTouchEnd)\n        oldTarget.removeEventListener('touchcancel', handleTouchEnd) // Treat cancel like end\n        cancelInertiaAnimation() // Clean up animation on unmount/target change\n      }\n      if (newTarget) {\n        // Use passive: false for start/move to allow preventDefault()\n        newTarget.addEventListener('touchstart', handleTouchStart, {\n          passive: false,\n        })\n        newTarget.addEventListener('touchmove', handleTouchMove, {\n          passive: false,\n        })\n        // Use passive: true for end/cancel as we don't preventDefault there\n        newTarget.addEventListener('touchend', handleTouchEnd, {\n          passive: true,\n        })\n        newTarget.addEventListener('touchcancel', handleTouchEnd, {\n          passive: true,\n        })\n      }\n    },\n    { immediate: true },\n  )\n\n  return {\n    isPanning: readonly(isPanning),\n    isPinching: readonly(isPinching),\n    isAnimatingPan: readonly(isAnimatingPan), // Expose inertia animation status\n  }\n}\n","import { ref, watch, type Ref } from 'vue'\n\ninterface UseImageNavigationOptions {\n  initialIndex: Ref<number>\n  imageCount: Ref<number>\n  onNavigate?: () => void\n}\n\nexport function useImageNavigation({\n  initialIndex,\n  imageCount,\n  onNavigate,\n}: UseImageNavigationOptions) {\n  const currentIndex = ref(initialIndex.value)\n\n  watch(initialIndex, (newVal) => {\n    currentIndex.value = newVal\n    onNavigate?.()\n  })\n\n  function nextImage() {\n    if (imageCount.value > 0) {\n      currentIndex.value = (currentIndex.value + 1) % imageCount.value\n      onNavigate?.()\n    }\n  }\n\n  function previousImage() {\n    if (imageCount.value > 0) {\n      currentIndex.value =\n        (currentIndex.value - 1 + imageCount.value) % imageCount.value\n      onNavigate?.()\n    }\n  }\n\n  return {\n    currentIndex,\n    nextImage,\n    previousImage,\n  }\n}\n","import { ref, watch, onMounted, onUnmounted, type Ref } from 'vue'\n\ninterface UseZoomPanOptions {\n  containerRef: Ref<HTMLElement | null>\n  isEnabled: Ref<boolean>\n}\n\nexport function useZoomPan({ containerRef, isEnabled }: UseZoomPanOptions) {\n  const zoomLevel = ref(100)\n  const panPosition = ref({ x: 0, y: 0 })\n  const isMousePanning = ref(false)\n  const startMousePanCoords = ref({ x: 0, y: 0 })\n  const initialPanPositionOnGestureStart = ref({ x: 0, y: 0 })\n\n  const snapThresholdLower = 90\n  const snapThresholdUpper = 110\n\n  watch(zoomLevel, (newZoom, oldZoom) => {\n    if (newZoom <= 100 && oldZoom > 100) {\n      panPosition.value = { x: 0, y: 0 }\n    }\n  })\n\n  function zoomIn() {\n    zoomLevel.value = Math.min(zoomLevel.value + 25, 300)\n  }\n\n  function zoomOut() {\n    const newZoom = Math.max(zoomLevel.value - 25, 25)\n    if (zoomLevel.value > 100 && newZoom < 100) {\n      zoomLevel.value = 100\n    } else {\n      zoomLevel.value = newZoom\n    }\n  }\n\n  function resetZoom() {\n    zoomLevel.value = 100\n    panPosition.value = { x: 0, y: 0 }\n    isMousePanning.value = false\n    initialPanPositionOnGestureStart.value = { x: 0, y: 0 }\n  }\n\n  function handlePanStart(event: MouseEvent) {\n    if (zoomLevel.value <= 100) return\n    event.preventDefault()\n    isMousePanning.value = true\n    startMousePanCoords.value = { x: event.clientX, y: event.clientY }\n    initialPanPositionOnGestureStart.value = { ...panPosition.value }\n\n    const handlePanMove = (moveEvent: MouseEvent) => {\n      if (!isMousePanning.value) return\n      const deltaX = moveEvent.clientX - startMousePanCoords.value.x\n      const deltaY = moveEvent.clientY - startMousePanCoords.value.y\n      const zoomFactor = zoomLevel.value / 100\n\n      panPosition.value = {\n        x: initialPanPositionOnGestureStart.value.x + deltaX / zoomFactor,\n        y: initialPanPositionOnGestureStart.value.y + deltaY / zoomFactor,\n      }\n    }\n\n    const handlePanEnd = () => {\n      if (isMousePanning.value) {\n        isMousePanning.value = false\n        document.removeEventListener('mousemove', handlePanMove)\n        document.removeEventListener('mouseup', handlePanEnd)\n      }\n    }\n\n    document.addEventListener('mousemove', handlePanMove)\n    document.addEventListener('mouseup', handlePanEnd)\n  }\n\n  function handleWheel(event: WheelEvent) {\n    if (!isEnabled.value) return\n\n    if (containerRef.value?.contains(event.target as Node)) {\n      event.preventDefault()\n\n      let dampingFactor = event.ctrlKey ? 0.5 : 0.2\n\n      const zoomChange = -event.deltaY * dampingFactor\n      const currentZoom = zoomLevel.value\n      const newZoom = Math.round(currentZoom + zoomChange)\n      let clampedZoom = Math.max(25, Math.min(300, newZoom))\n\n      if (\n        (currentZoom > 100 && clampedZoom < 100) ||\n        (currentZoom < 100 && clampedZoom > 100)\n      ) {\n        if (Math.abs(100 - clampedZoom) < Math.abs(zoomChange) * 1.5) {\n          clampedZoom = 100\n        }\n      }\n\n      zoomLevel.value = clampedZoom\n    }\n  }\n\n  onMounted(() => {\n    const container = containerRef.value\n    if (container) {\n      container.addEventListener('wheel', handleWheel, {\n        passive: false,\n        capture: true,\n      })\n    }\n  })\n\n  onUnmounted(() => {\n    const container = containerRef.value\n    if (container) {\n      container.removeEventListener('wheel', handleWheel, { capture: true })\n    }\n    if (isMousePanning.value) {\n      isMousePanning.value = false\n    }\n  })\n\n  return {\n    zoomLevel,\n    panPosition,\n    isMousePanning,\n    initialPanPositionOnGestureStart,\n    zoomIn,\n    zoomOut,\n    resetZoom,\n    handlePanStart,\n    snapThresholdLower,\n    snapThresholdUpper,\n  }\n}\n","<template>\n  <Teleport to=\"body\">\n    <Transition\n      enter-active-class=\"transition-opacity duration-150 ease-in-out\"\n      leave-active-class=\"transition-opacity duration-150 ease-in-out\"\n      enter-from-class=\"opacity-0\"\n      leave-to-class=\"opacity-0\"\n      appear\n    >\n      <div\n        v-if=\"props.show\"\n        class=\"fixed top-0 left-0 w-full h-full bg-black sm:bg-black/90 z-[50] flex flex-col justify-center items-center overflow-hidden touch-none\"\n        ref=\"imageContainer\"\n        @mousemove=\"handleActivity\"\n        @touchstart=\"handleActivity\"\n        @touchmove=\"handleActivity\"\n      >\n        <!-- Dedicated Backdrop -->\n        <div\n          class=\"absolute inset-0 z-0\"\n          ref=\"backdropElement\"\n          @click=\"close\"\n        ></div>\n\n        <!-- Image Container -->\n        <div class=\"relative z-10 flex flex-col items-center\">\n          <img\n            :src=\"currentImage.src\"\n            :alt=\"currentImage.alt || 'Image preview'\"\n            class=\"max-w-screen max-h-screen object-contain block\"\n            :style=\"{\n              transform: `scale(${zoomLevel / 100}) translate(${panPosition.x}px, ${panPosition.y}px)`,\n              cursor:\n                zoomLevel > 100\n                  ? isMousePanning\n                    ? 'grabbing'\n                    : 'grab'\n                  : 'default',\n              transition:\n                isPanning || isPinching || isAnimatingPan\n                  ? 'none'\n                  : 'transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275)',\n            }\"\n            @mousedown=\"handlePanStart\"\n            draggable=\"false\"\n          />\n        </div>\n\n        <!-- Caption -->\n        <div\n          v-if=\"currentImage.alt\"\n          class=\"absolute bottom-4 p-2 text-center rounded-sm text-white text-sm bg-black/65 z-10 transition-opacity duration-300 ease-in-out\"\n          :class=\"{ 'opacity-0 pointer-events-none': !isControlsVisible }\"\n        >\n          {{ currentImage.alt }}\n        </div>\n\n        <!-- Controls bar -->\n        <div\n          ref=\"controlsBar\"\n          class=\"absolute top-4 flex items-center space-x-3 p-2 text-white z-20 transition-opacity duration-300 ease-in-out\"\n          :class=\"{ 'opacity-0 pointer-events-none': !isControlsVisible }\"\n          @touchstart.stop\n          @touchmove.stop\n          @touchend.stop\n          @mousedown.stop\n          @wheel.stop\n        >\n          <!-- Navigation controls -->\n          <div class=\"bg-black/65 rounded flex items-center\">\n            <Tooltip text=\"Previous image\">\n              <button\n                class=\"p-2 hover:bg-gray-900 rounded-l focus:outline-none\"\n                @click.stop=\"previousImage\"\n              >\n                <LucideChevronLeft class=\"size-4\" />\n              </button>\n            </Tooltip>\n\n            <span class=\"px-2 text-sm tabular-nums text-gray-400 select-none\">\n              {{ currentIndex + 1 }}/{{ props.images.length }}\n            </span>\n\n            <Tooltip text=\"Next image\">\n              <button\n                class=\"p-2 hover:bg-gray-900 rounded-r focus:outline-none\"\n                @click.stop=\"nextImage\"\n              >\n                <LucideChevronRight class=\"size-4\" />\n              </button>\n            </Tooltip>\n          </div>\n\n          <!-- Zoom controls -->\n          <div class=\"bg-black/65 rounded flex items-center\">\n            <Tooltip text=\"Zoom out\">\n              <button\n                class=\"p-2 hover:bg-gray-900 rounded-l focus:outline-none\"\n                @click.stop=\"zoomOut\"\n              >\n                <LucideMinus class=\"size-4\" />\n              </button>\n            </Tooltip>\n\n            <Tooltip text=\"Reset zoom\">\n              <button\n                class=\"p-2 hover:bg-gray-900 text-sm text-gray-400 focus:outline-none\"\n                @click.stop=\"resetZoom\"\n              >\n                {{ zoomLevel }}%\n              </button>\n            </Tooltip>\n\n            <Tooltip text=\"Zoom in\">\n              <button\n                class=\"p-2 hover:bg-gray-900 rounded-r focus:outline-none\"\n                @click.stop=\"zoomIn\"\n              >\n                <LucidePlus class=\"size-4\" />\n              </button>\n            </Tooltip>\n          </div>\n\n          <!-- Action controls -->\n          <div class=\"bg-black/65 rounded flex items-center\">\n            <Tooltip text=\"Download image\">\n              <button\n                class=\"p-2 hover:bg-gray-900 rounded-l focus:outline-none\"\n                @click.stop=\"downloadImage\"\n              >\n                <LucideDownload class=\"size-4\" />\n              </button>\n            </Tooltip>\n\n            <Tooltip\n              :text=\"isFullscreen ? 'Exit fullscreen' : 'Enter fullscreen'\"\n            >\n              <button\n                class=\"p-2 hover:bg-gray-900 rounded-r focus:outline-none hidden sm:block\"\n                @click.stop=\"toggleFullscreen\"\n              >\n                <LucideMaximize v-if=\"!isFullscreen\" class=\"size-4\" />\n                <LucideMinimize v-else class=\"size-4\" />\n              </button>\n            </Tooltip>\n          </div>\n\n          <!-- Close button -->\n          <div class=\"bg-black/65 rounded flex items-center\">\n            <Tooltip text=\"Close\">\n              <button\n                class=\"p-2 hover:bg-gray-900 rounded focus:outline-none\"\n                @click.stop=\"close\"\n              >\n                <LucideX class=\"size-4\" />\n              </button>\n            </Tooltip>\n          </div>\n        </div>\n      </div>\n    </Transition>\n  </Teleport>\n</template>\n\n<script setup lang=\"ts\">\nimport {\n  ref,\n  onMounted,\n  onUnmounted,\n  useTemplateRef,\n  computed,\n  toRef,\n  watch,\n} from 'vue'\nimport Tooltip from '../Tooltip/Tooltip.vue'\nimport { useTouchHandler } from '../../composables/useTouchHandler'\nimport { useImageNavigation } from '../../composables/useImageNavigation'\nimport { useZoomPan } from '../../composables/useZoomPan'\n\nimport LucideDownload from '~icons/lucide/download'\nimport LucideMaximize from '~icons/lucide/maximize'\nimport LucideMinimize from '~icons/lucide/minimize'\nimport LucideChevronLeft from '~icons/lucide/chevron-left'\nimport LucideChevronRight from '~icons/lucide/chevron-right'\nimport LucidePlus from '~icons/lucide/plus'\nimport LucideMinus from '~icons/lucide/minus'\nimport LucideX from '~icons/lucide/x'\n\ninterface ImageInfo {\n  src: string\n  alt: string | null\n}\n\nconst props = defineProps<{\n  show: boolean\n  images: ImageInfo[]\n  initialIndex: number\n}>()\n\nconst emit = defineEmits<{\n  'update:show': [value: boolean]\n}>()\n\nconst imageContainer = useTemplateRef('imageContainer')\nconst backdropElement = useTemplateRef('backdropElement')\nconst controlsBar = useTemplateRef('controlsBar')\nconst controlsBarHeight = ref(0)\n\nconst isFullscreen = ref(false)\nconst touchStartZoom = ref(100)\n\nconst isControlsVisible = ref(true)\nconst inactivityTimer = ref<ReturnType<typeof setTimeout> | null>(null)\nconst INACTIVITY_TIMEOUT = 3000 // 3 seconds\n\nconst {\n  zoomLevel,\n  panPosition,\n  isMousePanning,\n  initialPanPositionOnGestureStart,\n  zoomIn,\n  zoomOut,\n  resetZoom,\n  handlePanStart,\n  snapThresholdLower,\n  snapThresholdUpper,\n} = useZoomPan({\n  containerRef: imageContainer,\n  isEnabled: toRef(props, 'show'),\n})\n\nconst { currentIndex, nextImage, previousImage } = useImageNavigation({\n  initialIndex: toRef(props, 'initialIndex'),\n  imageCount: computed(() => props.images.length),\n  onNavigate: resetZoom,\n})\n\nconst currentImage = computed(() => props.images[currentIndex.value])\n\nconst {\n  isPanning: isTouchPanning,\n  isPinching,\n  isAnimatingPan,\n} = useTouchHandler({\n  targetRef: imageContainer,\n  zoomLevel: zoomLevel,\n  panThreshold: 10,\n  onSwipeLeft: () => {\n    if (zoomLevel.value <= 100) nextImage()\n  },\n  onSwipeRight: () => {\n    if (zoomLevel.value <= 100) previousImage()\n  },\n  onDoubleTap: (event) => {\n    if (controlsBar.value?.contains(event.target as Node)) return\n\n    if (zoomLevel.value > 100) {\n      resetZoom()\n    } else {\n      zoomLevel.value = 200\n      panPosition.value = { x: 0, y: 0 }\n    }\n  },\n  onTap: (event) => {\n    if (event.target === backdropElement.value) {\n      close()\n    }\n  },\n  onPanStart: () => {\n    if (zoomLevel.value <= 100) return\n    initialPanPositionOnGestureStart.value = { ...panPosition.value }\n  },\n  onPanMove: (deltaX, deltaY) => {\n    if (zoomLevel.value <= 100) return\n    panPosition.value = {\n      x: initialPanPositionOnGestureStart.value.x + deltaX,\n      y: initialPanPositionOnGestureStart.value.y + deltaY,\n    }\n  },\n  onPanAnimate: (deltaX, deltaY) => {\n    panPosition.value = {\n      x: panPosition.value.x + deltaX,\n      y: panPosition.value.y + deltaY,\n    }\n  },\n  onPinchStart: () => {\n    touchStartZoom.value = zoomLevel.value\n    initialPanPositionOnGestureStart.value = { ...panPosition.value }\n  },\n  onPinchMove: (scale) => {\n    const newZoom = touchStartZoom.value * scale\n    let finalZoom = Math.max(25, Math.min(300, Math.round(newZoom)))\n\n    if (finalZoom > snapThresholdLower && finalZoom < snapThresholdUpper) {\n      finalZoom = 100\n    }\n    zoomLevel.value = finalZoom\n  },\n  onPinchEnd: () => {\n    if (zoomLevel.value < 100) {\n      resetZoom()\n    }\n    initialPanPositionOnGestureStart.value = { x: 0, y: 0 }\n  },\n})\n\nconst isPanning = computed(() => isMousePanning.value || isTouchPanning.value)\n\nfunction showControlsAndResetTimer() {\n  isControlsVisible.value = true\n  if (inactivityTimer.value) {\n    clearTimeout(inactivityTimer.value)\n  }\n  inactivityTimer.value = setTimeout(() => {\n    if (!isPanning.value && !isPinching.value) {\n      isControlsVisible.value = false\n    } else {\n      showControlsAndResetTimer()\n    }\n  }, INACTIVITY_TIMEOUT)\n}\n\nfunction handleActivity() {\n  if (!isPinching.value || !isControlsVisible.value) {\n    showControlsAndResetTimer()\n  }\n}\n\nfunction close() {\n  emit('update:show', false)\n  resetZoom()\n  if (inactivityTimer.value) {\n    clearTimeout(inactivityTimer.value)\n    inactivityTimer.value = null\n  }\n}\n\nfunction downloadImage() {\n  const imageToDownload = currentImage.value\n\n  const link = document.createElement('a')\n  link.href = imageToDownload.src\n\n  const filename =\n    imageToDownload.alt?.replace(/[^a-z0-9]/gi, '_').toLowerCase() ||\n    imageToDownload.src.split('/').pop() ||\n    'download'\n  link.download = filename.includes('.') ? filename : `${filename}.jpg`\n\n  document.body.appendChild(link)\n  link.click()\n  document.body.removeChild(link)\n}\n\nfunction toggleFullscreen() {\n  const container = imageContainer.value\n\n  if (!isFullscreen.value) {\n    if (container?.requestFullscreen) {\n      container.requestFullscreen()\n      isFullscreen.value = true\n    }\n  } else {\n    if (document.exitFullscreen) {\n      document.exitFullscreen()\n      isFullscreen.value = false\n    }\n  }\n}\n\nfunction handleFullscreenChange() {\n  isFullscreen.value = Boolean(document.fullscreenElement)\n}\n\nfunction handleKeyDown(event: KeyboardEvent) {\n  if (!props.show) return\n\n  handleActivity()\n\n  switch (event.key) {\n    case 'ArrowLeft':\n      if (!isPanning.value) previousImage()\n      event.preventDefault()\n      break\n    case 'ArrowRight':\n      if (!isPanning.value) nextImage()\n      event.preventDefault()\n      break\n    case '+':\n    case '=':\n      zoomIn()\n      event.preventDefault()\n      break\n    case '-':\n      zoomOut()\n      event.preventDefault()\n      break\n    case 'Escape':\n      close()\n      event.preventDefault()\n      break\n    case 'f':\n    case 'F':\n      toggleFullscreen()\n      event.preventDefault()\n      break\n  }\n}\n\nwatch(\n  () => props.show,\n  (newValue) => {\n    if (newValue) {\n      isControlsVisible.value = true\n      resetZoom()\n      showControlsAndResetTimer()\n    } else {\n      if (inactivityTimer.value) {\n        clearTimeout(inactivityTimer.value)\n        inactivityTimer.value = null\n      }\n      if (isFullscreen.value && document.exitFullscreen) {\n        document.exitFullscreen()\n      }\n    }\n  },\n)\n\nwatch(controlsBar, (newVal) => {\n  if (newVal) {\n    const updateHeight = () => {\n      controlsBarHeight.value = newVal.offsetHeight\n    }\n    const resizeObserver = new ResizeObserver(updateHeight)\n    resizeObserver.observe(newVal)\n    updateHeight()\n    onUnmounted(() => resizeObserver.disconnect())\n  } else {\n    controlsBarHeight.value = 0\n  }\n})\n\nonMounted(() => {\n  document.addEventListener('fullscreenchange', handleFullscreenChange)\n  document.addEventListener('keydown', handleKeyDown)\n})\n\nonUnmounted(() => {\n  document.removeEventListener('fullscreenchange', handleFullscreenChange)\n  document.removeEventListener('keydown', handleKeyDown)\n\n  if (inactivityTimer.value) {\n    clearTimeout(inactivityTimer.value)\n  }\n\n  if (isFullscreen.value && document.exitFullscreen) {\n    document.exitFullscreen()\n  }\n})\n</script>\n","import { Extension } from '@tiptap/core'\nimport { Plugin, PluginKey } from '@tiptap/pm/state'\nimport { createApp, h } from 'vue'\nimport ImageViewerModal from './ImageViewerModal.vue'\n\ninterface ImageInfo {\n  src: string\n  alt: string | null\n}\n\ndeclare module '@tiptap/core' {\n  interface Commands<ReturnType> {\n    imageViewer: {\n      /**\n       * Open the image viewer\n       */\n      openImageViewer: (src: string) => ReturnType\n    }\n  }\n}\n\nexport default Extension.create({\n  name: 'imageViewer',\n\n  onBeforeCreate() {\n    // Only add the style if it doesn't already exist\n    if (!document.querySelector('style[data-image-viewer-style]')) {\n      // Add a CSS rule to make images clickable when the editor is not editable\n      const style = document.createElement('style')\n      style.textContent = `\n          .ProseMirror:not(.ProseMirror-focused) img {\n            cursor: pointer;\n          }\n        `\n      style.setAttribute('data-image-viewer-style', 'true')\n      document.head.appendChild(style)\n    }\n  },\n\n  onDestroy() {\n    // Clean up the style element when the editor instance is destroyed\n    const style = document.querySelector('style[data-image-viewer-style]')\n    if (style) {\n      document.head.removeChild(style)\n    }\n  },\n\n  addCommands() {\n    return {\n      openImageViewer:\n        (src: string) =>\n        ({ editor }) => {\n          // Find all images in the document to populate the viewer\n          const images: ImageInfo[] = []\n          editor.state.doc.descendants((node) => {\n            if (node.type.name === 'image') {\n              images.push({\n                src: node.attrs.src,\n                alt: node.attrs.alt || null,\n              })\n            }\n            return true\n          })\n\n          // Find the index of the clicked image to start the viewer at the correct position\n          const currentIndex = images.findIndex((image) => image.src === src)\n\n          // Create and open the image viewer modal\n          openImageViewerModal(images, currentIndex)\n\n          return true\n        },\n    }\n  },\n\n  addProseMirrorPlugins() {\n    const extension = this\n\n    return [\n      new Plugin({\n        key: new PluginKey('imageViewer'),\n        props: {\n          handleClick(view, pos, event) {\n            // Only allow opening the viewer when the editor is not editable\n            if (extension.editor.isEditable) {\n              return false\n            }\n\n            const { state } = view\n            const clickedNode = state.doc.nodeAt(pos)\n\n            // Check if the click was directly on an image node\n            if (clickedNode?.type.name === 'image') {\n              event.preventDefault()\n              const src = clickedNode.attrs.src\n              extension.editor.commands.openImageViewer(src)\n              return true // Indicate that the event was handled\n            }\n\n            // If the click target was an <img> element, but not directly the node at pos\n            // (e.g., clicking near the edge, handled by browser event bubbling)\n            if (event.target instanceof HTMLImageElement) {\n              let foundImageNode = false\n              // Traverse the document to find the ProseMirror node corresponding to the clicked <img>\n              state.doc.descendants((node, nodePos) => {\n                if (node.type.name === 'image' && !foundImageNode) {\n                  const domNode = view.nodeDOM(nodePos)\n                  // Check if the event target is the DOM representation of this node or inside it\n                  if (\n                    domNode &&\n                    (domNode === event.target || domNode.contains(event.target))\n                  ) {\n                    event.preventDefault()\n                    extension.editor.commands.openImageViewer(node.attrs.src)\n                    foundImageNode = true\n                    return false // Stop traversal once found\n                  }\n                }\n                return true // Continue traversal\n              })\n\n              if (foundImageNode) return true // Indicate that the event was handled\n            }\n\n            return false // Event not handled by this plugin\n          },\n        },\n      }),\n    ]\n  },\n})\n\nfunction openImageViewerModal(images: ImageInfo[], initialIndex: number) {\n  // Create a temporary container div for the Vue modal instance\n  const container = document.createElement('div')\n  document.body.appendChild(container)\n\n  // Create the Vue app instance for the modal\n  const app = createApp({\n    render() {\n      return h(ImageViewerModal, {\n        show: true,\n        images, // Pass the collected image data\n        initialIndex, // Pass the starting index\n        'onUpdate:show': (value: boolean) => {\n          // Handle the modal closing\n          if (!value) {\n            // Delay unmounting and removal to allow for closing animations\n            setTimeout(() => {\n              app.unmount()\n              container.remove()\n            }, 0) // Timeout 0 ensures it runs after the current execution context\n          }\n        },\n      })\n    },\n  })\n\n  // Mount the Vue app to the container div\n  app.mount(container)\n}\n","import { Node, mergeAttributes, Editor } from '@tiptap/core'\nimport { Node as ProseMirrorNode } from '@tiptap/pm/model'\nimport { EditorView } from '@tiptap/pm/view'\nimport { UploadedFile } from '../../utils/useFileUpload'\n\nexport interface VideoOptions {\n  uploadFunction: ((file: File) => Promise<UploadedFile>) | null\n  HTMLAttributes: Record<string, any>\n}\n\nexport interface SetVideoOptions {\n  src: string\n}\n\ndeclare module '@tiptap/core' {\n  interface Commands<ReturnType> {\n    video: {\n      setVideo: (options: SetVideoOptions) => ReturnType\n      uploadVideo: (file: File) => ReturnType\n      selectAndUploadVideo: () => ReturnType\n    }\n  }\n}\n\nexport default Node.create<VideoOptions>({\n  name: 'video',\n  group: 'block',\n  selectable: true,\n  draggable: true,\n  atom: true,\n\n  addOptions() {\n    return {\n      uploadFunction: null,\n      HTMLAttributes: {},\n    }\n  },\n\n  addAttributes() {\n    return {\n      src: {\n        default: null,\n      },\n    }\n  },\n\n  parseHTML() {\n    return [\n      {\n        tag: 'video',\n      },\n    ]\n  },\n\n  renderHTML({ HTMLAttributes }) {\n    return [\n      'video',\n      mergeAttributes(this.options.HTMLAttributes, HTMLAttributes, {\n        controls: '',\n      }),\n    ]\n  },\n\n  addCommands() {\n    return {\n      setVideo:\n        (options: SetVideoOptions) =>\n        ({ commands }) => {\n          return commands.insertContent({\n            type: this.name,\n            attrs: options,\n          })\n        },\n\n      uploadVideo:\n        (file: File) =>\n        ({ editor }) => {\n          const pos = editor.state.selection.from\n          return uploadVideoInternal(file, editor.view, pos, this.options)\n        },\n\n      selectAndUploadVideo:\n        () =>\n        ({ editor }) => {\n          if (!this.options.uploadFunction) {\n            console.error('uploadFunction option is not provided for videos.')\n            return false\n          }\n\n          const input = document.createElement('input')\n          input.type = 'file'\n          input.accept = 'video/*'\n          input.onchange = (event) => {\n            const target = event.target as HTMLInputElement\n            if (target.files && target.files.length) {\n              const file = target.files[0]\n              editor.commands.uploadVideo(file)\n            }\n          }\n          input.click()\n          return true\n        },\n    }\n  },\n\n  addNodeView() {\n    return ({ editor, node }: { editor: Editor; node: ProseMirrorNode }) => {\n      const div = document.createElement('div')\n      div.className =\n        'relative aspect-w-16 aspect-h-9' +\n        (editor.isEditable ? ' cursor-pointer' : '')\n\n      const video = document.createElement('video')\n      video.src = node.attrs.src\n      video.setAttribute('controls', '')\n\n      if (editor.isEditable) {\n        let videoPill = document.createElement('div')\n        videoPill.className =\n          'absolute top-0 right-0 text-xs m-2 bg-surface-gray-6 text-ink-white px-2 py-1 rounded-md'\n        videoPill.innerHTML = 'Video'\n        div.append(videoPill)\n      }\n      div.append(video)\n      return {\n        dom: div,\n      }\n    }\n  },\n})\n\nfunction uploadVideoInternal(\n  file: File,\n  view: EditorView,\n  pos: number | null | undefined,\n  options: Record<string, any>,\n): boolean {\n  if (!options.uploadFunction) {\n    console.error('uploadFunction option is not provided for videos.')\n    return false\n  }\n\n  options\n    .uploadFunction(file)\n    .then((uploadedVideo: UploadedFile) => {\n      const { schema } = view.state\n      const node = schema.nodes.video.create({ src: uploadedVideo.file_url })\n\n      const transaction = view.state.tr\n      if (pos != null) {\n        transaction.insert(pos, node)\n      } else {\n        transaction.replaceSelectionWith(node)\n      }\n      view.dispatch(transaction)\n    })\n    .catch((error: Error) => {\n      console.error('Video upload failed:', error)\n    })\n\n  return true\n}\n","import { IframeOptions } from './iframe-extension'\n\n\nexport const ALLOWED_DOMAINS = [\n  'youtube.com',\n  'www.youtube.com',\n  'youtu.be',\n  'vimeo.com',\n  'player.vimeo.com',\n  'codepen.io',\n  'codesandbox.io',\n  'figma.com',\n  'www.figma.com',\n  'embed.figma.com',\n  'docs.google.com',\n  'drive.google.com',\n  'notion.so',\n  'www.notion.so',\n]\n\nexport interface AspectRatioInfo {\n  ratio: number\n  width: number\n  height: number\n  platform: string\n}\n\nexport interface PlatformConfig {\n  name: string\n  ratio: number\n  defaultWidth: number\n  urlPatterns: string[]\n}\n\n// Platform-specific configurations\nconst PLATFORM_CONFIGS: PlatformConfig[] = [\n  {\n    name: 'YouTube',\n    ratio: 9/16, // 16:9 aspect ratio\n    defaultWidth: 640,\n    urlPatterns: ['youtube.com', 'youtu.be', 'youtube-nocookie.com']\n  },\n  {\n    name: 'Vimeo',\n    ratio: 9/16, // 16:9 aspect ratio\n    defaultWidth: 640,\n    urlPatterns: ['vimeo.com', 'player.vimeo.com']\n  },\n  {\n    name: 'CodePen',\n    ratio: 3/2, // 2:3 aspect ratio (taller for code demos)\n    defaultWidth: 500,\n    urlPatterns: ['codepen.io']\n  },\n  {\n    name: 'CodeSandbox',\n    ratio: 3/2, // 2:3 aspect ratio\n    defaultWidth: 500,\n    urlPatterns: ['codesandbox.io']\n  },\n  {\n    name: 'Figma',\n    ratio: 9/16, // 16:9 default for design embeds\n    defaultWidth: 800,\n    urlPatterns: ['figma.com', 'www.figma.com', 'embed.figma.com']\n  },\n  {\n    name: 'Google Docs',\n    ratio: 4/3, // 4:3 for documents\n    defaultWidth: 600,\n    urlPatterns: ['docs.google.com', 'drive.google.com']\n  },\n  {\n    name: 'Notion',\n    ratio: 4/3, // 4:3 for pages\n    defaultWidth: 600,\n    urlPatterns: ['notion.so', 'www.notion.so']\n  },\n]\n\nexport function detectPlatform(url: string): PlatformConfig | null {\n  try {\n    const urlObj = new URL(url)\n    const domain = urlObj.hostname.toLowerCase()\n\n    return PLATFORM_CONFIGS.find(config =>\n      config.urlPatterns.some(pattern => domain.includes(pattern))\n    ) || null\n  } catch {\n    return null\n  }\n}\n\nexport function calculateAspectRatio(url: string): AspectRatioInfo {\n  const platform = detectPlatform(url)\n\n  if (platform) {\n    return {\n      ratio: platform.ratio,\n      width: platform.defaultWidth,\n      height: Math.round(platform.defaultWidth * platform.ratio),\n      platform: platform.name\n    }\n  }\n\n  // Default to 16:9 for unknown platforms\n  return {\n    ratio: 9/16,\n    width: 640,\n    height: 360,\n    platform: 'Generic'\n  }\n}\n\nexport function getOptimalDimensions(url: string, containerWidth?: number): { width: number, height: number } {\n  const aspectInfo = calculateAspectRatio(url)\n\n  // If container width is provided, scale to fit\n  if (containerWidth) {\n    const CONTAINER_PADDING = 40 // px for editor padding\n    const maxWidth = Math.min(containerWidth - CONTAINER_PADDING, aspectInfo.width)\n    return {\n      width: maxWidth,\n      height: Math.round(maxWidth * aspectInfo.ratio)\n    }\n  }\n\n  return {\n    width: aspectInfo.width,\n    height: aspectInfo.height\n  }\n}\n\nexport function validateURL(url: string, options: IframeOptions): boolean {\n  try {\n    if (url.startsWith('/')) return true\n    const urlObj = new URL(url)\n    const domain = urlObj.hostname.toLowerCase()\n\n    // Check blocked domains first\n    if (options.blockedDomains?.some((blocked) => domain.includes(blocked))) {\n      return false\n    }\n\n    // If allowedDomains is specified, check if domain is allowed\n    if (options.allowedDomains?.length) {\n      return options.allowedDomains.some((allowed) =>\n        domain.includes(allowed.toLowerCase())\n      )\n    }\n\n    // If no allowedDomains specified, allow all except blocked\n    return true\n  } catch {\n    return false\n  }\n}\n\nexport function processURL(url: string): string {\n  try {\n    const urlObj = new URL(url)\n    const domain = urlObj.hostname.toLowerCase()\n\n    // YouTube URL processing\n    if (domain.includes('youtube.com') || domain.includes('youtu.be')) {\n      return convertToYouTubeEmbed(url)\n    }\n\n    // Vimeo URL processing\n    if (domain.includes('vimeo.com')) {\n      return convertToVimeoEmbed(url)\n    }\n\n    // CodePen URL processing\n    if (domain.includes('codepen.io')) {\n      return convertToCodePenEmbed(url)\n    }\n\n    // Figma URL processing\n    if (domain.includes('figma.com')) {\n      return convertToFigmaEmbed(url)\n    }\n\n    // For other supported domains, return as-is\n    return url\n  } catch {\n    return url\n  }\n}\n\nfunction convertToYouTubeEmbed(url: string): string {\n  try {\n    const urlObj = new URL(url)\n    let videoId = ''\n\n    if (urlObj.hostname === 'youtu.be') {\n      videoId = urlObj.pathname.slice(1)\n    } else if (urlObj.hostname.includes('youtube.com')) {\n      videoId = urlObj.searchParams.get('v') || ''\n\n      // Handle /embed/ URLs that are already in embed format\n      if (urlObj.pathname.includes('/embed/')) {\n        return url\n      }\n    }\n\n    if (videoId) {\n      // Add common YouTube embed parameters for better UX\n      return `https://www.youtube.com/embed/${videoId}?rel=0&modestbranding=1`\n    }\n  } catch (e) {\n    console.warn('Failed to convert YouTube URL:', e)\n  }\n\n  return url\n}\n\nfunction convertToVimeoEmbed(url: string): string {\n  try {\n    // Handle already embedded URLs\n    if (url.includes('player.vimeo.com')) {\n      return url\n    }\n\n    const match = url.match(/vimeo\\.com\\/(?:.*\\/)?(\\d+)/)\n    if (match?.[1]) {\n      return `https://player.vimeo.com/video/${match[1]}?title=0&byline=0&portrait=0`\n    }\n  } catch (e) {\n    console.warn('Failed to convert Vimeo URL:', e)\n  }\n\n  return url\n}\n\nfunction convertToCodePenEmbed(url: string): string {\n  try {\n    // Handle already embedded URLs\n    if (url.includes('/embed/')) {\n      return url\n    }\n\n    const match = url.match(/codepen\\.io\\/([^\\/]+)\\/pen\\/([^\\/\\?]+)/)\n    if (match?.[1] && match?.[2]) {\n      return `https://codepen.io/${match[1]}/embed/${match[2]}?default-tab=result`\n    }\n  } catch (e) {\n    console.warn('Failed to convert CodePen URL:', e)\n  }\n\n  return url\n}\n\nfunction convertToFigmaEmbed(url: string): string {\n  try {\n    const urlObj = new URL(url)\n\n    // Convert direct Figma links to embed URLs\n    if (urlObj.hostname === 'www.figma.com' || urlObj.hostname === 'figma.com') {\n      // Convert https://www.figma.com/design/... to https://embed.figma.com/design/...\n      if (urlObj.pathname.startsWith('/design/')) {\n        urlObj.hostname = 'embed.figma.com'\n        // Set embed-host to 'share' for public embeds\n        urlObj.searchParams.set('embed-host', 'share')\n        return urlObj.toString()\n      }\n    }\n\n    // For already embedded URLs, just ensure embed-host is set\n    if (urlObj.hostname === 'embed.figma.com') {\n      if (!urlObj.searchParams.has('embed-host')) {\n        urlObj.searchParams.set('embed-host', 'share')\n      }\n      return urlObj.toString()\n    }\n\n    return url\n  } catch (e) {\n    console.warn('Failed to convert Figma URL:', e)\n  }\n\n  return url\n}\n","<script setup lang=\"ts\">\nimport { ref, onMounted, computed, nextTick } from 'vue'\nimport { NodeViewWrapper, nodeViewProps } from '@tiptap/vue-3'\nimport { detectPlatform, calculateAspectRatio } from './utils'\nimport LucideMoveDiagonal2 from '~icons/lucide/move-diagonal-2'\nimport LucideAlignLeft from '~icons/lucide/align-left'\nimport LucideAlignCenter from '~icons/lucide/align-center'\nimport LucideAlignRight from '~icons/lucide/align-right'\n\nconst props = defineProps(nodeViewProps)\n\nconst iframeRef = ref<HTMLIFrameElement | null>(null)\nconst containerRef = ref<HTMLDivElement | null>(null)\nconst isResizing = ref(false)\nconst startDragX = ref(0)\nconst startWidth = ref(0)\nconst originalAspectRatio = ref(9/16) // Default 16:9\nconst isEditable = ref(false)\n\nfunction selectIframe() {\n  props.editor.commands.setNodeSelection(props.getPos())\n}\n\n// Computed properties for styling and info\nconst platformInfo = computed(() => {\n  if (props.node.attrs.src) {\n    const platform = detectPlatform(props.node.attrs.src)\n    const aspectInfo = calculateAspectRatio(props.node.attrs.src)\n    return {\n      platform: platform?.name || 'Generic',\n      aspectRatio: aspectInfo.ratio\n    }\n  }\n  return { platform: 'Generic', aspectRatio: 9/16 }\n})\n\nconst iframeStyles = computed(() => {\n  const width = props.node.attrs.width || 640\n  const height = props.node.attrs.height || (width * originalAspectRatio.value)\n\n  return {\n    width: `${width}px`,\n    height: `${height}px`\n  }\n})\n\nonMounted(() => {\n  isEditable.value = props.editor.isEditable\n\n  // Calculate aspect ratio from node attributes or URL\n  if (props.node.attrs.aspectRatio) {\n    originalAspectRatio.value = props.node.attrs.aspectRatio\n  } else if (props.node.attrs.src) {\n    const aspectInfo = calculateAspectRatio(props.node.attrs.src)\n    originalAspectRatio.value = aspectInfo.ratio\n\n    // Update node with calculated aspect ratio\n    props.updateAttributes({ aspectRatio: aspectInfo.ratio })\n  }\n})\n\nprops.editor.on('update', () => {\n  isEditable.value = props.editor.isEditable\n})\n\nfunction startResize(event: MouseEvent) {\n  if (!isEditable.value) return\n  selectIframe()\n  isResizing.value = true\n  startDragX.value = event.clientX\n  startWidth.value = containerRef.value?.offsetWidth || props.node.attrs.width || 640\n\n  // Use stored aspect ratio or calculate from current dimensions\n  if (props.node.attrs.aspectRatio) {\n    originalAspectRatio.value = props.node.attrs.aspectRatio\n  } else {\n    const width = props.node.attrs.width || startWidth.value\n    const height = props.node.attrs.height || (width * originalAspectRatio.value)\n    if (width && height) {\n      originalAspectRatio.value = height / width\n    }\n  }\n\n  window.addEventListener('mousemove', handleResize)\n  window.addEventListener('mouseup', stopResize)\n  document.body.style.cursor = 'ew-resize'\n}\n\nfunction handleResize(event: MouseEvent) {\n  if (!isResizing.value || !iframeRef.value || !containerRef.value) return\n\n  const editorElement = props.editor.view.dom\n  const editorWidth = editorElement.clientWidth\n\n  const deltaX = event.clientX - startDragX.value\n  let newWidth = startWidth.value + deltaX\n\n  // Add constraints (minimum width, maximum editor width with padding)\n  const MIN_WIDTH = 200\n  const PADDING = 40\n  newWidth = Math.max(MIN_WIDTH, Math.min(newWidth, editorWidth - PADDING))\n\n  const newHeight = newWidth * originalAspectRatio.value\n\n  // Apply temporary styles for visual feedback\n  iframeRef.value.style.width = `${newWidth}px`\n  iframeRef.value.style.height = `${newHeight}px`\n  containerRef.value.style.width = `${newWidth}px`\n}\n\nfunction stopResize() {\n  if (!isResizing.value) return\n\n  isResizing.value = false\n  window.removeEventListener('mousemove', handleResize)\n  window.removeEventListener('mouseup', stopResize)\n  document.body.style.cursor = ''\n\n  if (iframeRef.value && containerRef.value) {\n    // Capture final dimensions while temporary styles are still applied\n    const finalWidth = iframeRef.value.offsetWidth\n    const finalHeight = iframeRef.value.offsetHeight\n\n    // Update attributes\n    props.updateAttributes({\n      width: finalWidth,\n      height: finalHeight,\n      aspectRatio: originalAspectRatio.value\n    })\n\n    // Clear temporary styles immediately (like image extension)\n    iframeRef.value.style.width = ''\n    iframeRef.value.style.height = ''\n    containerRef.value.style.width = ''\n  }\n}\n\nfunction setAlignment(align: 'left' | 'center' | 'right') {\n  props.updateAttributes({ align })\n}\n\n// Handle keyboard navigation\nfunction handleKeydown(event: KeyboardEvent) {\n  if (event.key === 'Enter') {\n    event.preventDefault()\n    createParagraphAfterIframe()\n  } else if (event.key === 'Escape' || event.key === 'ArrowDown') {\n    event.preventDefault()\n    setCursorAfterIframe()\n  }\n  if (event.key === 'ArrowUp') {\n    event.preventDefault()\n    setCursorBeforeIframe()\n  }\n}\n\nfunction setCursorAt(pos: number) {\n  props.editor.commands.focus()\n  props.editor.chain().setTextSelection(pos).scrollIntoView().run()\n}\n\nfunction createParagraphAfterIframe() {\n  const pos = props.getPos()\n  props.editor.commands.focus()\n  props.editor\n    .chain()\n    .setTextSelection(pos + 1)\n    .createParagraphNear()\n    .scrollIntoView()\n    .run()\n}\n\nfunction setCursorAfterIframe() {\n  const pos = props.getPos()\n  setCursorAt(pos + 1)\n}\n\nfunction setCursorBeforeIframe() {\n  const pos = props.getPos()\n  setCursorAt(pos - 1)\n}\n</script>\n\n<template>\n  <NodeViewWrapper>\n    <div\n      ref=\"containerRef\"\n      class=\"relative overflow-hidden not-prose my-6 rounded-lg block max-w-full focus:outline-none\"\n      :class=\"[\n        { 'ring-2 ring-outline-gray-3 ring-offset-2': selected },\n        node.attrs.align === 'center' ? 'mx-auto' : '',\n        node.attrs.align === 'right' ? 'ml-auto mr-0' : '',\n        node.attrs.align === 'left' ? 'mr-auto ml-0' : '',\n      ]\"\n      :style=\"{\n        width: node.attrs.width ? `${node.attrs.width}px` : 'auto',\n        maxWidth: '100%'\n      }\"\n      @keydown=\"handleKeydown\"\n      tabindex=\"0\"\n    >\n      <div class=\"relative\">\n        <iframe\n          v-if=\"node.attrs.src\"\n          ref=\"iframeRef\"\n          class=\"rounded-lg border-0 block max-w-full h-auto\"\n          :class=\"{\n            'pointer-events-none': isEditable && !props.node.attrs.interactive,\n          }\"\n          :src=\"node.attrs.src\"\n          :style=\"iframeStyles\"\n          :title=\"node.attrs.title || ''\"\n          frameborder=\"0\"\n          allowfullscreen\n          loading=\"lazy\"\n          referrerpolicy=\"no-referrer-when-downgrade\"\n          sandbox=\"allow-scripts allow-same-origin allow-popups allow-forms\"\n          @click.stop=\"selectIframe\"\n        />\n\n        <!-- Transparent overlay for selection in edit mode -->\n        <div\n          v-if=\"isEditable && !props.node.attrs.interactive\"\n          class=\"absolute inset-0 cursor-pointer z-10\"\n          @click.stop=\"selectIframe\"\n        ></div>\n\n        <!-- Controls overlay -->\n        <div class=\"absolute bottom-2 right-2 flex items-center gap-2 z-20\">\n          <!-- Alignment Controls -->\n          <div\n            v-if=\"selected && isEditable\"\n            class=\"flex divide-x divide-ink-gray-6 rounded-md bg-black/65\"\n          >\n            <button\n              @click.stop=\"setAlignment('left')\"\n              :class=\"[\n                'px-1.5 py-1 text-ink-gray-4 hover:text-white transition-colors duration-150',\n                { 'text-white': node.attrs.align === 'left' }\n              ]\"\n              title=\"Align Left\"\n            >\n              <LucideAlignLeft class=\"size-4\" />\n            </button>\n            <button\n              @click.stop=\"setAlignment('center')\"\n              :class=\"[\n                'px-1.5 py-1 text-ink-gray-4 hover:text-white transition-colors duration-150',\n                { 'text-white': node.attrs.align === 'center' }\n              ]\"\n              title=\"Align Center\"\n            >\n              <LucideAlignCenter class=\"size-4\" />\n            </button>\n            <button\n              @click.stop=\"setAlignment('right')\"\n              :class=\"[\n                'px-1.5 py-1 text-ink-gray-4 hover:text-white transition-colors duration-150',\n                { 'text-white': node.attrs.align === 'right' }\n              ]\"\n              title=\"Align Right\"\n            >\n              <LucideAlignRight class=\"size-4\" />\n            </button>\n          </div>\n\n          <!-- Resize Handle -->\n          <button\n            v-if=\"selected && isEditable\"\n            class=\"cursor-nw-resize bg-black/65 rounded-md p-1\"\n            @mousedown.prevent=\"startResize\"\n            title=\"Resize\"\n          >\n            <LucideMoveDiagonal2 class=\"text-white size-4\" />\n          </button>\n        </div>\n\n\n        <!-- Loading state for new embeds -->\n        <div\n          v-if=\"!node.attrs.src\"\n          class=\"flex items-center justify-center bg-surface-gray-1 rounded-lg w-[640px] h-[360px]\"\n        >\n          <div class=\"text-ink-gray-5 text-center\">\n            <div class=\"text-lg mb-1\"></div>\n            <div class=\"text-sm\">Loading embed...</div>\n          </div>\n        </div>\n      </div>\n\n      <!-- Caption/Title input -->\n      <input\n        v-if=\"(isEditable || node.attrs.title) && node.attrs.src\"\n        :value=\"node.attrs.title\"\n        class=\"w-full text-center bg-transparent text-sm text-ink-gray-6 h-7 border-0 mt-2 focus:outline-none focus:ring-0 placeholder-ink-gray-4 disabled:opacity-60\"\n        placeholder=\"Add caption\"\n        :disabled=\"!isEditable\"\n        @input=\"(e) => props.updateAttributes({ title: (e.target as HTMLInputElement).value })\"\n        @keydown=\"handleKeydown\"\n      />\n    </div>\n  </NodeViewWrapper>\n</template>\n\n<style scoped>\n/* Component-specific styles if needed */\n</style>\n","import { Node, mergeAttributes } from '@tiptap/core'\nimport { VueNodeViewRenderer } from '@tiptap/vue-3'\nimport { Plugin, PluginKey } from '@tiptap/pm/state'\nimport IframeNodeView from './IframeNodeView.vue'\nimport { validateURL, processURL, getOptimalDimensions, ALLOWED_DOMAINS } from './utils'\n\n// Constants for iframe constraints\nconst MIN_IFRAME_WIDTH = 200\nconst EDITOR_PADDING = 40\nconst DEFAULT_EMBED_HOST = 'gameplan'\n\nexport interface IframeOptions {\n  allowedDomains?: string[]\n  blockedDomains?: string[]\n  HTMLAttributes: Record<string, any>\n}\n\nexport interface SetIframeOptions {\n  src: string\n  width?: number\n  height?: number\n  title?: string\n  interactive?: boolean\n  align?: 'left' | 'center' | 'right'\n}\n\ndeclare module '@tiptap/core' {\n  interface Commands<ReturnType> {\n    iframe: {\n      setIframe: (options: SetIframeOptions) => ReturnType\n      insertIframeURL: (url: string) => ReturnType\n      setIframeAlign: (align: 'left' | 'center' | 'right') => ReturnType\n      openIframeDialog: () => ReturnType\n    }\n  }\n}\n\nexport const IframeExtension = Node.create<IframeOptions>({\n  name: 'iframe',\n  group: 'block',\n  selectable: true,\n  draggable: true,\n  atom: true,\n\n  addOptions() {\n    return {\n      allowedDomains: ALLOWED_DOMAINS,\n      blockedDomains: [],\n      HTMLAttributes: {},\n    }\n  },\n\n  addAttributes() {\n    return {\n      src: {\n        default: null,\n        parseHTML: (element) => element.getAttribute('src'),\n        renderHTML: (attributes) => ({\n          src: attributes.src,\n        }),\n      },\n      width: {\n        default: null,\n        parseHTML: (element) => {\n          const width = element.getAttribute('width')\n          return width ? parseInt(width, 10) : null\n        },\n        renderHTML: (attributes) => ({\n          width: attributes.width ? String(attributes.width) : null,\n        }),\n      },\n      height: {\n        default: null,\n        parseHTML: (element) => {\n          const height = element.getAttribute('height')\n          return height ? parseInt(height, 10) : null\n        },\n        renderHTML: (attributes) => ({\n          height: attributes.height ? String(attributes.height) : null,\n        }),\n      },\n      aspectRatio: {\n        default: 9/16, // Default 16:9 aspect ratio\n        parseHTML: () => null, // Don't parse from HTML\n        renderHTML: () => ({}), // Don't render to HTML\n      },\n      align: {\n        default: 'center',\n        parseHTML: (element) => {\n          const align = (\n            element.getAttribute('data-align') ||\n            element.getAttribute('align') ||\n            'left'\n          ).toLowerCase()\n\n          if (['left', 'center', 'right'].includes(align)) {\n            return align as 'left' | 'center' | 'right'\n          }\n          return 'left'\n        },\n        renderHTML: (attributes) => {\n          return {\n            'data-align': attributes.align || 'center',\n          }\n        },\n      },\n      title: {\n        default: null,\n        parseHTML: (element) => element.getAttribute('title'),\n        renderHTML: (attributes) => ({\n          title: attributes.title,\n        }),\n      },\n      frameborder: {\n        default: '0',\n        renderHTML: () => ({\n          frameborder: '0',\n        }),\n      },\n      allowfullscreen: {\n        default: 'true',\n        renderHTML: () => ({\n          allowfullscreen: 'true',\n        }),\n      },\n      sandbox: {\n        default: 'allow-scripts allow-same-origin allow-popups allow-forms',\n        renderHTML: (attributes) => ({\n          sandbox: attributes.sandbox,\n        }),\n      },\n      interactive: {\n        default: false,\n        parseHTML: (el) => el.getAttribute('data-interactive') === 'true',\n        renderHTML: (attrs) => ({\n          'data-interactive': attrs.interactive ? 'true' : 'false',\n        }),\n      },\n    }\n  },\n\n  parseHTML() {\n    return [\n      {\n        tag: 'iframe[src]',\n        getAttrs: (element) => {\n          const src = (element as HTMLElement).getAttribute('src')\n          const width = (element as HTMLElement).getAttribute('width')\n          const height = (element as HTMLElement).getAttribute('height')\n          const title = (element as HTMLElement).getAttribute('title')\n          const align = (element as HTMLElement).getAttribute('data-align')\n\n          return {\n            src,\n            width: width ? parseInt(width, 10) : null,\n            height: height ? parseInt(height, 10) : null,\n            title: title || null,\n            align: align || 'center'\n          }\n        },\n      },\n    ]\n  },\n\n  renderHTML({ HTMLAttributes }) {\n    return [\n      'iframe',\n      mergeAttributes(this.options.HTMLAttributes, HTMLAttributes, {\n        loading: 'lazy',\n        referrerpolicy: 'no-referrer-when-downgrade',\n      }),\n    ]\n  },\n\n  addNodeView() {\n    return VueNodeViewRenderer(IframeNodeView)\n  },\n\n  addCommands() {\n    return {\n      setIframeAlign:\n        (align: 'left' | 'center' | 'right') =>\n        ({ commands }) => {\n          return commands.updateAttributes(this.name, { align })\n        },\n\n      setIframe:\n        (options: SetIframeOptions) =>\n        ({ commands, editor }) => {\n          if (!validateURL(options.src, this.options)) {\n            return false\n          }\n\n          const processedSrc = processURL(options.src)\n\n          // Calculate optimal dimensions if not provided\n          const editorElement = editor.view.dom\n          const editorWidth = editorElement?.clientWidth || 800\n          const optimalDimensions = getOptimalDimensions(processedSrc, editorWidth)\n\n          const attrs = {\n            src: processedSrc,\n            width: options.width || optimalDimensions.width,\n            height: options.height || optimalDimensions.height,\n            title: options.title,\n            align: options.align || 'center',\n            aspectRatio: optimalDimensions.height / optimalDimensions.width,\n            interactive: options.interactive,\n          }\n\n          return commands.insertContent({\n            type: this.name,\n            attrs\n          })\n        },\n\n      insertIframeURL:\n        (url: string) =>\n        ({ commands }) => {\n          const processedUrl = processURL(url)\n          return commands.setIframe({ src: processedUrl })\n        },\n\n      openIframeDialog:\n        () =>\n        ({ editor }) => {\n          // Emit a custom event on the editor's view DOM element\n          // This is more localized than document.dispatchEvent\n          const event = new CustomEvent('iframe:open-dialog', {\n            detail: { editor }\n          })\n          editor.view.dom.dispatchEvent(event)\n          return true\n        },\n    }\n  },\n\n  // Add ProseMirror plugin for paste handling\n  addProseMirrorPlugins() {\n    const extensionThis = this\n\n    return [\n      new Plugin({\n        key: new PluginKey('iframe-paste-handler'),\n        props: {\n          handlePaste: (view, event, slice) => {\n            const text = event.clipboardData?.getData('text/plain')\n            const html = event.clipboardData?.getData('text/html')\n\n            // First, check for iframe embed codes in HTML content\n            if (html) {\n              const iframeData = parseIframeFromHTML(html)\n              if (iframeData) {\n                return createIframeNode(view, extensionThis, iframeData.src, iframeData.width, iframeData.height, iframeData.title)\n              }\n            }\n\n            // Check if plain text contains iframe embed code\n            if (text && text.includes('<iframe')) {\n              const iframeData = parseIframeFromHTML(text)\n              if (iframeData) {\n                return createIframeNode(view, extensionThis, iframeData.src, iframeData.width, iframeData.height, iframeData.title)\n              }\n            }\n\n            // Fallback to URL detection for plain text\n            if (text) {\n              // Check if pasted text is a supported embed URL\n              const urlPattern = /^https?:\\/\\/(?:www\\.)?(?:youtube\\.com\\/watch\\?v=[\\w-]+|youtu\\.be\\/[\\w-]+|youtube\\.com\\/embed\\/[\\w-]+|vimeo\\.com\\/\\d+|player\\.vimeo\\.com\\/video\\/\\d+|codepen\\.io\\/[\\w-]+\\/pen\\/[\\w-]+|codesandbox\\.io\\/[\\w\\/.-]+|figma\\.com\\/[\\w\\/.-]+|embed\\.figma\\.com\\/[\\w\\/.-]+)$/\n\n              if (urlPattern.test(text.trim())) {\n                return createIframeNode(view, extensionThis, text.trim())\n              }\n            }\n\n            return false // Allow default paste behavior\n          },\n        },\n      }),\n    ]\n  },\n})\n\n// Helper function to parse iframe embed codes from pasted HTML content\nfunction parseIframeFromHTML(html: string): { src: string, width?: number, height?: number, title?: string } | null {\n  try {\n    const parser = new DOMParser()\n    const doc = parser.parseFromString(html, 'text/html')\n    const iframe = doc.querySelector('iframe')\n\n    if (!iframe) {\n      // Fallback: try to parse iframe tag using regex\n      const iframeMatch = html.match(/<iframe[^>]*src=[\"']([^\"']+)[\"'][^>]*>/i)\n      if (iframeMatch) {\n        const src = iframeMatch[1]\n        const widthMatch = html.match(/width=[\"'](\\d+)[\"']/i)\n        const heightMatch = html.match(/height=[\"'](\\d+)[\"']/i)\n        const titleMatch = html.match(/title=[\"']([^\"']+)[\"']/i)\n\n        return {\n          src,\n          width: widthMatch ? parseInt(widthMatch[1], 10) : undefined,\n          height: heightMatch ? parseInt(heightMatch[1], 10) : undefined,\n          title: titleMatch ? titleMatch[1] : undefined\n        }\n      }\n      return null\n    }\n\n    const src = iframe.getAttribute('src')\n    if (!src) return null\n\n    const width = iframe.getAttribute('width') ? parseInt(iframe.getAttribute('width')!, 10) : undefined\n    const height = iframe.getAttribute('height') ? parseInt(iframe.getAttribute('height')!, 10) : undefined\n    const title = iframe.getAttribute('title') || undefined\n\n    return { src, width, height, title }\n  } catch (error) {\n    return null\n  }\n}\n\n// Helper function to create iframe node from parsed data\nfunction createIframeNode(view: any, extensionThis: any, src: string, width?: number, height?: number, title?: string) {\n  // Ask user for confirmation before creating iframe\n  const shouldCreateEmbed = confirm(`Do you want to embed this content?\\n\\nURL: ${src}\\n\\nClick \"OK\" to create an embed, or \"Cancel\" to paste as plain text.`)\n\n  if (!shouldCreateEmbed) {\n    return false // Allow default paste behavior (paste as text)\n  }\n\n  if (!validateURL(src, extensionThis.options)) {\n    return false\n  }\n\n  console.log('URL validated, creating iframe node')\n  const processedUrl = processURL(src)\n  const editorElement = extensionThis.editor.view.dom\n  const editorWidth = editorElement?.clientWidth || 800\n\n  // Use provided dimensions or calculate optimal ones\n  const finalWidth = width || getOptimalDimensions(processedUrl, editorWidth).width\n  const finalHeight = height || getOptimalDimensions(processedUrl, editorWidth).height\n\n  const attrs = {\n    src: processedUrl,\n    width: finalWidth,\n    height: finalHeight,\n    title: title,\n    align: 'center' as const,\n    aspectRatio: finalHeight / finalWidth\n  }\n\n  const node = view.state.schema.nodes.iframe.create(attrs)\n  const tr = view.state.tr.replaceSelectionWith(node)\n  view.dispatch(tr)\n\n  return true // Prevent default paste behavior\n}\n\nexport default IframeExtension\n","/**\n * Validates if the given string is a valid URL, including common protocols,\n * relative paths, and anchor links. It also allows an empty string.\n *\n * @param url The URL string to validate.\n * @returns True if the URL is considered valid, false otherwise.\n */\nexport function isValidUrl(url: string): boolean {\n  if (url === '') {\n    return true // Allows empty string as per documentation\n  }\n\n  // Regex for absolute URLs with common schemes (http, https, mailto, tel, //)\n  // Allows for paths, query strings, and fragments.\n  if (/^(https?:\\/\\/|mailto:|tel:|\\/\\/)[^\\s]+$/i.test(url)) {\n    return true\n  }\n\n  // Regex for:\n  // 1. Relative paths (starting with / or .)\n  // 2. Anchor links (starting with #)\n  // These allow for most characters except whitespace, as the initial characters\n  // prevent misinterpretation as a scheme like 'javascript:'.\n  if (/^([./#][^\\s]*)$/i.test(url)) {\n    return true\n  }\n\n  // Regex for \"Schemeless\" paths (e.g., page.html, my-document, slug-name)\n  // Must start with a word character or hyphen.\n  // Subsequent characters are restricted to common URL path/query/fragment characters\n  // (alphanumeric, -, _, ., /, #, ?, =, &, %).\n  // This prevents colons (avoiding 'javascript:' like schemes) and other problematic\n  // characters like spaces, (, ), !, {, }.\n  if (/^[\\w\\-]([\\w\\-./#?=&%]*)$/i.test(url)) {\n    return true\n  }\n\n  return false\n}\n","<template>\n  <div\n    class=\"p-2 flex min-w-72 items-center gap-2 bg-surface-white shadow-xl rounded-lg\"\n  >\n    <TextInput\n      ref=\"input\"\n      type=\"text\"\n      class=\"w-full\"\n      placeholder=\"https://example.com\"\n      v-model=\"_href\"\n      @keydown.enter=\"submitLink\"\n      @keydown.esc=\"$emit('close')\"\n    />\n    <div class=\"shrink-0 flex items-center gap-2\">\n      <Tooltip text=\"Submit\" placement=\"top\">\n        <Button label=\"Submit\" @click=\"submitLink\">\n          <template #icon><LucideCheck class=\"size-4\" /></template>\n        </Button>\n      </Tooltip>\n      <Tooltip text=\"Remove link\" placement=\"top\">\n        <Button label=\"Remove link\" @click=\"$emit('updateHref', '')\">\n          <template #icon><LucideX class=\"size-4\" /></template>\n        </Button>\n      </Tooltip>\n    </div>\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport { onMounted, ref, useTemplateRef, nextTick } from 'vue'\nimport Button from '../Button/Button.vue'\nimport TextInput from '../TextInput/TextInput.vue'\nimport Tooltip from '../Tooltip/Tooltip.vue'\nimport LucideCheck from '~icons/lucide/check'\nimport LucideX from '~icons/lucide/x'\nimport { isValidUrl } from '../../utils/url-validation'\n\nconst props = defineProps<{\n  href: string\n}>()\n\nconst emit = defineEmits<{\n  (e: 'updateHref', href: string): void\n  (e: 'close'): void\n}>()\n\nconst _href = ref(props.href)\nconst input = useTemplateRef('input')\n\nconst submitLink = () => {\n  if (_href.value === '' || isValidUrl(_href.value)) {\n    emit('updateHref', _href.value)\n  }\n}\n\nonMounted(async () => {\n  await nextTick()\n  if (input.value?.el) {\n    input.value.el.focus()\n    input.value.el.select()\n  }\n})\n</script>\n","import { Editor } from '@tiptap/core'\nimport { MarkType } from '@tiptap/pm/model'\nimport { Plugin, PluginKey } from '@tiptap/pm/state'\nimport { isValidUrl } from '../../utils/url-validation'\n\ntype PasteHandlerOptions = {\n  editor: Editor\n  defaultProtocol: string\n  type: MarkType\n}\n\nexport function linkPasteHandler(options: PasteHandlerOptions): Plugin {\n  return new Plugin({\n    key: new PluginKey('handlePasteLink'),\n    props: {\n      handlePaste: (view, event, slice) => {\n        const { state } = view\n        const { selection } = state\n        const { empty } = selection\n\n        if (empty) {\n          return false\n        }\n\n        let textContent = ''\n        slice.content.forEach((node) => {\n          textContent += node.textContent\n        })\n        if (!textContent) {\n          return false\n        }\n\n        let link = isValidUrl(textContent) ? textContent : null\n        if (!link) {\n          return false\n        }\n\n        return options.editor\n          .chain()\n          .setTextSelection({ from: selection.from, to: selection.to })\n          .setLink({ href: link })\n          .setTextSelection(selection.to)\n          .command(({ tr }) => {\n            tr.setStoredMarks([])\n            return true\n          })\n          .run()\n      },\n    },\n  })\n}\n","import { createApp, h } from 'vue'\nimport Link from '@tiptap/extension-link'\nimport tippy, { type Instance as TippyInstance } from 'tippy.js'\nimport { getMarkRange, Range, Editor } from '@tiptap/core'\nimport { MarkType, Mark as ProseMirrorMark } from '@tiptap/pm/model'\nimport { Plugin, PluginKey } from '@tiptap/pm/state'\nimport EditLink from './EditLink.vue'\nimport { linkPasteHandler } from './linkPasteHandler'\n\ndeclare module '@tiptap/core' {\n  interface Commands<ReturnType> {\n    link: {\n      /**\n       * Opens the link editor bubble menu.\n       */\n      openLinkEditor: () => ReturnType\n    }\n  }\n}\n\nexport const LinkExtension = Link.extend({\n  addOptions() {\n    return {\n      ...this.parent?.(),\n      openOnClick: false,\n      autolink: true,\n      defaultProtocol: 'https',\n      linkOnPaste: false,\n    }\n  },\n\n  addCommands() {\n    return {\n      ...this.parent?.(),\n      openLinkEditor:\n        () =>\n        ({ editor }: { editor: Editor }): boolean => {\n          const { state } = editor\n          const { from, to } = state.selection\n          const { doc } = state\n\n          let range: Range | undefined = undefined\n          let mark: ProseMirrorMark | undefined = undefined\n          let shouldDelayPopover = false\n\n          // Check if cursor is within a link or if there's a selection\n          if (from === to) {\n            // Cursor is within a link\n            const $pos = state.selection.$from\n            const markRange = getMarkRange($pos, this.type)\n            if (markRange) {\n              range = markRange\n              mark = doc\n                .resolve(markRange.from)\n                .marks()\n                .find((m) => m.type === this.type)\n\n              // Select the link text\n              editor\n                .chain()\n                .setTextSelection({ from: markRange.from, to: markRange.to })\n                .run()\n              shouldDelayPopover = true\n            } else {\n              // No selection and not within a link, and cursor not in link\n              return false\n            }\n          } else {\n            // There is a selection\n            range = { from, to }\n            // Check if the selection is already a link\n            mark = doc\n              .resolve(from)\n              .marks()\n              .find((m) => m.type === this.type)\n          }\n\n          if (!range) return false\n\n          const existingHref = mark?.attrs.href || ''\n          const selectionFrom = range.from\n          const selectionTo = range.to\n\n          const showPopover = () => {\n            openLinkEditor(existingHref, editor.view.dom)\n              .then((href) => {\n                if (href === null) {\n                  return\n                }\n\n                let chain = editor\n                  .chain()\n                  .focus(null, { scrollIntoView: false })\n\n                if (href === '') {\n                  chain\n                    .setTextSelection({ from: selectionFrom, to: selectionTo })\n                    .unsetLink()\n                    .command(({ tr }) => {\n                      tr.setStoredMarks([])\n                      return true\n                    })\n                    .run()\n                  return\n                }\n\n                chain = chain\n                  .setTextSelection({ from: selectionFrom, to: selectionTo })\n                  .setLink({ href })\n                  .setTextSelection(selectionTo)\n                  .command(({ tr }) => {\n                    tr.setStoredMarks([])\n                    return true\n                  })\n\n                const posAfterLink = selectionTo\n                const charAfter =\n                  posAfterLink < doc.content.size\n                    ? doc.textBetween(posAfterLink, posAfterLink + 1)\n                    : null\n\n                if (charAfter === null || charAfter !== ' ') {\n                  chain = chain.insertContent(' ')\n                }\n\n                chain.run()\n              })\n              .catch(() => {})\n          }\n\n          if (shouldDelayPopover) {\n            requestAnimationFrame(showPopover)\n          } else {\n            showPopover()\n          }\n\n          return true\n        },\n    }\n  },\n\n  addKeyboardShortcuts() {\n    return {\n      'Mod-k': () => this.editor.commands.openLinkEditor(),\n    }\n  },\n\n  addProseMirrorPlugins() {\n    let plugins = this.parent?.() || []\n\n    plugins.push(\n      linkPasteHandler({\n        editor: this.editor,\n        defaultProtocol: this.options.defaultProtocol,\n        type: this.type,\n      }),\n    )\n\n    plugins.push(\n      clearLinkOnBoundaryPlugin({\n        editor: this.editor,\n        type: this.type,\n      }),\n    )\n\n    return plugins\n  },\n})\n\nfunction openLinkEditor(href: string, anchor: HTMLElement): Promise<string> {\n  return new Promise((resolve, reject) => {\n    const container = document.createElement('div')\n    document.body.appendChild(container)\n\n    let virtualReference: {\n      getBoundingClientRect: () => DOMRect | { [key: string]: any }\n    }\n\n    const selection = window.getSelection()\n    if (selection && selection.rangeCount > 0) {\n      const range = selection.getRangeAt(0)\n      const rect = range.getBoundingClientRect()\n      const isCollapsed = range.collapsed\n\n      virtualReference = {\n        getBoundingClientRect: () => ({\n          width: 0,\n          height: rect.height,\n          top: rect.top,\n          right: isCollapsed ? rect.left : rect.right,\n          bottom: rect.bottom,\n          left: rect.left,\n          x: rect.left,\n          y: rect.top,\n          toJSON: () => {},\n        }),\n      }\n    } else {\n      virtualReference = {\n        getBoundingClientRect: () => anchor.getBoundingClientRect(),\n      }\n    }\n\n    let app: ReturnType<typeof createApp> | null = null\n    let tippyInstance: TippyInstance | null = null\n    let isDestroyed = false\n    let promiseSettled = false\n\n    const settlePromise = (action: 'resolve' | 'reject', value?: any) => {\n      if (promiseSettled) return\n      promiseSettled = true\n      if (action === 'resolve') {\n        resolve(value)\n      } else {\n        reject(value)\n      }\n    }\n\n    const destroy = () => {\n      if (isDestroyed) return\n      isDestroyed = true\n\n      settlePromise('reject', 'Link editing cancelled or destroyed')\n\n      requestAnimationFrame(() => {\n        tippyInstance?.destroy()\n        app?.unmount()\n        container?.remove()\n        app = null\n        tippyInstance = null\n      })\n    }\n\n    app = createApp({\n      render() {\n        return h(EditLink, {\n          href,\n          onClose: () => {\n            settlePromise('reject', 'Link editing cancelled')\n            destroy()\n          },\n          onUpdateHref: (newHref: string) => {\n            settlePromise('resolve', newHref)\n            destroy()\n          },\n        })\n      },\n    })\n\n    app.mount(container)\n\n    tippyInstance = tippy(anchor, {\n      getReferenceClientRect: () => virtualReference.getBoundingClientRect(),\n      content: container,\n      trigger: 'manual',\n      interactive: true,\n      appendTo: document.body,\n      placement: 'top',\n      arrow: false,\n      theme: 'link-editor',\n      maxWidth: 'none',\n      onHidden() {\n        destroy()\n      },\n      hideOnClick: true,\n      interactiveDebounce: 75,\n    })\n\n    if (!tippyInstance) {\n      container.remove()\n      settlePromise('reject', 'Failed to initialize link editor tooltip')\n      return\n    }\n\n    tippyInstance.show()\n  })\n}\n\nfunction clearLinkOnBoundaryPlugin(options: {\n  editor: Editor\n  type: MarkType\n}) {\n  return new Plugin({\n    key: new PluginKey('clearLinkMarkOnBoundary'),\n    appendTransaction: (transactions, oldState, newState) => {\n      if (!options.editor.isEditable) {\n        return null\n      }\n\n      const { tr, doc, selection, storedMarks } = newState\n      const { $from, empty } = selection\n\n      if (!empty || !storedMarks || storedMarks.length === 0) {\n        // Only apply for cursor selections and if there are stored marks\n        return null\n      }\n\n      const linkMarkType = options.type\n      const hasStoredLinkMark = storedMarks.some(\n        (mark) => mark.type === linkMarkType,\n      )\n\n      if (!hasStoredLinkMark) {\n        return null\n      }\n\n      // Check if the cursor position itself has an active link mark in the document\n      const marksAtCursor = $from.marks()\n      const activeLinkAtCursor = marksAtCursor.some(\n        (mark) => mark.type === linkMarkType,\n      )\n\n      if (activeLinkAtCursor) {\n        // If there's an actual link mark active in the document at the cursor,\n        // then it's correct for the stored mark to be there.\n        return null\n      }\n\n      // If we are here, it means:\n      // 1. Selection is a cursor (empty).\n      // 2. There's a stored link mark.\n      // 3. There's no active link mark in the document at the cursor position.\n      // This indicates the stored link mark should be cleared.\n      return tr.setStoredMarks([])\n    },\n  })\n}\n\nexport default LinkExtension\n","/**\n * Shared utilities for color conversion and mapping across text editor extensions\n */\n\n// Foreground/text color mappings (tailwind scale 600)\nexport const textColorHexMap: Record<string, string> = {\n  black: '#000000',\n  red: '#dc2626',\n  blue: '#1579D0',\n  green: '#16a34a',\n  yellow: '#ca8a04',\n  orange: '#ea580c',\n  purple: '#9333ea',\n  pink: '#db2777',\n  gray: '#6b7280',\n  indigo: '#4f46e5',\n  teal: '#0d9488',\n  cyan: '#06b6d4',\n}\n\n// Background/highlight color mappings (tailwind scale 100)\nexport const highlightColorHexMap: Record<string, string> = {\n  red: '#fecaca',\n  blue: '#bfdbfe',\n  green: '#bbf7d0',\n  yellow: '#fef08a',\n  orange: '#fed7aa',\n  purple: '#e9d5ff',\n  pink: '#fbcfe8',\n  gray: '#e5e7eb',\n  indigo: '#c7d2fe',\n  teal: '#99f6e4',\n  cyan: '#a5f3fc',\n}\n\n// Legacy color mappings for backward compatibility\nexport const legacyTextColorMap: Record<string, string> = {\n  '#1F272E': 'gray',\n  '#ca8a04': 'yellow',\n  '#ea580c': 'orange',\n  '#dc2626': 'red',\n  '#16a34a': 'green',\n  '#1579D0': 'blue',\n  '#9333ea': 'purple',\n  '#db2777': 'pink',\n}\n\nexport const legacyHighlightColorMap: Record<string, string> = {\n  '#fef9c3': 'yellow',\n  '#ffedd5': 'orange',\n  '#fee2e2': 'red',\n  '#dcfce7': 'green',\n  '#D3E9FC': 'blue',\n  '#f3e8ff': 'purple',\n  '#fce7f3': 'pink',\n}\n\n/**\n * Converts a hex or RGB color to the closest named color from our allowed list\n * @param color - Color to convert (e.g. \"#fee2e2\" or \"rgb(254, 226, 226)\")\n * @param allowedColors - List of allowed color names\n * @param colorMap - Map of color names to hex values to compare against\n * @param legacyMap - Optional legacy color mapping for exact matches\n * @returns The closest named color\n */\nexport function getClosestNamedColor(\n  color: string,\n  allowedColors: string[],\n  colorMap: Record<string, string>,\n  legacyMap?: Record<string, string>,\n): string | null {\n  // Check exact match first for quick returns\n  if (legacyMap && color.startsWith('#') && legacyMap[color]) {\n    return legacyMap[color]\n  }\n\n  // Parse the color to RGB values\n  let r = 0,\n    g = 0,\n    b = 0\n\n  // Handle hex format\n  if (color.startsWith('#')) {\n    const hex = color.substring(1)\n    if (hex.length === 6) {\n      r = parseInt(hex.substring(0, 2), 16)\n      g = parseInt(hex.substring(2, 4), 16)\n      b = parseInt(hex.substring(4, 6), 16)\n    }\n  }\n  // Handle rgb format\n  else if (color.startsWith('rgb')) {\n    const rgbMatch = /rgb\\(\\s*(\\d+)\\s*,\\s*(\\d+)\\s*,\\s*(\\d+)\\s*\\)/i.exec(color)\n    if (rgbMatch) {\n      r = parseInt(rgbMatch[1], 10)\n      g = parseInt(rgbMatch[2], 10)\n      b = parseInt(rgbMatch[3], 10)\n    }\n  }\n\n  // Invalid color format\n  if (isNaN(r) || isNaN(g) || isNaN(b)) {\n    return null\n  }\n\n  let closestColor = null\n  let minDistance = Infinity\n\n  // Find the closest color by calculating the Euclidean distance in RGB space\n  for (const colorName of allowedColors) {\n    const namedHex = colorMap[colorName]\n    if (!namedHex) continue\n\n    const namedHexClean = namedHex.startsWith('#')\n      ? namedHex.substring(1)\n      : namedHex\n\n    if (namedHexClean.length !== 6) continue\n\n    const nr = parseInt(namedHexClean.substring(0, 2), 16)\n    const ng = parseInt(namedHexClean.substring(2, 4), 16)\n    const nb = parseInt(namedHexClean.substring(4, 6), 16)\n\n    // Calculate Euclidean distance\n    const distance = Math.sqrt(\n      Math.pow(r - nr, 2) + Math.pow(g - ng, 2) + Math.pow(b - nb, 2),\n    )\n\n    if (distance < minDistance) {\n      minDistance = distance\n      closestColor = colorName\n    }\n  }\n\n  return closestColor\n}\n\n/**\n * Extracts color from a style attribute and converts it to the closest named color\n * @param style - CSS style string (e.g., \"color: #ff0000; font-weight: bold;\")\n * @param allowedColors - List of allowed color names\n * @param colorMap - Map of color names to hex values\n * @param legacyMap - Optional legacy color mapping\n * @param property - CSS property to extract ('color' or 'background-color')\n * @returns The closest named color or null\n */\nexport function extractColorFromStyle(\n  style: string,\n  allowedColors: string[],\n  colorMap: Record<string, string> = textColorHexMap,\n  legacyMap: Record<string, string> = legacyTextColorMap,\n  property: string = 'color',\n): string | null {\n  const allColorsInMap = Object.keys(colorMap)\n\n  // Check for color in hex format\n  const hexColorMatch = new RegExp(`${property}:\\\\s*(#[0-9a-f]{6})`, 'i').exec(\n    style,\n  )\n  if (hexColorMatch && hexColorMatch[1]) {\n    const closestOverallColor = getClosestNamedColor(\n      hexColorMatch[1],\n      allColorsInMap, // Search in all colors from the map\n      colorMap,\n      legacyMap,\n    )\n    if (closestOverallColor) {\n      // Check if this color is in the originally passed 'allowedColors'\n      if (allowedColors.includes(closestOverallColor)) {\n        if (closestOverallColor === 'gray') {\n          return null // Special handling for gray\n        }\n        return closestOverallColor // It's the closest, allowed, and not gray\n      }\n      // If not in allowedColors, this match is invalid for the current context\n    }\n  }\n\n  // Check for color in rgb format\n  const rgbColorMatch = new RegExp(\n    `${property}:\\\\s*(rgb\\\\(\\\\s*\\\\d+\\\\s*,\\\\s*\\\\d+\\\\s*,\\\\s*\\\\d+\\\\s*\\\\))`,\n    'i',\n  ).exec(style)\n  if (rgbColorMatch && rgbColorMatch[1]) {\n    const closestOverallColor = getClosestNamedColor(\n      rgbColorMatch[1],\n      allColorsInMap, // Search in all colors from the map\n      colorMap,\n      legacyMap,\n    )\n    if (closestOverallColor) {\n      // Check if this color is in the originally passed 'allowedColors'\n      if (allowedColors.includes(closestOverallColor)) {\n        if (closestOverallColor === 'gray') {\n          return null // Special handling for gray\n        }\n        return closestOverallColor // It's the closest, allowed, and not gray\n      }\n      // If not in allowedColors, this match is invalid for the current context\n    }\n  }\n\n  return null\n}\n\n/**\n * Extracts text color from a style attribute\n */\nexport function extractTextColorFromStyle(\n  style: string,\n  allowedColors: string[],\n): string | null {\n  return extractColorFromStyle(\n    style,\n    allowedColors,\n    textColorHexMap,\n    legacyTextColorMap,\n    'color',\n  )\n}\n\n/**\n * Extracts background color from a style attribute for highlights\n */\nexport function extractHighlightColorFromStyle(\n  style: string,\n  allowedColors: string[],\n): string | null {\n  return extractColorFromStyle(\n    style,\n    allowedColors,\n    highlightColorHexMap,\n    legacyHighlightColorMap,\n    'background-color',\n  )\n}\n","import '@tiptap/extension-text-style'\n\nimport { Extension } from '@tiptap/core'\nimport { extractTextColorFromStyle } from '../shared/color-utils'\n\nexport type ColorOptions = {\n  /**\n   * The types where the color can be applied\n   * @default ['textStyle']\n   */\n  types: string[]\n\n  /**\n   * Available color names that can be used\n   * @default ['red', 'blue', 'green', 'yellow', 'orange', 'purple', 'pink', 'gray']\n   */\n  colors: string[]\n}\n\ndeclare module '@tiptap/core' {\n  interface Commands<ReturnType> {\n    namedColor: {\n      /**\n       * Set the text color by name\n       * @param colorName The named color to set (e.g., 'blue', 'red')\n       * @example editor.commands.setColorByName('blue')\n       */\n      setColorByName: (colorName: string) => ReturnType\n\n      /**\n       * Unset the text color\n       * @example editor.commands.unsetColor()\n       */\n      unsetColor: () => ReturnType\n    }\n  }\n}\n\n/**\n * This extension allows you to color your text using named colors instead of hex/rgb values.\n * Colors are applied as data attributes that can be styled with CSS for light/dark mode support.\n */\nexport const NamedColorExtension = Extension.create<ColorOptions>({\n  name: 'namedColor',\n\n  addOptions() {\n    return {\n      types: ['textStyle'],\n      colors: [\n        'red',\n        'blue',\n        'green',\n        'yellow',\n        'orange',\n        'purple',\n        'pink',\n        'gray',\n        'teal',\n        'cyan',\n      ],\n    }\n  },\n\n  addGlobalAttributes() {\n    return [\n      {\n        types: this.options.types,\n        attributes: {\n          color: {\n            default: null,\n            parseHTML: (element) => {\n              // Check for CSS custom property format in style attribute\n              const style = element.getAttribute('style')\n              if (style) {\n                const colorMatch = style.match(\n                  /color:\\s*var\\(--prose-color-(\\w+)\\)/,\n                )\n                if (colorMatch && this.options.colors.includes(colorMatch[1])) {\n                  return colorMatch[1]\n                }\n\n                // Fallback: try extracting from legacy formats\n                const extractedColor = extractTextColorFromStyle(\n                  style,\n                  this.options.colors,\n                )\n                if (extractedColor) {\n                  return extractedColor\n                }\n              }\n\n              return null\n            },\n            renderHTML: (attributes) => {\n              if (\n                !attributes.color ||\n                !this.options.colors.includes(attributes.color)\n              ) {\n                return {}\n              }\n              return {\n                style: `color: var(--prose-color-${attributes.color})`,\n              }\n            },\n          },\n        },\n      },\n    ]\n  },\n\n  addCommands() {\n    return {\n      setColorByName:\n        (colorName: string) =>\n        ({ chain, state, editor }) => {\n          // Validate that the color name is allowed\n          if (!this.options.colors.includes(colorName)) {\n            console.warn(\n              `Color \"${colorName}\" is not in the allowed colors list`,\n            )\n            return false\n          }\n\n          const { to, empty } = state.selection\n\n          let commandChain = chain().setMark('textStyle', { color: colorName })\n\n          if (!empty) {\n            commandChain = commandChain\n              .setTextSelection(to)\n              .command(({ tr }) => {\n                tr.setStoredMarks([])\n                return true\n              })\n          }\n\n          return commandChain.focus().run()\n        },\n      unsetColor:\n        () =>\n        ({ chain }) => {\n          return chain()\n            .setMark('textStyle', { color: null })\n            .removeEmptyTextStyle()\n            .run()\n        },\n    }\n  },\n})\n\nexport { NamedColorExtension as default }\n","import { Mark, mergeAttributes } from '@tiptap/core'\nimport {\n  getClosestNamedColor,\n  highlightColorHexMap,\n  legacyHighlightColorMap,\n  extractHighlightColorFromStyle,\n} from '../shared/color-utils'\n\nexport interface HighlightOptions {\n  /**\n   * HTML tag to wrap the highlighted text\n   * @default 'mark'\n   */\n  HTMLAttributes: Record<string, any>\n\n  /**\n   * Available highlight color names that can be used\n   * @default ['yellow', 'blue', 'green', 'red', 'orange', 'purple', 'pink', 'gray']\n   */\n  colors: string[]\n\n  /**\n   * Enable multiple highlight colors\n   * @default true\n   */\n  multicolor: boolean\n}\n\ndeclare module '@tiptap/core' {\n  interface Commands<ReturnType> {\n    namedHighlight: {\n      /**\n       * Set a highlight by color name\n       * @param colorName The named color to set (e.g., 'yellow', 'blue')\n       * @example editor.commands.setHighlightByName('yellow')\n       */\n      setHighlightByName: (colorName: string) => ReturnType\n      /**\n       * Toggle a highlight by color name\n       * @param colorName The named color to toggle (e.g., 'yellow', 'blue')\n       * @example editor.commands.toggleHighlightByName('yellow')\n       */\n      toggleHighlightByName: (colorName: string) => ReturnType\n      /**\n       * Unset the highlight\n       * @example editor.commands.unsetHighlight()\n       */\n      unsetHighlight: () => ReturnType\n    }\n  }\n}\n\n/**\n * This extension allows you to highlight your text using named colors instead of hex/rgb values.\n * Highlights are applied as data attributes that can be styled with CSS for light/dark mode support.\n */\nexport const NamedHighlightExtension = Mark.create<HighlightOptions>({\n  name: 'namedHighlight',\n\n  addOptions() {\n    return {\n      HTMLAttributes: {},\n      multicolor: true,\n      colors: [\n        'yellow',\n        'blue',\n        'green',\n        'red',\n        'orange',\n        'purple',\n        'pink',\n        'gray',\n        'teal',\n        'cyan',\n      ],\n    }\n  },\n\n  addAttributes() {\n    if (!this.options.multicolor) {\n      return {}\n    }\n\n    return {\n      color: {\n        default: null,\n        parseHTML: (element) => {\n          // Check for CSS custom property format in style attribute\n          const style = element.getAttribute('style')\n          if (style) {\n            const highlightMatch = style.match(\n              /background-color:\\s*var\\(--prose-highlight-(\\w+)\\)/,\n            )\n            if (\n              highlightMatch &&\n              this.options.colors.includes(highlightMatch[1])\n            ) {\n              return highlightMatch[1]\n            }\n          }\n\n          // Check for legacy format with data-color attribute (hex value)\n          const legacyColorAttr = element.getAttribute('data-color')\n          if (legacyColorAttr) {\n            const closestColor = getClosestNamedColor(\n              legacyColorAttr,\n              this.options.colors,\n              highlightColorHexMap,\n              legacyHighlightColorMap,\n            )\n            if (closestColor) {\n              return closestColor\n            }\n          }\n\n          // Try extracting from style attribute as fallback\n          if (style) {\n            const extractedColor = extractHighlightColorFromStyle(\n              style,\n              this.options.colors,\n            )\n            if (extractedColor) {\n              return extractedColor\n            }\n          }\n\n          return null\n        },\n        renderHTML: (attributes) => {\n          if (\n            !attributes.color ||\n            !this.options.colors.includes(attributes.color)\n          ) {\n            return {}\n          }\n\n          return {\n            style: `background-color: var(--prose-highlight-${attributes.color})`,\n          }\n        },\n      },\n    }\n  },\n\n  parseHTML() {\n    return [\n      {\n        tag: 'mark',\n      },\n    ]\n  },\n\n  renderHTML({ HTMLAttributes }) {\n    return [\n      'mark',\n      mergeAttributes(this.options.HTMLAttributes, HTMLAttributes),\n      0,\n    ]\n  },\n\n  addCommands() {\n    return {\n      setHighlightByName:\n        (colorName) =>\n        ({ chain, commands, editor, state }) => {\n          // Validate that the color name is allowed\n          if (!this.options.colors.includes(colorName)) {\n            console.warn(\n              `Highlight color \"${colorName}\" is not in the allowed colors list`,\n            )\n            return false\n          }\n\n          const { from, to, empty } = state.selection // Get original selection details\n\n          let commandChain = chain()\n          if (this.options.multicolor) {\n            commandChain = commandChain.setMark(this.name, { color: colorName })\n          } else {\n            commandChain = commandChain.setMark(this.name)\n          }\n\n          if (!empty) {\n            commandChain = commandChain\n              .setTextSelection(to)\n              .command(({ tr }) => {\n                tr.setStoredMarks([])\n                return true\n              })\n          }\n\n          return commandChain.focus().run()\n        },\n      toggleHighlightByName:\n        (colorName) =>\n        ({ chain, commands, editor, state }) => {\n          // Validate that the color name is allowed\n          if (!this.options.colors.includes(colorName)) {\n            console.warn(\n              `Highlight color \"${colorName}\" is not in the allowed colors list`,\n            )\n            return false\n          }\n\n          const { to, empty } = state.selection // Get original selection details\n          const highlightAttributes = this.options.multicolor\n            ? { color: colorName }\n            : undefined\n\n          // Check if the mark is currently active with the given attributes *before* toggling\n          // This helps determine if the toggle action will be setting or unsetting the mark.\n          const isCurrentlyActive = editor.isActive(\n            this.name,\n            highlightAttributes,\n          )\n\n          let commandChain = chain().toggleMark(this.name, highlightAttributes)\n\n          // If the selection was not empty AND the toggle action is about to *set* the mark\n          // (i.e., it wasn't active before)\n          if (!empty && !isCurrentlyActive) {\n            commandChain = commandChain\n              .setTextSelection(to)\n              .command(({ tr }) => {\n                tr.setStoredMarks([])\n                return true\n              })\n          }\n\n          return commandChain.focus().run()\n        },\n      unsetHighlight:\n        () =>\n        ({ commands }) => {\n          return commands.unsetMark(this.name)\n        },\n    }\n  },\n})\n\nexport { NamedHighlightExtension as default }\n","import { Extension, Editor, Range } from '@tiptap/core'\nimport { VueRenderer } from '@tiptap/vue-3'\nimport Suggestion, {\n  SuggestionOptions,\n  SuggestionProps,\n} from '@tiptap/suggestion'\nimport { PluginKey } from '@tiptap/pm/state'\nimport tippy, { Instance as TippyInstance, Props as TippyProps } from 'tippy.js'\nimport { Component as VueComponent } from 'vue'\n\nexport interface BaseSuggestionItem {\n  title?: string\n  name?: string\n  [key: string]: any\n}\n\nexport interface CreateSuggestionExtensionOptions<\n  TItem extends BaseSuggestionItem,\n> {\n  name: string\n  char: string\n  pluginKey: PluginKey\n  items: (props: {\n    query: string\n    editor: Editor\n  }) => TItem[] | Promise<TItem[]>\n  command: (props: { editor: Editor; range: Range; props: TItem }) => void\n  component: VueComponent\n  tippyOptions?: Partial<TippyProps>\n  allowSpaces?: boolean\n  startOfLine?: boolean\n  decorationTag?: string\n  decorationClass?: string\n  addOptions?: () => Record<string, any>\n}\n\nexport function createSuggestionExtension<TItem extends BaseSuggestionItem>(\n  options: CreateSuggestionExtensionOptions<TItem>,\n) {\n  type ExtensionFullOptions = Record<string, any> & {\n    suggestion: Omit<SuggestionOptions<TItem>, 'editor'>\n  }\n\n  return Extension.create<ExtensionFullOptions>({\n    name: options.name,\n\n    addOptions() {\n      const customOptions = options.addOptions\n        ? options.addOptions.call(this)\n        : {}\n\n      return {\n        ...customOptions,\n        suggestion: {\n          char: options.char,\n          pluginKey: options.pluginKey,\n          items: options.items,\n          command: options.command,\n          allowSpaces: options.allowSpaces,\n          startOfLine: options.startOfLine,\n          decorationTag: options.decorationTag || 'span',\n          decorationClass: options.decorationClass || 'suggestion',\n          render: () => {\n            let component: VueRenderer | null\n            let popup: TippyInstance[] | null\n\n            return {\n              onStart: (props: SuggestionProps<TItem>) => {\n                component = new VueRenderer(options.component, {\n                  editor: props.editor,\n                  props: props,\n                })\n\n                if (!props.clientRect || !component.element) {\n                  return\n                }\n\n                const defaultTippyOptions: Partial<TippyProps> = {\n                  getReferenceClientRect: props.clientRect as () => DOMRect,\n                  appendTo: () => document.body,\n                  content: component.element,\n                  showOnCreate: true,\n                  interactive: true,\n                  trigger: 'manual',\n                  placement: 'bottom-start',\n                }\n\n                popup = tippy('body', {\n                  ...defaultTippyOptions,\n                  ...options.tippyOptions,\n                })\n              },\n\n              onUpdate(props: SuggestionProps<TItem>) {\n                component?.updateProps(props)\n\n                if (!props.clientRect) {\n                  return\n                }\n\n                if (popup && popup[0]) {\n                  popup[0].setProps({\n                    getReferenceClientRect: props.clientRect as () => DOMRect,\n                  })\n                }\n              },\n\n              onKeyDown(props: { event: KeyboardEvent }): boolean {\n                if (props.event.key === 'Escape') {\n                  if (popup && popup[0]) {\n                    popup[0].hide()\n                  }\n                  return true\n                }\n\n                if (\n                  component &&\n                  component.ref &&\n                  typeof (component.ref as any).onKeyDown === 'function'\n                ) {\n                  return (component.ref as any).onKeyDown(props)\n                }\n                return false\n              },\n\n              onExit() {\n                if (popup && popup[0]) {\n                  popup[0].destroy()\n                }\n                if (component) {\n                  component.destroy()\n                }\n                popup = null\n                component = null\n              },\n            }\n          },\n        } as Omit<SuggestionOptions<TItem>, 'editor'>,\n      }\n    },\n\n    addProseMirrorPlugins() {\n      return [\n        Suggestion<TItem>({\n          editor: this.editor,\n          ...this.options.suggestion,\n        }),\n      ]\n    },\n  })\n}\n","<template>\n  <div\n    v-if=\"items.length\"\n    ref=\"container\"\n    class=\"relative max-h-[300px] min-w-40 overflow-y-auto rounded-lg bg-surface-white p-1 text-base shadow-lg\"\n    :class=\"containerClass\"\n  >\n    <button\n      v-for=\"(item, index) in items\"\n      :key=\"index\"\n      :ref=\"\n        (el) => {\n          if (el) itemRefs[index] = el as HTMLButtonElement\n        }\n      \"\n      :class=\"[\n        'flex w-full items-center whitespace-nowrap rounded-md px-2 py-1.5 text-sm text-ink-gray-9',\n        index === selectedIndex ? 'bg-surface-gray-2' : '',\n        itemClass,\n      ]\"\n      @click=\"selectItem(index)\"\n      @mouseover=\"selectedIndex = index\"\n    >\n      <slot :item=\"item\" :index=\"index\">\n        <span>{{ item.display || item.title || item.name }}</span>\n      </slot>\n    </button>\n    <div\n      v-if=\"!items.length && showNoResults\"\n      class=\"px-3 py-1.5 text-sm text-ink-gray-5\"\n    >\n      No results\n    </div>\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport { ref, watch, type PropType, nextTick, onBeforeUpdate } from 'vue'\nimport type { BaseSuggestionItem } from './createSuggestionExtension'\n\nconst props = defineProps({\n  items: {\n    type: Array as PropType<BaseSuggestionItem[]>,\n    required: true,\n  },\n  command: {\n    type: Function as PropType<(item: BaseSuggestionItem) => void>,\n    required: true,\n  },\n  containerClass: {\n    type: String,\n    default: '',\n  },\n  itemClass: {\n    type: String,\n    default: '',\n  },\n  showNoResults: {\n    type: Boolean,\n    default: false,\n  },\n})\n\nconst selectedIndex = ref(0)\nconst container = ref<HTMLDivElement | null>(null)\nconst itemRefs = ref<HTMLButtonElement[]>([])\n\nonBeforeUpdate(() => {\n  itemRefs.value = []\n})\n\nconst scrollIntoView = () => {\n  nextTick(() => {\n    const selectedElement = itemRefs.value[selectedIndex.value]\n    if (selectedElement) {\n      selectedElement.scrollIntoView({ block: 'nearest' })\n    }\n  })\n}\n\nconst selectItem = (index: number) => {\n  const item = props.items[index]\n  if (item) {\n    props.command(item)\n  }\n}\n\nconst onKeyDown = ({ event }: { event: KeyboardEvent }) => {\n  if (!props.items.length) return false\n\n  if (event.key === 'ArrowUp') {\n    upHandler()\n    return true\n  }\n  if (event.key === 'ArrowDown') {\n    downHandler()\n    return true\n  }\n  if (event.key === 'Enter') {\n    enterHandler()\n    return true\n  }\n  return false\n}\n\nconst upHandler = () => {\n  selectedIndex.value =\n    (selectedIndex.value + props.items.length - 1) % props.items.length\n  scrollIntoView()\n}\n\nconst downHandler = () => {\n  selectedIndex.value = (selectedIndex.value + 1) % props.items.length\n  scrollIntoView()\n}\n\nconst enterHandler = () => {\n  selectItem(selectedIndex.value)\n}\n\nwatch(\n  () => props.items,\n  () => {\n    selectedIndex.value = 0\n  },\n)\n\ndefineExpose({\n  onKeyDown,\n})\n</script>\n","import { MaybeRefOrGetter, toValue, type Component } from 'vue'\nimport { Extension, Node, mergeAttributes } from '@tiptap/core'\nimport { VueNodeViewRenderer } from '@tiptap/vue-3'\nimport { PluginKey } from '@tiptap/pm/state'\nimport {\n  createSuggestionExtension,\n  BaseSuggestionItem,\n} from '../suggestion/createSuggestionExtension'\nimport SuggestionList from '../suggestion/SuggestionList.vue'\nimport './style.css'\n\nexport interface MentionSuggestionItem extends BaseSuggestionItem {\n  id: string\n  label: string\n  value?: string\n  email?: string\n  full_name?: string\n}\n\nfunction createMentionNode(component?: Component) {\n  const config: any = {\n    name: 'mention',\n    group: 'inline',\n    inline: true,\n    selectable: true,\n    atom: true,\n\n    addOptions() {\n      return {\n        component: undefined,\n      }\n    },\n\n    addAttributes() {\n      return {\n        id: {\n          default: null,\n          parseHTML: (element: HTMLElement) => element.getAttribute('data-id'),\n          renderHTML: (attributes: any) => {\n            if (!attributes.id) {\n              return {}\n            }\n            return { 'data-id': attributes.id }\n          },\n        },\n        label: {\n          default: null,\n          parseHTML: (element: HTMLElement) =>\n            element.getAttribute('data-label'),\n          renderHTML: (attributes: any) => {\n            if (!attributes.label) {\n              return {}\n            }\n            return { 'data-label': attributes.label }\n          },\n        },\n      }\n    },\n\n    parseHTML() {\n      return [\n        {\n          tag: 'span.mention[data-type=\"mention\"]',\n          getAttrs: (dom: any) => {\n            const element = dom as HTMLElement\n            return {\n              id: element.getAttribute('data-id'),\n              label: element.getAttribute('data-label'),\n            }\n          },\n        },\n      ]\n    },\n\n    renderHTML({ HTMLAttributes }: any) {\n      return [\n        'span',\n        mergeAttributes(HTMLAttributes, {\n          class: 'mention',\n          'data-type': 'mention',\n        }),\n        `@${HTMLAttributes['data-label'] || HTMLAttributes.id || ''}`,\n      ]\n    },\n  }\n\n  if (component) {\n    config.addNodeView = () => {\n      return VueNodeViewRenderer(component)\n    }\n  }\n\n  return Node.create(config)\n}\n\nconst MentionSuggestionExtension =\n  createSuggestionExtension<MentionSuggestionItem>({\n    name: 'mentionSuggestion',\n    char: '@',\n    pluginKey: new PluginKey('mentionSuggestion'),\n    component: SuggestionList,\n\n    addOptions() {\n      return {\n        mentions: [],\n      }\n    },\n\n    items: ({ query, editor }) => {\n      const { mentions: _mentions } = editor.extensionManager.extensions.find(\n        (ext) => ext.name === 'mentionSuggestion',\n      )!.options\n      const mentions = toValue(_mentions)\n\n      const filtered = mentions\n        .filter((mention: MentionSuggestionItem) =>\n          mention.label.toLowerCase().startsWith(query.toLowerCase()),\n        )\n        .slice(0, 10)\n        .map((mention: MentionSuggestionItem) => ({\n          ...mention,\n          display: mention.label,\n        }))\n\n      return filtered\n    },\n\n    command: ({ editor, range, props }) => {\n      const attributes = {\n        id: props.id || props.value,\n        label: props.label,\n      }\n\n      editor\n        .chain()\n        .focus()\n        .insertContentAt(range, [\n          {\n            type: 'mention',\n            attrs: attributes,\n          },\n          {\n            type: 'text',\n            text: ' ',\n          },\n        ])\n        .run()\n    },\n\n    tippyOptions: {\n      placement: 'bottom-start',\n      offset: [0, 8],\n    },\n    allowSpaces: false,\n    decorationTag: 'span',\n    decorationClass: 'mention-suggestion-active',\n  })\n\nexport const MentionExtension = Extension.create<{\n  mentions: MaybeRefOrGetter<MentionSuggestionItem[]>\n  component?: Component\n}>({\n  name: 'mentionExtension',\n\n  addOptions() {\n    return {\n      mentions: [],\n      component: undefined,\n    }\n  },\n\n  addExtensions() {\n    return [\n      createMentionNode(this.options.component),\n      MentionSuggestionExtension.configure({\n        mentions: this.options.mentions,\n      }),\n    ]\n  },\n})\n","<template>\n  <SuggestionList\n    ref=\"suggestionList\"\n    :items=\"items\"\n    :command=\"(item) => onItemSelect(item as EmojiItem)\"\n    item-class=\"py-2\"\n  >\n    <template #default=\"{ item }\">\n      <span class=\"mr-2\">{{ item.emoji }}</span>\n      <span>{{ item.name }}</span>\n    </template>\n  </SuggestionList>\n</template>\n\n<script setup lang=\"ts\">\nimport { ref, type PropType } from 'vue'\nimport SuggestionList from '../suggestion/SuggestionList.vue'\nimport type { Editor, Range } from '@tiptap/core'\nimport type { EmojiItem } from './emoji-extension'\n\nconst props = defineProps({\n  items: {\n    type: Array as PropType<EmojiItem[]>,\n    required: true,\n  },\n  editor: {\n    type: Object as PropType<Editor>,\n    required: true,\n  },\n  range: {\n    type: Object as PropType<Range>,\n    required: true,\n  },\n  command: {\n    type: Function as PropType<(item: EmojiItem) => void>,\n    required: true,\n  },\n})\n\nconst suggestionList = ref<InstanceType<typeof SuggestionList> | null>(null)\n\nconst onItemSelect = (item: EmojiItem) => {\n  if (item) {\n    props.command(item)\n  }\n}\n\nconst onKeyDown = ({ event }: { event: KeyboardEvent }) => {\n  return suggestionList.value?.onKeyDown({ event }) ?? false\n}\n\ndefineExpose({\n  onKeyDown,\n})\n</script>\n","import { PluginKey } from '@tiptap/pm/state'\nimport {\n  BaseSuggestionItem,\n  createSuggestionExtension,\n} from '../suggestion/createSuggestionExtension'\nimport EmojiList from './EmojiList.vue'\nimport _EMOJIS from './emojis.json'\n\nconst EMOJIS = _EMOJIS as EmojiItem[]\n\nexport interface EmojiItem extends BaseSuggestionItem {\n  name: string\n  emoji: string\n}\n\nexport default createSuggestionExtension<EmojiItem>({\n  name: 'emoji',\n  char: ':',\n  pluginKey: new PluginKey('emojiSuggestion'),\n  items: ({ query }: { query: string }) => {\n    return EMOJIS.filter((item) =>\n      item.name.toLowerCase().includes(query.toLowerCase()),\n    )\n      .sort((a, b) => {\n        const aName = a.name.toLowerCase()\n        const bName = b.name.toLowerCase()\n        const queryLower = query.toLowerCase()\n\n        // Exact matches first\n        if (aName === queryLower && bName !== queryLower) return -1\n        if (bName === queryLower && aName !== queryLower) return 1\n\n        // Then names starting with the query\n        if (aName.startsWith(queryLower) && !bName.startsWith(queryLower))\n          return -1\n        if (bName.startsWith(queryLower) && !aName.startsWith(queryLower))\n          return 1\n\n        // Then sort by name length (shorter first)\n        return aName.length - bName.length\n      })\n      .slice(0, 5)\n  },\n  command: ({ editor, range, props: item }) => {\n    if (item && item.emoji) {\n      editor.chain().focus().deleteRange(range).insertContent(item.emoji).run()\n    } else {\n      console.error(\n        'Emoji command execution error: emoji property not found on selected item or item is invalid.',\n        item,\n      )\n    }\n  },\n  component: EmojiList,\n})\n","<template>\n  <SuggestionList\n    ref=\"suggestionList\"\n    :items=\"props.items\"\n    :command=\"(item) => onItemSelect(item as CommandItem)\"\n    container-class=\"min-w-48\"\n    item-class=\"h-7\"\n    :show-no-results=\"true\"\n  >\n    <template #default=\"{ item }\">\n      <component :is=\"item.icon\" v-if=\"item.icon\" class=\"mr-2 h-4 w-4\" />\n      <div v-else class=\"mr-2 h-4 w-4\"></div>\n      <span>{{ item.title }}</span>\n    </template>\n  </SuggestionList>\n</template>\n\n<script setup lang=\"ts\">\nimport { ref, type PropType } from 'vue'\nimport SuggestionList from '../suggestion/SuggestionList.vue'\nimport type { Editor, Range } from '@tiptap/core'\nimport type { CommandItem } from './slash-commands-extension'\n\nconst props = defineProps({\n  items: {\n    type: Array as PropType<CommandItem[]>,\n    required: true,\n  },\n  editor: {\n    type: Object as PropType<Editor>,\n    required: true,\n  },\n  range: {\n    type: Object as PropType<Range>,\n    required: true,\n  },\n  command: {\n    type: Function as PropType<(item: CommandItem) => void>,\n    required: true,\n  },\n  query: String,\n})\n\nconst suggestionList = ref<InstanceType<typeof SuggestionList> | null>(null)\n\nconst onItemSelect = (item: CommandItem) => {\n  if (item) {\n    props.command(item)\n  }\n}\n\nconst onKeyDown = ({ event }: { event: KeyboardEvent }) => {\n  return suggestionList.value?.onKeyDown({ event }) ?? false\n}\n\ndefineExpose({\n  onKeyDown,\n})\n</script>\n","import { Editor, Range } from '@tiptap/core'\nimport { PluginKey } from '@tiptap/pm/state'\nimport {\n  createSuggestionExtension,\n  type BaseSuggestionItem,\n} from '../suggestion/createSuggestionExtension'\nimport SlashCommandsList from './SlashCommandsList.vue'\nimport { Component as VueComponent } from 'vue'\n\nimport Heading2 from '~icons/lucide/heading-2'\nimport Heading3 from '~icons/lucide/heading-3'\nimport List from '~icons/lucide/list'\nimport ListOrdered from '~icons/lucide/list-ordered'\nimport ListTask from '~icons/lucide/list-checks'\nimport Code from '~icons/lucide/code'\nimport Quote from '~icons/lucide/quote'\nimport Image from '~icons/lucide/image'\nimport Video from '~icons/lucide/video'\nimport GalleryVertical from '~icons/lucide/gallery-vertical'\nimport Link from '~icons/lucide/link'\nimport Minus from '~icons/lucide/minus'\nimport Table from '~icons/lucide/table-2'\n\nexport const SlashCommandSuggestionKey = new PluginKey<any>(\n  'slashCommandSuggestion',\n)\n\nexport interface CommandItem extends BaseSuggestionItem {\n  title: string\n  icon: VueComponent\n  command: (props: CommandExecutionProps) => void\n}\n\ntype CommandExecutionProps = {\n  editor: Editor\n  range: Range\n}\n\nconst getCommands = (): CommandItem[] => [\n  {\n    title: 'Heading 2',\n    icon: Heading2,\n    command: ({ editor, range }: CommandExecutionProps) => {\n      editor\n        .chain()\n        .focus()\n        .deleteRange(range)\n        .setNode('heading', { level: 2 })\n        .run()\n    },\n  },\n  {\n    title: 'Heading 3',\n    icon: Heading3,\n    command: ({ editor, range }: CommandExecutionProps) => {\n      editor\n        .chain()\n        .focus()\n        .deleteRange(range)\n        .setNode('heading', { level: 3 })\n        .run()\n    },\n  },\n  {\n    title: 'Bullet List',\n    icon: List,\n    command: ({ editor, range }: CommandExecutionProps) => {\n      editor.chain().focus().deleteRange(range).toggleBulletList().run()\n    },\n  },\n  {\n    title: 'Numbered List',\n    icon: ListOrdered,\n    command: ({ editor, range }: CommandExecutionProps) => {\n      editor.chain().focus().deleteRange(range).toggleOrderedList().run()\n    },\n  },\n  {\n    title: 'Task List',\n    icon: ListTask,\n    command: ({ editor, range }: CommandExecutionProps) => {\n      editor.chain().focus().deleteRange(range).toggleTaskList().run()\n    },\n  },\n  {\n    title: 'Code Block',\n    icon: Code,\n    command: ({ editor, range }: CommandExecutionProps) => {\n      editor.chain().focus().deleteRange(range).toggleCodeBlock().run()\n    },\n  },\n  {\n    title: 'Blockquote',\n    icon: Quote,\n    command: ({ editor, range }: CommandExecutionProps) => {\n      editor.chain().focus().deleteRange(range).toggleBlockquote().run()\n    },\n  },\n  {\n    title: 'Image',\n    icon: Image,\n    command: ({ editor, range }: CommandExecutionProps) => {\n      editor.chain().focus().deleteRange(range).selectAndUploadImage().run()\n    },\n  },\n  {\n    title: 'Video',\n    icon: Video,\n    command: ({ editor, range }: CommandExecutionProps) => {\n      editor.chain().focus().deleteRange(range).selectAndUploadVideo().run()\n    },\n  },\n  {\n    title: 'Embed',\n    icon: GalleryVertical,\n    command: ({ editor, range }: CommandExecutionProps) => {\n      editor.chain().focus().deleteRange(range).openIframeDialog().run()\n    },\n  },\n  {\n    title: 'Link',\n    icon: Link,\n    command: ({ editor, range }: CommandExecutionProps) => {\n      editor.chain().focus().deleteRange(range).setLink({ href: '' }).run()\n    },\n  },\n  {\n    title: 'Horizontal Rule',\n    icon: Minus,\n    command: ({ editor, range }: CommandExecutionProps) => {\n      editor.chain().focus().deleteRange(range).setHorizontalRule().run()\n    },\n  },\n  {\n    title: 'Table',\n    icon: Table,\n    command: ({ editor, range }: CommandExecutionProps) => {\n      editor\n        .chain()\n        .focus()\n        .deleteRange(range)\n        .insertTable({ rows: 3, cols: 3, withHeaderRow: true })\n        .run()\n    },\n  },\n]\n\nexport const SlashCommands = createSuggestionExtension<CommandItem>({\n  name: 'slashCommands',\n  char: '/',\n  pluginKey: SlashCommandSuggestionKey,\n  items: ({ query }) => {\n    const commands = getCommands()\n    return commands.filter((item) =>\n      item.title.toLowerCase().startsWith(query.toLowerCase()),\n    )\n  },\n  command: ({ editor, range, props: item }) => {\n    if (item && typeof item.command === 'function') {\n      item.command({ editor, range })\n    } else {\n      console.error(\n        'Slash command execution error: command function not found on selected item or item is invalid.',\n        item,\n      )\n    }\n  },\n  component: SlashCommandsList,\n})\n\nexport default SlashCommands\n","import { marked } from 'marked'\n\nexport function markdownToHTML(text: string): string {\n  // Use synchronous marked.parse\n  return marked.parse(text, {\n    gfm: true,\n    breaks: true,\n    async: false,\n  }) as string\n}\n\nexport function detectMarkdown(text: string): boolean {\n  const lines = text.split('\\n')\n  const markdown = lines.filter(\n    (line) =>\n      // check for inline markdown content like images, links, italic, bold, etc.\n      /!\\[.*\\]\\(.*\\)/.test(line) ||\n      /\\[.*\\]\\(.*\\)/.test(line) ||\n      /(^|\\s)\\*.*\\*(\\s|$)/.test(line) ||\n      /(^|\\s)_.*_(\\s|$)/.test(line) ||\n      /(^|\\s)\\*\\*.*\\*\\*(\\s|$)/.test(line) ||\n      /(^|\\s)__.*__(\\s|$)/.test(line) ||\n      /(^|\\s)~~.*~~(\\s|$)/.test(line) ||\n      // check for block markdown content like headings, code blocks, lists, etc.\n      line.startsWith('![') ||\n      line.startsWith('#') ||\n      line.startsWith('> ') ||\n      line.startsWith('*') ||\n      line.startsWith('- ') ||\n      line.startsWith('1. ') ||\n      line.startsWith('```') ||\n      line.startsWith('`') ||\n      line.startsWith('[') ||\n      line.startsWith('---'),\n  )\n  return markdown.length > 0\n}\n","import { Extension } from '@tiptap/core'\nimport { Plugin, PluginKey } from '@tiptap/pm/state'\nimport { DOMParser } from '@tiptap/pm/model'\nimport { EditorView } from '@tiptap/pm/view'\nimport { detectMarkdown, markdownToHTML } from '../../../utils/markdown'\nimport { processMultipleImages } from './image/image-extension'\n\nexport interface ContentPasteOptions {\n  enabled: boolean\n  showConfirmation: boolean\n  uploadFunction: Function | null\n}\n\nexport const ContentPasteExtension = Extension.create<ContentPasteOptions>({\n  name: 'contentPaste',\n\n  addOptions() {\n    return {\n      enabled: true,\n      showConfirmation: true,\n      uploadFunction: null,\n    }\n  },\n\n  addProseMirrorPlugins() {\n    const extensionThis = this\n    return [\n      new Plugin({\n        key: new PluginKey('contentPaste'),\n        props: {\n          handlePaste: (\n            view: EditorView,\n            event: ClipboardEvent,\n            slice: any,\n          ) => {\n            if (!this.options.enabled) return false\n\n            // handle image pasting\n            const files: File[] | [] = Array.from(\n              event.clipboardData?.files || [],\n            )\n            const images = Array.from(files).filter((file) =>\n              file.type.startsWith('image/'),\n            )\n            if (images.length > 0) {\n              processMultipleImages(images, view, null, extensionThis.options)\n              return true\n            }\n\n            // handle markdown pasting\n            const text = event.clipboardData?.getData('text/plain')\n            if (!text) return false\n\n            if (!detectMarkdown(text)) return false\n\n            if (this.options.showConfirmation) {\n              const shouldConvert = confirm(\n                'Do you want to convert markdown content to HTML before pasting?',\n              )\n              if (!shouldConvert) return false\n            }\n\n            const htmlContent = markdownToHTML(text)\n            const tempDiv = document.createElement('div')\n            tempDiv.innerHTML = htmlContent\n\n            const parser = DOMParser.fromSchema(view.state.schema)\n            const parsedSlice = parser.parseSlice(tempDiv, {\n              preserveWhitespace: true,\n            })\n\n            const tr = view.state.tr.replaceSelection(parsedSlice)\n            view.dispatch(tr)\n\n            return true\n          },\n        },\n      }),\n    ]\n  },\n})\n","import { Node, mergeAttributes, Range, Editor } from '@tiptap/core'\nimport { PluginKey } from '@tiptap/pm/state'\nimport {\n  createSuggestionExtension,\n  BaseSuggestionItem,\n} from '../suggestion/createSuggestionExtension'\nimport SuggestionList from '../suggestion/SuggestionList.vue'\nimport { toValue, unref } from 'vue'\n\nexport const TagNode = Node.create({\n  name: 'tagItem',\n  group: 'inline',\n  inline: true,\n  selectable: true,\n  atom: true,\n\n  addAttributes() {\n    return {\n      tagId: {\n        default: null,\n        parseHTML: (element) => element.getAttribute('data-tag-id'),\n        renderHTML: (attributes) => {\n          if (!attributes.tagId) {\n            return {}\n          }\n          return { 'data-tag-id': attributes.tagId }\n        },\n      },\n      tagLabel: {\n        default: 'tag',\n        parseHTML: (element) => element.getAttribute('data-tag-label'),\n        renderHTML: (attributes) => ({ 'data-tag-label': attributes.tagLabel }),\n      },\n    }\n  },\n\n  parseHTML() {\n    return [\n      {\n        tag: 'span.tag-item',\n        getAttrs: (dom) => {\n          const element = dom as HTMLElement\n          return {\n            tagId: element.getAttribute('data-tag-id'),\n            tagLabel:\n              element.getAttribute('data-tag-label') ||\n              element.innerText.replace(/^#/, ''),\n          }\n        },\n      },\n    ]\n  },\n\n  renderHTML({ HTMLAttributes }) {\n    // HTMLAttributes will include data-tag-id and data-tag-label\n    return [\n      'span',\n      mergeAttributes(HTMLAttributes, { class: 'tag-item' }),\n      `#${HTMLAttributes['data-tag-label']}`,\n    ]\n  },\n\n  addCommands() {\n    return {\n      setTag:\n        (attributes: { tagLabel: string; tagId?: string }) =>\n        ({ commands }) => {\n          return commands.insertContent({\n            type: this.name,\n            attrs: attributes,\n          })\n        },\n    }\n  },\n})\n\ninterface TagSuggestionItem extends BaseSuggestionItem {\n  name?: string\n  label: string\n  isNew?: boolean\n}\n\nexport const TagExtension = createSuggestionExtension<TagSuggestionItem>({\n  name: 'tagSuggestion',\n  char: '#',\n  pluginKey: new PluginKey('tagSuggestion'),\n  component: SuggestionList,\n\n  addOptions() {\n    return {\n      tags: [],\n    }\n  },\n\n  items: ({ query, editor }) => {\n    const { tags: _tags } = editor.extensionManager.extensions.find(\n      (ext) => ext.name === 'tagSuggestion',\n    )!.options\n    let tags = toValue(_tags)\n\n    // Filter existing tags based on the query\n    let filteredTags = tags\n      .filter((tag: TagSuggestionItem) =>\n        tag.label.toLowerCase().startsWith(query.toLowerCase()),\n      )\n      .map((tag: TagSuggestionItem) => ({ ...tag, display: tag.label }))\n\n    if (\n      query.length > 0 &&\n      !tags.some(\n        (tag: TagSuggestionItem) =>\n          tag.label.toLowerCase() === query.toLowerCase(),\n      )\n    ) {\n      filteredTags.push({\n        display: `New tag: \"${query}\"`,\n        label: query,\n        isNew: true,\n      })\n    }\n    return filteredTags\n  },\n\n  command: ({ editor, range, props }) => {\n    const attributes = {\n      tagLabel: props.label,\n      ...(props.id && !props.isNew && { tagId: props.id }),\n    }\n\n    editor\n      .chain()\n      .focus()\n      .insertContentAt(range, [\n        {\n          type: TagNode.name,\n          attrs: attributes,\n        },\n        {\n          type: 'text',\n          text: ' ',\n        },\n      ])\n      .run()\n  },\n\n  tippyOptions: {\n    placement: 'bottom-start',\n    offset: [0, 8],\n  },\n  allowSpaces: false,\n  decorationTag: 'span',\n  decorationClass: 'tag-suggestion-active',\n})\n","import TiptapHeading from '@tiptap/extension-heading'\nimport { textblockTypeInputRule } from '@tiptap/core'\n\n// This custom Heading extension modifies the default input rule behavior.\n// The default Tiptap heading input rule converts text to a heading when '#' is followed by any whitespace (including Enter).\n// This customization ensures that headings are only created when '#' is followed by a literal space.\n// This change is necessary to prevent conflicts with other extensions, such as a tags extension,\n// which uses '#' followed by Enter to add a tag.\nexport const Heading = TiptapHeading.extend({\n  addInputRules() {\n    return this.options.levels.map((level) => {\n      let regexp = new RegExp(`^(#{${level}}) $`)\n      return textblockTypeInputRule({\n        find: regexp,\n        type: this.type,\n        getAttributes: { level },\n      })\n    })\n  },\n})\n","<template>\n  <Dialog\n    v-model=\"modelValue\"\n    :options=\"{\n      title: props.mode === 'edit' ? 'Edit Images' : 'Upload Images',\n      size: '3xl',\n    }\"\n    @close=\"$emit('close')\"\n    :disableOutsideClickToClose=\"true\"\n  >\n    <template #body-content>\n      <div class=\"space-y-2\">\n        <div class=\"flex items-center gap-2\">\n          <Button @click=\"triggerFileInput\">\n            <template #prefix>\n              <LucideImagePlus class=\"size-4\" />\n            </template>\n            Add images\n          </Button>\n          <Select\n            id=\"columns-select\"\n            :options=\"selectOptions\"\n            v-model=\"internalColumns\"\n            size=\"sm\"\n            variant=\"subtle\"\n            class=\"w-28\"\n            @update:modelValue=\"(val) => (columns = +val)\"\n          />\n        </div>\n        <div\n          v-if=\"images && images.length\"\n          class=\"grid gap-px mb-4\"\n          :style=\"gridStyle\"\n        >\n          <div\n            v-for=\"(item, idx) in images\"\n            :key=\"item.id\"\n            class=\"relative aspect-square w-full h-full overflow-hidden group bg-surface-white\"\n            :draggable=\"true\"\n            @dragstart=\"onDragStart(idx)\"\n            @dragover=\"onDragOver($event, idx)\"\n            @drop=\"onDrop($event)\"\n            @dragend=\"onDragEnd\"\n            @dragleave=\"onDragLeave($event, idx)\"\n            :class=\"{ 'ring-2 ring-primary-400 z-10': isDropTarget(idx) }\"\n          >\n            <button\n              type=\"button\"\n              class=\"absolute top-1 right-1 z-10 bg-white/80 hover:bg-white rounded-full p-1 shadow transition-opacity opacity-0 group-hover:opacity-100 focus:opacity-100\"\n              aria-label=\"Remove image\"\n              @click.stop=\"removeImage(idx)\"\n            >\n              <LucideX class=\"w-4 h-4 text-gray-700\" />\n            </button>\n\n            <!-- Existing images from edit mode -->\n            <template v-if=\"item.type === 'existing'\">\n              <img\n                :src=\"item.existing?.src\"\n                :alt=\"item.existing?.alt || ''\"\n                class=\"object-cover w-full h-full rounded-[2px]\"\n              />\n              <!-- Caption overlay -->\n              <div\n                class=\"absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/60 to-transparent rounded-b-[2px] transition-opacity\"\n                :class=\"\n                  editingCaption === `${item.type}-${idx}`\n                    ? 'opacity-100'\n                    : 'opacity-0 group-hover:opacity-100'\n                \"\n              >\n                <div\n                  v-if=\"editingCaption !== `${item.type}-${idx}`\"\n                  class=\"p-2 cursor-pointer\"\n                  @click.stop=\"\n                    startEditingCaption(\n                      `${item.type}-${idx}`,\n                      item.existing?.alt || '',\n                    )\n                  \"\n                >\n                  <div\n                    class=\"text-white text-xs truncate\"\n                    :title=\"item.existing?.alt || 'Click to add caption'\"\n                  >\n                    {{ item.existing?.alt || 'Add caption...' }}\n                  </div>\n                </div>\n                <div v-else class=\"p-2\" @click.stop>\n                  <input\n                    :ref=\"(el) => (captionInputRef = el as HTMLInputElement)\"\n                    v-model=\"captionEditValue\"\n                    @blur=\"handleCaptionBlur(`${item.type}-${idx}`, idx)\"\n                    @keydown.enter.prevent=\"\n                      saveCaption(`${item.type}-${idx}`, idx)\n                    \"\n                    @keydown.escape=\"cancelEditingCaption\"\n                    class=\"w-full text-xs bg-white/90 text-gray-900 px-1 py-0.5 rounded-sm border-none outline-none\"\n                    placeholder=\"Add caption...\"\n                    maxlength=\"200\"\n                  />\n                </div>\n              </div>\n            </template>\n\n            <!-- New file uploads -->\n            <template v-else-if=\"item.type === 'file' && item.file\">\n              <template v-if=\"!isImageSupported(item.file)\">\n                <div\n                  class=\"flex flex-col items-center justify-center w-full h-full text-ink-gray-4 bg-surface-gray-1 rounded-[2px]\"\n                >\n                  <span\n                    class=\"text-p-xs text-ink-gray-4 w-full text-center px-2 mt-1\"\n                    :title=\"item.file.name\"\n                  >\n                    {{ item.file.name }}\n                  </span>\n                </div>\n              </template>\n              <template v-else-if=\"item.file.type.startsWith('image/')\">\n                <img\n                  :src=\"filePreview(item.file)\"\n                  class=\"object-cover w-full h-full rounded-[2px]\"\n                  :alt=\"item.alt || ''\"\n                />\n                <!-- Caption overlay -->\n                <div\n                  class=\"absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/60 to-transparent rounded-b-[2px] transition-opacity\"\n                  :class=\"\n                    editingCaption === `${item.type}-${idx}`\n                      ? 'opacity-100'\n                      : 'opacity-0 group-hover:opacity-100'\n                  \"\n                >\n                  <div\n                    v-if=\"editingCaption !== `${item.type}-${idx}`\"\n                    class=\"p-2 cursor-pointer\"\n                    @click.stop=\"\n                      startEditingCaption(`${item.type}-${idx}`, item.alt || '')\n                    \"\n                  >\n                    <div\n                      class=\"text-white text-xs truncate\"\n                      :title=\"item.alt || 'Click to add caption'\"\n                    >\n                      {{ item.alt || 'Add caption...' }}\n                    </div>\n                  </div>\n                  <div v-else class=\"p-2\" @click.stop>\n                    <input\n                      ref=\"captionInput\"\n                      v-model=\"captionEditValue\"\n                      @blur=\"handleCaptionBlur(`${item.type}-${idx}`, idx)\"\n                      @keydown.enter.prevent=\"\n                        saveCaption(`${item.type}-${idx}`, idx)\n                      \"\n                      @keydown.escape=\"cancelEditingCaption\"\n                      class=\"w-full text-xs bg-white/90 text-gray-900 px-1 py-0.5 rounded border-none outline-none\"\n                      placeholder=\"Add caption...\"\n                      maxlength=\"200\"\n                    />\n                  </div>\n                </div>\n              </template>\n            </template>\n          </div>\n        </div>\n        <div v-if=\"images && images.length\" class=\"text-p-sm text-ink-gray-5\">\n          Upload more images by dropping them anywhere in this window. Reorder\n          images by dragging them. Hover over an image to edit caption.\n        </div>\n        <div\n          v-else\n          class=\"flex flex-col items-center justify-center min-h-[200px]\"\n        >\n          <div\n            class=\"w-full flex flex-1 flex-col items-center justify-center border border-outline-gray-2 rounded-lg bg-surface-gray-1 h-full cursor-pointer transition hover:border-primary-400 hover:bg-primary-50 text-center\"\n            @click=\"triggerFileInput\"\n            @dragover.prevent\n            @drop.prevent=\"onDrop\"\n          >\n            <div class=\"text-ink-gray-4 mb-2\">\n              <LucideImagePlus class=\"size-6\" />\n            </div>\n            <div class=\"text-ink-gray-5 text-sm font-medium\">\n              Drag & drop images here or click to select\n            </div>\n          </div>\n        </div>\n        <div v-if=\"uploading\">\n          <div class=\"mb-2 text-sm\">\n            Uploading: {{ uploadedCount }}/{{ totalCount }}\n          </div>\n          <div class=\"w-full bg-gray-200 rounded h-2 overflow-hidden\">\n            <div\n              class=\"bg-surface-gray-5 h-2 transition-all\"\n              :style=\"{ width: uploadProgress + '%' }\"\n            ></div>\n          </div>\n          <div\n            v-if=\"uploadErrors && uploadErrors.some((e) => e)\"\n            class=\"mt-2 text-red-500 text-xs\"\n          >\n            Some files failed to upload.\n          </div>\n        </div>\n      </div>\n    </template>\n    <template #actions>\n      <div class=\"flex justify-end gap-2\">\n        <Button variant=\"ghost\" :disabled=\"uploading\" @click=\"handleCancel\">\n          Cancel\n        </Button>\n        <Button\n          v-if=\"props.mode === 'edit'\"\n          variant=\"solid\"\n          :loading=\"uploading\"\n          @click=\"handleSave\"\n        >\n          Save\n        </Button>\n        <Button\n          v-if=\"props.mode === 'new'\"\n          variant=\"solid\"\n          :loading=\"uploading\"\n          @click=\"handleUpload\"\n        >\n          Upload\n        </Button>\n      </div>\n    </template>\n  </Dialog>\n  <Teleport to=\"body\">\n    <Transition\n      name=\"fade\"\n      enter-active-class=\"transition-opacity duration-200\"\n      leave-active-class=\"transition-opacity duration-200\"\n      enter-from-class=\"opacity-0\"\n      enter-to-class=\"opacity-100\"\n      leave-from-class=\"opacity-100\"\n      leave-to-class=\"opacity-0\"\n    >\n      <div\n        v-if=\"isFileDragging\"\n        class=\"fixed inset-0 z-50 bg-gray-900/60 pointer-events-none flex items-center justify-center\"\n      >\n        <div class=\"text-ink-gray-1 text-base font-medium\">\n          Drop images anywhere\n        </div>\n      </div>\n    </Transition>\n  </Teleport>\n</template>\n\n<script setup lang=\"ts\">\nimport {\n  computed,\n  ref,\n  onMounted,\n  onUnmounted,\n  watch,\n  nextTick,\n  useTemplateRef,\n} from 'vue'\nimport Dialog from '../../../Dialog/Dialog.vue'\nimport Button from '../../../Button/Button.vue'\nimport Select from '../../../Select/Select.vue'\nimport type { Editor } from '@tiptap/vue-3'\nimport type { UploadedFile } from '../../../../utils/useFileUpload'\nimport LucideX from '~icons/lucide/x'\nimport LucideImagePlus from '~icons/lucide/image-plus'\n\ninterface UploadResult {\n  success: boolean\n  file?: UploadedFile\n  error?: Error\n}\n\ninterface ExistingImage {\n  src: string\n  alt: string\n}\n\ninterface ImageItem {\n  type: 'file' | 'existing'\n  file?: File\n  existing?: ExistingImage\n  alt?: string\n  id: string\n}\n\nconst props = withDefaults(\n  defineProps<{\n    modelValue: boolean\n    files: File[]\n    editor: Editor\n    mode: 'new' | 'edit'\n    existingImages?: ExistingImage[]\n    initialColumns?: number\n  }>(),\n  {\n    mode: 'new',\n  },\n)\n\nconst emit = defineEmits(['update:modelValue', 'close', 'update:files', 'save'])\n\nconst modelValue = computed({\n  get: () => props.modelValue,\n  set: (val) => emit('update:modelValue', val),\n})\n\nconst isFileDragging = ref(false)\nconst draggedIndex = ref<number | null>(null)\nconst overIndex = ref<number | null>(null)\nconst columnsInitialized = ref(false)\n\n// Caption editing state\nconst editingCaption = ref<string | null>(null)\nconst captionEditValue = ref('')\nconst captionInputRef = ref<HTMLInputElement | null>(null)\n\nconst uploading = ref(false)\nconst columns = ref(4)\nconst uploadProgress = ref(0)\nconst uploadedCount = ref(0)\nconst totalCount = ref(0)\nconst uploadErrors = ref<(Error | null)[]>([])\nconst uploadResults = ref<UploadResult[]>([])\n\n// Unified images array handling both files and existing images\nconst images = ref<ImageItem[]>([])\n\n// Initialize images when modal opens\nwatch(\n  () => props.modelValue,\n  (isOpen) => {\n    if (isOpen && props.mode === 'edit') {\n      const existingItems = (props.existingImages || []).map(\n        createExistingImageItem,\n      )\n      const fileItems = (props.files || []).map(createImageItem)\n      images.value = [...existingItems, ...fileItems]\n\n      if (props.initialColumns) {\n        columns.value = props.initialColumns\n        columnsInitialized.value = true\n      }\n    } else if (isOpen && props.mode === 'new') {\n      images.value = (props.files || []).map(createImageItem)\n      columns.value = getDefaultColumns(images.value.length)\n      columnsInitialized.value = true\n    }\n  },\n  { immediate: true },\n)\n\nwatch(\n  () => props.existingImages,\n  (newExistingImages) => {\n    if (props.modelValue && props.mode === 'edit') {\n      const existingItems = (newExistingImages || []).map(\n        createExistingImageItem,\n      )\n      const fileItems = (props.files || []).map(createImageItem)\n      images.value = [...existingItems, ...fileItems]\n    }\n  },\n  { deep: true },\n)\n\nwatch(\n  () => props.files,\n  (newFiles) => {\n    if (props.mode === 'new') {\n      images.value = (newFiles || []).map(createImageItem)\n    }\n  },\n  { deep: true },\n)\n\nonMounted(() => {\n  window.addEventListener('dragover', onDragOverWindow)\n  window.addEventListener('drop', onDrop)\n  window.addEventListener('dragleave', onDragLeaveWindow)\n})\n\nonUnmounted(() => {\n  window.removeEventListener('dragover', onDragOverWindow)\n  window.removeEventListener('drop', onDrop)\n  window.removeEventListener('dragleave', onDragLeaveWindow)\n})\n\nasync function handleSave() {\n  // Upload new files and combine with existing images\n  const newFiles = images.value\n    .filter((item) => item.type === 'file' && item.file)\n    .map((item) => item.file!)\n\n  const existingImages = images.value\n    .filter((item) => item.type === 'existing' && item.existing)\n    .map((item) => item.existing!)\n\n  let uploadResults: UploadResult[] = []\n\n  if (newFiles.length > 0) {\n    uploadResults = await uploadFiles(newFiles)\n  }\n\n  // Map files to their upload results for reliable lookup\n  const fileToUploadMap = new Map<File, ExistingImage>()\n  newFiles.forEach((file, index) => {\n    const result = uploadResults[index]\n    if (result?.success && result.file) {\n      fileToUploadMap.set(file, {\n        src: result.file.file_url || '',\n        alt: result.file.file_name || '',\n      })\n    }\n  })\n\n  // Build final images maintaining UI order\n  const finalImages: ExistingImage[] = []\n  for (const item of images.value) {\n    if (item.type === 'existing' && item.existing) {\n      finalImages.push(item.existing)\n    } else if (item.type === 'file' && item.file) {\n      const uploadedImage = fileToUploadMap.get(item.file)\n      if (uploadedImage) {\n        finalImages.push(uploadedImage)\n      }\n    }\n  }\n\n  emit('save', {\n    images: finalImages,\n    columns: columns.value,\n  })\n\n  uploading.value = false\n  modelValue.value = false\n}\n\nasync function handleUpload() {\n  if (!props.files || props.files.length === 0) return\n\n  const results = await uploadFiles(props.files)\n\n  const uploadedImages = results\n    .filter((result) => result.success && result.file)\n    .map((result) => ({\n      src: result.file?.file_url || '',\n      alt: result.file?.file_name || '',\n    }))\n\n  if (uploadedImages.length > 1) {\n    props.editor\n      .chain()\n      .focus()\n      .setImageGroup({ images: uploadedImages, columns: columns.value })\n      .run()\n  }\n\n  uploading.value = false\n  modelValue.value = false\n  emit('close')\n}\n\nfunction handleCancel() {\n  modelValue.value = false\n  emit('close')\n}\n\nfunction removeImage(idx: number) {\n  images.value.splice(idx, 1)\n\n  if (props.mode === 'new') {\n    const newFiles = images.value\n      .filter((item) => item.type === 'file' && item.file)\n      .map((item) => item.file!)\n    emit('update:files', newFiles)\n  }\n}\n\nfunction triggerFileInput() {\n  const fileInput = document.createElement('input')\n  fileInput.type = 'file'\n  fileInput.accept = 'image/*'\n  fileInput.multiple = true\n  fileInput.onchange = (e) => {\n    const files = (e.target as HTMLInputElement).files\n    if (files) {\n      addFiles(Array.from(files))\n    }\n  }\n  fileInput.click()\n}\n\nfunction addFiles(files: File[]) {\n  const imageFiles = files.filter((file) => file.type.startsWith('image/'))\n  const newImageItems = imageFiles.map(createImageItem)\n\n  const existingFileSignatures = images.value\n    .filter((item) => item.type === 'file' && item.file)\n    .map((item) => `${item.file!.name}-${item.file!.size}`)\n\n  const uniqueNewItems = newImageItems.filter(\n    (item) =>\n      !existingFileSignatures.includes(`${item.file!.name}-${item.file!.size}`),\n  )\n\n  images.value.push(...uniqueNewItems)\n\n  if (props.mode === 'new') {\n    const newFiles = images.value\n      .filter((item) => item.type === 'file' && item.file)\n      .map((item) => item.file!)\n    emit('update:files', newFiles)\n  }\n}\n\nfunction onDrop(e: DragEvent) {\n  e.preventDefault()\n  e.stopPropagation()\n  const droppedFiles = Array.from(e.dataTransfer?.files || [])\n  if (droppedFiles.length) {\n    addFiles(droppedFiles)\n  } else if (\n    draggedIndex.value !== null &&\n    overIndex.value !== null &&\n    draggedIndex.value !== overIndex.value\n  ) {\n    // Handle image reordering\n    const [moved] = images.value.splice(draggedIndex.value, 1)\n    images.value.splice(overIndex.value, 0, moved)\n\n    if (props.mode === 'new') {\n      const newFiles = images.value\n        .filter((item) => item.type === 'file' && item.file)\n        .map((item) => item.file!)\n      emit('update:files', newFiles)\n    }\n  }\n  isFileDragging.value = false\n  draggedIndex.value = null\n  overIndex.value = null\n}\n\nfunction createImageItem(file: File): ImageItem {\n  return {\n    type: 'file',\n    file,\n    id: `file-${file.name}-${file.size}-${Date.now()}`,\n  }\n}\n\nfunction createExistingImageItem(existing: ExistingImage): ImageItem {\n  return {\n    type: 'existing',\n    existing,\n    id: `existing-${existing.src}-${Date.now()}`,\n  }\n}\n\nfunction getDefaultColumns(count: number) {\n  if (count <= 4) return count\n  if (count % 4 === 0) return 4\n  if (count % 3 === 0) return 3\n  if (count > 10) return 4\n  return 3\n}\n\nfunction getUploadFunction() {\n  const imageGroupExtension = props.editor.extensionManager.extensions.find(\n    (ext) => ext.name === 'imageGroup',\n  )\n  return imageGroupExtension?.options?.uploadFunction\n}\n\nfunction filePreview(file: File) {\n  const url = URL.createObjectURL(file)\n\n  onUnmounted(() => {\n    URL.revokeObjectURL(url)\n  })\n\n  return url\n}\n\nfunction isImageSupported(file: File): boolean {\n  // HEIC/HEIF files can't be previewed in browsers\n  const unsupportedTypes = ['image/heic', 'image/heif']\n  const unsupportedExtensions = ['.heic', '.heif']\n\n  const hasUnsupportedType = unsupportedTypes.includes(file.type)\n  const hasUnsupportedExtension = unsupportedExtensions.some((ext) =>\n    file.name?.toLowerCase().endsWith(ext),\n  )\n\n  return !hasUnsupportedType && !hasUnsupportedExtension\n}\n\nfunction onDragOver(e: DragEvent, idx: number) {\n  e.preventDefault()\n  overIndex.value = idx\n}\n\nfunction onDragStart(idx: number) {\n  draggedIndex.value = idx\n}\n\nfunction onDragEnd() {\n  draggedIndex.value = null\n  overIndex.value = null\n}\n\nfunction onDragLeave(e: DragEvent, idx: number) {\n  if (overIndex.value === idx) {\n    overIndex.value = null\n  }\n}\n\nfunction isDropTarget(idx: number) {\n  return (\n    overIndex.value === idx &&\n    draggedIndex.value !== null &&\n    draggedIndex.value !== idx\n  )\n}\n\nfunction onDragOverWindow(e: DragEvent) {\n  e.preventDefault()\n  if (e.dataTransfer && Array.from(e.dataTransfer.types).includes('Files')) {\n    isFileDragging.value = true\n  }\n}\n\nfunction onDragLeaveWindow(e: DragEvent) {\n  if (e.target === window || e.relatedTarget === null) {\n    isFileDragging.value = false\n  }\n}\n\nconst gridStyle = computed(() => ({\n  gridTemplateColumns: `repeat(${columns.value || 4}, minmax(0, 1fr))`,\n}))\n\nconst internalColumns = computed({\n  get: () => String(columns.value ?? 4),\n  set: (val) => {\n    columns.value = +val\n  },\n})\n\nconst selectOptions = [\n  { label: '2 columns', value: '2' },\n  { label: '3 columns', value: '3' },\n  { label: '4 columns', value: '4' },\n]\n\nfunction startEditingCaption(itemId: string, currentAlt: string) {\n  editingCaption.value = itemId\n  captionEditValue.value = currentAlt\n\n  nextTick(() => {\n    if (captionInputRef.value) {\n      captionInputRef.value.focus()\n      captionInputRef.value.select()\n    }\n  })\n}\n\nfunction saveCaption(itemId: string, itemIndex: number) {\n  const [type, indexStr] = itemId.split('-')\n  const newCaption = captionEditValue.value.trim()\n\n  if (type === 'existing') {\n    if (images.value[itemIndex]?.existing) {\n      images.value[itemIndex].existing.alt = newCaption\n    }\n  } else if (type === 'file') {\n    if (images.value[itemIndex]) {\n      images.value[itemIndex].alt = newCaption\n    }\n  }\n\n  editingCaption.value = null\n  captionEditValue.value = ''\n}\n\nfunction cancelEditingCaption() {\n  editingCaption.value = null\n  captionEditValue.value = ''\n}\n\nfunction handleCaptionBlur(itemId: string, itemIndex: number) {\n  if (editingCaption.value === itemId) {\n    saveCaption(itemId, itemIndex)\n  }\n}\n\nasync function uploadFiles(files: File[]): Promise<UploadResult[]> {\n  const uploadFunction = getUploadFunction()\n  if (!uploadFunction) {\n    console.error('uploadFunction not found')\n    throw new Error('Upload function not found')\n  }\n\n  uploading.value = true\n  totalCount.value = files.length\n  uploadedCount.value = 0\n  uploadProgress.value = 0\n  uploadErrors.value = Array(files.length).fill(null)\n  uploadResults.value = Array(files.length).fill(null)\n\n  const uploadPromises = files.map(async (file, index) => {\n    try {\n      const result = await uploadFunction(file)\n      uploadResults.value[index] = { success: true, file: result }\n      return { success: true, file: result }\n    } catch (error) {\n      const err = error as Error\n      uploadErrors.value[index] = err\n      uploadResults.value[index] = { success: false, error: err }\n      return { success: false, error: err }\n    } finally {\n      uploadedCount.value++\n      uploadProgress.value = Math.round(\n        (uploadedCount.value / totalCount.value) * 100,\n      )\n    }\n  })\n\n  // Execute all uploads in parallel\n  const results = await Promise.all(uploadPromises)\n  return results\n}\n</script>\n","<template>\n  <NodeViewWrapper>\n    <div class=\"w-full\">\n      <div v-if=\"isEditable\" class=\"flex items-center mb-2 gap-2\">\n        <Button @click=\"edit\">\n          <template #prefix>\n            <LucideEdit class=\"size-4\" />\n          </template>\n          Edit\n        </Button>\n        <Select\n          :options=\"selectOptions\"\n          v-model=\"internalColumns\"\n          size=\"sm\"\n          variant=\"subtle\"\n          class=\"w-28\"\n        />\n      </div>\n      <div class=\"grid gap-px\" :style=\"gridStyle\">\n        <div\n          v-for=\"(img, idx) in images\"\n          :key=\"img.attrs.src + idx\"\n          class=\"relative aspect-square w-full h-full overflow-hidden bg-surface-white group\"\n        >\n          <button\n            v-if=\"isEditable\"\n            type=\"button\"\n            class=\"absolute top-1 right-1 z-10 bg-white/80 hover:bg-white rounded-full p-1 shadow transition-opacity opacity-0 group-hover:opacity-100 focus:opacity-100\"\n            aria-label=\"Remove image\"\n            @click.stop=\"removeImage(idx)\"\n          >\n            <LucideX class=\"w-4 h-4 text-gray-700\" />\n          </button>\n          <img\n            :src=\"img.attrs.src\"\n            :alt=\"img.attrs.alt || ''\"\n            class=\"object-cover w-full h-full not-prose cursor-pointer rounded-[2px]\"\n            v-if=\"!isEditable\"\n            @click=\"openViewer(idx)\"\n          />\n          <img\n            v-else\n            :src=\"img.attrs.src\"\n            :alt=\"img.attrs.alt || ''\"\n            class=\"object-cover w-full h-full not-prose rounded-[2px]\"\n          />\n\n          <!-- Caption overlay (visible when there's alt text) -->\n          <div\n            v-if=\"img.attrs.alt\"\n            class=\"absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/60 to-transparent rounded-b-[2px] opacity-0 group-hover:opacity-100 transition-opacity\"\n          >\n            <div class=\"p-2\">\n              <div class=\"text-white text-xs truncate\" :title=\"img.attrs.alt\">\n                {{ img.attrs.alt }}\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n      <ImageViewerModal\n        v-if=\"showViewer\"\n        v-model:show=\"showViewer\"\n        :images=\"viewerImages\"\n        :initialIndex=\"viewerIndex\"\n      />\n      <ImageGroupUploadDialog\n        v-if=\"showEditModal\"\n        v-model=\"showEditModal\"\n        :files=\"editFiles\"\n        :editor=\"props.editor\"\n        mode=\"edit\"\n        :existingImages=\"existingImages\"\n        :initialColumns=\"columns\"\n        @close=\"handleEditModalClose\"\n        @save=\"handleEditSave\"\n      />\n      <slot />\n    </div>\n  </NodeViewWrapper>\n</template>\n\n<script setup lang=\"ts\">\nimport { computed, ref, onMounted, onUnmounted } from 'vue'\nimport { NodeViewWrapper, type Editor } from '@tiptap/vue-3'\nimport type { NodeViewProps } from '@tiptap/vue-3'\nimport LucideX from '~icons/lucide/x'\nimport LucideEdit from '~icons/lucide/edit'\nimport Button from '../../../Button/Button.vue'\nimport Select from '../../../Select/Select.vue'\nimport ImageViewerModal from '../../ImageViewerModal.vue'\nimport ImageGroupUploadDialog from './ImageGroupUploadDialog.vue'\n\nconst props = defineProps<NodeViewProps & { editor: Editor }>()\n\nconst columns = computed(() => props.node.attrs.columns || 4)\nconst images = computed(() => props.node.content.content || [])\nconst gridStyle = computed(() => ({\n  gridTemplateColumns: `repeat(${columns.value}, minmax(0, 1fr))`,\n}))\nconst isEditable = ref(props.editor.isEditable)\n\nconst selectOptions = [\n  { label: '2 columns', value: '2' },\n  { label: '3 columns', value: '3' },\n  { label: '4 columns', value: '4' },\n]\n\nconst internalColumns = computed({\n  get: () => String(columns.value),\n  set: (val) => props.updateAttributes({ columns: +val }),\n})\n\nconst showViewer = ref(false)\nconst viewerIndex = ref(0)\nconst viewerImages = computed(() =>\n  images.value.map((img: any) => ({\n    src: img.attrs.src,\n    alt: img.attrs.alt || '',\n  })),\n)\n\nconst showEditModal = ref(false)\nconst editFiles = ref<File[]>([])\n\ninterface ExistingImage {\n  src: string\n  alt: string\n}\n\nconst existingImages = computed(() =>\n  images.value.map((img: any) => ({\n    src: img.attrs.src,\n    alt: img.attrs.alt || '',\n  })),\n)\n\nonMounted(() => {\n  const updateEditable = () => {\n    isEditable.value = props.editor.isEditable\n  }\n  props.editor.on('update', updateEditable)\n  onUnmounted(() => {\n    props.editor.off('update', updateEditable)\n  })\n})\n\nfunction edit() {\n  editFiles.value = []\n  showEditModal.value = true\n}\n\nfunction handleEditModalClose() {\n  showEditModal.value = false\n  editFiles.value = []\n}\n\nasync function handleEditSave(data: {\n  images: ExistingImage[]\n  columns: number\n}) {\n  // Update the node with the final images and columns from the modal\n  props.editor.commands.command(({ tr, state }) => {\n    const pos = props.getPos()\n    if (typeof pos === 'number') {\n      const node = state.doc.nodeAt(pos)\n      if (node && node.type.name === 'imageGroup') {\n        const newContent = data.images.map((img) =>\n          state.schema.nodes.image.create({ src: img.src, alt: img.alt }),\n        )\n\n        const newAttrs = { ...node.attrs, columns: data.columns }\n        const newNode = node.type.create(newAttrs, newContent)\n        tr.replaceWith(pos, pos + node.nodeSize, newNode)\n        return true\n      }\n    }\n    return false\n  })\n\n  showEditModal.value = false\n}\n\nfunction openViewer(idx: number) {\n  if (props.editor.isEditable) return\n  viewerIndex.value = idx\n  showViewer.value = true\n}\n\nfunction removeImage(idx: number) {\n  // Remove the image at the specified index and update the node\n  const newImages = images.value.slice()\n  newImages.splice(idx, 1)\n  if (newImages.length === 0) {\n    // Remove the whole node if no images left\n    props.editor.commands.deleteNode('imageGroup')\n  } else {\n    // Update the node content with remaining images\n    props.updateAttributes({})\n    props.editor.commands.command(({ tr, state }) => {\n      const pos = props.getPos()\n      if (typeof pos === 'number') {\n        const node = state.doc.nodeAt(pos)\n        if (node && node.type.name === 'imageGroup') {\n          const newContent = newImages.map((img) =>\n            state.schema.nodes.image.create(img.attrs),\n          )\n          tr.replaceWith(pos + 1, pos + 1 + node.content.size, newContent)\n          return true\n        }\n      }\n      return false\n    })\n  }\n}\n</script>\n","import { Node, mergeAttributes } from '@tiptap/core'\nimport { VueNodeViewRenderer } from '@tiptap/vue-3'\nimport ImageGroupNodeView from './ImageGroupNodeView.vue'\nimport { UploadedFile } from '../../../../utils/useFileUpload'\n\nexport interface ImageGroupOptions {\n  /**\n   * Function to handle image uploads\n   * @default null\n   */\n  uploadFunction: ((file: File) => Promise<UploadedFile>) | null\n  HTMLAttributes: Record<string, any>\n}\n\nexport interface ImageGroupAttrs {\n  columns?: number\n  images: {\n    src: string\n    alt?: string\n  }[]\n}\n\ndeclare module '@tiptap/core' {\n  interface Commands<ReturnType> {\n    imageGroup: {\n      /**\n       * Insert an image group/gallery node\n       */\n      setImageGroup: (attrs: {\n        columns?: number\n        images: { src: string; alt?: string }[]\n      }) => ReturnType\n    }\n  }\n}\n\nexport const ImageGroup = Node.create<ImageGroupOptions>({\n  name: 'imageGroup',\n\n  group: 'block',\n  content: 'image+', // one or more images\n  selectable: true,\n  draggable: true,\n  isolating: true,\n\n  addOptions() {\n    return {\n      uploadFunction: null,\n      HTMLAttributes: {},\n    }\n  },\n\n  addAttributes() {\n    return {\n      columns: {\n        default: 4,\n      },\n    }\n  },\n\n  parseHTML() {\n    return [\n      {\n        tag: 'div[data-type=\"image-group\"]',\n        getAttrs: (element) => {\n          if (typeof element === 'string') return {}\n          const el = element as HTMLElement\n          return {\n            columns: el.getAttribute('data-columns')\n              ? Number(el.getAttribute('data-columns'))\n              : 4,\n          }\n        },\n      },\n    ]\n  },\n\n  renderHTML({ HTMLAttributes, node }) {\n    return [\n      'div',\n      mergeAttributes(\n        {\n          'data-type': 'image-group',\n          'data-columns': node.attrs.columns,\n        },\n        this.options.HTMLAttributes,\n        HTMLAttributes,\n      ),\n      0, // content placeholder for child images\n    ]\n  },\n\n  addNodeView() {\n    return VueNodeViewRenderer(ImageGroupNodeView)\n  },\n\n  addCommands() {\n    return {\n      setImageGroup:\n        (attrs) =>\n        ({ commands }) => {\n          return commands.insertContent({\n            type: this.name,\n            attrs: {\n              columns: attrs.columns || 4,\n            },\n            content: attrs.images.map((img) => ({\n              type: 'image',\n              attrs: img,\n            })),\n          })\n        },\n    }\n  },\n})\n","import DOMPurify from 'dompurify'\nimport { defineComponent, h, ref, Ref } from 'vue'\nimport LoadingIndicator from '../LoadingIndicator.vue'\nimport ToastComponent from './Toast.vue'\nimport type { ToastProps } from './types'\n\ninterface ToastOptions\n  extends Omit<Partial<ToastProps>, 'open' | 'message' | 'title'> {\n  id?: string\n  message: string\n}\n\ninterface ToastItem\n  extends Pick<\n    ToastProps,\n    'duration' | 'action' | 'type' | 'icon' | 'closable'\n  > {\n  id: string\n  open: boolean\n  message: string\n}\n\ninterface ToastPromiseOptions<TData = any, TError = any> {\n  loading: string\n  /** Message for success state, or a function that returns a message. */\n  success: string | ((data: TData) => string)\n  /** Message for error state, or a function that returns a message. */\n  error: string | ((error: TError) => string)\n  /** Optional: Duration in seconds for the success toast. Defaults to 5 seconds. */\n  successDuration?: number\n  /** Optional: Duration in seconds for the error toast. Defaults to 5 seconds. */\n  errorDuration?: number\n  /** Optional: Common duration in seconds for all toast states, unless overridden by successDuration or errorDuration. */\n  duration?: number\n}\n\nconst toastsState: Ref<ToastItem[]> = ref([])\nlet toastIdCounter = 0\n\nconst updateToastInState = (\n  id: string,\n  updates: Partial<Omit<ToastItem, 'id'>>,\n) => {\n  const index = toastsState.value.findIndex((t) => t.id === id)\n  if (index !== -1) {\n    toastsState.value[index] = {\n      ...toastsState.value[index],\n      ...updates,\n      open: true,\n    }\n  }\n}\n\nexport const toast = {\n  create: (options: ToastOptions): string => {\n    const id = `toast-${toastIdCounter++}`\n    const durationInMs =\n      options.duration != null ? options.duration * 1000 : 5000\n\n    const sanitizedMessage = DOMPurify.sanitize(options.message, {\n      ALLOWED_TAGS: ['a', 'em', 'strong', 'i', 'b', 'u'],\n    })\n\n    const toastItem: ToastItem = {\n      id: options.id || id,\n      open: true,\n      message: sanitizedMessage,\n      type: options.type || 'info',\n      duration: durationInMs,\n      action: options.action,\n      icon: options.icon,\n      closable: options.closable ?? true,\n    }\n    toastsState.value.push(toastItem)\n    return toastItem.id\n  },\n  remove: (id: string) => {\n    toastsState.value = toastsState.value.filter((t) => t.id !== id)\n  },\n  removeAll: () => {\n    toastsState.value = []\n  },\n\n  promise: async <TData = any, TError = any>(\n    promiseToResolve: Promise<TData>,\n    options: ToastPromiseOptions<TData, TError>,\n  ): Promise<TData> => {\n    const loadingDurationInSeconds = options.duration ?? 0\n\n    const toastId = toast.create({\n      message: options.loading,\n      type: 'info',\n      icon: () => h(LoadingIndicator, { class: 'text-ink-white' }),\n      duration: loadingDurationInSeconds,\n      closable: false,\n    })\n\n    try {\n      const data = await promiseToResolve\n      const successMessage =\n        typeof options.success === 'function'\n          ? options.success(data)\n          : options.success\n\n      const successToastDurationInSeconds =\n        options.successDuration ?? options.duration ?? 5\n\n      updateToastInState(toastId, {\n        message: successMessage,\n        type: 'success',\n        duration: successToastDurationInSeconds * 1000,\n        icon: undefined,\n        closable: true,\n      })\n      return data\n    } catch (error) {\n      const errorMessage =\n        typeof options.error === 'function'\n          ? options.error(error as TError)\n          : options.error\n\n      const errorToastDurationInSeconds =\n        options.errorDuration ?? options.duration ?? 5\n\n      updateToastInState(toastId, {\n        message: errorMessage,\n        type: 'error',\n        duration: errorToastDurationInSeconds * 1000,\n        icon: undefined,\n        closable: true,\n      })\n      throw error\n    }\n  },\n\n  success: (\n    message: string,\n    options: Omit<ToastOptions, 'message' | 'type'> = {},\n  ) => toast.create({ message, type: 'success', ...options }),\n  error: (\n    message: string,\n    options: Omit<ToastOptions, 'message' | 'type'> = {},\n  ) => toast.create({ message, type: 'error', ...options }),\n  warning: (\n    message: string,\n    options: Omit<ToastOptions, 'message' | 'type'> = {},\n  ) => toast.create({ message, type: 'warning', ...options }),\n  info: (\n    message: string,\n    options: Omit<ToastOptions, 'message' | 'type'> = {},\n  ) => toast.create({ message, type: 'info', ...options }),\n}\n\nexport const Toasts = defineComponent({\n  name: 'FrappeToasts',\n  setup() {\n    const handleUpdateOpen = (id: string, isOpen: boolean) => {\n      if (!isOpen) {\n        toast.remove(id)\n      } else {\n        const t = toastsState.value.find((item) => item.id === id)\n        if (t) t.open = true\n      }\n    }\n\n    const handleActionForItem = (toastItem: ToastItem) => {\n      toast.remove(toastItem.id)\n    }\n\n    return () =>\n      toastsState.value.map((t) =>\n        h(ToastComponent, {\n          key: t.id,\n          open: t.open,\n          message: t.message,\n          type: t.type,\n          duration: t.duration,\n          action: t.action,\n          icon: t.icon,\n          closable: t.closable,\n          'onUpdate:open': (isOpen) => handleUpdateOpen(t.id, isOpen),\n          onAction: () => handleActionForItem(t),\n        }),\n      )\n  },\n})\n","import { ref, computed } from 'vue'\nimport {\n  groupBy,\n  calculateMinutes,\n  findOverlappingEventsCount,\n} from '../calendarUtils'\n\nexport const activeEvent = ref('')\n\nexport default function useCalendarData(events, view = '') {\n  const timedEvents = computed(() => {\n    let groupByDate = groupBy(events, (row) => row.date)\n    let sortedArray = {}\n    if (view === 'Month') {\n      for (const [key, value] of Object.entries(groupByDate)) {\n        sortedArray[key] = sortMonthlyEvents(value)\n      }\n    } else {\n      for (let [key, value] of Object.entries(groupByDate)) {\n        value = value.filter((event) => !event.isFullDay)\n        value.forEach((task) => {\n          task.startTime = calculateMinutes(task.fromTime)\n          task.endTime = calculateMinutes(task.toTime)\n        })\n        let sortedEvents = value.sort((a, b) => a.startTime - b.startTime)\n        sortedArray[key] = findOverlappingEventsCount(sortedEvents)\n      }\n    }\n    return sortedArray\n  })\n\n  const fullDayEvents = computed(() => {\n    let fullDay = events.filter((event) => event.isFullDay)\n    let dateGroup = groupBy(fullDay, (row) => row.date)\n    return dateGroup\n  })\n\n  return { timedEvents, fullDayEvents }\n}\n\nfunction sortMonthlyEvents(events) {\n  let fullDayEvents = events.filter((event) => event.isFullDay)\n  let timedEvents = events\n    .filter((event) => !event.isFullDay)\n    .sort((a, b) =>\n      a.fromTime !== b.fromTime\n        ? calculateMinutes(a.fromTime) > calculateMinutes(b.fromTime)\n          ? 1\n          : -1\n        : calculateMinutes(a.toTime) > calculateMinutes(b.toTime)\n          ? 1\n          : -1,\n    )\n  // full day events should be at the top in month view\n  return [...fullDayEvents, ...timedEvents]\n}\n","export default async function call(method, args, options = {}) {\n  if (!args) {\n    args = {}\n  }\n\n  let headers = Object.assign(\n    {\n      Accept: 'application/json',\n      'Content-Type': 'application/json; charset=utf-8',\n      'X-Frappe-Site-Name': window.location.hostname,\n    },\n    options.headers || {},\n  )\n\n  if (window.csrf_token && window.csrf_token !== '{{ csrf_token }}') {\n    headers['X-Frappe-CSRF-Token'] = window.csrf_token\n  }\n\n  let path = method.startsWith('/') ? method : `/api/method/${method}`\n  const res = await fetch(path, {\n    method: 'POST',\n    headers,\n    body: JSON.stringify(args),\n  })\n\n  if (res.ok) {\n    const data = await res.json()\n    if (data.docs || method === 'login') {\n      return data\n    }\n    if (data.exc) {\n      try {\n        console.groupCollapsed(method)\n        console.log(`method: ${method}`)\n        console.log(`params:`, args)\n        let warning = JSON.parse(data.exc)\n        for (let text of warning) {\n          console.log(text)\n        }\n        console.groupEnd()\n      } catch (e) {\n        console.warn('Error printing debug messages', e)\n      }\n    }\n    return data.message\n  } else {\n    let response = await res.text()\n    let error, exception\n    try {\n      error = JSON.parse(response)\n      // eslint-disable-next-line no-empty\n    } catch (e) {}\n    let errorParts = [\n      [method, error.exc_type, error._error_message].filter(Boolean).join(' '),\n    ]\n    if (error.exc) {\n      exception = error.exc\n      try {\n        exception = JSON.parse(exception)[0]\n        console.log(exception)\n        // eslint-disable-next-line no-empty\n      } catch (e) {}\n    }\n    let e = new Error(errorParts.join('\\n'))\n    e.exc_type = error.exc_type\n    e.exc = exception\n    e.status = res.status\n    e.messages = error._server_messages\n      ? JSON.parse(error._server_messages)\n      : []\n    e.messages = e.messages.concat(error.message)\n    e.messages = e.messages.map((m) => {\n      try {\n        return JSON.parse(m).message\n      } catch (error) {\n        return m\n      }\n    })\n    e.messages = e.messages.filter(Boolean)\n    if (!e.messages.length) {\n      e.messages = error._error_message\n        ? [error._error_message]\n        : ['Internal Server Error']\n    }\n\n    if (options.onError) {\n      options.onError({ response: res, status: res.status, error: e })\n    }\n\n    throw e\n  }\n}\n\nexport function createCall(options) {\n  return function customCall(method, args) {\n    return call(method, args, options)\n  }\n}\n","export default (file: File): Promise<string> => {\n  return new Promise((resolve, reject) => {\n    const reader = new FileReader()\n    reader.onloadend = () => {\n      if (reader.result == null) {\n        reject(new Error('FileReader result is null'))\n      } else if (typeof reader.result === 'string') {\n        resolve(reader.result)\n      }\n    }\n    reader.readAsDataURL(file)\n  })\n}\n","import {\n  watch,\n  getCurrentInstance,\n  onBeforeUnmount,\n  type App,\n  type WatchStopHandle,\n} from 'vue'\n\ninterface PageMeta {\n  title?: string\n  emoji?: string\n  icon?: string\n}\n\ntype PageMetaFunction = () => PageMeta | null | undefined\ntype StopWatcherFunction = () => void\n\nlet faviconRef: HTMLLinkElement | null = null\nlet defaultFavIcon: string | null = null\n\nfunction initializeFavicon(): void {\n  if (typeof window !== 'undefined' && !faviconRef) {\n    faviconRef = document.querySelector('link[rel=\"icon\"]')\n    defaultFavIcon = faviconRef?.href || null\n  }\n}\n\nexport function usePageMeta(fn: PageMetaFunction): StopWatcherFunction {\n  // Initialize favicon if we're on the client\n  if (typeof window !== 'undefined') {\n    initializeFavicon()\n  }\n\n  const stopWatcher: WatchStopHandle = watch(\n    () => {\n      try {\n        return fn()\n      } catch (error) {\n        if (process.env.NODE_ENV === 'development') {\n          console.warn('Failed to parse pageMeta in', fn)\n          console.error(error)\n        }\n        return null\n      }\n    },\n    (pageMeta: PageMeta | null | undefined) => {\n      // Only execute on client side\n      if (typeof window === 'undefined') return\n      if (!pageMeta) return\n\n      if (pageMeta.title) {\n        document.title = pageMeta.title\n      }\n\n      // Ensure favicon ref is initialized\n      if (!faviconRef) initializeFavicon()\n\n      if (pageMeta.emoji) {\n        const href = `data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>${pageMeta.emoji}</text></svg>`\n        if (faviconRef) faviconRef.href = href\n      } else if (pageMeta.icon) {\n        if (faviconRef) faviconRef.href = pageMeta.icon\n      } else {\n        if (faviconRef && defaultFavIcon) faviconRef.href = defaultFavIcon\n      }\n    },\n    {\n      immediate: true,\n      deep: true,\n    },\n  )\n\n  // Auto-cleanup if called within a component (like <script setup>)\n  const instance = getCurrentInstance()\n  if (instance) {\n    onBeforeUnmount(stopWatcher)\n  }\n\n  return stopWatcher\n}\n\ninterface PageMetaPlugin {\n  install(app: App): void\n}\n\nexport default {\n  install(app: App): void {\n    app.mixin(createMixin())\n  },\n} as PageMetaPlugin\n\ninterface ComponentWithPageMeta {\n  $options: {\n    pageMeta?: PageMetaFunction\n  }\n  _pageMetaStopWatcher?: StopWatcherFunction\n}\n\nfunction createMixin() {\n  return {\n    mounted(this: ComponentWithPageMeta): void {\n      if (this.$options.pageMeta) {\n        const fn = this.$options.pageMeta.bind(this)\n        this._pageMetaStopWatcher = usePageMeta(fn)\n      }\n    },\n    beforeUnmount(this: ComponentWithPageMeta): void {\n      if (this._pageMetaStopWatcher) {\n        this._pageMetaStopWatcher()\n        this._pageMetaStopWatcher = undefined\n      }\n    },\n  }\n}\n","export function request(_options) {\n  let options = Object.assign({}, _options)\n  if (!options.url) {\n    throw new Error('[request] options.url is required')\n  }\n  if (options.transformRequest) {\n    options = options.transformRequest(_options)\n  }\n  if (!options.responseType) {\n    options.responseType = 'json'\n  }\n  if (!options.method) {\n    options.method = 'GET'\n  }\n\n  let url = options.url\n  let body\n  if (options.params) {\n    if (options.method === 'GET') {\n      let params = new URLSearchParams()\n      for (let key in options.params) {\n        params.append(key, options.params[key])\n      }\n      url = options.url + '?' + params.toString()\n    } else {\n      body = JSON.stringify(options.params)\n    }\n  }\n\n  return fetch(url, {\n    method: options.method || 'GET',\n    headers: options.headers,\n    body,\n  })\n    .then((response) => {\n      if (options.transformResponse) {\n        return options.transformResponse(response, options)\n      }\n      if (response.status >= 200 && response.status < 300) {\n        if (options.responseType === 'json') {\n          return response.json()\n        }\n        return response\n      } else {\n        let error = new Error(response.statusText)\n        error.response = response\n        throw error\n      }\n    })\n    .catch((error) => {\n      if (options.transformError) {\n        return options.transformError(error)\n      }\n      throw error\n    })\n}\n","import { get, set, del } from 'idb-keyval'\n\nexport function saveLocal(key, data) {\n  if (typeof indexedDB === 'undefined') {\n    return Promise.resolve(null)\n  }\n  if (!key) return Promise.resolve()\n  return set(key, JSON.stringify(data))\n}\n\nexport function deleteLocal(key) {\n  if (typeof indexedDB === 'undefined') {\n    return Promise.resolve(null)\n  }\n  if (!key) return Promise.resolve()\n  return del(key)\n}\n\nexport function getLocal(key) {\n  if (typeof indexedDB === 'undefined') {\n    return Promise.resolve(null)\n  }\n  return get(key).then((val) => (val ? JSON.parse(val) : val))\n}\n","import { reactive } from 'vue'\nimport debounce from '../utils/debounce'\nimport { request } from '../utils/request'\nimport { getLocal, saveLocal } from './local'\nimport { getConfig } from '../utils/config'\n\nlet cached = {}\n\nexport function createResource(options, vm) {\n  let cacheKey = null\n  if (options.cache) {\n    cacheKey = getCacheKey(options.cache)\n    let cachedResource = cached[cacheKey]\n\n    if (cachedResource) {\n      if (cachedResource.auto) {\n        cachedResource.reload()\n      }\n      return cachedResource\n    }\n  }\n\n  if (typeof options == 'string') {\n    options = {\n      url: options,\n      auto: true,\n    }\n  }\n\n  let fetchFunction = options.debounce\n    ? debounce(fetch, options.debounce)\n    : fetch\n\n  let out = reactive({\n    method: options.method,\n    url: options.url,\n    data: options.initialData || null,\n    previousData: null,\n    loading: false,\n    fetched: false,\n    error: null,\n    promise: null,\n    auto: options.auto,\n    params: null,\n    fetch: fetchFunction,\n    reload: fetchFunction,\n    submit: fetchFunction,\n    reset,\n    update,\n    setData,\n  })\n\n  async function fetch(params, tempOptions = {}) {\n    let resourceFetcher =\n      options.resourceFetcher || getConfig('resourceFetcher') || request\n\n    if (params instanceof Event) {\n      params = null\n    }\n    params = params || out.params\n    if (options.makeParams) {\n      params = options.makeParams.call(vm, params)\n    }\n    out.params = params\n    out.previousData = out.data ? JSON.parse(JSON.stringify(out.data)) : null\n    out.loading = true\n    out.error = null\n\n    if (options.onFetch) {\n      options.onFetch.call(vm, out.params)\n    }\n\n    let beforeSubmitFunctions = [options.beforeSubmit, tempOptions.beforeSubmit]\n    for (let fn of beforeSubmitFunctions) {\n      if (fn) {\n        fn.call(vm, out.params)\n      }\n    }\n\n    let validateFunction = tempOptions.validate || options.validate\n    let errorFunctions = [options.onError, tempOptions.onError]\n    let successFunctions = [options.onSuccess, tempOptions.onSuccess]\n    let dataFunctions = [options.onData, tempOptions.onData]\n\n    if (validateFunction) {\n      let invalidMessage\n      try {\n        invalidMessage = await validateFunction.call(vm, out.params)\n        if (invalidMessage && typeof invalidMessage == 'string') {\n          throw new Error(invalidMessage)\n        }\n      } catch (error) {\n        handleError(error, errorFunctions)\n        return\n      }\n    }\n\n    try {\n      out.promise = resourceFetcher({\n        ...options,\n        params: params || options.params,\n      })\n      let data = await out.promise\n      saveLocal(cacheKey, data)\n      out.data = transform(data)\n      out.fetched = true\n      for (let fn of successFunctions) {\n        if (fn) {\n          fn.call(vm, data)\n        }\n      }\n      for (let fn of dataFunctions) {\n        if (fn) {\n          fn.call(vm, data)\n        }\n      }\n    } catch (error) {\n      handleError(error, errorFunctions)\n    }\n    out.loading = false\n    return out.data\n  }\n\n  function update({ method, url, params, auto }) {\n    if (method && method !== options.method) {\n      out.method = method\n    }\n    if (url && url !== options.url) {\n      out.url = url\n    }\n    if (params && params !== options.params) {\n      out.params = params\n    }\n    if (auto !== undefined && auto !== out.auto) {\n      out.auto = auto\n    }\n  }\n\n  function reset() {\n    out.data = options.initialData || null\n    out.previousData = null\n    out.loading = false\n    out.fetched = false\n    out.error = null\n    out.params = null\n    out.auto = options.auto\n  }\n\n  function handleError(error, errorFunctions) {\n    out.loading = false\n    if (out.previousData) {\n      out.data = out.previousData\n    }\n    out.error = error\n    for (let fn of errorFunctions) {\n      if (fn) {\n        fn.call(vm, error)\n      }\n    }\n    // if no error handler is defined, use fallbackErrorHandler\n    if (errorFunctions.every((fn) => fn == null)) {\n      let errorHandler = getConfig('fallbackErrorHandler')\n      if (errorHandler) {\n        try {\n          errorHandler(error)\n        } catch (error) {\n          // who handles the error handler?\n          console.warn('Error in fallbackErrorHandler', error)\n        }\n      }\n    }\n    throw error\n  }\n\n  // usage:\n  // setData(newData) or\n  // setData(data => data.filter(d => !d.deleted))\n  function setData(data) {\n    if (typeof data === 'function') {\n      data = data.call(vm, out.data)\n    }\n    out.data = transform(data)\n  }\n\n  function transform(data) {\n    if (options.transform) {\n      let returnValue = options.transform.call(vm, data)\n      if (returnValue != null) {\n        return returnValue\n      }\n    }\n    return data\n  }\n\n  if (cacheKey && !cached[cacheKey]) {\n    cached[cacheKey] = out\n    // offline\n    getLocal(cacheKey).then((data) => {\n      if ((out.loading || !out.fetched) && data) {\n        setData(data)\n        options.onData?.call(vm, data)\n      }\n    })\n  }\n\n  if (options.auto) {\n    out.fetch()\n  }\n\n  return out\n}\n\nexport function getCacheKey(cacheKey) {\n  if (!cacheKey) {\n    return null\n  }\n  if (typeof cacheKey === 'string') {\n    cacheKey = [cacheKey]\n  }\n  return JSON.stringify(cacheKey)\n}\n\nexport function getCachedResource(cacheKey) {\n  cacheKey = getCacheKey(cacheKey)\n  return cached[cacheKey] || null\n}\n","export function onDocUpdate(socket, doctype, callback) {\n  subscribe(socket, doctype)\n  socket.on('list_update', (data) => {\n    if (data.doctype == doctype) {\n      callback(data.name)\n    }\n  })\n}\n\nlet subscribed = {}\nfunction subscribe(socket, doctype) {\n  if (subscribed[doctype]) return\n  socket.emit('doctype_subscribe', doctype)\n  subscribed[doctype] = true\n}\n","import { reactive } from 'vue'\nimport { getCacheKey, createResource } from './resources'\nimport { saveLocal, getLocal } from './local'\nimport { onDocUpdate } from './realtime'\nimport { getConfig } from '../utils/config'\n\nlet listCache = reactive({})\nlet resourcesByDocType = {}\n\nexport function createListResource(options, vm) {\n  if (!options.doctype) {\n    throw new Error('List resource requires doctype')\n  }\n\n  let cacheKey = getCacheKey(options.cache)\n  if (cacheKey) {\n    let cachedResource = listCache[cacheKey]\n    if (cachedResource) {\n      if (cachedResource.auto) {\n        cachedResource.reload()\n      }\n      return cachedResource\n    }\n  }\n\n  let defaultListUrl = getConfig('defaultListUrl') || 'frappe.client.get_list'\n  let defaultDocInsertUrl =\n    getConfig('defaultDocInsertUrl') || 'frappe.client.insert'\n  let defaultDocUpdateUrl =\n    getConfig('defaultDocUpdateUrl') || 'frappe.client.set_value'\n  let defaultDocDeleteUrl =\n    getConfig('defaultDocDeleteUrl') || 'frappe.client.delete'\n  let defaultRunDocMethodUrl =\n    getConfig('defaultRunDocMethodUrl') || 'run_doc_method'\n\n  let out = reactive({\n    doctype: options.doctype,\n    fields: options.fields,\n    filters: options.filters,\n    orFilters: options.orFilters,\n    orderBy: options.orderBy,\n    start: options.start || 0,\n    pageLength: options.pageLength || 20,\n    groupBy: options.groupBy,\n    parent: options.parent,\n    debug: options.debug || 0,\n    originalData: null,\n    dataMap: {},\n    data: null,\n    previous,\n    hasPreviousPage: false,\n    next,\n    hasNextPage: true,\n    auto: options.auto,\n    list: createResource(\n      {\n        url: options.url || defaultListUrl,\n        makeParams() {\n          return {\n            doctype: out.doctype,\n            fields: out.fields,\n            filters: out.filters,\n            or_filters: out.orFilters,\n            order_by: out.orderBy,\n            start: out.start,\n            limit: out.pageLength,\n            limit_start: out.start,\n            limit_page_length: out.pageLength,\n            group_by: out.groupBy,\n            parent: out.parent,\n            debug: out.debug,\n          }\n        },\n        onSuccess(data) {\n          out.hasPreviousPage = !!out.start\n          out.hasNextPage = data.length < out.pageLength ? false : true\n          let pagedData\n          if (!out.start || out.start == 0) {\n            pagedData = data\n          } else if (out.start > 0) {\n            pagedData = out.originalData.concat(data)\n          }\n          saveLocal(cacheKey, pagedData)\n          setData(pagedData)\n          options.onSuccess?.call(vm, out.data)\n        },\n        onError: options.onError,\n      },\n      vm,\n    ),\n    fetchOne: createResource(\n      {\n        url: options.url || defaultListUrl,\n        makeParams(name) {\n          return {\n            doctype: out.doctype,\n            fields: out.fields || '*',\n            filters: { name },\n          }\n        },\n        onSuccess(data) {\n          if (data.length > 0 && out.originalData) {\n            let doc = data[0]\n            updateRowInListResource(out.doctype, doc)\n          }\n\n          options.fetchOne?.onSuccess?.call(vm, out.data)\n        },\n        onError: options.fetchOne?.onError,\n      },\n      vm,\n    ),\n    insert: createResource(\n      {\n        url: defaultDocInsertUrl,\n        makeParams(values) {\n          return {\n            doc: {\n              doctype: out.doctype,\n              ...values,\n            },\n          }\n        },\n        onSuccess(data) {\n          out.list.fetch()\n          options.insert?.onSuccess?.call(vm, data)\n        },\n        onError: options.insert?.onError,\n      },\n      vm,\n    ),\n    setValue: createResource(\n      {\n        url: defaultDocUpdateUrl,\n        makeParams(options) {\n          let { name, ...values } = options\n          return {\n            doctype: out.doctype,\n            name: name,\n            fieldname: values,\n          }\n        },\n        onSuccess(doc) {\n          updateRowInListResource(out.doctype, doc)\n          options.setValue?.onSuccess?.call(vm, doc)\n        },\n        onError: options.setValue?.onError,\n      },\n      vm,\n    ),\n    delete: createResource(\n      {\n        url: defaultDocDeleteUrl,\n        makeParams(name) {\n          return {\n            doctype: out.doctype,\n            name,\n          }\n        },\n        onSuccess(data) {\n          out.list.fetch()\n          options.delete?.onSuccess?.call(vm, data)\n        },\n        onError: options.delete?.onError,\n      },\n      vm,\n    ),\n    runDocMethod: createResource(\n      {\n        url: defaultRunDocMethodUrl,\n        makeParams({ method, name, ...values }) {\n          return {\n            dt: out.doctype,\n            dn: name,\n            method: method,\n            args: values,\n          }\n        },\n        onSuccess(data) {\n          if (data.docs) {\n            for (let doc of data.docs) {\n              updateRowInListResource(doc.doctype, doc)\n            }\n          }\n          options.runDocMethod?.onSuccess?.call(vm, data)\n        },\n        onError: options.runDocMethod?.onError,\n      },\n      vm,\n    ),\n    update,\n    fetch,\n    reload,\n    setData,\n    transform,\n    getRow,\n  })\n\n  function update(updatedOptions) {\n    Object.assign(out, updatedOptions)\n  }\n\n  function transform(data) {\n    if (options.transform) {\n      let returnValue = options.transform.call(vm, data)\n      if (returnValue != null) {\n        return returnValue\n      }\n    }\n    return data\n  }\n\n  function reload() {\n    let _start = out.start\n    let _pageLength = out.pageLength\n    if (out.start > 0) {\n      out.start = 0\n      out.pageLength = out.originalData.length\n    }\n    return out.list.fetch().finally(() => {\n      out.start = _start\n      out.pageLength = _pageLength\n    })\n  }\n\n  function fetch() {\n    reload()\n  }\n\n  function setData(data) {\n    out.originalData = data\n    if (typeof data === 'function') {\n      data = data.call(vm, out.data)\n    }\n    out.data = transform(data)\n\n    if (Array.isArray(out.data)) {\n      out.dataMap = {}\n      for (let row of out.data) {\n        if (!row.name) continue\n        let key = row.name.toString()\n        out.dataMap[key] = row\n      }\n    }\n  }\n\n  function previous() {\n    out.start = out.start - out.pageLength\n    out.list.fetch()\n  }\n\n  function next() {\n    out.start = out.start + out.pageLength\n    out.list.fetch()\n  }\n\n  function getRow(name) {\n    let key = name.toString()\n    return out.dataMap[key]\n  }\n\n  if (options.realtime && vm?.$socket) {\n    onDocUpdate(vm.$socket, out.doctype, (name) => {\n      if (out.originalData?.find((d) => d.name === name)) {\n        out.fetchOne.submit(name)\n      }\n    })\n  }\n\n  if (cacheKey) {\n    // cache\n    listCache[cacheKey] = out\n    // offline\n    getLocal(cacheKey).then((data) => {\n      if ((out.list.loading || !out.list.fetched) && data) {\n        setData(data)\n        options.onData?.call(vm, data)\n      }\n    })\n  }\n\n  if (options.auto) {\n    out.list.fetch()\n  }\n\n  resourcesByDocType[out.doctype] = resourcesByDocType[out.doctype] || []\n  resourcesByDocType[out.doctype].push(out)\n\n  return out\n}\n\nexport function getCachedListResource(cacheKey) {\n  cacheKey = getCacheKey(cacheKey)\n  return listCache[cacheKey] || null\n}\n\nexport function updateRowInListResource(doctype, doc) {\n  if (!doc.name) return\n  let resources = resourcesByDocType[doctype] || []\n  for (let resource of resources) {\n    if (resource.originalData) {\n      for (let row of resource.originalData) {\n        if (row.name && row.name == doc.name) {\n          delete row._previousData\n          let previousRowData = JSON.stringify(row)\n          for (let key in row) {\n            if (key in doc) {\n              row[key] = doc[key]\n            }\n          }\n          row._previousData = previousRowData\n        }\n      }\n      resource.data = resource.transform(resource.originalData)\n    }\n  }\n}\n\nexport function deleteRowInListResource(doctype, docname) {\n  let resources = resourcesByDocType[doctype] || []\n  for (let resource of resources) {\n    if (resource.originalData) {\n      resource.originalData = resource.originalData.filter(\n        (row) => row.name.toString() !== docname.toString(),\n      )\n      resource.data = resource.transform(resource.originalData)\n    }\n  }\n}\n\nexport function revertRowInListResource(doctype, doc) {\n  let resources = resourcesByDocType[doctype] || []\n  for (let resource of resources) {\n    if (resource.originalData) {\n      for (let row of resource.originalData) {\n        if (row.name && row.name == doc.name) {\n          let previousRowData = JSON.parse(row._previousData)\n          for (let key in row) {\n            row[key] = previousRowData[key]\n          }\n          delete row._previousData\n        }\n      }\n      resource.data = resource.transform(resource.originalData)\n    }\n  }\n}\n","import { reactive, watch } from 'vue'\nimport { getCacheKey, createResource } from './resources'\nimport {\n  updateRowInListResource,\n  deleteRowInListResource,\n  revertRowInListResource,\n} from './listResource'\nimport { getLocal, saveLocal, deleteLocal } from './local'\nimport { onDocUpdate } from './realtime'\nimport { getConfig } from '../utils/config'\n\nlet documentCache = reactive({})\n\nexport function createDocumentResource(options, vm) {\n  if (!(options.doctype && options.name)) return\n\n  let cacheKey = getCacheKey([options.doctype, options.name])\n  let cachedResource = documentCache[cacheKey]\n  if (cachedResource) {\n    if (cachedResource.auto) {\n      cachedResource.reload()\n    }\n    return cachedResource\n  }\n\n  let defaultDocGetUrl = getConfig('defaultDocGetUrl') || 'frappe.client.get'\n  let defaultDocUpdateUrl =\n    getConfig('defaultDocUpdateUrl') || 'frappe.client.set_value'\n  let defaultDocDeleteUrl =\n    getConfig('defaultDocDeleteUrl') || 'frappe.client.delete'\n  let defaultRunDocMethodUrl =\n    getConfig('defaultRunDocMethodUrl') || 'run_doc_method'\n\n  let setValueOptions = {\n    url: defaultDocUpdateUrl,\n    makeParams(values) {\n      return {\n        doctype: out.doctype,\n        name: out.name,\n        fieldname: values,\n      }\n    },\n    validate(data) {\n      options.setValue?.validate?.call(vm, data)\n    },\n    beforeSubmit(params) {\n      out.previousDoc = JSON.stringify(out.doc)\n      Object.assign(out.doc, params.fieldname || {})\n      // update data in list resources\n      updateRowInListResource(out.doctype, out.doc)\n    },\n    onSuccess(data) {\n      out.doc = transform(data)\n      out.originalDoc = JSON.parse(JSON.stringify(out.doc))\n      options.setValue?.onSuccess?.call(vm, data)\n    },\n    onError(error) {\n      out.doc = JSON.parse(out.previousDoc)\n      options.setValue?.onError?.call(vm, error)\n      // revert data in list resource\n      revertRowInListResource(out.doctype, out.doc)\n    },\n  }\n\n  const autoPropIsPassed = options.auto !== undefined\n\n  let out = reactive({\n    doctype: options.doctype,\n    name: options.name,\n    doc: null,\n    originalDoc: null,\n    isDirty: false,\n    auto: autoPropIsPassed ? options.auto : true,\n    get: createResource(\n      {\n        url: defaultDocGetUrl,\n        makeParams() {\n          return {\n            doctype: out.doctype,\n            name: out.name,\n          }\n        },\n        onSuccess(data) {\n          saveLocal(cacheKey, data)\n          out.doc = transform(data)\n          out.originalDoc = JSON.parse(JSON.stringify(out.doc))\n          options.onSuccess?.call(vm, out.doc)\n        },\n        onError(error) {\n          deleteLocal(cacheKey)\n          out.doc = null\n          out.originalDoc = null\n          options.onError?.call(vm, error)\n        },\n      },\n      vm,\n    ),\n    setValue: createResource(setValueOptions, vm),\n    setValueDebounced: createResource(\n      {\n        ...setValueOptions,\n        debounce: options.debounce || 500,\n      },\n      vm,\n    ),\n    save: createResource(\n      {\n        ...setValueOptions,\n        makeParams() {\n          let values = JSON.parse(JSON.stringify(out.doc))\n          delete values.doctype\n          delete values.name\n          return {\n            doctype: out.doctype,\n            name: out.name,\n            fieldname: values,\n          }\n        },\n      },\n      vm,\n    ),\n    delete: createResource(\n      {\n        url: defaultDocDeleteUrl,\n        makeParams() {\n          return {\n            doctype: out.doctype,\n            name: out.name,\n          }\n        },\n        onSuccess() {\n          out.doc = null\n          options.delete?.onSuccess?.call(vm)\n          // delete from list resources\n          deleteRowInListResource(out.doctype, out.name)\n        },\n        onError: options.delete?.onError,\n      },\n      vm,\n    ),\n    reload,\n    setDoc,\n  })\n\n  // keep track of isDirty as doc changes\n  watch(\n    () => out.doc,\n    () => {\n      out.isDirty = JSON.stringify(out.doc) !== JSON.stringify(out.originalDoc)\n    },\n    {\n      deep: true,\n    },\n  )\n\n  for (let methodKey in options.whitelistedMethods) {\n    let methodOptions = options.whitelistedMethods[methodKey]\n    if (typeof methodOptions == 'string') {\n      methodOptions = {\n        method: methodOptions,\n      }\n    }\n\n    let {\n      method,\n      onSuccess,\n      makeParams,\n      transform: _transform,\n      ...otherOptions\n    } = methodOptions\n\n    out[methodKey] = createResource(\n      {\n        url: defaultRunDocMethodUrl,\n        makeParams(values) {\n          values = makeParams ? makeParams.call(vm, values) : values\n          return {\n            dt: out.doctype,\n            dn: out.name,\n            method: method,\n            args: values,\n          }\n        },\n        transform(data) {\n          if (_transform) {\n            let returnValue = _transform.call(vm, data.message)\n            if (returnValue != null) {\n              return returnValue\n            }\n          }\n          return data.message\n        },\n        onSuccess(data) {\n          if (data.docs) {\n            for (let doc of data.docs) {\n              if (\n                doc.doctype === out.doctype &&\n                doc.name.toString() === out.name.toString()\n              ) {\n                out.doc = transform(doc)\n                // update data in list resources\n                updateRowInListResource(out.doctype, out.doc)\n                break\n              }\n            }\n          }\n          onSuccess?.call(vm, data.message)\n        },\n        ...otherOptions,\n      },\n      vm,\n    )\n  }\n\n  function reload() {\n    return out.get.fetch()\n  }\n\n  function setDoc(doc) {\n    if (typeof doc === 'function') {\n      doc = doc.call(vm, out.doc)\n    }\n    out.doc = transform(doc)\n  }\n\n  function transform(doc) {\n    if (options.transform) {\n      let returnValue = options.transform.call(vm, doc)\n      if (typeof returnValue === 'object') {\n        return returnValue\n      }\n    }\n    return doc\n  }\n\n  if (options.realtime && vm.$socket) {\n    onDocUpdate(vm.$socket, out.doctype, (name) => {\n      if (name == out.name) {\n        out.get.fetch()\n      }\n    })\n  }\n\n  // cache\n  documentCache[cacheKey] = out\n  // offline\n  getLocal(cacheKey).then((data) => {\n    if ((out.get.loading || !out.get.fetched) && data) {\n      out.doc = transform(data)\n    }\n  })\n\n  if (out.auto) {\n    out.get.fetch()\n  }\n\n  return out\n}\n\nexport function getCachedDocumentResource(doctype, name) {\n  let cacheKey = getCacheKey([doctype, name])\n  return documentCache[cacheKey] || null\n}\n","import { reactive, watch } from 'vue'\nimport { createResource, getCachedResource } from './resources'\nimport {\n  createDocumentResource,\n  getCachedDocumentResource,\n} from './documentResource'\nimport { createListResource, getCachedListResource } from './listResource'\n\nlet createMixin = (mixinOptions) => ({\n  created() {\n    if (this.$options.resources) {\n      this._resources = reactive({})\n      for (let key in this.$options.resources) {\n        let options = this.$options.resources[key]\n\n        if (typeof options == 'function') {\n          watch(\n            () => {\n              let out = null\n              try {\n                out = options.call(this)\n              } catch (error) {\n                console.warn('Failed to get resource options\\n\\n', error)\n                out = null\n              }\n              return out\n            },\n            (options, oldOptions) => {\n              if (!options) {\n                return\n              }\n\n              let changed =\n                !oldOptions ||\n                JSON.stringify(options) !== JSON.stringify(oldOptions)\n\n              if (!changed) return\n              this._resources[key] = createResourceForOptions(options, this)\n            },\n            {\n              immediate: true,\n              deep: true,\n            },\n          )\n        } else {\n          let resource = createResourceForOptions(options, this)\n          this._resources[key] = resource\n        }\n      }\n    }\n  },\n  methods: {\n    $getResource(cacheKey) {\n      return getCachedResource(cacheKey)\n    },\n    $getDocumentResource(doctype, name) {\n      return getCachedDocumentResource(doctype, name)\n    },\n    $getDoc(doctype, name) {\n      let resource = this.$getDocumentResource(doctype, name)\n      return resource ? resource.doc : null\n    },\n    $getListResource(cacheKey) {\n      return getCachedListResource(cacheKey)\n    },\n    $refetchResource(cache) {\n      let resource = this.$getResource(cache)\n      resource && resource.fetch()\n    },\n  },\n  computed: {\n    $resources() {\n      return this._resources\n    },\n  },\n})\n\nfunction createResourceForOptions(options, vm) {\n  if (options.type === 'document') {\n    return createDocumentResource(options, vm)\n  }\n  if (options.type === 'list') {\n    return createListResource(options, vm)\n  }\n  return createResource(options, vm)\n}\n\nexport default {\n  install(app, options) {\n    let resourceMixin = createMixin(options)\n    app.mixin(resourceMixin)\n  },\n}\n","import { getConfig } from './config'\nimport { request } from './request'\n\nexport function frappeRequest(options) {\n  return request({\n    ...options,\n    transformRequest: (options = {}) => {\n      if (!options.url) {\n        throw new Error('[frappeRequest] options.url is required')\n      }\n      let headers = Object.assign(\n        {\n          Accept: 'application/json',\n          'Content-Type': 'application/json; charset=utf-8',\n          'X-Frappe-Site-Name': window.location.hostname,\n        },\n        options.headers || {},\n      )\n      if (window.csrf_token && window.csrf_token !== '{{ csrf_token }}') {\n        headers['X-Frappe-CSRF-Token'] = window.csrf_token\n      }\n      if (!options.url.startsWith('/') && !options.url.startsWith('http')) {\n        options.url = '/api/method/' + options.url\n      }\n      return {\n        ...options,\n        method: options.method || 'POST',\n        headers,\n      }\n    },\n    transformResponse: async (response, options) => {\n      let url = options.url\n      if (response.ok) {\n        const data = await response.json()\n        if (data.docs || url === '/api/method/login') {\n          return data\n        }\n        if (data.exc) {\n          try {\n            console.groupCollapsed(url)\n            console.log(options)\n            let warning = JSON.parse(data.exc)\n            for (let text of warning) {\n              console.log(text)\n            }\n            console.groupEnd()\n          } catch (e) {\n            console.warn('Error printing debug messages', e)\n          }\n        }\n\n        if (data._server_messages) {\n          let onMessageHandler =\n            getConfig('serverMessagesHandler') || options.onServerMessages || null\n          if (onMessageHandler) {\n            onMessageHandler(JSON.parse(data?._server_messages) || [])\n          }\n        }\n\n        return data.message\n      } else {\n        let errorResponse = await response.text()\n        let error, exception\n        try {\n          error = JSON.parse(errorResponse)\n          // eslint-disable-next-line no-empty\n        } catch (e) {}\n        let errorParts = [\n          [options.url, error?.exc_type, error?._error_message]\n            .filter(Boolean)\n            .join(' '),\n        ]\n        if (error.exc) {\n          exception = error.exc\n          try {\n            exception = JSON.parse(exception)[0]\n            console.log(exception)\n            // eslint-disable-next-line no-empty\n          } catch (e) {}\n        }\n        let e = new Error(errorParts.join('\\n'))\n        e.exc_type = error.exc_type\n        e.exc = exception\n        e.response = response\n        e.status = errorResponse.status\n        e.messages = error._server_messages\n          ? JSON.parse(error._server_messages)\n          : []\n        e.messages = e.messages.concat(error.message)\n        e.messages = e.messages.map((m) => {\n          try {\n            return JSON.parse(m).message\n          } catch (error) {\n            return m\n          }\n        })\n        e.messages = e.messages.filter(Boolean)\n        if (!e.messages.length) {\n          e.messages = error._error_message\n            ? [error._error_message]\n            : ['Internal Server Error']\n        }\n        options.onError && options.onError(e)\n        throw e\n      }\n    },\n    transformError: (error) => {\n      options.onError && options.onError(error)\n      throw error\n    },\n  })\n}\n","import { get, set, del, setMany, keys } from 'idb-keyval'\n\nexport class IDBStore {\n  private memoryStore: Record<string, string> = {}\n  private useIndexedDB: boolean\n\n  constructor() {\n    this.useIndexedDB = typeof window !== 'undefined' && !!window.indexedDB\n  }\n\n  set(key: string, data: unknown): Promise<void | null> {\n    if (!this.validateKey(key)) {\n      return Promise.resolve(null)\n    }\n\n    try {\n      if (this.useIndexedDB) {\n        return set(key, JSON.stringify(data))\n      }\n      this.memoryStore[key] = JSON.stringify(data)\n      return Promise.resolve()\n    } catch (error) {\n      return this.handleError(error, 'save to')\n    }\n  }\n\n  setMany(data: Record<string, unknown>): Promise<void | null> {\n    try {\n      if (this.useIndexedDB) {\n        let entries: [IDBValidKey, any][] = []\n        for (const [key, value] of Object.entries(data)) {\n          entries.push([key, JSON.stringify(value)])\n        }\n        return setMany(entries)\n      }\n      for (const [key, value] of Object.entries(data)) {\n        this.memoryStore[key] = JSON.stringify(value)\n      }\n      return Promise.resolve()\n    } catch (error) {\n      return this.handleError(error, 'save to')\n    }\n  }\n\n  delete(key: string): Promise<void | null> {\n    if (!this.validateKey(key)) {\n      return Promise.resolve(null)\n    }\n\n    try {\n      if (this.useIndexedDB) {\n        return del(key)\n      }\n      delete this.memoryStore[key]\n      return Promise.resolve()\n    } catch (error) {\n      return this.handleError(error, 'delete from')\n    }\n  }\n\n  get(key: string): Promise<unknown | null> {\n    if (!this.validateKey(key)) {\n      return Promise.resolve(null)\n    }\n\n    if (this.useIndexedDB) {\n      return get(key).then((val) => {\n        if (!val) return null\n        try {\n          return JSON.parse(val)\n        } catch (error) {\n          return this.handleError(error, 'parse data from')\n        }\n      })\n    }\n\n    try {\n      const val = this.memoryStore[key]\n      return Promise.resolve(val ? JSON.parse(val) : null)\n    } catch (error) {\n      return this.handleError(error, 'parse data from')\n    }\n  }\n\n  async keys(): Promise<string[]> {\n    try {\n      if (this.useIndexedDB) {\n        return keys() as Promise<string[]>\n      }\n      return Promise.resolve(Object.keys(this.memoryStore))\n    } catch (error) {\n      console.error(\n        `Failed to get keys from ${this.useIndexedDB ? 'IndexedDB' : 'memory store'}:`,\n        error,\n      )\n      return Promise.resolve([])\n    }\n  }\n\n  private validateKey(key: string): boolean {\n    return !!key\n  }\n\n  private handleError(error: unknown, operation: string): Promise<null> {\n    console.error(\n      `Failed to ${operation} ${this.useIndexedDB ? 'IndexedDB' : 'memory store'}:`,\n      error,\n    )\n    return Promise.resolve(null)\n  }\n}\n\nexport let idbStore = new IDBStore()\n","import { Ref, ref, MaybeRefOrGetter, toValue } from 'vue'\nimport { idbStore } from './idbStore'\n\ntype Doc = {\n  doctype: string\n  name: string\n  [key: string]: any\n}\n\ntype DocKey = `${string}/${string}`\n\nclass DocStore {\n  private docs: Map<DocKey, Ref<Doc | null>>\n  private lastFetched: Map<DocKey, number>\n  private cacheTimeout: number = 5 * 60 * 1000 // 5 minutes\n  private storePrefix = 'doc:'\n\n  constructor() {\n    this.docs = new Map<DocKey, Ref<Doc | null>>()\n    this.lastFetched = new Map()\n  }\n\n  setCacheTimeout(minutes: number) {\n    if (minutes < 1) {\n      throw new Error('Cache timeout must be at least 1 minute')\n    }\n    this.cacheTimeout = minutes * 60 * 1000\n  }\n\n  async setDoc(doc: Doc) {\n    if (!doc?.doctype || !doc?.name) {\n      throw new Error('Invalid doc: must have doctype and name')\n    }\n    doc.name = doc.name.toString()\n    const key = this.getKey(doc.doctype, doc.name)\n    try {\n      await idbStore.set(this.storePrefix + key, doc)\n      if (!this.docs.has(key)) {\n        this.docs.set(key, ref(null))\n      }\n      const docRef = this.docs.get(key)\n      if (docRef) {\n        docRef.value = doc\n      }\n      this.lastFetched.set(key, Date.now())\n    } catch (error) {\n      console.error('Failed to set doc in IDB:', error)\n      throw error\n    }\n  }\n\n  getDoc(doctype: string, name: MaybeRefOrGetter<string>): Ref<Doc | null> {\n    const nameStr = toValue(name)\n    if (!doctype || !nameStr) {\n      throw new Error('doctype and name are required')\n    }\n    const key = this.getKey(doctype, nameStr)\n\n    if (!this.docs.has(key)) {\n      this.docs.set(key, ref(null))\n      this.loadDoc(key, true)\n    } else if (this.isStale(key)) {\n      this.loadDoc(key, false)\n    }\n\n    return this.docs.get(key)!\n  }\n\n  private async loadDoc(key: DocKey, isFirstLoad: boolean) {\n    try {\n      if (!isFirstLoad && this.isStale(key)) {\n        await this.cleanup(key)\n      }\n\n      const idbDoc = (await idbStore.get(this.storePrefix + key)) as Doc | null\n      if (idbDoc) {\n        const docRef = this.docs.get(key)\n        if (docRef) {\n          docRef.value = idbDoc\n        }\n        this.lastFetched.set(key, Date.now())\n      }\n    } catch (error) {\n      console.error('Failed to load doc from IDB:', error)\n      throw error\n    }\n  }\n\n  async setDocs(docs: Doc[]) {\n    const docMap: Record<string, Doc> = {}\n    for (const doc of docs) {\n      if (!doc?.doctype || !doc?.name) continue\n      doc.name = doc.name.toString()\n      const key = this.getKey(doc.doctype, doc.name)\n      if (!this.docs.has(key)) {\n        this.docs.set(key, ref(null))\n      }\n      const docRef = this.docs.get(key)\n      if (docRef) {\n        docRef.value = doc\n      }\n      this.lastFetched.set(key, Date.now())\n      docMap[this.storePrefix + key] = doc\n    }\n    await idbStore.setMany(docMap)\n  }\n\n  async invalidateDoc(doctype: string, name: string) {\n    if (!doctype || !name) return\n    const key = this.getKey(doctype, name)\n    await this.cleanup(key)\n  }\n\n  removeDoc(doctype: string, name: string) {\n    return this.invalidateDoc(doctype, name)\n  }\n\n  private getKey(doctype: string, name: string): DocKey {\n    return `${doctype.trim()}/${name.trim()}` as DocKey\n  }\n\n  private isStale(key: DocKey): boolean {\n    const fetchTime = this.lastFetched.get(key)\n    if (!fetchTime) return true\n    return Date.now() - fetchTime > this.cacheTimeout\n  }\n\n  private async cleanup(key: DocKey) {\n    this.docs.delete(key)\n    this.lastFetched.delete(key)\n    await idbStore.delete(this.storePrefix + key)\n  }\n\n  async clearAll() {\n    try {\n      const allKeys = await idbStore.keys()\n      const docKeys = allKeys.filter((key: string) =>\n        key.startsWith(this.storePrefix),\n      )\n      await Promise.all(docKeys.map((key: string) => idbStore.delete(key)))\n      this.docs.clear()\n      this.lastFetched.clear()\n    } catch (error) {\n      console.error('Failed to clear all docs:', error)\n      throw error\n    }\n  }\n}\n\nexport const docStore = new DocStore()\n","export interface ListInstanceMethods {\n  updateRow: (doc: Partial<{ name: string }> & Record<string, unknown>) => void\n  removeRow: (name: string) => void\n}\n\ninterface Doc {\n  name: string\n  [key: string]: any\n}\n\nclass ListStore {\n  byDocType: { [key: string]: Array<ListInstanceMethods> }\n\n  constructor() {\n    this.byDocType = {}\n  }\n\n  addList(doctype: string, list: ListInstanceMethods) {\n    this.ensureList(doctype)\n    this.byDocType[doctype].push(list)\n  }\n\n  updateRows(docs: Array<Doc>) {\n    for (let doc of docs) {\n      this.updateRow(doc.doctype, doc)\n    }\n  }\n\n  updateRow(doctype: string, doc: Doc) {\n    this.ensureList(doctype)\n    this.byDocType[doctype].forEach((list) => {\n      list.updateRow(doc)\n    })\n  }\n\n  removeRow(doctype: string, name: string) {\n    this.ensureList(doctype)\n    this.byDocType[doctype].forEach((list) => {\n      list.removeRow(name)\n    })\n  }\n\n  ensureList(docType: string) {\n    if (!this.byDocType[docType]) {\n      this.byDocType[docType] = []\n    }\n  }\n}\n\nexport const listStore = new ListStore()\n","import { createFetch } from '@vueuse/core'\nimport { docStore } from './docStore'\nimport { listStore } from './useList/listStore'\n\nexport class FrappeResponseError extends Error {\n  title: string\n  type: string\n  exception?: string\n  indicator?: string\n\n  constructor(\n    message: string,\n    options: {\n      title: string\n      type: string\n      exception?: string\n      indicator?: string\n    },\n  ) {\n    super(message)\n    this.name = 'FrappeResponseError'\n    this.title = options.title\n    this.type = options.type\n    this.exception = options.exception\n    this.indicator = options.indicator\n\n    // Maintains proper stack trace for where our error was thrown (only available on V8)\n    if (Error.captureStackTrace) {\n      Error.captureStackTrace(this, FrappeResponseError)\n    }\n  }\n}\n\nexport const useFrappeFetch = createFetch({\n  options: {\n    fetch: (...args) => fetch(...args), // required for vitest\n    beforeFetch({ options }) {\n      options.headers = setHeaders(options.headers || {})\n      return { options }\n    },\n    afterFetch(ctx) {\n      let responseData = JSON.parse(ctx.data)\n      ctx.data = responseData\n      if (responseData.debug) {\n        let path = ctx.response.url.replace(window.location.origin, '')\n        console.group(path)\n        for (let d of responseData.debug) {\n          console.log(d?.message)\n        }\n        console.groupEnd()\n      }\n      if (responseData.docs) {\n        let docs = responseData.docs\n        for (let doc of docs) {\n          doc.name = doc.name.toString()\n        }\n        docStore.setDocs(docs)\n        listStore.updateRows(docs)\n      }\n      return ctx\n    },\n    onFetchError(ctx) {\n      if (ctx.response?.ok && ctx.error) {\n        // if response is ok and there is an error, it's a client side programming error\n        console.error(\n          'Fetch request succeeded but there was a programming error:\\n\\n',\n          ctx.error,\n        )\n        return ctx\n      }\n\n      type FrappeError = {\n        title: string\n        message: string\n        exception?: string\n        type: string\n        indicator: string\n      }\n      try {\n        let errorResponse = JSON.parse(ctx.data)\n        let errors: Array<FrappeError> = errorResponse.errors\n        let error = errors[0] // assuming only one error for now\n        let errorDescription = error.message\n          ? `: ${error.message}`\n          : error.exception\n            ? ` (Traceback)`\n            : ''\n        let frappeError = new FrappeResponseError(\n          `${error.type}${errorDescription}`,\n          {\n            title: error.title,\n            type: error.type,\n            exception: error.exception,\n            indicator: error.indicator,\n          },\n        )\n\n        if (import.meta.env.DEV && error.exception) {\n          console.log(error.exception)\n        }\n\n        ctx.error = frappeError\n        return ctx\n      } catch (e) {\n        console.log('Error parsing error response:', e)\n        return ctx\n      }\n    },\n  },\n})\n\nfunction setHeaders(headers: HeadersInit) {\n  // handle case where this could run in node environment (vitest)\n  let siteName = null\n  let csrfToken = null\n  if (typeof window !== 'undefined') {\n    siteName = window.location.hostname\n    csrfToken =\n      window.csrf_token !== '{{ csrf_token }}' ? window.csrf_token : null\n  }\n\n  const defaultHeaders: Record<string, string> = {\n    Accept: 'application/json',\n    'Content-Type': 'application/json; charset=utf-8',\n  }\n  if (siteName) {\n    defaultHeaders['X-Frappe-Site-Name'] = siteName\n  }\n  if (csrfToken) {\n    defaultHeaders['X-Frappe-CSRF-Token'] = csrfToken\n  }\n\n  return { ...headers, ...defaultHeaders }\n}\n"],"names":["props","__props","classes","computed","_openBlock","_createElementBlock","_hoisted_1","_createElementVNode","_normalizeClass","_hoisted_2","_hoisted_3","_hoisted_4","_toDisplayString","_hoisted_5","_renderSlot","_ctx","_hoisted_6","emit","__emit","__expose","open","close","_isOpen","ref","pointerOverTargetOrPopup","hoverTimer","leaveTimer","anchorRef","isOpen","isShowPropPassed","value","placementSide","side","placementAlign","align","togglePopover","flag","updatePosition","onUpdateOpen","onMouseover","onMouseleave","onInteractOutside","event","target","hasTransition","onUnmounted","_createBlock","_unref","PopoverRoot","$event","_createVNode","PopoverAnchor","$attrs","_normalizeProps","_guardReactiveProps","PopoverPortal","PopoverContent","_normalizeStyle","_cache","validIcons","feather","_sfc_main","valid","icon","h","mergeProps","delayDuration","TooltipProvider","TooltipRoot","TooltipTrigger","TooltipPortal","$slots","TooltipContent","_createTextVNode","TooltipArrow","slots","useSlots","router","useRouter","buttonClasses","solidClasses","subtleClasses","outlineClasses","ghostClasses","focusClasses","variantClasses","themeVariant","disabledClasses","sizeClasses","isIconButton","isDisabled","slotClasses","ariaLabel","hasLucideIconInDefaultSlot","slotContent","firstVNode","_a","_c","_b","handleClick","rootRef","Tooltip","_mergeProps","LoadingIndicator","FeatherIcon","_resolveDynamicComponent","_Fragment","searchInput","showOptions","query","groups","isOptionGroup","sanitizeOptions","group","i","filterOptions","allOptions","options","option","isOption","selectedValue","findOption","makeOption","values","v","val","o","getLabel","displayValue","isOptionSelected","areAllOptionsSelected","selectAll","clearAll","watch","nextTick","Combobox","_withCtx","isComboboxOpen","Popover","openPopover","closePopover","ComboboxOptions","_hoisted_7","_hoisted_8","ComboboxInput","_hoisted_9","_renderList","_hoisted_10","idx","ComboboxOption","active","selected","_hoisted_11","_hoisted_12","_hoisted_13","_hoisted_14","_hoisted_15","_hoisted_16","_hoisted_17","_hoisted_18","_hoisted_19","Button","_hoisted_20","id","generateId","useId","_component_LoadingIndicator","$props","LoadingText","_component_LoadingText","attrs","useAttrs","htmlId","labelClasses","inputClasses","baseClasses","interactionClasses","e","$emit","debounce","func","wait","immediate","timeout","context","args","later","attrsWithoutClassStyle","key","inputRef","textColor","paddingClasses","variant","prefixClasses","suffixClasses","emitChange","handleChange","config","setConfig","getConfig","_dayjs","updateLocale","relativeTime","localizedFormat","isToday","duration","utc","timezone","advancedFormat","customParseFormat","actions","action","_action","reactive","__spreadProps","__spreadValues","__async","backwardsCompatibleContext","handleOpenChange","dialogPositionClasses","position","dialogIconBgClasses","appearance","dialogIconClasses","DialogRoot","DialogPortal","DialogOverlay","DialogContent","DialogTitle","DialogClose","LucideX","DialogDescription","Dialog","DialogMain","errorMessage","selectOptions","fontSizeClasses","selectClasses","textareaRef","__default__","controlAttrs","_attrs","descriptionClasses","FormLabel","_createSlots","itemPrefixProps","isValid","$input","onInput","$options","_component_FeatherIcon","imageRef","containerRef","isResizing","startDragX","startWidth","originalAspectRatio","selectImage","caption","isEditable","onMounted","initialWidth","initialHeight","updateCaption","newCaption","handleKeydown","createParagraphAfterImage","setCursorAfterImage","setCursorBeforeImage","setCursorAt","pos","startResize","width","height","handleResize","stopResize","editorWidth","deltaX","newWidth","newHeight","finalWidth","finalHeight","setAlignment","NodeViewWrapper","node","LucideAlignLeft","LucideAlignCenter","LucideAlignRight","LucideMoveDiagonal2","ErrorMessage","inputRegex","NodeExtension","element","attributes","HTMLAttributes","mergeAttributes","VueNodeViewRenderer","ImageNodeView","commands","editor","result","findImageNodeBySource","updateNodeWithDimensions","file","uploadImage","input","nodeInputRule","match","alt","src","title","extensionThis","Plugin","view","images","coordinates","transaction","Selection","processMultipleImages","clipboardItems","item","transactions","oldState","newState","newImageNodes","tr","findInsertPosition","lastNodeId","insertPos","uploadImageBase","insertMode","onComplete","moveCursor","uploadId","fileToBase64","base64Result","nodeSize","nodePos","n","posAfter","uploadedImage","getImageDimensions","dimensions","error","uploadImageWithTracking","callback","currentAttrs","resolve","reject","img","imageQueue","lastInsertedNodeId","processNextImage","currentPos","newNodeId","useTouchHandler","targetRef","zoomLevel","onSwipeLeft","onSwipeRight","onDoubleTap","onTap","onPanStart","onPanMove","onPanAnimate","onPanEnd","onPinchStart","onPinchMove","onPinchEnd","doubleTapDelay","minSwipeDistance","maxVerticalSwipeDistance","maxTapDuration","maxTapMovement","panThreshold","inertiaDamping","inertiaVelocityThreshold","isPanning","isPinching","isAnimatingPan","startPanCoords","lastTapTime","touchStartTime","touchStartDistance","initialTouchPoints","lastMoveTime","lastMoveCoords","panVelocity","animationFrameId","cancelInertiaAnimation","handleTouchStart","currentTime","timeSinceLastTap","touch","touch1","touch2","handleTouchMove","deltaTime","currentDistance","scale","currentX","currentY","rawDeltaX","rawDeltaY","deltaXFromStart","deltaYFromStart","zoomFactor","panDeltaX","panDeltaY","handleTouchEnd","touchesLeft","touchEndTime","wasPanning","wasPinching","finalVelocity","lastFrameTime","animVelocity","animate","frameDeltaTime","moveX","moveY","dampingFactor","endCoords","deltaY","newTarget","oldTarget","readonly","useImageNavigation","initialIndex","imageCount","onNavigate","currentIndex","newVal","nextImage","previousImage","useZoomPan","isEnabled","panPosition","isMousePanning","startMousePanCoords","initialPanPositionOnGestureStart","snapThresholdLower","snapThresholdUpper","newZoom","oldZoom","zoomIn","zoomOut","resetZoom","handlePanStart","handlePanMove","moveEvent","handlePanEnd","handleWheel","zoomChange","currentZoom","clampedZoom","container","INACTIVITY_TIMEOUT","imageContainer","useTemplateRef","backdropElement","controlsBar","controlsBarHeight","isFullscreen","touchStartZoom","isControlsVisible","inactivityTimer","toRef","currentImage","isTouchPanning","finalZoom","showControlsAndResetTimer","handleActivity","downloadImage","imageToDownload","link","filename","toggleFullscreen","handleFullscreenChange","handleKeyDown","newValue","updateHeight","resizeObserver","_Teleport","_Transition","_withModifiers","LucideChevronLeft","LucideChevronRight","LucideMinus","LucidePlus","LucideDownload","LucideMinimize","LucideMaximize","Extension","style","image","openImageViewerModal","extension","PluginKey","state","clickedNode","foundImageNode","domNode","app","createApp","ImageViewerModal","Node","uploadVideoInternal","div","video","videoPill","uploadedVideo","schema","ALLOWED_DOMAINS","PLATFORM_CONFIGS","detectPlatform","url","domain","pattern","calculateAspectRatio","platform","getOptimalDimensions","containerWidth","aspectInfo","maxWidth","validateURL","blocked","allowed","processURL","convertToYouTubeEmbed","convertToVimeoEmbed","convertToCodePenEmbed","convertToFigmaEmbed","urlObj","videoId","iframeRef","selectIframe","iframeStyles","createParagraphAfterIframe","setCursorAfterIframe","setCursorBeforeIframe","el","IframeNodeView","processedSrc","editorElement","optimalDimensions","processedUrl","slice","text","html","iframeData","parseIframeFromHTML","createIframeNode","iframe","iframeMatch","widthMatch","heightMatch","titleMatch","isValidUrl","_href","submitLink","TextInput","LucideCheck","linkPasteHandler","selection","empty","textContent","Link","from","to","doc","range","mark","shouldDelayPopover","$pos","markRange","getMarkRange","m","existingHref","selectionFrom","selectionTo","showPopover","openLinkEditor","href","chain","posAfterLink","charAfter","plugins","clearLinkOnBoundaryPlugin","anchor","virtualReference","rect","isCollapsed","tippyInstance","isDestroyed","promiseSettled","settlePromise","destroy","EditLink","newHref","tippy","storedMarks","$from","linkMarkType","textColorHexMap","highlightColorHexMap","legacyTextColorMap","legacyHighlightColorMap","getClosestNamedColor","color","allowedColors","colorMap","legacyMap","r","g","b","hex","rgbMatch","closestColor","minDistance","colorName","namedHex","namedHexClean","nr","ng","nb","distance","extractColorFromStyle","property","allColorsInMap","hexColorMatch","closestOverallColor","rgbColorMatch","extractTextColorFromStyle","extractHighlightColorFromStyle","colorMatch","extractedColor","commandChain","Mark","highlightMatch","legacyColorAttr","highlightAttributes","isCurrentlyActive","createSuggestionExtension","customOptions","component","popup","VueRenderer","defaultTippyOptions","Suggestion","selectedIndex","itemRefs","onBeforeUpdate","scrollIntoView","selectedElement","selectItem","index","onKeyDown","upHandler","downHandler","enterHandler","createMentionNode","dom","MentionSuggestionExtension","SuggestionList","_mentions","ext","toValue","mention","suggestionList","onItemSelect","EMOJIS","_EMOJIS","a","aName","bName","queryLower","EmojiList","SlashCommandSuggestionKey","getCommands","Heading2","Heading3","List","ListOrdered","ListTask","Code","Quote","Image","Video","GalleryVertical","Minus","Table","SlashCommandsList","markdownToHTML","marked","detectMarkdown","line","files","htmlContent","tempDiv","parsedSlice","DOMParser","TagNode","_tags","tags","filteredTags","tag","TiptapHeading","level","regexp","textblockTypeInputRule","modelValue","isFileDragging","draggedIndex","overIndex","columnsInitialized","editingCaption","captionEditValue","captionInputRef","uploading","columns","uploadProgress","uploadedCount","totalCount","uploadErrors","uploadResults","existingItems","createExistingImageItem","fileItems","createImageItem","getDefaultColumns","newExistingImages","newFiles","onDragOverWindow","onDrop","onDragLeaveWindow","handleSave","uploadFiles","fileToUploadMap","finalImages","handleUpload","uploadedImages","handleCancel","removeImage","triggerFileInput","fileInput","addFiles","newImageItems","existingFileSignatures","uniqueNewItems","droppedFiles","moved","existing","count","getUploadFunction","imageGroupExtension","filePreview","isImageSupported","unsupportedTypes","unsupportedExtensions","hasUnsupportedType","hasUnsupportedExtension","onDragOver","onDragStart","onDragEnd","onDragLeave","isDropTarget","gridStyle","internalColumns","startEditingCaption","itemId","currentAlt","saveCaption","itemIndex","type","indexStr","cancelEditingCaption","handleCaptionBlur","uploadFunction","uploadPromises","err","LucideImagePlus","Select","_d","_hoisted_21","_hoisted_22","_hoisted_23","showViewer","viewerIndex","viewerImages","showEditModal","editFiles","existingImages","updateEditable","edit","handleEditModalClose","handleEditSave","data","newContent","newAttrs","newNode","openViewer","newImages","LucideEdit","ImageGroupUploadDialog","ImageGroupNodeView","call","_0","_1","method","headers","path","res","warning","response","exception","errorParts","reader","faviconRef","defaultFavIcon","initializeFavicon","usePageMeta","fn","stopWatcher","pageMeta","getCurrentInstance","onBeforeUnmount","pageMetaPlugin","createMixin","request","_options","body","params","saveLocal","set","deleteLocal","del","getLocal","get","cached","createResource","vm","cacheKey","getCacheKey","cachedResource","fetchFunction","fetch","out","reset","update","setData","tempOptions","resourceFetcher","beforeSubmitFunctions","validateFunction","errorFunctions","successFunctions","dataFunctions","invalidMessage","handleError","transform","auto","errorHandler","returnValue","getCachedResource","onDocUpdate","socket","doctype","subscribe","subscribed","listCache","resourcesByDocType","createListResource","defaultListUrl","defaultDocInsertUrl","defaultDocUpdateUrl","defaultDocDeleteUrl","defaultRunDocMethodUrl","previous","next","pagedData","name","updateRowInListResource","__objRest","_e","_f","_g","reload","getRow","updatedOptions","_start","_pageLength","row","d","getCachedListResource","resources","resource","previousRowData","deleteRowInListResource","docname","revertRowInListResource","documentCache","createDocumentResource","defaultDocGetUrl","setValueOptions","autoPropIsPassed","setDoc","methodKey","methodOptions","onSuccess","makeParams","_transform","otherOptions","getCachedDocumentResource","mixinOptions","oldOptions","createResourceForOptions","cache","resourcesPlugin","resourceMixin","frappeRequest","onMessageHandler","errorResponse","IDBStore","entries","setMany","keys","operation","idbStore","DocStore","minutes","docRef","nameStr","isFirstLoad","idbDoc","docs","docMap","fetchTime","docKeys","docStore","ListStore","list","docType","listStore","FrappeResponseError","message","createFetch","setHeaders","ctx","responseData","errorDescription","frappeError","siteName","csrfToken","defaultHeaders"],"mappings":"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","x_google_ignoreList":[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73]}