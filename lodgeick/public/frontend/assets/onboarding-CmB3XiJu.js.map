{"version":3,"file":"onboarding-CmB3XiJu.js","sources":["../../../../frontend/src/stores/onboarding.js"],"sourcesContent":["import { defineStore } from 'pinia'\r\nimport { ref, computed } from 'vue'\r\nimport { call } from 'frappe-ui'\r\n\r\nexport const useOnboardingStore = defineStore('onboarding', () => {\r\n  // Load persisted state from localStorage\r\n  const loadPersistedState = () => {\r\n    try {\r\n      const saved = localStorage.getItem('lodgeick_onboarding')\r\n      if (saved) {\r\n        return JSON.parse(saved)\r\n      }\r\n    } catch (e) {\r\n      console.error('Failed to load persisted onboarding state:', e)\r\n    }\r\n    return {\r\n      currentStep: 1,\r\n      connectedApps: [],\r\n      selectedIntegrations: [],\r\n      fieldMappings: {}\r\n    }\r\n  }\r\n\r\n  const persisted = loadPersistedState()\r\n\r\n  // State\r\n  const currentStep = ref(persisted.currentStep || 1)\r\n  const totalSteps = ref(2) // Simplified: 1. Select Apps, 2. Connect Apps\r\n  const isCompleted = ref(false)\r\n  const connectedApps = ref(persisted.connectedApps || [])\r\n  const selectedIntegrations = ref(persisted.selectedIntegrations || [])\r\n  const fieldMappings = ref(persisted.fieldMappings || {})\r\n  const isLoadingApps = ref(false)\r\n\r\n  // Available apps for integration (loaded from backend)\r\n  const availableApps = ref([])\r\n\r\n  // Persist state to localStorage whenever it changes\r\n  const persistState = () => {\r\n    try {\r\n      localStorage.setItem('lodgeick_onboarding', JSON.stringify({\r\n        currentStep: currentStep.value,\r\n        connectedApps: connectedApps.value,\r\n        selectedIntegrations: selectedIntegrations.value,\r\n        fieldMappings: fieldMappings.value\r\n      }))\r\n    } catch (e) {\r\n      console.error('Failed to persist onboarding state:', e)\r\n    }\r\n  }\r\n\r\n  // Computed\r\n  const progress = computed(() => (currentStep.value / totalSteps.value) * 100)\r\n  const canContinue = computed(() => {\r\n    switch (currentStep.value) {\r\n      case 1: // Select Apps\r\n        return connectedApps.value.length > 0\r\n      case 2: // Connect Apps (OAuth)\r\n        return true // Can proceed after connecting\r\n      default:\r\n        return false\r\n    }\r\n  })\r\n\r\n  const hasConnectedApps = computed(() => connectedApps.value.length > 0)\r\n\r\n  // Actions\r\n  async function loadApps() {\r\n    if (availableApps.value.length > 0) return // Already loaded\r\n\r\n    isLoadingApps.value = true\r\n    try {\r\n      const response = await call('lodgeick.api.catalog.get_app_catalog')\r\n\r\n      if (response.success && response.apps) {\r\n        availableApps.value = response.apps.map(app => ({\r\n          id: app.app_name,\r\n          name: app.display_name || app.app_name,\r\n          description: app.description,\r\n          icon: getAppIcon(app.app_name),\r\n          color: getAppColor(app.category),\r\n          logo_url: app.logo_url,\r\n          category: app.category,\r\n          oauth_provider: app.oauth_provider,\r\n          // Restore connected state from persisted connectedApps array\r\n          isConnected: connectedApps.value.includes(app.app_name),\r\n          use_cases: app.use_cases || []\r\n        }))\r\n      }\r\n    } catch (error) {\r\n      console.error('Failed to load apps:', error)\r\n      console.error('Error details:', error)\r\n    } finally {\r\n      isLoadingApps.value = false\r\n    }\r\n  }\r\n\r\n  function getAppIcon(appName) {\r\n    const icons = {\r\n      'jira': 'üéØ',\r\n      'slack': 'üí¨',\r\n      'hubspot': 'üé®',\r\n      'google_sheets': 'üìä',\r\n      'salesforce': '‚òÅÔ∏è',\r\n      'mailchimp': '‚úâÔ∏è',\r\n      'xero': 'üíº',\r\n    }\r\n    return icons[appName] || 'üîå'\r\n  }\r\n\r\n  function getAppColor(category) {\r\n    const colors = {\r\n      'CRM': 'bg-orange-500',\r\n      'Communication': 'bg-purple-500',\r\n      'Productivity': 'bg-green-500',\r\n      'Finance': 'bg-blue-600',\r\n      'Marketing': 'bg-yellow-500',\r\n      'Project Management': 'bg-blue-500',\r\n    }\r\n    return colors[category] || 'bg-gray-500'\r\n  }\r\n\r\n  function setStep(step) {\r\n    currentStep.value = step\r\n    persistState()\r\n  }\r\n\r\n  function nextStep() {\r\n    if (currentStep.value < totalSteps.value) {\r\n      currentStep.value++\r\n      persistState()\r\n    }\r\n  }\r\n\r\n  function previousStep() {\r\n    if (currentStep.value > 1) {\r\n      currentStep.value--\r\n      persistState()\r\n    }\r\n  }\r\n\r\n  function connectApp(appId) {\r\n    const app = availableApps.value.find(a => a.id === appId)\r\n    if (app && !app.isConnected) {\r\n      app.isConnected = true\r\n      if (!connectedApps.value.includes(appId)) {\r\n        connectedApps.value.push(appId)\r\n      }\r\n      persistState()\r\n    }\r\n  }\r\n\r\n  function disconnectApp(appId) {\r\n    const app = availableApps.value.find(a => a.id === appId)\r\n    if (app) {\r\n      app.isConnected = false\r\n      connectedApps.value = connectedApps.value.filter(id => id !== appId)\r\n      selectedIntegrations.value = selectedIntegrations.value.filter(\r\n        integration => !integration.includes(appId)\r\n      )\r\n      persistState()\r\n    }\r\n  }\r\n\r\n  function addIntegration(fromApp, toApp) {\r\n    const integrationKey = `${fromApp}-${toApp}`\r\n    if (!selectedIntegrations.value.includes(integrationKey)) {\r\n      selectedIntegrations.value.push(integrationKey)\r\n      persistState()\r\n    }\r\n  }\r\n\r\n  function removeIntegration(integrationKey) {\r\n    selectedIntegrations.value = selectedIntegrations.value.filter(\r\n      key => key !== integrationKey\r\n    )\r\n    persistState()\r\n  }\r\n\r\n  function saveFieldMapping(integrationKey, mapping) {\r\n    fieldMappings.value[integrationKey] = mapping\r\n    persistState()\r\n  }\r\n\r\n  function completeOnboarding() {\r\n    isCompleted.value = true\r\n    // Clear persisted state when onboarding is complete\r\n    localStorage.removeItem('lodgeick_onboarding')\r\n    // Reset for next time if needed\r\n    currentStep.value = 1\r\n  }\r\n\r\n  function resetOnboarding() {\r\n    currentStep.value = 1\r\n    isCompleted.value = false\r\n    connectedApps.value = []\r\n    selectedIntegrations.value = []\r\n    fieldMappings.value = {}\r\n    availableApps.value.forEach(app => {\r\n      app.isConnected = false\r\n    })\r\n    // Clear persisted state\r\n    localStorage.removeItem('lodgeick_onboarding')\r\n  }\r\n\r\n  return {\r\n    // State\r\n    currentStep,\r\n    totalSteps,\r\n    isCompleted,\r\n    connectedApps,\r\n    selectedIntegrations,\r\n    fieldMappings,\r\n    availableApps,\r\n    isLoadingApps,\r\n\r\n    // Computed\r\n    progress,\r\n    canContinue,\r\n    hasConnectedApps,\r\n\r\n    // Actions\r\n    loadApps,\r\n    setStep,\r\n    nextStep,\r\n    previousStep,\r\n    connectApp,\r\n    disconnectApp,\r\n    addIntegration,\r\n    removeIntegration,\r\n    saveFieldMapping,\r\n    completeOnboarding,\r\n    resetOnboarding,\r\n  }\r\n})\r\n"],"names":["useOnboardingStore","defineStore","persisted","saved","currentStep","ref","totalSteps","isCompleted","connectedApps","selectedIntegrations","fieldMappings","isLoadingApps","availableApps","persistState","progress","computed","canContinue","hasConnectedApps","loadApps","__async","response","call","app","getAppIcon","getAppColor","error","appName","category","setStep","step","nextStep","previousStep","connectApp","appId","a","disconnectApp","id","integration","addIntegration","fromApp","toApp","integrationKey","removeIntegration","key","saveFieldMapping","mapping","completeOnboarding","resetOnboarding"],"mappings":"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"}